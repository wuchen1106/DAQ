<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ROOT Analyzer: analyzer.cxx Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>analyzer.cxx</h1><a href="a00049.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//</span>
<a name="l00002"></a>00002 <span class="comment">// ROOT analyzer</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// K.Olchanski</span>
<a name="l00005"></a>00005 <span class="comment">//</span>
<a name="l00006"></a>00006 <span class="comment">// $Id: analyzer.cxx 118 2012-12-14 07:19:24Z olchansk $</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="a00091.html">TMidasOnline.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;<a class="code" href="a00087.html">TMidasEvent.h</a>&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;<a class="code" href="a00089.html">TMidasFile.h</a>&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="a00113.html">XmlOdb.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifdef HAVE_MIDASSERVER</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#include &quot;midasServer.h&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#endif</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_LIBNETDIRECTORY</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="a00061.html">libNetDirectory/netDirectoryServer.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_XMLSERVER</span>
<a name="l00026"></a>00026 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="a00115.html">libXmlServer/xmlServer.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;TSystem.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;TROOT.h&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;TApplication.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;TTimer.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;TFile.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;TDirectory.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;TGClient.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;TGFrame.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;TFolder.h&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="a00053.html">Globals.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">// Global Variables</span>
<a name="l00042"></a><a class="code" href="a00053.html#a6cf028aba8f1557987171e864c6e92aa">00042</a> <span class="keywordtype">int</span>  <a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a> = 0;
<a name="l00043"></a><a class="code" href="a00053.html#a2a67d96e62cbb9dfae0655f222220cec">00043</a> <span class="keywordtype">bool</span> <a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a> = <span class="keyword">false</span>;
<a name="l00044"></a><a class="code" href="a00053.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">00044</a> <span class="keywordtype">bool</span> <a class="code" href="a00049.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">gIsPedestalsRun</a> = <span class="keyword">false</span>;
<a name="l00045"></a><a class="code" href="a00053.html#a9c47b919164f4d2be7fcf95761311698">00045</a> <span class="keywordtype">bool</span> <a class="code" href="a00049.html#a9c47b919164f4d2be7fcf95761311698">gIsOffline</a> = <span class="keyword">false</span>;
<a name="l00046"></a><a class="code" href="a00049.html#a23df21001564909dbffa60ba0f52ddbb">00046</a> <span class="keywordtype">int</span>  <a class="code" href="a00049.html#a23df21001564909dbffa60ba0f52ddbb">gEventCutoff</a> = 0;
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="a00053.html#a407abaf72a170e5f72bd9895d1321d75">00048</a> <a class="code" href="a00019.html">TDirectory</a>* <a class="code" href="a00049.html#a407abaf72a170e5f72bd9895d1321d75">gOnlineHistDir</a> = NULL;
<a name="l00049"></a><a class="code" href="a00053.html#adfc671c1d981c8748737e93f0e170dcb">00049</a> TFile* <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a> = NULL;
<a name="l00050"></a><a class="code" href="a00053.html#a04f129423143dbb41b65a5de57a71b43">00050</a> <a class="code" href="a00045.html" title="Interface class for ODB access.">VirtualOdb</a>* <a class="code" href="a00049.html#a04f129423143dbb41b65a5de57a71b43">gOdb</a> = NULL;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">//TCanvas  *gMainWindow = NULL;         // the online histogram window</span>
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="a00097.html#aed5e107931778acf0dec4d53809130b4">00054</a> <span class="keywordtype">double</span> <a class="code" href="a00049.html#aed5e107931778acf0dec4d53809130b4">GetTimeSec</a>()
<a name="l00055"></a>00055 {
<a name="l00056"></a>00056   <span class="keyword">struct </span>timeval tv;
<a name="l00057"></a>00057   gettimeofday(&amp;tv,NULL);
<a name="l00058"></a>00058   <span class="keywordflow">return</span> tv.tv_sec + 0.000001*tv.tv_usec;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="a00009.html">00061</a> <span class="keyword">class </span><a class="code" href="a00009.html">MyPeriodic</a> : <span class="keyword">public</span> <a class="code" href="a00040.html">TTimer</a>
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063 <span class="keyword">public</span>:
<a name="l00064"></a><a class="code" href="a00009.html#ab8bb19fec99e7986789a904a43ddf238">00064</a>   <span class="keyword">typedef</span> void (*<a class="code" href="a00009.html#ab8bb19fec99e7986789a904a43ddf238">TimerHandler</a>)(void);
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="a00009.html#a691051e7f80a7e2654ceed6e7023e6d7">00066</a>   <span class="keywordtype">int</span>          <a class="code" href="a00009.html#a691051e7f80a7e2654ceed6e7023e6d7">fPeriod_msec</a>;
<a name="l00067"></a><a class="code" href="a00009.html#a2d7848e27c0d45955f0748d2c38f84b0">00067</a>   <a class="code" href="a00009.html#ab8bb19fec99e7986789a904a43ddf238">TimerHandler</a> <a class="code" href="a00009.html#a2d7848e27c0d45955f0748d2c38f84b0">fHandler</a>;
<a name="l00068"></a><a class="code" href="a00009.html#a2cc023867f3bd4049f2c87c345eb955d">00068</a>   <span class="keywordtype">double</span>       <a class="code" href="a00009.html#a2cc023867f3bd4049f2c87c345eb955d">fLastTime</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="a00009.html#abc523c514850616ec3fcb33eb43eb753">00070</a>   <a class="code" href="a00009.html#abc523c514850616ec3fcb33eb43eb753">MyPeriodic</a>(<span class="keywordtype">int</span> period_msec,<a class="code" href="a00009.html#ab8bb19fec99e7986789a904a43ddf238">TimerHandler</a> handler)
<a name="l00071"></a>00071   {
<a name="l00072"></a>00072     assert(handler != NULL);
<a name="l00073"></a>00073     <a class="code" href="a00009.html#a691051e7f80a7e2654ceed6e7023e6d7">fPeriod_msec</a> = period_msec;
<a name="l00074"></a>00074     <a class="code" href="a00009.html#a2d7848e27c0d45955f0748d2c38f84b0">fHandler</a>  = handler;
<a name="l00075"></a>00075     <a class="code" href="a00009.html#a2cc023867f3bd4049f2c87c345eb955d">fLastTime</a> = <a class="code" href="a00049.html#aed5e107931778acf0dec4d53809130b4">GetTimeSec</a>();
<a name="l00076"></a>00076     Start(period_msec,kTRUE);
<a name="l00077"></a>00077   }
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="a00009.html#abc3c8bdea115df8cc0d74da299784c23">00079</a>   Bool_t <a class="code" href="a00009.html#abc3c8bdea115df8cc0d74da299784c23">Notify</a>()
<a name="l00080"></a>00080   {
<a name="l00081"></a>00081     <span class="keywordtype">double</span> t = <a class="code" href="a00049.html#aed5e107931778acf0dec4d53809130b4">GetTimeSec</a>();
<a name="l00082"></a>00082     <span class="comment">//printf(&quot;timer notify, period %f should be %f!\n&quot;,t-fLastTime,fPeriod_msec*0.001);</span>
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="keywordflow">if</span> (t - <a class="code" href="a00009.html#a2cc023867f3bd4049f2c87c345eb955d">fLastTime</a> &gt;= 0.9*<a class="code" href="a00009.html#a691051e7f80a7e2654ceed6e7023e6d7">fPeriod_msec</a>*0.001)
<a name="l00085"></a>00085       {
<a name="l00086"></a>00086         <span class="comment">//printf(&quot;timer: call handler %p\n&quot;,fHandler);</span>
<a name="l00087"></a>00087         <span class="keywordflow">if</span> (<a class="code" href="a00009.html#a2d7848e27c0d45955f0748d2c38f84b0">fHandler</a>)
<a name="l00088"></a>00088           (*fHandler)();
<a name="l00089"></a>00089 
<a name="l00090"></a>00090         <a class="code" href="a00009.html#a2cc023867f3bd4049f2c87c345eb955d">fLastTime</a> = t;
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     Reset();
<a name="l00094"></a>00094     <span class="keywordflow">return</span> kTRUE;
<a name="l00095"></a>00095   }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="a00009.html#abeee3a948773bc0913042a6b654a1509">00097</a>   <a class="code" href="a00009.html#abeee3a948773bc0913042a6b654a1509">~MyPeriodic</a>()
<a name="l00098"></a>00098   {
<a name="l00099"></a>00099     TurnOff();
<a name="l00100"></a>00100   }
<a name="l00101"></a>00101 };
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="a00049.html#a4e082e91477310a20b1befbfe7917a79">00104</a> <span class="keywordtype">void</span> <a class="code" href="a00049.html#a4e082e91477310a20b1befbfe7917a79">startRun</a>(<span class="keywordtype">int</span> transition,<span class="keywordtype">int</span> run,<span class="keywordtype">int</span> time)
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106   <a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a> = <span class="keyword">true</span>;
<a name="l00107"></a>00107   <a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a> = run;
<a name="l00108"></a>00108   <a class="code" href="a00049.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">gIsPedestalsRun</a> = gOdb-&gt;<a class="code" href="a00045.html#ab282d9685e765d1fe15254a22507af31" title="Read a boolean value, midas type TID_BOOL.">odbReadBool</a>(<span class="stringliteral">&quot;/experiment/edit on start/Pedestals run&quot;</span>);
<a name="l00109"></a>00109   printf(<span class="stringliteral">&quot;Begin run: %d, pedestal run: %d\n&quot;</span>, <a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a>, <a class="code" href="a00049.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">gIsPedestalsRun</a>);
<a name="l00110"></a>00110     
<a name="l00111"></a>00111   <span class="keywordflow">if</span>(<a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>!=NULL)
<a name="l00112"></a>00112   {
<a name="l00113"></a>00113     <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>-&gt;Write();
<a name="l00114"></a>00114     <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>-&gt;Close();
<a name="l00115"></a>00115     <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>=NULL;
<a name="l00116"></a>00116   }  
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="keywordtype">char</span> filename[1024];
<a name="l00119"></a>00119   sprintf(filename, <span class="stringliteral">&quot;output%05d.root&quot;</span>, run);
<a name="l00120"></a>00120   <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a> = <span class="keyword">new</span> TFile(filename, <span class="stringliteral">&quot;RECREATE&quot;</span>);
<a name="l00121"></a>00121   
<a name="l00122"></a>00122   <span class="comment">//if (gOutputFile &amp;&amp; !gOutputFile-&gt;IsOpen())</span>
<a name="l00123"></a>00123   <span class="comment">//gOutputFile = NULL;</span>
<a name="l00124"></a>00124 
<a name="l00125"></a>00125   assert(<a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>);
<a name="l00126"></a>00126   assert(<a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>-&gt;IsOpen());
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">//printf(&quot;gOutputFile: %p, isOpen %d\n&quot;, gOutputFile, gOutputFile-&gt;IsOpen());</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="preprocessor">#ifdef HAVE_LIBNETDIRECTORY</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span>  <a class="code" href="a00060.html#a7a5b2fe6305f7eee49ef669d43aed3bc">NetDirectoryExport</a>(<a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>, <span class="stringliteral">&quot;outputFile&quot;</span>);
<a name="l00132"></a>00132 <span class="preprocessor">#endif</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span>}
<a name="l00134"></a>00134 
<a name="l00135"></a><a class="code" href="a00049.html#aafa783d6b432e3fb42e1fe5c97c4c9a5">00135</a> <span class="keywordtype">void</span> <a class="code" href="a00049.html#aafa783d6b432e3fb42e1fe5c97c4c9a5">endRun</a>(<span class="keywordtype">int</span> transition,<span class="keywordtype">int</span> run,<span class="keywordtype">int</span> time)
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137   <a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a> = <span class="keyword">false</span>;
<a name="l00138"></a>00138   <a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a> = run;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="preprocessor">#ifdef HAVE_MIDASSERVER</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>)
<a name="l00142"></a>00142     <a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>-&gt;Clear();
<a name="l00143"></a>00143 <span class="preprocessor">#endif</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>
<a name="l00145"></a>00145   <span class="keywordflow">if</span> (<a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>)
<a name="l00146"></a>00146     {
<a name="l00147"></a>00147       <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>-&gt;Write();
<a name="l00148"></a>00148       <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>-&gt;Close();             <span class="comment">//close the histogram file</span>
<a name="l00149"></a>00149       <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a> = NULL;
<a name="l00150"></a>00150     }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   printf(<span class="stringliteral">&quot;End of run %d\n&quot;</span>,run);
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="preprocessor">#include &lt;TH1D.h&gt;</span>
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="a00049.html#a1700345458ef0b50773df63aad4b9be9">00157</a> <span class="keywordtype">void</span> <a class="code" href="a00049.html#a1700345458ef0b50773df63aad4b9be9">HandleSample</a>(<span class="keywordtype">int</span> ichan, <span class="keywordtype">void</span>* ptr, <span class="keywordtype">int</span> wsize)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159   uint16_t *samples = (uint16_t*) ptr;
<a name="l00160"></a>00160   <span class="keywordtype">int</span> numSamples = wsize;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   <span class="keywordflow">if</span> (numSamples != 512)
<a name="l00163"></a>00163     <span class="keywordflow">return</span>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keywordtype">char</span> name[256];
<a name="l00166"></a>00166   sprintf(name, <span class="stringliteral">&quot;channel%d&quot;</span>, ichan);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="keywordflow">if</span> (<a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>)
<a name="l00169"></a>00169     <a class="code" href="a00049.html#adfc671c1d981c8748737e93f0e170dcb">gOutputFile</a>-&gt;cd();
<a name="l00170"></a>00170 
<a name="l00171"></a>00171   TH1D* samplePlot = (TH1D*)<a class="code" href="a00070.html#a5bbe8c15751fe59280d72d356ff00f07">gDirectory</a>-&gt;<a class="code" href="a00019.html#af65d6b86aa0f57f7ab7cc8fc60c6558a">Get</a>(name);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="keywordflow">if</span> (!samplePlot)
<a name="l00174"></a>00174     {
<a name="l00175"></a>00175       printf(<span class="stringliteral">&quot;Create [%s]\n&quot;</span>, name);
<a name="l00176"></a>00176       samplePlot = <span class="keyword">new</span> TH1D(name, name, numSamples, 0, numSamples);
<a name="l00177"></a>00177       <span class="comment">//samplePlot-&gt;SetMinimum(0);</span>
<a name="l00178"></a>00178 <span class="preprocessor">#ifdef HAVE_MIDASSERVER</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>)
<a name="l00180"></a>00180         <a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>-&gt;Add(samplePlot);
<a name="l00181"></a>00181 <span class="preprocessor">#endif</span>
<a name="l00182"></a>00182 <span class="preprocessor"></span>    }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ti=0; ti&lt;numSamples; ti++)
<a name="l00185"></a>00185     samplePlot-&gt;SetBinContent(ti, samples[ti]);
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 
<a name="l00189"></a><a class="code" href="a00049.html#a02459e0090feced3b21974cef795351a">00189</a> <span class="keywordtype">void</span> <a class="code" href="a00049.html#a02459e0090feced3b21974cef795351a">HandleMidasEvent</a>(<a class="code" href="a00030.html" title="MIDAS event.">TMidasEvent</a>&amp; event)
<a name="l00190"></a>00190 {
<a name="l00191"></a>00191   <span class="keywordtype">int</span> eventId = <span class="keyword">event</span>.GetEventId();
<a name="l00192"></a>00192 
<a name="l00193"></a>00193   <span class="keywordflow">if</span> (<span class="keyword">false</span>&amp;&amp;(eventId == 1))
<a name="l00194"></a>00194     {
<a name="l00195"></a>00195       <span class="keywordtype">void</span> *ptr;
<a name="l00196"></a>00196       <span class="keywordtype">int</span> size = <span class="keyword">event</span>.LocateBank(NULL, <span class="stringliteral">&quot;CHA3&quot;</span>, &amp;ptr);
<a name="l00197"></a>00197       <span class="keywordflow">if</span> (ptr)
<a name="l00198"></a>00198         <a class="code" href="a00049.html#a1700345458ef0b50773df63aad4b9be9">HandleSample</a>(3, ptr, size);
<a name="l00199"></a>00199     }
<a name="l00200"></a>00200   <span class="keywordflow">if</span> (<span class="keyword">false</span>&amp;&amp;(eventId == 1)&amp;&amp;(<a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a>==<span class="keyword">true</span>)&amp;&amp;(<a class="code" href="a00049.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">gIsPedestalsRun</a>==<span class="keyword">false</span>)) <span class="comment">// SIS data</span>
<a name="l00201"></a>00201     {
<a name="l00202"></a>00202       <span class="comment">//printf(&quot;SIS event\n&quot;);</span>
<a name="l00203"></a>00203       <span class="comment">//event.Print();</span>
<a name="l00204"></a>00204       <span class="comment">//void *ptr;</span>
<a name="l00205"></a>00205       <span class="comment">//int size = event.LocateBank(event.GetData(),&quot;MCS&quot;,&amp;ptr);</span>
<a name="l00206"></a>00206       <span class="comment">//HandleSIS(kMaxSisChannels,size,ptr);</span>
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span>&amp;&amp;(eventId == 2)&amp;&amp;(<a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a>==<span class="keyword">true</span>)) <span class="comment">// ADC data</span>
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210       <span class="comment">//printf(&quot;ADC event\n&quot;);</span>
<a name="l00211"></a>00211       <span class="comment">//event.Print();</span>
<a name="l00212"></a>00212       <span class="comment">//void *ptr;</span>
<a name="l00213"></a>00213       <span class="comment">//int size = event.LocateBank(event.GetData(),&quot;ADC&quot;,&amp;ptr);</span>
<a name="l00214"></a>00214       <span class="comment">//HandleBeamADC(kMaxADCChannels,size,ptr,event);</span>
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="keyword">false</span>&amp;&amp;(eventId==5)&amp;&amp;(<a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a>==<span class="keyword">true</span>)&amp;&amp;(<a class="code" href="a00049.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">gIsPedestalsRun</a>==<span class="keyword">false</span>))<span class="comment">// Scaler data</span>
<a name="l00217"></a>00217     {
<a name="l00218"></a>00218       <span class="comment">//event.Print();</span>
<a name="l00219"></a>00219       <span class="comment">//void *sclrptr;</span>
<a name="l00220"></a>00220       <span class="comment">//int sclrsize = event.LocateBank(event.GetData(),&quot;SCLR&quot;,&amp;sclrptr);</span>
<a name="l00221"></a>00221       <span class="comment">//void *scrtptr;</span>
<a name="l00222"></a>00222       <span class="comment">//int scrtsize = event.LocateBank(event.GetData(),&quot;SCRT&quot;,&amp;scrtptr);</span>
<a name="l00223"></a>00223       <span class="comment">//HandleScaler(kMaxScalerChannels,sclrsize,sclrptr,scrtsize,scrtptr,event);</span>
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225   <span class="keywordflow">else</span>
<a name="l00226"></a>00226     {
<a name="l00227"></a>00227       <span class="comment">// unknown event type</span>
<a name="l00228"></a>00228       <span class="keyword">event</span>.Print();
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="a00049.html#a248b55c42bdb565a94be7790a08f2be6">00232</a> <span class="keywordtype">void</span> <a class="code" href="a00049.html#a248b55c42bdb565a94be7790a08f2be6">eventHandler</a>(<span class="keyword">const</span> <span class="keywordtype">void</span>*pheader,<span class="keyword">const</span> <span class="keywordtype">void</span>*pdata,<span class="keywordtype">int</span> size)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   <a class="code" href="a00030.html" title="MIDAS event.">TMidasEvent</a> event;
<a name="l00235"></a>00235   memcpy(event.<a class="code" href="a00030.html#a185596086a78015119f24c5e5132f2d0" title="return pointer to the event header">GetEventHeader</a>(), pheader, <span class="keyword">sizeof</span>(<a class="code" href="a00029.html" title="Event header.">TMidas_EVENT_HEADER</a>));
<a name="l00236"></a>00236   <span class="keyword">event</span>.SetData(size, (<span class="keywordtype">char</span>*)pdata);
<a name="l00237"></a>00237   <span class="keyword">event</span>.SetBankList();
<a name="l00238"></a>00238   <a class="code" href="a00049.html#a02459e0090feced3b21974cef795351a">HandleMidasEvent</a>(event);
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a><a class="code" href="a00049.html#a6973be6408175a61a9cb696648b4959c">00241</a> <span class="keywordtype">int</span> <a class="code" href="a00049.html#a6973be6408175a61a9cb696648b4959c">ProcessMidasFile</a>(TApplication*app,<span class="keyword">const</span> <span class="keywordtype">char</span>*fname)
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243   <a class="code" href="a00031.html" title="Reader for MIDAS .mid files.">TMidasFile</a> f;
<a name="l00244"></a>00244   <span class="keywordtype">bool</span> tryOpen = f.<a class="code" href="a00031.html#a0f39c35bb559a648f46a5b0d05c16768" title="Open input file.">Open</a>(fname);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="keywordflow">if</span> (!tryOpen)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248       printf(<span class="stringliteral">&quot;Cannot open input file \&quot;%s\&quot;\n&quot;</span>,fname);
<a name="l00249"></a>00249       <span class="keywordflow">return</span> -1;
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   <span class="keywordtype">int</span> i=0;
<a name="l00253"></a>00253   <span class="keywordflow">while</span> (1)
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255       <a class="code" href="a00030.html" title="MIDAS event.">TMidasEvent</a> event;
<a name="l00256"></a>00256       <span class="keywordflow">if</span> (!f.<a class="code" href="a00031.html#acd25594fcc51873a05fd16ec24979940" title="Read one event from the file.">Read</a>(&amp;event))
<a name="l00257"></a>00257         <span class="keywordflow">break</span>;
<a name="l00258"></a>00258 
<a name="l00259"></a>00259       <span class="keywordtype">int</span> eventId = <span class="keyword">event</span>.GetEventId();
<a name="l00260"></a>00260       <span class="comment">//printf(&quot;Have an event of type %d\n&quot;,eventId);</span>
<a name="l00261"></a>00261 
<a name="l00262"></a>00262       <span class="keywordflow">if</span> ((eventId &amp; 0xFFFF) == 0x8000)
<a name="l00263"></a>00263         {
<a name="l00264"></a>00264           <span class="comment">// begin run</span>
<a name="l00265"></a>00265           <span class="keyword">event</span>.Print();
<a name="l00266"></a>00266 
<a name="l00267"></a>00267           <span class="comment">//char buf[256];</span>
<a name="l00268"></a>00268           <span class="comment">//memset(buf,0,sizeof(buf));</span>
<a name="l00269"></a>00269           <span class="comment">//memcpy(buf,event.GetData(),255);</span>
<a name="l00270"></a>00270           <span class="comment">//printf(&quot;buf is [%s]\n&quot;,buf);</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272           <span class="comment">//</span>
<a name="l00273"></a>00273           <span class="comment">// Load ODB contents from the ODB XML file</span>
<a name="l00274"></a>00274           <span class="comment">//</span>
<a name="l00275"></a>00275           <span class="keywordflow">if</span> (gOdb)
<a name="l00276"></a>00276             <span class="keyword">delete</span> gOdb;
<a name="l00277"></a>00277           gOdb = <span class="keyword">new</span> <a class="code" href="a00047.html" title="Access to ODB saved in XML format inside midas .mid files.">XmlOdb</a>(event.<a class="code" href="a00030.html#af7b600b29911a56e604a2bd0159a8664" title="return pointer to the data buffer">GetData</a>(),<span class="keyword">event</span>.GetDataSize());
<a name="l00278"></a>00278 
<a name="l00279"></a>00279           <a class="code" href="a00049.html#a4e082e91477310a20b1befbfe7917a79">startRun</a>(0,event.<a class="code" href="a00030.html#acbaff1df97247584f3772ac8b5df720e" title="return the serial number">GetSerialNumber</a>(),0);
<a name="l00280"></a>00280         }
<a name="l00281"></a>00281       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((eventId &amp; 0xFFFF) == 0x8001)
<a name="l00282"></a>00282         {
<a name="l00283"></a>00283           <span class="comment">// end run</span>
<a name="l00284"></a>00284           <span class="keyword">event</span>.Print();
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((eventId &amp; 0xFFFF) == 0x8002) 
<a name="l00287"></a>00287         { 
<a name="l00288"></a>00288           <span class="comment">// log message </span>
<a name="l00289"></a>00289           <span class="keyword">event</span>.Print(); 
<a name="l00290"></a>00290           printf(<span class="stringliteral">&quot;Log message: %s\n&quot;</span>, event.<a class="code" href="a00030.html#af7b600b29911a56e604a2bd0159a8664" title="return pointer to the data buffer">GetData</a>()); 
<a name="l00291"></a>00291         } 
<a name="l00292"></a>00292       <span class="keywordflow">else</span>
<a name="l00293"></a>00293         {
<a name="l00294"></a>00294           <span class="keyword">event</span>.SetBankList();
<a name="l00295"></a>00295           <span class="comment">//event.Print();</span>
<a name="l00296"></a>00296           <a class="code" href="a00049.html#a02459e0090feced3b21974cef795351a">HandleMidasEvent</a>(event);
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         
<a name="l00299"></a>00299       <span class="keywordflow">if</span>((i%500)==0)
<a name="l00300"></a>00300         {
<a name="l00301"></a>00301           <span class="comment">//resetClock2time();</span>
<a name="l00302"></a>00302           printf(<span class="stringliteral">&quot;Processing event %d\n&quot;</span>,i);
<a name="l00303"></a>00303           <span class="comment">//SISperiodic();</span>
<a name="l00304"></a>00304           <span class="comment">//StepThroughSISBuffer();</span>
<a name="l00305"></a>00305         }
<a name="l00306"></a>00306       
<a name="l00307"></a>00307       i++;
<a name="l00308"></a>00308       <span class="keywordflow">if</span> ((<a class="code" href="a00049.html#a23df21001564909dbffa60ba0f52ddbb">gEventCutoff</a>!=0)&amp;&amp;(i&gt;=<a class="code" href="a00049.html#a23df21001564909dbffa60ba0f52ddbb">gEventCutoff</a>))
<a name="l00309"></a>00309         {
<a name="l00310"></a>00310           printf(<span class="stringliteral">&quot;Reached event %d, exiting loop.\n&quot;</span>,i);
<a name="l00311"></a>00311           <span class="keywordflow">break</span>;
<a name="l00312"></a>00312         }
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314   
<a name="l00315"></a>00315   f.<a class="code" href="a00031.html#a693315cd892c50575f44c46080a339b8" title="Close input file.">Close</a>();
<a name="l00316"></a>00316 
<a name="l00317"></a>00317   <a class="code" href="a00049.html#aafa783d6b432e3fb42e1fe5c97c4c9a5">endRun</a>(0,<a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a>,0);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="comment">// start the ROOT GUI event loop</span>
<a name="l00320"></a>00320   <span class="comment">//  app-&gt;Run(kTRUE);</span>
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <span class="keywordflow">return</span> 0;
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 
<a name="l00325"></a>00325 <span class="preprocessor">#ifdef HAVE_MIDAS</span>
<a name="l00326"></a>00326 <span class="preprocessor"></span>
<a name="l00327"></a>00327 <span class="keywordtype">void</span> MidasPollHandler()
<a name="l00328"></a>00328 {
<a name="l00329"></a>00329   <span class="keywordflow">if</span> (!(<a class="code" href="a00032.html#a8c926749be13682ed03a6561d9f3c3f9">TMidasOnline::instance</a>()-&gt;poll(0)))
<a name="l00330"></a>00330     gSystem-&gt;ExitLoop();
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="keywordtype">int</span> ProcessMidasOnline(TApplication*app, <span class="keyword">const</span> <span class="keywordtype">char</span>* hostname, <span class="keyword">const</span> <span class="keywordtype">char</span>* exptname)
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335    <a class="code" href="a00032.html" title="MIDAS online connection, including access to online ODB.">TMidasOnline</a> *midas = <a class="code" href="a00032.html#a8c926749be13682ed03a6561d9f3c3f9">TMidasOnline::instance</a>();
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <span class="keywordtype">int</span> err = midas-&gt;<a class="code" href="a00032.html#aa1cb5793f05100370e0e0c8346e8cf76" title="Connect to MIDAS experiment.">connect</a>(hostname, exptname, <span class="stringliteral">&quot;rootana&quot;</span>);
<a name="l00338"></a>00338    <span class="keywordflow">if</span> (err != 0)
<a name="l00339"></a>00339      {
<a name="l00340"></a>00340        fprintf(stderr,<span class="stringliteral">&quot;Cannot connect to MIDAS, error %d\n&quot;</span>, err);
<a name="l00341"></a>00341        <span class="keywordflow">return</span> -1;
<a name="l00342"></a>00342      }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344    gOdb = midas;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346    midas-&gt;<a class="code" href="a00032.html#abf5e0554efa4737d37a5ceedc8efaf0a" title="Specify user handlers for run transitions.">setTransitionHandlers</a>(<a class="code" href="a00049.html#a4e082e91477310a20b1befbfe7917a79">startRun</a>,<a class="code" href="a00049.html#aafa783d6b432e3fb42e1fe5c97c4c9a5">endRun</a>,NULL,NULL);
<a name="l00347"></a>00347    midas-&gt;<a class="code" href="a00032.html#a21f7ca84cb25973f7a6563167c557650" title="Ask MIDAS to tell us about run transitions.">registerTransitions</a>();
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <span class="comment">/* reqister event requests */</span>
<a name="l00350"></a>00350 
<a name="l00351"></a>00351    midas-&gt;<a class="code" href="a00032.html#a162c61b23a29d330f12aafce3d84b63e" title="Specify user handler for data events.">setEventHandler</a>(<a class="code" href="a00049.html#a248b55c42bdb565a94be7790a08f2be6">eventHandler</a>);
<a name="l00352"></a>00352    midas-&gt;<a class="code" href="a00032.html#ae8b19368fabc60994c4a21cb8780057c" title="Request data for delivery via callback (setEventHandler) or by polling (via receiveEvent)...">eventRequest</a>(<span class="stringliteral">&quot;SYSTEM&quot;</span>,-1,-1,(1&lt;&lt;1));
<a name="l00353"></a>00353 
<a name="l00354"></a>00354    <span class="comment">/* fill present run parameters */</span>
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    <a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a> = gOdb-&gt;<a class="code" href="a00045.html#a98d121aa5782ff9b602884c5a2e8cda3" title="Read an integer value, midas type TID_INT.">odbReadInt</a>(<span class="stringliteral">&quot;/runinfo/Run number&quot;</span>);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358    <span class="keywordflow">if</span> ((gOdb-&gt;<a class="code" href="a00045.html#a98d121aa5782ff9b602884c5a2e8cda3" title="Read an integer value, midas type TID_INT.">odbReadInt</a>(<span class="stringliteral">&quot;/runinfo/State&quot;</span>) == 3))
<a name="l00359"></a>00359      <a class="code" href="a00049.html#a4e082e91477310a20b1befbfe7917a79">startRun</a>(0,<a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a>,0);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361    printf(<span class="stringliteral">&quot;Startup: run %d, is running: %d, is pedestals run: %d\n&quot;</span>,<a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a>,<a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a>,<a class="code" href="a00049.html#a4b1bfdba322ba30fe8bb49e3d3b40cf3">gIsPedestalsRun</a>);
<a name="l00362"></a>00362    
<a name="l00363"></a>00363    <a class="code" href="a00009.html">MyPeriodic</a> tm(100,MidasPollHandler);
<a name="l00364"></a>00364    <span class="comment">//MyPeriodic th(1000,SISperiodic);</span>
<a name="l00365"></a>00365    <span class="comment">//MyPeriodic tn(1000,StepThroughSISBuffer);</span>
<a name="l00366"></a>00366    <span class="comment">//MyPeriodic to(1000,Scalerperiodic);</span>
<a name="l00367"></a>00367 
<a name="l00368"></a>00368    <span class="comment">/*---- start main loop ----*/</span>
<a name="l00369"></a>00369 
<a name="l00370"></a>00370    <span class="comment">//loop_online();</span>
<a name="l00371"></a>00371    app-&gt;Run(kTRUE);
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <span class="comment">/* disconnect from experiment */</span>
<a name="l00374"></a>00374    midas-&gt;<a class="code" href="a00032.html#a7551fdfc06f5db42659ab05ce04e1aa8" title="Disconnect from MIDAS.">disconnect</a>();
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    <span class="keywordflow">return</span> 0;
<a name="l00377"></a>00377 }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 <span class="preprocessor">#endif</span>
<a name="l00380"></a>00380 <span class="preprocessor"></span>
<a name="l00381"></a>00381 <span class="preprocessor">#include &lt;TGMenu.h&gt;</span>
<a name="l00382"></a>00382 
<a name="l00383"></a><a class="code" href="a00008.html">00383</a> <span class="keyword">class </span><a class="code" href="a00008.html">MainWindow</a>: <span class="keyword">public</span> <a class="code" href="a00022.html">TGMainFrame</a> {
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="keyword">private</span>:
<a name="l00386"></a><a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">00386</a>   TGPopupMenu*          <a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">menuFile</a>;
<a name="l00387"></a>00387   <span class="comment">//TGPopupMenu*                menuControls;</span>
<a name="l00388"></a><a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">00388</a>   TGMenuBar*            <a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">menuBar</a>;
<a name="l00389"></a><a class="code" href="a00008.html#a1f547d880ed8b6710f0bfa5d3e4f11c2">00389</a>   TGLayoutHints*        <a class="code" href="a00008.html#a1f547d880ed8b6710f0bfa5d3e4f11c2">menuBarLayout</a>;
<a name="l00390"></a><a class="code" href="a00008.html#a189dba622eb9d4d1aebbfcd1d3f483c9">00390</a>   TGLayoutHints*        <a class="code" href="a00008.html#a189dba622eb9d4d1aebbfcd1d3f483c9">menuBarItemLayout</a>;
<a name="l00391"></a>00391   
<a name="l00392"></a>00392 <span class="keyword">public</span>:
<a name="l00393"></a>00393   <a class="code" href="a00008.html#aecd31daaa9aef9f34443ae6cb5fd3150">MainWindow</a>(<span class="keyword">const</span> TGWindow*w,<span class="keywordtype">int</span> s1,<span class="keywordtype">int</span> s2);
<a name="l00394"></a>00394   <span class="keyword">virtual</span> <a class="code" href="a00008.html#ae98d00a93bc118200eeef9f9bba1dba7">~MainWindow</a>(); <span class="comment">// Closing the control window closes the whole program</span>
<a name="l00395"></a>00395   <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="a00008.html#a030bda5de4b8e1793e650001f4debc07">CloseWindow</a>();
<a name="l00396"></a>00396   
<a name="l00397"></a>00397   Bool_t <a class="code" href="a00008.html#ab059a23977448a23ac90a17d76c90572">ProcessMessage</a>(Long_t msg, Long_t parm1, Long_t parm2);
<a name="l00398"></a>00398 };
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="a00049.html#a86ca54f6c4f162654162f3aa5f2fd920">00400</a> <span class="preprocessor">#define M_FILE_EXIT 0</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>
<a name="l00402"></a><a class="code" href="a00008.html#ab059a23977448a23ac90a17d76c90572">00402</a> Bool_t <a class="code" href="a00008.html#ab059a23977448a23ac90a17d76c90572">MainWindow::ProcessMessage</a>(Long_t msg, Long_t parm1, Long_t parm2)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404    <span class="comment">// printf(&quot;GUI Message %d %d %d\n&quot;,(int)msg,(int)parm1,(int)parm2);</span>
<a name="l00405"></a>00405     <span class="keywordflow">switch</span> (GET_MSG(msg))
<a name="l00406"></a>00406       {
<a name="l00407"></a>00407       <span class="keywordflow">default</span>:
<a name="l00408"></a>00408         <span class="keywordflow">break</span>;
<a name="l00409"></a>00409       <span class="keywordflow">case</span> kC_COMMAND:
<a name="l00410"></a>00410         <span class="keywordflow">switch</span> (GET_SUBMSG(msg))
<a name="l00411"></a>00411           {
<a name="l00412"></a>00412           <span class="keywordflow">default</span>:
<a name="l00413"></a>00413             <span class="keywordflow">break</span>;
<a name="l00414"></a>00414           <span class="keywordflow">case</span> kCM_MENU:
<a name="l00415"></a>00415             <span class="keywordflow">switch</span> (parm1)
<a name="l00416"></a>00416               {
<a name="l00417"></a>00417               <span class="keywordflow">default</span>:
<a name="l00418"></a>00418                 <span class="keywordflow">break</span>;
<a name="l00419"></a>00419               <span class="keywordflow">case</span> <a class="code" href="a00049.html#a86ca54f6c4f162654162f3aa5f2fd920">M_FILE_EXIT</a>:
<a name="l00420"></a>00420                 <span class="keywordflow">if</span>(<a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a>)
<a name="l00421"></a>00421                    <a class="code" href="a00049.html#aafa783d6b432e3fb42e1fe5c97c4c9a5">endRun</a>(0,<a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a>,0);
<a name="l00422"></a>00422                 gSystem-&gt;ExitLoop();
<a name="l00423"></a>00423                 <span class="keywordflow">break</span>;
<a name="l00424"></a>00424               }
<a name="l00425"></a>00425             <span class="keywordflow">break</span>;
<a name="l00426"></a>00426           }
<a name="l00427"></a>00427         <span class="keywordflow">break</span>;
<a name="l00428"></a>00428       }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     <span class="keywordflow">return</span> kTRUE;
<a name="l00431"></a>00431 }
<a name="l00432"></a>00432 
<a name="l00433"></a><a class="code" href="a00008.html#aecd31daaa9aef9f34443ae6cb5fd3150">00433</a> <a class="code" href="a00008.html#aecd31daaa9aef9f34443ae6cb5fd3150">MainWindow::MainWindow</a>(<span class="keyword">const</span> TGWindow*w,<span class="keywordtype">int</span> s1,<span class="keywordtype">int</span> s2) <span class="comment">// ctor</span>
<a name="l00434"></a>00434     : <a class="code" href="a00022.html">TGMainFrame</a>(w,s1,s2)
<a name="l00435"></a>00435 {
<a name="l00436"></a>00436    <span class="comment">//SetCleanup(kDeepCleanup);</span>
<a name="l00437"></a>00437    
<a name="l00438"></a>00438    SetWindowName(<span class="stringliteral">&quot;ROOT Analyzer Control&quot;</span>);
<a name="l00439"></a>00439 
<a name="l00440"></a>00440    <span class="comment">// layout the gui</span>
<a name="l00441"></a>00441    <a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">menuFile</a> = <span class="keyword">new</span> TGPopupMenu(gClient-&gt;GetRoot());
<a name="l00442"></a>00442    <a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">menuFile</a>-&gt;AddEntry(<span class="stringliteral">&quot;Exit&quot;</span>, <a class="code" href="a00049.html#a86ca54f6c4f162654162f3aa5f2fd920">M_FILE_EXIT</a>);
<a name="l00443"></a>00443 
<a name="l00444"></a>00444    <a class="code" href="a00008.html#a189dba622eb9d4d1aebbfcd1d3f483c9">menuBarItemLayout</a> = <span class="keyword">new</span> TGLayoutHints(kLHintsTop|kLHintsLeft, 0, 4, 0, 0);
<a name="l00445"></a>00445 
<a name="l00446"></a>00446    <a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">menuFile</a>-&gt;Associate(<span class="keyword">this</span>);
<a name="l00447"></a>00447    <span class="comment">//menuControls-&gt;Associate(this);</span>
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">menuBar</a> = <span class="keyword">new</span> TGMenuBar(<span class="keyword">this</span>, 1, 1, kRaisedFrame);
<a name="l00450"></a>00450    <a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">menuBar</a>-&gt;AddPopup(<span class="stringliteral">&quot;&amp;File&quot;</span>,     <a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">menuFile</a>,     <a class="code" href="a00008.html#a189dba622eb9d4d1aebbfcd1d3f483c9">menuBarItemLayout</a>);
<a name="l00451"></a>00451    <span class="comment">//menuBar-&gt;AddPopup(&quot;&amp;Controls&quot;, menuControls, menuBarItemLayout);</span>
<a name="l00452"></a>00452    <a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">menuBar</a>-&gt;Layout();
<a name="l00453"></a>00453 
<a name="l00454"></a>00454    <a class="code" href="a00008.html#a1f547d880ed8b6710f0bfa5d3e4f11c2">menuBarLayout</a> = <span class="keyword">new</span> TGLayoutHints(kLHintsTop|kLHintsLeft|kLHintsExpandX);
<a name="l00455"></a>00455    AddFrame(<a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">menuBar</a>,<a class="code" href="a00008.html#a1f547d880ed8b6710f0bfa5d3e4f11c2">menuBarLayout</a>);
<a name="l00456"></a>00456    
<a name="l00457"></a>00457    MapSubwindows(); 
<a name="l00458"></a>00458    Layout();
<a name="l00459"></a>00459    MapWindow();
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a><a class="code" href="a00008.html#ae98d00a93bc118200eeef9f9bba1dba7">00462</a> <a class="code" href="a00008.html#ae98d00a93bc118200eeef9f9bba1dba7">MainWindow::~MainWindow</a>()
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     <span class="keyword">delete</span> <a class="code" href="a00008.html#a4fc7f71c56d57040c834e2a5b7daec26">menuFile</a>;
<a name="l00465"></a>00465     <span class="comment">//delete menuControls;</span>
<a name="l00466"></a>00466     <span class="keyword">delete</span> <a class="code" href="a00008.html#aaaeffaa0e548dc272d4fa7efc633fadb">menuBar</a>;
<a name="l00467"></a>00467     <span class="keyword">delete</span> <a class="code" href="a00008.html#a1f547d880ed8b6710f0bfa5d3e4f11c2">menuBarLayout</a>;
<a name="l00468"></a>00468     <span class="keyword">delete</span> <a class="code" href="a00008.html#a189dba622eb9d4d1aebbfcd1d3f483c9">menuBarItemLayout</a>;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="a00008.html#a030bda5de4b8e1793e650001f4debc07">00471</a> <span class="keywordtype">void</span> <a class="code" href="a00008.html#a030bda5de4b8e1793e650001f4debc07">MainWindow::CloseWindow</a>()
<a name="l00472"></a>00472 {
<a name="l00473"></a>00473     <span class="keywordflow">if</span>(<a class="code" href="a00049.html#a2a67d96e62cbb9dfae0655f222220cec">gIsRunning</a>)
<a name="l00474"></a>00474         <a class="code" href="a00049.html#aafa783d6b432e3fb42e1fe5c97c4c9a5">endRun</a>(0,<a class="code" href="a00049.html#a6cf028aba8f1557987171e864c6e92aa">gRunNumber</a>,0);
<a name="l00475"></a>00475     gSystem-&gt;ExitLoop();
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="a00049.html#a91cc1a3c62679e579b1415884e2534e6">00478</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="a00049.html#a91cc1a3c62679e579b1415884e2534e6">gEnableShowMem</a> = <span class="keyword">false</span>;
<a name="l00479"></a>00479 
<a name="l00480"></a><a class="code" href="a00049.html#ab4ac2d59faf760d2272bb679c09b793f">00480</a> <span class="keywordtype">int</span> <a class="code" href="a00049.html#ab4ac2d59faf760d2272bb679c09b793f">ShowMem</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* label)
<a name="l00481"></a>00481 {
<a name="l00482"></a>00482   <span class="keywordflow">if</span> (!gEnableShowMem)
<a name="l00483"></a>00483     <span class="keywordflow">return</span> 0;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485   FILE* fp = fopen(<span class="stringliteral">&quot;/proc/self/statm&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00486"></a>00486   <span class="keywordflow">if</span> (!fp)
<a name="l00487"></a>00487     <span class="keywordflow">return</span> 0;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <span class="keywordtype">int</span> mem = 0;
<a name="l00490"></a>00490   fscanf(fp,<span class="stringliteral">&quot;%d&quot;</span>,&amp;mem);
<a name="l00491"></a>00491   fclose(fp);
<a name="l00492"></a>00492 
<a name="l00493"></a>00493   <span class="keywordflow">if</span> (label)
<a name="l00494"></a>00494     printf(<span class="stringliteral">&quot;memory at %s is %d\n&quot;</span>, label, mem);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   <span class="keywordflow">return</span> mem;
<a name="l00497"></a>00497 }
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="a00049.html#a97ee70a8770dc30d06c744b24eb2fcfc">00499</a> <span class="keywordtype">void</span> <a class="code" href="a00049.html#a97ee70a8770dc30d06c744b24eb2fcfc">help</a>()
<a name="l00500"></a>00500 {
<a name="l00501"></a>00501   printf(<span class="stringliteral">&quot;\nUsage:\n&quot;</span>);
<a name="l00502"></a>00502   printf(<span class="stringliteral">&quot;\n./analyzer.exe [-h] [-Hhostname] [-Eexptname] [-eMaxEvents] [-P9091] [-p9090] [-m] [-g] [file1 file2 ...]\n&quot;</span>);
<a name="l00503"></a>00503   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00504"></a>00504   printf(<span class="stringliteral">&quot;\t-h: print this help message\n&quot;</span>);
<a name="l00505"></a>00505   printf(<span class="stringliteral">&quot;\t-T: test mode - start and serve a test histogram\n&quot;</span>);
<a name="l00506"></a>00506   printf(<span class="stringliteral">&quot;\t-Hhostname: connect to MIDAS experiment on given host\n&quot;</span>);
<a name="l00507"></a>00507   printf(<span class="stringliteral">&quot;\t-Eexptname: connect to this MIDAS experiment\n&quot;</span>);
<a name="l00508"></a>00508   printf(<span class="stringliteral">&quot;\t-P: Start the TNetDirectory server on specified tcp port (for use with roody -Plocalhost:9091)\n&quot;</span>);
<a name="l00509"></a>00509   printf(<span class="stringliteral">&quot;\t-p: Start the old midas histogram server on specified tcp port (for use with roody -Hlocalhost:9090)\n&quot;</span>);
<a name="l00510"></a>00510   printf(<span class="stringliteral">&quot;\t-e: Number of events to read from input data files\n&quot;</span>);
<a name="l00511"></a>00511   printf(<span class="stringliteral">&quot;\t-m: Enable memory leak debugging\n&quot;</span>);
<a name="l00512"></a>00512   printf(<span class="stringliteral">&quot;\t-g: Enable graphics display when processing data files\n&quot;</span>);
<a name="l00513"></a>00513   printf(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00514"></a>00514   printf(<span class="stringliteral">&quot;Example1: analyze online data: ./analyzer.exe -P9091\n&quot;</span>);
<a name="l00515"></a>00515   printf(<span class="stringliteral">&quot;Example2: analyze existing data: ./analyzer.exe /data/alpha/current/run00500.mid\n&quot;</span>);
<a name="l00516"></a>00516   exit(1);
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="comment">// Main function call</span>
<a name="l00520"></a>00520 
<a name="l00521"></a><a class="code" href="a00049.html#a0ddf1224851353fc92bfbff6f499fa97">00521</a> <span class="keywordtype">int</span> <a class="code" href="a00049.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00522"></a>00522 {
<a name="l00523"></a>00523    setbuf(stdout,NULL);
<a name="l00524"></a>00524    setbuf(stderr,NULL);
<a name="l00525"></a>00525  
<a name="l00526"></a>00526    signal(SIGILL,  SIG_DFL);
<a name="l00527"></a>00527    signal(SIGBUS,  SIG_DFL);
<a name="l00528"></a>00528    signal(SIGSEGV, SIG_DFL);
<a name="l00529"></a>00529    signal(SIGPIPE, SIG_DFL);
<a name="l00530"></a>00530  
<a name="l00531"></a>00531    std::vector&lt;std::string&gt; args;
<a name="l00532"></a>00532    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;argc; i++)
<a name="l00533"></a>00533      {
<a name="l00534"></a>00534        <span class="keywordflow">if</span> (strcmp(argv[i],<span class="stringliteral">&quot;-h&quot;</span>)==0)
<a name="l00535"></a>00535          <a class="code" href="a00049.html#a97ee70a8770dc30d06c744b24eb2fcfc">help</a>(); <span class="comment">// does not return</span>
<a name="l00536"></a>00536        args.push_back(argv[i]);
<a name="l00537"></a>00537      }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    TApplication *app = <span class="keyword">new</span> TApplication(<span class="stringliteral">&quot;rootana&quot;</span>, &amp;argc, argv);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541    <span class="keywordflow">if</span>(gROOT-&gt;IsBatch()) {
<a name="l00542"></a>00542         printf(<span class="stringliteral">&quot;Cannot run in batch mode\n&quot;</span>);
<a name="l00543"></a>00543         <span class="keywordflow">return</span> 1;
<a name="l00544"></a>00544    }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546    <span class="keywordtype">bool</span> forceEnableGraphics = <span class="keyword">false</span>;
<a name="l00547"></a>00547    <span class="keywordtype">bool</span> testMode = <span class="keyword">false</span>;
<a name="l00548"></a>00548    <span class="keywordtype">int</span>  oldTcpPort = 0;
<a name="l00549"></a>00549    <span class="keywordtype">int</span>  tcpPort = 0;
<a name="l00550"></a>00550    <span class="keywordtype">int</span>  xmlTcpPort = 0;
<a name="l00551"></a>00551    <span class="keyword">const</span> <span class="keywordtype">char</span>* hostname = NULL;
<a name="l00552"></a>00552    <span class="keyword">const</span> <span class="keywordtype">char</span>* exptname = NULL;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=1; i&lt;args.size(); i++) <span class="comment">// loop over the commandline options</span>
<a name="l00555"></a>00555      {
<a name="l00556"></a>00556        <span class="keyword">const</span> <span class="keywordtype">char</span>* arg = args[i].c_str();
<a name="l00557"></a>00557        <span class="comment">//printf(&quot;argv[%d] is %s\n&quot;,i,arg);</span>
<a name="l00558"></a>00558            
<a name="l00559"></a>00559        <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-e&quot;</span>,2)==0)  <span class="comment">// Event cutoff flag (only applicable in offline mode)</span>
<a name="l00560"></a>00560          <a class="code" href="a00049.html#a23df21001564909dbffa60ba0f52ddbb">gEventCutoff</a> = atoi(arg+2);
<a name="l00561"></a>00561        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-m&quot;</span>,2)==0) <span class="comment">// Enable memory debugging</span>
<a name="l00562"></a>00562          gEnableShowMem = <span class="keyword">true</span>;
<a name="l00563"></a>00563        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-p&quot;</span>,2)==0) <span class="comment">// Set the histogram server port</span>
<a name="l00564"></a>00564          oldTcpPort = atoi(arg+2);
<a name="l00565"></a>00565        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-P&quot;</span>,2)==0) <span class="comment">// Set the histogram server port</span>
<a name="l00566"></a>00566          tcpPort = atoi(arg+2);
<a name="l00567"></a>00567        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-X&quot;</span>,2)==0) <span class="comment">// Set the histogram server port</span>
<a name="l00568"></a>00568          xmlTcpPort = atoi(arg+2);
<a name="l00569"></a>00569        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arg,<span class="stringliteral">&quot;-T&quot;</span>)==0)
<a name="l00570"></a>00570          testMode = <span class="keyword">true</span>;
<a name="l00571"></a>00571        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arg,<span class="stringliteral">&quot;-g&quot;</span>)==0)
<a name="l00572"></a>00572          forceEnableGraphics = <span class="keyword">true</span>;
<a name="l00573"></a>00573        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-H&quot;</span>,2)==0)
<a name="l00574"></a>00574          hostname = strdup(arg+2);
<a name="l00575"></a>00575        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(arg,<span class="stringliteral">&quot;-E&quot;</span>,2)==0)
<a name="l00576"></a>00576          exptname = strdup(arg+2);
<a name="l00577"></a>00577        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(arg,<span class="stringliteral">&quot;-h&quot;</span>)==0)
<a name="l00578"></a>00578          <a class="code" href="a00049.html#a97ee70a8770dc30d06c744b24eb2fcfc">help</a>(); <span class="comment">// does not return</span>
<a name="l00579"></a>00579        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arg[0] == <span class="charliteral">&apos;-&apos;</span>)
<a name="l00580"></a>00580          <a class="code" href="a00049.html#a97ee70a8770dc30d06c744b24eb2fcfc">help</a>(); <span class="comment">// does not return</span>
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582     
<a name="l00583"></a>00583    <a class="code" href="a00008.html">MainWindow</a> mainWindow(gClient-&gt;GetRoot(), 200, 300);
<a name="l00584"></a>00584 
<a name="l00585"></a>00585    gROOT-&gt;cd();
<a name="l00586"></a>00586    gOnlineHistDir = <span class="keyword">new</span> <a class="code" href="a00019.html">TDirectory</a>(<span class="stringliteral">&quot;rootana&quot;</span>, <span class="stringliteral">&quot;rootana online plots&quot;</span>);
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="preprocessor">#ifdef HAVE_MIDASSERVER</span>
<a name="l00589"></a>00589 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (oldTcpPort)
<a name="l00590"></a>00590      <a class="code" href="a00058.html#aeca754799402cdd99d6eacc8f454d423">StartMidasServer</a>(oldTcpPort);
<a name="l00591"></a>00591 <span class="preprocessor">#else</span>
<a name="l00592"></a>00592 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (oldTcpPort)
<a name="l00593"></a>00593      fprintf(stderr,<span class="stringliteral">&quot;ERROR: No support for the old midas server!\n&quot;</span>);
<a name="l00594"></a>00594 <span class="preprocessor">#endif</span>
<a name="l00595"></a>00595 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_LIBNETDIRECTORY</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (tcpPort)
<a name="l00597"></a>00597      <a class="code" href="a00060.html#af280d129baa10e736ba821d2f6bf4682">StartNetDirectoryServer</a>(tcpPort, gOnlineHistDir);
<a name="l00598"></a>00598 <span class="preprocessor">#else</span>
<a name="l00599"></a>00599 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (tcpPort)
<a name="l00600"></a>00600      fprintf(stderr,<span class="stringliteral">&quot;ERROR: No support for the TNetDirectory server!\n&quot;</span>);
<a name="l00601"></a>00601 <span class="preprocessor">#endif</span>
<a name="l00602"></a>00602 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_XMLSERVER</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>   <a class="code" href="a00048.html">XmlServer</a>* xmlServer = NULL;
<a name="l00604"></a>00604    <span class="keywordflow">if</span> (xmlTcpPort)
<a name="l00605"></a>00605      {
<a name="l00606"></a>00606         xmlServer = <span class="keyword">new</span> <a class="code" href="a00048.html">XmlServer</a>();
<a name="l00607"></a>00607         xmlServer-&gt;<a class="code" href="a00048.html#a69b01f1e5f2b0879f25319ba702fde0b">SetVerbose</a>(<span class="keyword">true</span>);
<a name="l00608"></a>00608         xmlServer-&gt;<a class="code" href="a00048.html#af7d8699ca08edc3142c9b1339c4d92d6">Start</a>(xmlTcpPort);
<a name="l00609"></a>00609         xmlServer-&gt;<a class="code" href="a00048.html#a41a96e8328c9df0269ed240f2d70d015">Export</a>(gOnlineHistDir, gOnlineHistDir-&gt;GetName());
<a name="l00610"></a>00610      }
<a name="l00611"></a>00611 <span class="preprocessor">#else</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (xmlTcpPort)
<a name="l00613"></a>00613      fprintf(stderr,<span class="stringliteral">&quot;ERROR: No support for the XML Server!\n&quot;</span>);
<a name="l00614"></a>00614 <span class="preprocessor">#endif</span>
<a name="l00615"></a>00615 <span class="preprocessor"></span>         
<a name="l00616"></a>00616    <a class="code" href="a00049.html#a9c47b919164f4d2be7fcf95761311698">gIsOffline</a> = <span class="keyword">false</span>;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=1; i&lt;args.size(); i++)
<a name="l00619"></a>00619      {
<a name="l00620"></a>00620        <span class="keyword">const</span> <span class="keywordtype">char</span>* arg = args[i].c_str();
<a name="l00621"></a>00621 
<a name="l00622"></a>00622        <span class="keywordflow">if</span> (arg[0] != <span class="charliteral">&apos;-&apos;</span>)  
<a name="l00623"></a>00623          {  
<a name="l00624"></a>00624            <a class="code" href="a00049.html#a9c47b919164f4d2be7fcf95761311698">gIsOffline</a> = <span class="keyword">true</span>;
<a name="l00625"></a>00625            <span class="comment">//gEnableGraphics = false;</span>
<a name="l00626"></a>00626            <span class="comment">//gEnableGraphics |= forceEnableGraphics;</span>
<a name="l00627"></a>00627            <a class="code" href="a00049.html#a6973be6408175a61a9cb696648b4959c">ProcessMidasFile</a>(app,arg);
<a name="l00628"></a>00628          }
<a name="l00629"></a>00629      }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631    <span class="keywordflow">if</span> (testMode)
<a name="l00632"></a>00632      {
<a name="l00633"></a>00633        gOnlineHistDir-&gt;<a class="code" href="a00019.html#ad44b6f5729763e2c82528f74b092c7c9">cd</a>();
<a name="l00634"></a>00634        TH1D* hh = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>, 100, 0, 100);
<a name="l00635"></a>00635        hh-&gt;Fill(1);
<a name="l00636"></a>00636        hh-&gt;Fill(10);
<a name="l00637"></a>00637        hh-&gt;Fill(50);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639        app-&gt;Run(kTRUE);
<a name="l00640"></a>00640        <span class="keywordflow">return</span> 0;
<a name="l00641"></a>00641      }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643    <span class="comment">// if we processed some data files,</span>
<a name="l00644"></a>00644    <span class="comment">// do not go into online mode.</span>
<a name="l00645"></a>00645    <span class="keywordflow">if</span> (<a class="code" href="a00049.html#a9c47b919164f4d2be7fcf95761311698">gIsOffline</a>)
<a name="l00646"></a>00646      <span class="keywordflow">return</span> 0;
<a name="l00647"></a>00647            
<a name="l00648"></a>00648    <a class="code" href="a00049.html#a9c47b919164f4d2be7fcf95761311698">gIsOffline</a> = <span class="keyword">false</span>;
<a name="l00649"></a>00649    <span class="comment">//gEnableGraphics = true;</span>
<a name="l00650"></a>00650 <span class="preprocessor">#ifdef HAVE_MIDAS</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>   ProcessMidasOnline(app, hostname, exptname);
<a name="l00652"></a>00652 <span class="preprocessor">#endif</span>
<a name="l00653"></a>00653 <span class="preprocessor"></span>   
<a name="l00654"></a>00654    <span class="keywordflow">return</span> 0;
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 <span class="comment">//end</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 15 May 2013 for ROOT Analyzer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
