<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ROOT Analyzer: libMidasServer/midasServer.cxx File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0958503a518ce72e67224f54b21c0b54.html">libMidasServer</a>
  </div>
</div>
<div class="contents">
<h1>midasServer.cxx File Reference</h1><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;assert.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="a00059_source.html">midasServer.h</a>&quot;</code><br/>
<code>#include &lt;TROOT.h&gt;</code><br/>
<code>#include &lt;TSemaphore.h&gt;</code><br/>
<code>#include &lt;TFolder.h&gt;</code><br/>
<code>#include &lt;TSocket.h&gt;</code><br/>
<code>#include &lt;TServerSocket.h&gt;</code><br/>
<code>#include &lt;TThread.h&gt;</code><br/>
<code>#include &lt;TMessage.h&gt;</code><br/>
<code>#include &lt;TObjString.h&gt;</code><br/>
<code>#include &lt;TObjArray.h&gt;</code><br/>
<code>#include &lt;TH1.h&gt;</code><br/>
<code>#include &lt;TCutG.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="a00063_source.html">RootLock.h</a>&quot;</code><br/>
<code>#include &lt;map&gt;</code><br/>
<code>#include &lt;string&gt;</code><br/>
<div class="dynheader">
Include dependency graph for midasServer.cxx:</div>
<div class="dynsection">
<div class="center"><img src="a00250.png" border="0" usemap="#libMidasServer_2midasServer_8cxx_map" alt=""/></div>
<map name="libMidasServer_2midasServer_8cxx_map" id="libMidasServer_2midasServer_8cxx">
<area shape="rect" id="node9" href="a00059.html" title="midasServer.h" alt="" coords="296,83,411,112"/><area shape="rect" id="node33" href="a00063.html" title="RootLock.h" alt="" coords="1725,83,1821,112"/></map>
</div>

<p><a href="a00139_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a3685f6e53a22f6b1b1212bda97940395">XPOINTER_T</a>&nbsp;&nbsp;&nbsp;uint32_t</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a2260603b1f294b352b8cef4241aac374">VerboseMidasServer</a> (bool verbose)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TFolder *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2">ReadFolderPointer</a> (TSocket *fSocket)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#af1ab5f1dddd620d9b2a2977c18a17450">root_server_thread</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#ae4c520908e89934574ff6a73619ec5ea">root_socket_server</a> (void *arg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#aeca754799402cdd99d6eacc8f454d423">StartMidasServer</a> (int port)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a> = false</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static std::map&lt; XPOINTER_T, <br class="typebreak"/>
std::string &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a19e514e8ad48b6aac34c4aec04dd9745">gPointers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static std::map&lt; std::string, <br class="typebreak"/>
XPOINTER_T &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a3dbad6df57598a82b1373a69007650bd">gRevPointers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static XPOINTER_T&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a8bfae589a628d948821e2a407e156e28">gLastPointer</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TFolder *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00139.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a> = NULL</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a3685f6e53a22f6b1b1212bda97940395"></a><!-- doxytag: member="midasServer.cxx::XPOINTER_T" ref="a3685f6e53a22f6b1b1212bda97940395" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define XPOINTER_T&nbsp;&nbsp;&nbsp;uint32_t</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00049">49</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00055">ReadFolderPointer()</a>, and <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a46bb444c1c19c18f6e1cc93126bdd2b2"></a><!-- doxytag: member="midasServer.cxx::ReadFolderPointer" ref="a46bb444c1c19c18f6e1cc93126bdd2b2" args="(TSocket *fSocket)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TFolder* ReadFolderPointer </td>
          <td>(</td>
          <td class="paramtype">TSocket *&nbsp;</td>
          <td class="paramname"> <em>fSocket</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00055">55</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>References <a class="el" href="a00139_source.html#l00288">gManaHistosFolder</a>, <a class="el" href="a00139_source.html#l00051">gPointers</a>, <a class="el" href="a00139_source.html#l00035">gVerbose</a>, and <a class="el" href="a00139_source.html#l00049">XPOINTER_T</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00056"></a>00056 {
<a name="l00057"></a>00057    <span class="comment">//read pointer to current folder</span>
<a name="l00058"></a>00058    TMessage *m = 0;
<a name="l00059"></a>00059    fSocket-&gt;Recv(m);
<a name="l00060"></a>00060    <a class="code" href="a00139.html#a3685f6e53a22f6b1b1212bda97940395">XPOINTER_T</a> p;
<a name="l00061"></a>00061    *m &gt;&gt; p;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063    <span class="keyword">const</span> <span class="keywordtype">char</span>* name = <a class="code" href="a00139.html#a19e514e8ad48b6aac34c4aec04dd9745">gPointers</a>[p].c_str();
<a name="l00064"></a>00064 
<a name="l00065"></a>00065    <span class="keywordflow">if</span> (<a class="code" href="a00139.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a>)
<a name="l00066"></a>00066      printf(<span class="stringliteral">&quot;converted %d to \&apos;%s\&apos;\n&quot;</span>, p, name);
<a name="l00067"></a>00067 
<a name="l00068"></a>00068    TObject* obj = gROOT-&gt;FindObjectAny(name);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070    <span class="keywordflow">if</span> (!obj)
<a name="l00071"></a>00071      obj = <a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073    <span class="keywordflow">return</span> (TFolder*) obj;
<a name="l00074"></a>00074 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_a46bb444c1c19c18f6e1cc93126bdd2b2_icgraph.png" border="0" usemap="#a00139_a46bb444c1c19c18f6e1cc93126bdd2b2_icgraph_map" alt=""></div>
<map name="a00139_a46bb444c1c19c18f6e1cc93126bdd2b2_icgraph_map" id="a00139_a46bb444c1c19c18f6e1cc93126bdd2b2_icgraph">
<area shape="rect" id="node3" href="a00139.html#af1ab5f1dddd620d9b2a2977c18a17450" title="root_server_thread" alt="" coords="200,32,352,61"/><area shape="rect" id="node5" href="a00139.html#ae4c520908e89934574ff6a73619ec5ea" title="root_socket_server" alt="" coords="401,5,553,35"/><area shape="rect" id="node11" href="a00140.html#a9e7f85724d1297d2f50530af4e1e8847" title="socket_listener" alt="" coords="415,59,540,88"/><area shape="rect" id="node7" href="a00059.html#aeca754799402cdd99d6eacc8f454d423" title="StartMidasServer" alt="" coords="629,5,768,35"/><area shape="rect" id="node9" href="a00061.html#af280d129baa10e736ba821d2f6bf4682" title="StartNetDirectoryServer" alt="" coords="604,59,793,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af1ab5f1dddd620d9b2a2977c18a17450"></a><!-- doxytag: member="midasServer.cxx::root_server_thread" ref="af1ab5f1dddd620d9b2a2977c18a17450" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void root_server_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00078">78</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>References <a class="el" href="a00139_source.html#l00053">gLastPointer</a>, <a class="el" href="a00139_source.html#l00288">gManaHistosFolder</a>, <a class="el" href="a00139_source.html#l00051">gPointers</a>, <a class="el" href="a00139_source.html#l00052">gRevPointers</a>, <a class="el" href="a00139_source.html#l00035">gVerbose</a>, <a class="el" href="a00139_source.html#l00055">ReadFolderPointer()</a>, <a class="el" href="a00141_source.html#l00052">LockRootGuard::Unlock()</a>, and <a class="el" href="a00139_source.html#l00049">XPOINTER_T</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00256">root_socket_server()</a>, and <a class="el" href="a00140_source.html#l00571">socket_listener()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00082"></a>00082 {
<a name="l00083"></a>00083    <span class="keywordtype">char</span> request[256];
<a name="l00084"></a>00084 
<a name="l00085"></a>00085    TSocket *sock = (TSocket *) arg;
<a name="l00086"></a>00086    TMessage message(kMESS_OBJECT);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    <span class="keywordflow">do</span> {
<a name="l00089"></a>00089 
<a name="l00090"></a>00090       <span class="comment">/* close connection if client has disconnected */</span>
<a name="l00091"></a>00091       <span class="keywordtype">int</span> rd = sock-&gt;Recv(request, <span class="keyword">sizeof</span>(request));
<a name="l00092"></a>00092       <span class="keywordflow">if</span> (rd &lt;= 0) {
<a name="l00093"></a>00093          <span class="comment">// printf(&quot;Closed connection to %s\n&quot;, sock-&gt;GetInetAddress().GetHostName());</span>
<a name="l00094"></a>00094          sock-&gt;Close();
<a name="l00095"></a>00095          <span class="keyword">delete</span> sock;
<a name="l00096"></a>00096          <span class="keywordflow">return</span>;
<a name="l00097"></a>00097       }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099       <span class="keywordflow">if</span> (<a class="code" href="a00139.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a>)
<a name="l00100"></a>00100         printf(<span class="stringliteral">&quot;Request %s\n&quot;</span>, request);
<a name="l00101"></a>00101 
<a name="l00102"></a>00102       <span class="keywordflow">if</span> (strcmp(request, <span class="stringliteral">&quot;GetListOfFolders&quot;</span>) == 0) {
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <a class="code" href="a00007.html">LockRootGuard</a> lock;
<a name="l00105"></a>00105         
<a name="l00106"></a>00106         TFolder *folder = <a class="code" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2">ReadFolderPointer</a>(sock);
<a name="l00107"></a>00107         <span class="keywordflow">if</span> (folder == NULL) {
<a name="l00108"></a>00108           message.Reset(kMESS_OBJECT);
<a name="l00109"></a>00109           message.WriteObject(NULL);
<a name="l00110"></a>00110           lock.<a class="code" href="a00007.html#a6eacd9797b31cb1cbbc213516fe4940f">Unlock</a>();
<a name="l00111"></a>00111           sock-&gt;Send(message);
<a name="l00112"></a>00112           <span class="keywordflow">continue</span>;
<a name="l00113"></a>00113         }
<a name="l00114"></a>00114         <span class="comment">//get folder names</span>
<a name="l00115"></a>00115         TObject *obj;
<a name="l00116"></a>00116         TObjArray *names = <span class="keyword">new</span> TObjArray(100);
<a name="l00117"></a>00117         
<a name="l00118"></a>00118         TCollection *folders = folder-&gt;GetListOfFolders();
<a name="l00119"></a>00119         TIterator *iterFolders = folders-&gt;MakeIterator();
<a name="l00120"></a>00120         <span class="keywordflow">while</span> ((obj = iterFolders-&gt;Next()) != NULL)
<a name="l00121"></a>00121           names-&gt;Add(<span class="keyword">new</span> TObjString(obj-&gt;GetName()));
<a name="l00122"></a>00122         
<a name="l00123"></a>00123         <span class="comment">//write folder names</span>
<a name="l00124"></a>00124         message.Reset(kMESS_OBJECT);
<a name="l00125"></a>00125         message.WriteObject(names);
<a name="l00126"></a>00126         sock-&gt;Send(message);
<a name="l00127"></a>00127         
<a name="l00128"></a>00128         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; names-&gt;GetLast() + 1; i++)
<a name="l00129"></a>00129           <span class="keyword">delete</span>(TObjString *) names-&gt;At(i);
<a name="l00130"></a>00130         
<a name="l00131"></a>00131         <span class="keyword">delete</span> names;
<a name="l00132"></a>00132         
<a name="l00133"></a>00133       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(request, <span class="stringliteral">&quot;FindObject&quot;</span>, 10) == 0) {
<a name="l00134"></a>00134         
<a name="l00135"></a>00135         <a class="code" href="a00007.html">LockRootGuard</a> lock;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137         TFolder *folder = <a class="code" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2">ReadFolderPointer</a>(sock);
<a name="l00138"></a>00138         
<a name="l00139"></a>00139         <span class="comment">//get object</span>
<a name="l00140"></a>00140         TObject *obj;
<a name="l00141"></a>00141         <span class="keywordflow">if</span> (strncmp(request + 10, <span class="stringliteral">&quot;Any&quot;</span>, 3) == 0)
<a name="l00142"></a>00142           obj = folder-&gt;FindObjectAny(request + 14);
<a name="l00143"></a>00143         <span class="keywordflow">else</span>
<a name="l00144"></a>00144           obj = folder-&gt;FindObject(request + 11);
<a name="l00145"></a>00145         
<a name="l00146"></a>00146         <span class="comment">//write object</span>
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (!obj)
<a name="l00148"></a>00148           sock-&gt;Send(<span class="stringliteral">&quot;Error&quot;</span>);
<a name="l00149"></a>00149         <span class="keywordflow">else</span> {
<a name="l00150"></a>00150           message.Reset(kMESS_OBJECT);
<a name="l00151"></a>00151           message.WriteObject(obj);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153           lock.<a class="code" href="a00007.html#a6eacd9797b31cb1cbbc213516fe4940f">Unlock</a>();
<a name="l00154"></a>00154           sock-&gt;Send(message);
<a name="l00155"></a>00155         }
<a name="l00156"></a>00156         
<a name="l00157"></a>00157       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(request, <span class="stringliteral">&quot;FindFullPathName&quot;</span>, 16) == 0) {
<a name="l00158"></a>00158         
<a name="l00159"></a>00159         <a class="code" href="a00007.html">LockRootGuard</a> lock;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161         TFolder *folder = <a class="code" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2">ReadFolderPointer</a>(sock);
<a name="l00162"></a>00162         
<a name="l00163"></a>00163         <span class="comment">//find path</span>
<a name="l00164"></a>00164         <span class="keyword">const</span> <span class="keywordtype">char</span> *path = folder-&gt;FindFullPathName(request + 17);
<a name="l00165"></a>00165         
<a name="l00166"></a>00166         <span class="comment">//write path</span>
<a name="l00167"></a>00167         <span class="keywordflow">if</span> (!path) {
<a name="l00168"></a>00168           sock-&gt;Send(<span class="stringliteral">&quot;Error&quot;</span>);
<a name="l00169"></a>00169         } <span class="keywordflow">else</span> {
<a name="l00170"></a>00170           TObjString *obj = <span class="keyword">new</span> TObjString(path);
<a name="l00171"></a>00171           message.Reset(kMESS_OBJECT);
<a name="l00172"></a>00172           message.WriteObject(obj);
<a name="l00173"></a>00173           lock.<a class="code" href="a00007.html#a6eacd9797b31cb1cbbc213516fe4940f">Unlock</a>();
<a name="l00174"></a>00174           sock-&gt;Send(message);
<a name="l00175"></a>00175           <span class="keyword">delete</span> obj;
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         
<a name="l00178"></a>00178       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(request, <span class="stringliteral">&quot;GetPointer&quot;</span>, 10) == 0) {
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">//find object</span>
<a name="l00181"></a>00181         <a class="code" href="a00139.html#a3685f6e53a22f6b1b1212bda97940395">XPOINTER_T</a> p = 0;
<a name="l00182"></a>00182         TObject *obj = gROOT-&gt;FindObjectAny(request + 11);
<a name="l00183"></a>00183         
<a name="l00184"></a>00184         <span class="comment">//write pointer</span>
<a name="l00185"></a>00185         message.Reset(kMESS_ANY);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="keywordflow">if</span> (obj)
<a name="l00188"></a>00188           {
<a name="l00189"></a>00189             <span class="keyword">const</span> <span class="keywordtype">char</span>* name = obj-&gt;GetName();
<a name="l00190"></a>00190             p = <a class="code" href="a00139.html#a3dbad6df57598a82b1373a69007650bd">gRevPointers</a>[name];
<a name="l00191"></a>00191             <span class="keywordflow">if</span> (p==0)
<a name="l00192"></a>00192               {
<a name="l00193"></a>00193                 p = ++<a class="code" href="a00139.html#a8bfae589a628d948821e2a407e156e28">gLastPointer</a>;
<a name="l00194"></a>00194                 <a class="code" href="a00139.html#a19e514e8ad48b6aac34c4aec04dd9745">gPointers</a>[p] = name;
<a name="l00195"></a>00195                 <a class="code" href="a00139.html#a3dbad6df57598a82b1373a69007650bd">gRevPointers</a>[name] = p;
<a name="l00196"></a>00196               }
<a name="l00197"></a>00197 
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (<a class="code" href="a00139.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a>)
<a name="l00199"></a>00199               printf(<span class="stringliteral">&quot;give %d for \&apos;%s\&apos;\n&quot;</span>, p, name);
<a name="l00200"></a>00200           }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         message &lt;&lt; p;
<a name="l00203"></a>00203         sock-&gt;Send(message);
<a name="l00204"></a>00204         
<a name="l00205"></a>00205       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(request, <span class="stringliteral">&quot;Command&quot;</span>, 7) == 0) {
<a name="l00206"></a>00206         <span class="keywordtype">char</span> objName[100], method[100];
<a name="l00207"></a>00207         sock-&gt;Recv(objName, <span class="keyword">sizeof</span>(objName));
<a name="l00208"></a>00208         sock-&gt;Recv(method, <span class="keyword">sizeof</span>(method));
<a name="l00209"></a>00209 
<a name="l00210"></a>00210         <a class="code" href="a00007.html">LockRootGuard</a> lock;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         TObject *<span class="keywordtype">object</span> = gROOT-&gt;FindObjectAny(objName);
<a name="l00213"></a>00213         <span class="keywordflow">if</span> (<span class="keywordtype">object</span> &amp;&amp; object-&gt;InheritsFrom(TH1::Class())
<a name="l00214"></a>00214             &amp;&amp; strcmp(method, <span class="stringliteral">&quot;Reset&quot;</span>) == 0)
<a name="l00215"></a>00215           static_cast &lt; TH1 * &gt;(<span class="keywordtype">object</span>)-&gt;Reset();
<a name="l00216"></a>00216         
<a name="l00217"></a>00217       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(request, <span class="stringliteral">&quot;SetCut&quot;</span>, 6) == 0) {
<a name="l00218"></a>00218         
<a name="l00219"></a>00219         <span class="comment">//read new settings for a cut</span>
<a name="l00220"></a>00220         <span class="keywordtype">char</span> name[256];
<a name="l00221"></a>00221         sock-&gt;Recv(name, <span class="keyword">sizeof</span>(name));
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <a class="code" href="a00007.html">LockRootGuard</a> lock;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         TCutG *cut = (TCutG *) <a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>-&gt;FindObjectAny(name);
<a name="l00226"></a>00226         
<a name="l00227"></a>00227         TMessage *m = 0;
<a name="l00228"></a>00228         sock-&gt;Recv(m);
<a name="l00229"></a>00229         TCutG *newc = ((TCutG *) m-&gt;ReadObject(m-&gt;GetClass()));
<a name="l00230"></a>00230         
<a name="l00231"></a>00231         <span class="keywordflow">if</span> (cut) {
<a name="l00232"></a>00232           fprintf(stderr, <span class="stringliteral">&quot;root server thread: changing cut %s\n&quot;</span>, newc-&gt;GetName());
<a name="l00233"></a>00233           newc-&gt;TAttMarker::Copy(*cut);
<a name="l00234"></a>00234           newc-&gt;TAttFill::Copy(*cut);
<a name="l00235"></a>00235           newc-&gt;TAttLine::Copy(*cut);
<a name="l00236"></a>00236           newc-&gt;TNamed::Copy(*cut);
<a name="l00237"></a>00237           cut-&gt;Set(newc-&gt;GetN());
<a name="l00238"></a>00238           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; cut-&gt;GetN(); ++i) {
<a name="l00239"></a>00239             cut-&gt;SetPoint(i, newc-&gt;GetX()[i], newc-&gt;GetY()[i]);
<a name="l00240"></a>00240           }
<a name="l00241"></a>00241         } <span class="keywordflow">else</span> {
<a name="l00242"></a>00242           fprintf(stderr, <span class="stringliteral">&quot;root server thread: ignoring receipt of unknown cut \&apos;%s\&apos;\n&quot;</span>,
<a name="l00243"></a>00243                   newc-&gt;GetName());
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245         <span class="keyword">delete</span> newc;
<a name="l00246"></a>00246         
<a name="l00247"></a>00247       } <span class="keywordflow">else</span> {
<a name="l00248"></a>00248         fprintf(stderr, <span class="stringliteral">&quot;midasServer: Received unknown request \&quot;%s\&quot;\n&quot;</span>, request);
<a name="l00249"></a>00249       }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    } <span class="keywordflow">while</span> (1);
<a name="l00252"></a>00252 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_af1ab5f1dddd620d9b2a2977c18a17450_cgraph.png" border="0" usemap="#a00139_af1ab5f1dddd620d9b2a2977c18a17450_cgraph_map" alt=""></div>
<map name="a00139_af1ab5f1dddd620d9b2a2977c18a17450_cgraph_map" id="a00139_af1ab5f1dddd620d9b2a2977c18a17450_cgraph">
<area shape="rect" id="node3" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2" title="ReadFolderPointer" alt="" coords="221,5,368,35"/><area shape="rect" id="node5" href="a00007.html#a6eacd9797b31cb1cbbc213516fe4940f" title="LockRootGuard::Unlock" alt="" coords="207,59,383,88"/><area shape="rect" id="node7" href="a00062.html#a78a97bb7d60bd863c98e75e86e4dc3a0" title="UnlockRoot" alt="" coords="433,59,529,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_af1ab5f1dddd620d9b2a2977c18a17450_icgraph.png" border="0" usemap="#a00139_af1ab5f1dddd620d9b2a2977c18a17450_icgraph_map" alt=""></div>
<map name="a00139_af1ab5f1dddd620d9b2a2977c18a17450_icgraph_map" id="a00139_af1ab5f1dddd620d9b2a2977c18a17450_icgraph">
<area shape="rect" id="node3" href="a00139.html#ae4c520908e89934574ff6a73619ec5ea" title="root_socket_server" alt="" coords="207,5,359,35"/><area shape="rect" id="node9" href="a00140.html#a9e7f85724d1297d2f50530af4e1e8847" title="socket_listener" alt="" coords="220,59,345,88"/><area shape="rect" id="node5" href="a00059.html#aeca754799402cdd99d6eacc8f454d423" title="StartMidasServer" alt="" coords="435,5,573,35"/><area shape="rect" id="node7" href="a00061.html#af280d129baa10e736ba821d2f6bf4682" title="StartNetDirectoryServer" alt="" coords="409,59,599,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae4c520908e89934574ff6a73619ec5ea"></a><!-- doxytag: member="midasServer.cxx::root_socket_server" ref="ae4c520908e89934574ff6a73619ec5ea" args="(void *arg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void root_socket_server </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00256">256</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>References <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00290">StartMidasServer()</a>, and <a class="el" href="a00140_source.html#l00672">StartNetDirectoryServer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00257"></a>00257 {
<a name="l00258"></a>00258 <span class="comment">// Server loop listening for incoming network connections on specified port.</span>
<a name="l00259"></a>00259 <span class="comment">// Starts a searver_thread for each connection.</span>
<a name="l00260"></a>00260    <span class="keywordtype">int</span> port;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262    port = *(<span class="keywordtype">int</span> *) arg;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264    printf(<span class="stringliteral">&quot;MIDAS ROOT server listening on port %d...\n&quot;</span>, port);
<a name="l00265"></a>00265    TServerSocket *lsock = <span class="keyword">new</span> TServerSocket(port, kTRUE);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="keywordflow">do</span> {
<a name="l00268"></a>00268       TSocket *sock = lsock-&gt;Accept();
<a name="l00269"></a>00269 
<a name="l00270"></a>00270       <span class="keywordflow">if</span> (sock==NULL) {
<a name="l00271"></a>00271         fprintf(stderr, <span class="stringliteral">&quot;MIDAS ROOT server accept() error\n&quot;</span>);
<a name="l00272"></a>00272         <span class="keywordflow">break</span>;
<a name="l00273"></a>00273       }
<a name="l00274"></a>00274 
<a name="l00275"></a>00275       <span class="comment">// printf(&quot;Established connection to %s\n&quot;, sock-&gt;GetInetAddress().GetHostName());</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277       TThread *thread = <span class="keyword">new</span> TThread(<span class="stringliteral">&quot;Server&quot;</span>, <a class="code" href="a00139.html#af1ab5f1dddd620d9b2a2977c18a17450">root_server_thread</a>, (<span class="keywordtype">void</span>*)sock);
<a name="l00278"></a>00278       thread-&gt;Run();
<a name="l00279"></a>00279 <span class="preprocessor">#if 0</span>
<a name="l00280"></a>00280 <span class="preprocessor"></span>      LPDWORD lpThreadId = 0;
<a name="l00281"></a>00281       CloseHandle(CreateThread(NULL, 1024, &amp;<a class="code" href="a00139.html#af1ab5f1dddd620d9b2a2977c18a17450">root_server_thread</a>, sock, 0, lpThreadId));
<a name="l00282"></a>00282 <span class="preprocessor">#endif</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>   } <span class="keywordflow">while</span> (1);
<a name="l00284"></a>00284 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_ae4c520908e89934574ff6a73619ec5ea_cgraph.png" border="0" usemap="#a00139_ae4c520908e89934574ff6a73619ec5ea_cgraph_map" alt=""></div>
<map name="a00139_ae4c520908e89934574ff6a73619ec5ea_cgraph_map" id="a00139_ae4c520908e89934574ff6a73619ec5ea_cgraph">
<area shape="rect" id="node3" href="a00139.html#af1ab5f1dddd620d9b2a2977c18a17450" title="root_server_thread" alt="" coords="208,32,360,61"/><area shape="rect" id="node5" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2" title="ReadFolderPointer" alt="" coords="424,5,571,35"/><area shape="rect" id="node7" href="a00007.html#a6eacd9797b31cb1cbbc213516fe4940f" title="LockRootGuard::Unlock" alt="" coords="409,59,585,88"/><area shape="rect" id="node9" href="a00062.html#a78a97bb7d60bd863c98e75e86e4dc3a0" title="UnlockRoot" alt="" coords="636,59,732,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_ae4c520908e89934574ff6a73619ec5ea_icgraph.png" border="0" usemap="#a00139_ae4c520908e89934574ff6a73619ec5ea_icgraph_map" alt=""></div>
<map name="a00139_ae4c520908e89934574ff6a73619ec5ea_icgraph_map" id="a00139_ae4c520908e89934574ff6a73619ec5ea_icgraph">
<area shape="rect" id="node3" href="a00059.html#aeca754799402cdd99d6eacc8f454d423" title="StartMidasServer" alt="" coords="235,5,373,35"/><area shape="rect" id="node5" href="a00061.html#af280d129baa10e736ba821d2f6bf4682" title="StartNetDirectoryServer" alt="" coords="209,59,399,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aeca754799402cdd99d6eacc8f454d423"></a><!-- doxytag: member="midasServer.cxx::StartMidasServer" ref="aeca754799402cdd99d6eacc8f454d423" args="(int port)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void StartMidasServer </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>port</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00290">290</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>References <a class="el" href="a00139_source.html#l00288">gManaHistosFolder</a>, <a class="el" href="a00139_source.html#l00256">root_socket_server()</a>, and <a class="el" href="a00141_source.html#l00114">StartLockRootTimer()</a>.</p>

<p>Referenced by <a class="el" href="a00049_source.html#l00521">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00291"></a>00291 {
<a name="l00292"></a>00292   <span class="comment">/* create the folder for analyzer histograms */</span>
<a name="l00293"></a>00293   <a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a> = gROOT-&gt;GetRootFolder()-&gt;AddFolder(<span class="stringliteral">&quot;histos&quot;</span>, <span class="stringliteral">&quot;MIDAS Analyzer Histograms&quot;</span>);
<a name="l00294"></a>00294   gROOT-&gt;GetListOfBrowsables()-&gt;Add(<a class="code" href="a00058.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a>, <span class="stringliteral">&quot;histos&quot;</span>);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <a class="code" href="a00062.html#aae77a7cf2fc9f586fcfcb244ce1e9cc6">StartLockRootTimer</a>();
<a name="l00297"></a>00297   
<a name="l00298"></a>00298   <span class="keyword">static</span> <span class="keywordtype">int</span> pport = port;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   TThread *thread = <span class="keyword">new</span> TThread(<span class="stringliteral">&quot;server_loop&quot;</span>, <a class="code" href="a00139.html#ae4c520908e89934574ff6a73619ec5ea">root_socket_server</a>, (<span class="keywordtype">void</span>*)&amp;pport);
<a name="l00301"></a>00301   thread-&gt;Run();
<a name="l00302"></a>00302 
<a name="l00303"></a>00303 <span class="preprocessor">#if 0</span>
<a name="l00304"></a>00304 <span class="preprocessor"></span>  LPDWORD lpThreadId = 0;
<a name="l00305"></a>00305   CloseHandle(CreateThread(NULL, 1024, &amp;<a class="code" href="a00139.html#ae4c520908e89934574ff6a73619ec5ea">root_socket_server</a>, &amp;pport, 0, lpThreadId));
<a name="l00306"></a>00306 <span class="preprocessor">#endif</span>
<a name="l00307"></a>00307 <span class="preprocessor"></span>}
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_aeca754799402cdd99d6eacc8f454d423_cgraph.png" border="0" usemap="#a00139_aeca754799402cdd99d6eacc8f454d423_cgraph_map" alt=""></div>
<map name="a00139_aeca754799402cdd99d6eacc8f454d423_cgraph_map" id="a00139_aeca754799402cdd99d6eacc8f454d423_cgraph">
<area shape="rect" id="node3" href="a00139.html#ae4c520908e89934574ff6a73619ec5ea" title="root_socket_server" alt="" coords="196,32,348,61"/><area shape="rect" id="node13" href="a00062.html#aae77a7cf2fc9f586fcfcb244ce1e9cc6" title="StartLockRootTimer" alt="" coords="193,85,351,115"/><area shape="rect" id="node5" href="a00139.html#af1ab5f1dddd620d9b2a2977c18a17450" title="root_server_thread" alt="" coords="400,32,552,61"/><area shape="rect" id="node7" href="a00139.html#a46bb444c1c19c18f6e1cc93126bdd2b2" title="ReadFolderPointer" alt="" coords="616,5,763,35"/><area shape="rect" id="node9" href="a00007.html#a6eacd9797b31cb1cbbc213516fe4940f" title="LockRootGuard::Unlock" alt="" coords="601,59,777,88"/><area shape="rect" id="node11" href="a00062.html#a78a97bb7d60bd863c98e75e86e4dc3a0" title="UnlockRoot" alt="" coords="828,59,924,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="a00139_aeca754799402cdd99d6eacc8f454d423_icgraph.png" border="0" usemap="#a00139_aeca754799402cdd99d6eacc8f454d423_icgraph_map" alt=""></div>
<map name="a00139_aeca754799402cdd99d6eacc8f454d423_icgraph_map" id="a00139_aeca754799402cdd99d6eacc8f454d423_icgraph">
<area shape="rect" id="node3" href="a00049.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="193,5,247,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2260603b1f294b352b8cef4241aac374"></a><!-- doxytag: member="midasServer.cxx::VerboseMidasServer" ref="a2260603b1f294b352b8cef4241aac374" args="(bool verbose)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void VerboseMidasServer </td>
          <td>(</td>
          <td class="paramtype">bool&nbsp;</td>
          <td class="paramname"> <em>verbose</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00037">37</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>References <a class="el" href="a00139_source.html#l00035">gVerbose</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00038"></a>00038 {
<a name="l00039"></a>00039   fprintf(stderr, <span class="stringliteral">&quot;VerboseMidasServer: change verbose level from %d to %d\n&quot;</span>, <a class="code" href="a00139.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a>, verbose);
<a name="l00040"></a>00040   <a class="code" href="a00139.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a> = verbose;
<a name="l00041"></a>00041 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a8bfae589a628d948821e2a407e156e28"></a><!-- doxytag: member="midasServer.cxx::gLastPointer" ref="a8bfae589a628d948821e2a407e156e28" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">XPOINTER_T <a class="el" href="a00139.html#a8bfae589a628d948821e2a407e156e28">gLastPointer</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00053">53</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a5fa7695c5cc2f2ec1604f9c83bc7c737"></a><!-- doxytag: member="midasServer.cxx::gManaHistosFolder" ref="a5fa7695c5cc2f2ec1604f9c83bc7c737" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TFolder* <a class="el" href="a00059.html#a5fa7695c5cc2f2ec1604f9c83bc7c737">gManaHistosFolder</a> = NULL</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00288">288</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>Referenced by <a class="el" href="a00049_source.html#l00135">endRun()</a>, <a class="el" href="a00049_source.html#l00157">HandleSample()</a>, <a class="el" href="a00145_source.html#l00149">main()</a>, <a class="el" href="a00139_source.html#l00055">ReadFolderPointer()</a>, <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>, and <a class="el" href="a00139_source.html#l00290">StartMidasServer()</a>.</p>

</div>
</div>
<a class="anchor" id="a19e514e8ad48b6aac34c4aec04dd9745"></a><!-- doxytag: member="midasServer.cxx::gPointers" ref="a19e514e8ad48b6aac34c4aec04dd9745" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;XPOINTER_T,std::string&gt; <a class="el" href="a00139.html#a19e514e8ad48b6aac34c4aec04dd9745">gPointers</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00051">51</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00055">ReadFolderPointer()</a>, and <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a3dbad6df57598a82b1373a69007650bd"></a><!-- doxytag: member="midasServer.cxx::gRevPointers" ref="a3dbad6df57598a82b1373a69007650bd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;std::string,XPOINTER_T&gt; <a class="el" href="a00139.html#a3dbad6df57598a82b1373a69007650bd">gRevPointers</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00052">52</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a4ae8be9a29156353385c2cd257d01c44"></a><!-- doxytag: member="midasServer.cxx::gVerbose" ref="a4ae8be9a29156353385c2cd257d01c44" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="a00144.html#a4ae8be9a29156353385c2cd257d01c44">gVerbose</a> = false<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="a00139_source.html#l00035">35</a> of file <a class="el" href="a00139_source.html">midasServer.cxx</a>.</p>

<p>Referenced by <a class="el" href="a00139_source.html#l00055">ReadFolderPointer()</a>, <a class="el" href="a00139_source.html#l00078">root_server_thread()</a>, and <a class="el" href="a00139_source.html#l00037">VerboseMidasServer()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 15 May 2013 for ROOT Analyzer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
