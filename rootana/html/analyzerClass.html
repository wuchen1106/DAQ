<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ROOT Analyzer: Analyzer Classes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="analyzerClass">Analyzer Classes </a></h1><h2><a class="anchor" id="analyzerIntro">
Introduction</a></h2>
<p>This set of classes provides the following functionality</p>
<ul>
<li>A class <a class="el" href="a00038.html">TRootanaEventLoop</a> that handles most of the functionality associated with an event loop. The user creates a derived class that inherits from <a class="el" href="a00038.html">TRootanaEventLoop</a>.</li>
<li>A set of bank decoder classes.</li>
</ul>
<p>These classes depend on the Midas interface classes (<a class="el" href="a00031.html" title="Reader for MIDAS .mid files.">TMidasFile</a>, <a class="el" href="a00030.html" title="MIDAS event.">TMidasEvent</a>, <a class="el" href="a00032.html" title="MIDAS online connection, including access to online ODB.">TMidasOnline</a>).</p>
<h2><a class="anchor" id="eventLoop">
Event Loop Class</a></h2>
<p>The <a class="el" href="a00038.html">TRootanaEventLoop</a> provides the functionality to handle many of the features for a standard event loop including</p>
<ul>
<li>looping over events in a midas file or</li>
<li>getting online events by connecting to midas server</li>
</ul>
<p>The idea is that the user provides a class that derives from <a class="el" href="a00038.html">TRootanaEventLoop</a>. This derived class would provides begin-of-run actions, end-of-run actions and midas event actions.</p>
<p>The following simple example shows a full program that simply prints out the event number for each event:</p>
<div class="fragment"><pre class="fragment">
#include &lt;stdio.h&gt;
#include "TRootanaEventLoop.hxx"

class Analyzer: public TRootanaEventLoop {
public:

  Analyzer() {};

  virtual ~Analyzer() {};

  void BeginRun(int transition,int run,int time){}

  // Get the midas event and print event number
  bool ProcessMidasEvent(TDataContainer&amp; dataContainer){
    std::cout &lt;&lt; "Event Number " &lt;&lt; dataContainer.GetMidasEvent().GetSerialNumber() &lt;&lt; std::endl;
    return true;
  }
};   

int main(int argc, char *argv[])
{  
  Analyzer::CreateSingleton&lt;Analyzer&gt;();
  return Analyzer::Get().ExecuteLoop(argc, argv);
}  
</pre></div><h2><a class="anchor" id="histogramCreation">
Histogram Creation, Begin-Of-Run/End-Of-Run</a></h2>
<p>Users will naturally want to create and fill ROOT histograms. This needs to be done with some care because of:</p>
<ul>
<li>interaction with the output ROOT file: by default, for each run, the analyzer opens a new ROOT file outputNNNNN.root and make it the current directory (gOutputFile) for newly created ROOT objects, i.e. those create by "new TH1(...)". At the end of a run, all these objects are saved into the file, the file is closed and all these objects disappear from memory. To create ROOT objects that persist across runs, use some other ROOT directory (i.e. gOnlineHistDir-&gt;cd()).</li>
<li>when using the netDirectoryServer (HAVE_LIBNETDIRECTORY), the contents of gOnlineHistDir and gOutputFile are exported to outside applications. Other programs, i.e. ROODY, can use <a class="el" href="a00034.html">TNetDirectory</a> to "see" the histograms (and other objects) as they are filled. (Note: this does not work for most TTree objects because they cannot be easily "exported").</li>
</ul>
<p>The general rule is therefore that you should create histograms in your event loop BeginRun() function, rather than in the constructor or the Initialize() method. That is the only way to ensure that the histograms are created after the output ROOT file is created. Also, you should ensure that you delete the old histograms before producing new ones. The following example shows how this would look:</p>
<div class="fragment"><pre class="fragment">
#include &lt;stdio.h&gt;
#include "TRootanaEventLoop.hxx"
#include &lt;TH1F.h&gt; 

class Analyzer: public TRootanaEventLoop {
private:
  
  TH1F* evtno_histo; // histogram the event numbers.
  
public:

  Analyzer() {
    evtno_histo = 0; // initialize pointer to null.
  };

  virtual ~Analyzer() {};

  void BeginRun(int transition,int run,int time){
    // delete old histogram, if it exists.
    TH1F *old = (TH1F*)gDirectory-&gt;Get("evtno_histo");
    if (old) delete old;

    // create new histogram
    evtno_histo = new TH1F("evtno_histo","Event Number Histogram",1000,0,10000);
  }

  bool ProcessMidasEvent(TDataContainer&amp; dataContainer){
    evtno_histo-&gt;Fill(dataContainer.GetMidasEvent().GetSerialNumber());
    return true;
  }
}; 

int main(int argc, char *argv[])  
{
  Analyzer::CreateSingleton&lt;Analyzer&gt;();  
  return Analyzer::Get().ExecuteLoop(argc, argv);  
}
</pre></div><p>You also have disable the automatic creation of ROOT files for each run by using the function TRootanaEventLoop::DisableRootOutput(true) and then create histograms where ever you want in your program.</p>
<h2><a class="anchor" id="decoder">
Bank Decoder</a></h2>
<p>Naturally we want to do more than just checking the event numbers; we need to process the data in the data banks. The rootana analyzer classes facilitate this by providing decoding classes for a number of standard MIDAS banks.</p>
<p>Since the data being stored in each bank is different, the format of the decoder classes will also be quite different. You should see the individual decoders to see how the data is organized; for now we currently have the following decoders:</p>
<ul>
<li><a class="el" href="a00042.html" title="Class for storing data from CAEN V792 module.">TV792Data</a></li>
<li><a class="el" href="a00041.html">TV1190Data</a></li>
<li><a class="el" href="a00025.html">TMesytecData</a></li>
</ul>
<p>The following example shows how to acces information for a particular V792 bank called 'ADC0' and histogram the results:</p>
<div class="fragment"><pre class="fragment">
#include &lt;stdio.h&gt;
#include "TRootanaEventLoop.hxx"
#include &lt;TH1F.h&gt;
#include &lt;TV792Data.hxx&gt;

class Analyzer: public TRootanaEventLoop {
private:
  
  TH1F* adc; // ADC spectrum for all V792 channels in bank.
  
public:

  Analyzer() {
    adc = 0; // initialize pointer to null.
  };

  virtual ~Analyzer() {};

  void BeginRun(int transition,int run,int time){
    // delete old histogram, if it exists.
    TH1F *old = (TH1F*)gDirectory-&gt;Get("adc");
    if (old) delete old;

    // create new histogram
    adc = new TH1F("adc","V792 ADC Spectrum",4200,0,4200);
  }

  bool ProcessMidasEvent(TDataContainer&amp; dataContainer){

    // Get pointer to the V792 decoded data; need to provide the 
    // bank name.
    TV792Data *data = dataContainer.GetEventData&lt;TV792Data&gt;("ADC0");
    if(data){
      // Loop over all measurement for all channels
      std::vector&lt;VADCMeasurement&gt; measurements = data-&gt;GetMeasurements();
      for(unsigned int i = 0; i &lt; measurements.size(); i++){ // loop over measurements
        adc-&gt;Fill(measurements[i].GetMeasurement());
      }
    }
    
    return true;
  }
}; 

int main(int argc, char *argv[])
{
  Analyzer::CreateSingleton&lt;Analyzer&gt;();
  return Analyzer::Get().ExecuteLoop(argc, argv);
}
</pre></div><p>You can also get access to the raw information in the MIDAS banks, if you haven't yet written a decoder for a particular bank type. You do this by doing accessing a bank using the <a class="el" href="a00021.html">TGenericData</a> class.</p>
<h2><a class="anchor" id="histogram">
Histogram Classes</a></h2>
<p>We also provide an ABC class for set of histograms: <a class="el" href="a00023.html">THistogramArrayBase</a>. The derived histogram-set class would specify how to create and fill an interesting set of histograms. The hope is that these generic histogram-sets would make it easy to provide generic analyzer displays.</p>
<p>It remains to be seen how useful these histogram-set classes are in other context.</p>
<p>T. Lindner </p>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 15 May 2013 for ROOT Analyzer by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
