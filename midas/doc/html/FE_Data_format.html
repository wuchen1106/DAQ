<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Data formats written by the frontend</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="FrontendOperation.html">SECTION 6: Frontend Operation</a>&nbsp;&raquo&nbsp;<a class="el" href="Frontend_code.html">Frontend code</a>&nbsp;&raquo&nbsp;<a class="el" href="FE_Appendices.html">Frontend Appendices</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="FE_Data_format">Data formats written by the frontend </a></h1><p><br/>
</p>
 
<script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "FE_Appendices","FrontendOperation", "FE_Hardware","FE_Data_format","end" );

// section parameters: last section; top of this section; next section
sections("RunControl","FrontendOperation","DataAnalysis");
</script>
<p><br/>
 <br/>
 <a class="anchor" id="idx_format_frontend"></a> Only two formats are now now supported by the frontend, <a class="el" href="FE_Data_format.html#FE_Midas_format">MIDAS</a> and <a class="el" href="FE_bank_construction.html#FE_FIXED_event_readout">FIXED</a> (support for YBOS format has been discontinued (<a class="el" href="NDF.html#ndf_sep_2010">Sep 2010</a>). <a class="el" href="FE_bank_construction.html#FE_MIDAS_event_construction">MIDAS event construction</a> has been described previously. This section gives a detailed description of the MIDAS format.</p>
<p>Note that a frontend cannot write data directly into ROOT format. A conversion to ROOT may be done (e.g. by the data logger) from one of the supported formats (see <a class="el" href="FE_table.html#FE_tbl_Format">equipment list</a> for details).</p>
<p><a class="anchor" id="idx_format_MIDAS"></a> <a class="anchor" id="idx_Midas_format"></a> <a class="anchor" id="Midas_format"></a> <hr/>
 <h2><a class="anchor" id="FE_Midas_format">
MIDAS format</a></h2>
<p>Special formats are used in MIDAS for the event header, banks and when writing to disk or tape. This section explains these formats in detail. Each event carries a 16-byte header. The header is generated by the front-end with the <a class="el" href="group__bmfunctionc.html#gac5e3e469fb6721a502ebd80a35a328f5">bm_compose_event()</a> routine and is used by consumers to distinguish between different events. The header is defined in the <a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> structure in <a class="el" href="midas_8h.html">midas.h</a>. It has following structure:</p>
<center><span class="image"> Figure 1: Event and bank headers with data block.</span> </p>
<div align="center">
<img src="mEHBH.jpg" alt="mEHBH.jpg"/>
</div>
 </center><ul>
<li>The <a class="el" href="FE_table.html#FE_tbl_EventID">event ID</a> describes the type of event. Usually 1 is used for triggered events, 2 for scaler events, 3 for HV events etc.</li>
<li>The <a class="el" href="FE_table.html#FE_tbl_TrigMask">trigger mask</a> can be used to describe the sub-type of an event. A trigger event can have different trigger sources like "physics event", "calibration event", "clock event". These trigger sources are usually read in by the front-end in a pattern unit. Consumers can request events with a specific triggering mask.</li>
<li>The <b>serial number</b> starts at 1 and is incremented by the front-end for each event.</li>
<li>The <b>time stamp</b> is written by the front-end before an event is read out. It uses the time() function which returns the time in seconds since 1.1.1970 00:00:00 UTC.</li>
<li>The <b>data size</b> contains the number of bytes that follows the event header.</li>
<li>The <b>data area</b> of the event can contain information in any user format (integer, real etc.), although only certain formats are supported when events are copied to the ODB or written by the logger in ASCII format.</li>
</ul>
<p><a class="anchor" id="idx_byte-ordering"></a> Event headers are always kept in the <b>byte ordering</b> of the local machine. If events are sent over the network between computers with different byte ordering, the event header is swapped automatically, but not the event contents.</p>
<h3><a class="anchor" id="FE_Bank_Format">
Bank Format</a></h3>
<p>Events in MIDAS format contain "MIDAS banks". A bank is a substructure of an event and can contain only one type of data, either a single value or an array of values. Banks have a name of exactly four characters, which are treated as a <b>bank ID</b>. Banks in an event consist of a <b>global</b> bank header and an <b>individual</b> bank header for each bank.</p>
<p>Figure 2 shows a MIDAS event containing banks coloured to match the structure in Figure 1. This has been obtained from a MIDAS data file using the <a class="el" href="RC_Monitor.html#RC_mdump_utility">mdump utility</a>.</p>
<p><br/>
<br/>
 <span class="image"> Figure 2: Example of MIDAS banks dumped by <span class="client">mdump</span>.</span> <br/>
 ------------------------ Event# 2 --------------------------------<br/>
 <span style="background-color: rgb(204, 204, 255);">Evid:000d- Mask:0000- Serial:0- Time:0x4c7a6869- Dsize:48/0x30</span><br/>
 <span style="background-color: lightgreen;">#banks:1 - Bank list:-SDAS-</span><br/>
 <br/>
 <span style="background-color: orange;">Bank:SDAS Length: 32(I*1)/8(I*4)/8(Type)Type:Real*4 (FMT machine dependent)</span><br/>
 <span style="background-color: pink;"> 1-&gt; 4.000e+00 1.000e+01 1.000e+00 3.400e+00 3.400e+00 3.400e+00 3.400e+00 3.400e+00</span><br/>
 <br/>
 ------------------------ Event# 3 --------------------------------<br/>
 <span style="background-color: rgb(204, 204, 255);">Evid:0001- Mask:0000- Serial:0- Time:0x4c7a686b- Dsize:344/0x158</span><br/>
 <span style="background-color: lightgreen;">#banks:2 - Bank list:-MPETMCPP-</span><br/>
 <br/>
 <span style="background-color: orange;">Bank:MPET Length: 304(I*1)/76(I*4)/76(Type) Type:Unsigned Integer*4</span><br/>
 <span style="background-color: pink;"> 1-&gt; 0x80010000 0x00000002 0x10010000 0x00004e21 0x80020000 0x00000002 0x20020000 0x000015f4<br/>
 9-&gt; 0x20020000 0x00001660 0x20020000 0x0000185f 0x20020000 0x0000191e 0x20020000 0x000019d6<br/>
 17-&gt; 0x40020000 0x00001a37 0x20020000 0x00001a77 0x20020000 0x00001ba2 0x10020000 0x00004e22<br/>
 25-&gt; 0x80030000 0x00000002 0x20030000 0x00001637 0x20030000 0x000018d1 0x20030000 0x000019bc<br/>
 33-&gt; 0x20030000 0x00001b35 0x20030000 0x00001bb2 0x10030000 0x00004e21 0x80040000 0x00000002<br/>
 41-&gt; 0x10040000 0x00004e22 0x80050000 0x00000002 0x20050000 0x000013c5 0x20050000 0x000017f2<br/>
 49-&gt; 0x20050000 0x0000185f 0x20050000 0x00001976 0x20050000 0x00001aa8 0x10050000 0x00004e21<br/>
 57-&gt; 0x80060000 0x00000002 0x20060000 0x000015c3 0x20060000 0x000018d8 0x20060000 0x0000198d<br/>
 65-&gt; 0x20060000 0x00001ac4 0x10060000 0x00004e22 0x80070000 0x00000002 0x20070000 0x00001747<br/>
 73-&gt; 0x20070000 0x000019ae 0x10070000 0x00004e21</span><br/>
 <br/>
 <span style="background-color: orange;">Bank:MCPP Length: 16(I*1)/4(I*4)/4(Type) Type:Unsigned Integer*4</span><br/>
 <span style="background-color: pink;"> 1-&gt; 0x00005e4c 0x0000352d 0x00006453 0x00006d5b</span><br/>
 <br/>
</p>
<p>The "data size total" is the size in bytes of all bank headers and bank data. Flags are currently not used. The bank header contains four characters as identification, a bank type that is one of the TID_xxx values defined in <a class="el" href="midas_8h.html">midas.h</a>, and the data size in bytes. If the byte ordering of the contents of a complete event has to be swapped, the routine <a class="el" href="group__bkfunctionc.html#ga44b7381af9b91fbdf2f6d59f55451ea1">bk_swap()</a> can be used.</p>
<p><br/>
<hr/>
<br/>
 <a class="anchor" id="idx_format_Midas_Tape"></a> </p>
<h3><a class="anchor" id="Tape">
Format</a></h3>
<p>Events are written to disk files without any reformatting. For tapes, however, a fixed block size is used. The block size TAPE_BUFFER_SIZE is defined in <a class="el" href="midas_8h.html">midas.h</a> and usually 32kB. Three special events are produced by the system. A begin-of-run (BOR) and end-of-run (EOR) event is produced which contains an ASCII dump of the ODB in its data area. Their IDs is 0x8000 (BOR) and 0x8001 (EOR). A message event (ID 0x8002) is created if Log messages is enabled in the logger channel setting. The message is contained in the data area as an ASCII string. The BOR event has the number MIDAS_MAGIC (0x494d or 'MI') as the trigger mask and the current run number as the serial number. A tape can therefore be identified as a MIDAS formatted tape. The routine tape_copy() in the utility mtape.c is an example of how to read a tape in MIDAS format.</p>
<p><a class="anchor" id="end"></a></p>
<p><br/>
</p>
 
<script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "FE_Appendices","FrontendOperation", "FE_Hardware","FE_Data_format","" );

// section parameters: last section; top of this section; next section
sections("RunControl","FrontendOperation","DataAnalysis");
</script>
<p><br/>
 </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

