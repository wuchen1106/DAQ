<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Midas Buffer Manager Functions (bm_xxx)</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Midas Buffer Manager Functions (bm_xxx)<br/>
<small>
[<a class="el" href="group__midasincludecode.html">The midas.h &amp; midas.c</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga181dcf462745127aa3d011a2e3fee805">bm_match_event</a> (short int event_id, short int trigger_mask, <a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *pevent)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#gaf13b277e24b666918ee8aec0160f5288">bm_remove_client_locked</a> (<a class="el" href="structBUFFER__HEADER.html">BUFFER_HEADER</a> *pheader, int j)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga6a2a39a8d4d4a0302ec443762e7a34b4">bm_cleanup_buffer_locked</a> (int i, const char *who, <a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mevb_8c.html#a6431147bd66aebfe3ca728d244da1253">actual_time</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga2109ffa213706ade60f0b054d6c39164">cm_update_last_activity</a> (<a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mevb_8c.html#a6431147bd66aebfe3ca728d244da1253">actual_time</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga7ea560e34b23fa5fbf9596c2cc9d156d">bm_cleanup</a> (const char *who, <a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> <a class="el" href="mevb_8c.html#a6431147bd66aebfe3ca728d244da1253">actual_time</a>, <a class="el" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a> wrong_interval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer</a> (char *<a class="el" href="mevb_8c.html#a93bc09c1f5f9f26a081d11962971f301">buffer_name</a>, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_size, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *buffer_handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga7b2cbde6caa572dfc978c780d63ab6be">bm_close_buffer</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga3a2dae045156606fc157e01a82983a25">bm_close_all_buffers</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga2689ca85c6d0023f1a02e6827a5eff6e">bm_set_cache_size</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> read_size, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> write_size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#gac5e3e469fb6721a502ebd80a35a328f5">bm_compose_event</a> (<a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *event_header, short int event_id, short int trigger_mask, <a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> size, <a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a> serial)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#gabf663d96482aeede1846487a7ada8184">bm_request_event</a> (HNDLE buffer_handle, short int event_id, short int trigger_mask, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> sampling_type, HNDLE *request_id, void(*func)(HNDLE, HNDLE, <a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *, void *))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga7810d29ac3894a4e299737bc7c7a2cf1">bm_remove_event_request</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> request_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga33221a55f8c90e411dea5eb34a2ee773">bm_delete_request</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> request_id)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga499b14a246f8ab8d5a3b6ec77bfa9407">bm_send_event</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, void *source, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buf_size, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> async_flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga9b74b8aa633c942682e642acba93c51d">bm_flush_cache</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> async_flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga2fd8bb52ad5282be3ce076e84bc007fa">bm_receive_event</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle, void *destination, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *buf_size, <a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> async_flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga4a12567d843b2e1d20da58d8abfabb04">bm_skip_event</a> (<a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> buffer_handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#gabcc6bb732b720fcc3ffe859f732a07e0">bm_push_event</a> (char *<a class="el" href="mevb_8c.html#a93bc09c1f5f9f26a081d11962971f301">buffer_name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga6f72d4840fd9ca14a9864252fe5d8b3a">bm_check_buffers</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__bmfunctionc.html#ga516c50d818df89f466ac1fc135120fa6">bm_empty_buffers</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>dox dox dox </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga6f72d4840fd9ca14a9864252fe5d8b3a"></a><!-- doxytag: member="midas.c::bm_check_buffers" ref="ga6f72d4840fd9ca14a9864252fe5d8b3a" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_check_buffers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check if any requested event is waiting in a buffer </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE More events are waiting<br/>
 FALSE No more events are waiting </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l07660">7660</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04229">cm_yield()</a>.</p>

</div>
</div>
<a class="anchor" id="ga7ea560e34b23fa5fbf9596c2cc9d156d"></a><!-- doxytag: member="midas.c::bm_cleanup" ref="ga7ea560e34b23fa5fbf9596c2cc9d156d" args="(const char *who, DWORD actual_time, BOOL wrong_interval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_cleanup </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>actual_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a>&nbsp;</td>
          <td class="paramname"> <em>wrong_interval</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check all clients on all buffers, remove invalid clients </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04521">4521</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04595">bm_open_buffer()</a>, and <a class="el" href="midas_8c_source.html#l06473">bm_wait_for_free_space()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6a2a39a8d4d4a0302ec443762e7a34b4"></a><!-- doxytag: member="midas.c::bm_cleanup_buffer_locked" ref="ga6a2a39a8d4d4a0302ec443762e7a34b4" args="(int i, const char *who, DWORD actual_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_cleanup_buffer_locked </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>who</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>actual_time</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check all clients on buffer, remove invalid clients </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04445">4445</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04521">bm_cleanup()</a>, and <a class="el" href="midas_8c_source.html#l04595">bm_open_buffer()</a>.</p>

</div>
</div>
<a class="anchor" id="ga3a2dae045156606fc157e01a82983a25"></a><!-- doxytag: member="midas.c::bm_close_all_buffers" ref="ga3a2dae045156606fc157e01a82983a25" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_close_all_buffers </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Close all open buffers </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04946">4946</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l02511">cm_disconnect_experiment()</a>, and <a class="el" href="midas_8c_source.html#l01702">cm_set_client_info()</a>.</p>

</div>
</div>
<a class="anchor" id="ga7b2cbde6caa572dfc978c780d63ab6be"></a><!-- doxytag: member="midas.c::bm_close_buffer" ref="ga7b2cbde6caa572dfc978c780d63ab6be" args="(INT buffer_handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_close_buffer </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Closes an event buffer previously opened with <a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer()</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>buffer handle </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04826">4826</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04946">bm_close_all_buffers()</a>, and <a class="el" href="mevb_8c_source.html#l00914">source_unbooking()</a>.</p>

</div>
</div>
<a class="anchor" id="gac5e3e469fb6721a502ebd80a35a328f5"></a><!-- doxytag: member="midas.c::bm_compose_event" ref="gac5e3e469fb6721a502ebd80a35a328f5" args="(EVENT_HEADER *event_header, short int event_id, short int trigger_mask, DWORD size, DWORD serial)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_compose_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>event_header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int&nbsp;</td>
          <td class="paramname"> <em>trigger_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>serial</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Compose a Midas event header. An event header can usually be set-up manually or through this routine. If the data size of the event is not known when the header is composed, it can be set later with event_header-&gt;data-size = &lt;...&gt; Following structure is created at the beginning of an event </p>
<div class="fragment"><pre class="fragment"><span class="keyword">typedef</span> <span class="keyword">struct </span>{
 <span class="keywordtype">short</span> <span class="keywordtype">int</span>     event_id;
 <span class="keywordtype">short</span> <span class="keywordtype">int</span>     trigger_mask;
 <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a>         serial_number;
 <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a>         time_stamp;
 <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a>         data_size;
} <a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>;

<span class="keywordtype">char</span> <span class="keyword">event</span>[1000];
 <a class="code" href="group__bmfunctionc.html#gac5e3e469fb6721a502ebd80a35a328f5">bm_compose_event</a>((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *)event, 1, 0, 100, 1);
 *(<span class="keyword">event</span>+<span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>)) = &lt;...&gt;
</pre></div> <dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_header</em>&nbsp;</td><td>pointer to the event header </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>event_id</em>&nbsp;</td><td>event ID of the event </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>trigger_mask</em>&nbsp;</td><td>trigger mask of the event </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>size if the data part of the event in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>serial</em>&nbsp;</td><td>serial number </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l05901">5901</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l00904">cm_msg1()</a>, <a class="el" href="midas_8c_source.html#l00662">cm_msg_send_event()</a>, and <a class="el" href="mevb_8c_source.html#l00997">source_scan()</a>.</p>

</div>
</div>
<a class="anchor" id="ga59590af56aeabd24fce9112ca32ffecf"></a><!-- doxytag: member="midas.c::bm_convert_event_header" ref="ga59590af56aeabd24fce9112ca32ffecf" args="(EVENT_HEADER *pevent, int convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_convert_event_header </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pevent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06416">6416</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06428">bm_copy_from_cache()</a>, and <a class="el" href="midas_8c_source.html#l07094">bm_receive_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga3c7b7fc1483b9cdcb5ee4a6baef102e2"></a><!-- doxytag: member="midas.c::bm_copy_from_cache" ref="ga3c7b7fc1483b9cdcb5ee4a6baef102e2" args="(BUFFER *pbuf, void *destination, int max_size, int *buf_size, int convert_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bm_copy_from_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBUFFER.html">BUFFER</a> *&nbsp;</td>
          <td class="paramname"> <em>pbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>destination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>max_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>buf_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>convert_flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06428">6428</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07094">bm_receive_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga33221a55f8c90e411dea5eb34a2ee773"></a><!-- doxytag: member="midas.c::bm_delete_request" ref="ga33221a55f8c90e411dea5eb34a2ee773" args="(INT request_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_delete_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>request_id</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Deletes an event request previously done with <a class="el" href="group__bmfunctionc.html#gabf663d96482aeede1846487a7ada8184">bm_request_event()</a>. When an event request gets deleted, events of that requested type are not received any more. When a buffer is closed via <a class="el" href="group__bmfunctionc.html#ga7b2cbde6caa572dfc978c780d63ab6be">bm_close_buffer()</a>, all event requests from that buffer are deleted automatically </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>request_id</em>&nbsp;</td><td>request identifier given by <a class="el" href="group__bmfunctionc.html#gabf663d96482aeede1846487a7ada8184">bm_request_event()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l06200">6200</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04826">bm_close_buffer()</a>, and <a class="el" href="mevb_8c_source.html#l00914">source_unbooking()</a>.</p>

</div>
</div>
<a class="anchor" id="gacc844625f422be4b21810748a2618783"></a><!-- doxytag: member="midas.c::bm_dispatch_event" ref="gacc844625f422be4b21810748a2618783" args="(int buffer_handle, EVENT_HEADER *pevent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_dispatch_event </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pevent</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06380">6380</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06396">bm_dispatch_from_cache()</a>, and <a class="el" href="midas_8c_source.html#l07426">bm_push_event()</a>.</p>

</div>
</div>
<a class="anchor" id="gae17352acfb63e945e2e932ca92156da2"></a><!-- doxytag: member="midas.c::bm_dispatch_from_cache" ref="gae17352acfb63e945e2e932ca92156da2" args="(BUFFER *pbuf, int buffer_handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_dispatch_from_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBUFFER.html">BUFFER</a> *&nbsp;</td>
          <td class="paramname"> <em>pbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06396">6396</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07426">bm_push_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga516c50d818df89f466ac1fc135120fa6"></a><!-- doxytag: member="midas.c::bm_empty_buffers" ref="ga516c50d818df89f466ac1fc135120fa6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_empty_buffers </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Clears event buffer and cache. If an event buffer is large and a consumer is slow in analyzing events, events are usually received some time after they are produced. This effect is even more experienced if a read cache is used (via <a class="el" href="group__bmfunctionc.html#ga2689ca85c6d0023f1a02e6827a5eff6e">bm_set_cache_size()</a>). When changes to the hardware are made in the experience, the consumer will then still analyze old events before any new event which reflects the hardware change. Users can be fooled by looking at histograms which reflect the hardware change many seconds after they have been made.</p>
<p>To overcome this potential problem, the analyzer can call <a class="el" href="group__bmfunctionc.html#ga516c50d818df89f466ac1fc135120fa6">bm_empty_buffers()</a> just after the hardware change has been made which skips all old events contained in event buffers and read caches. Technically this is done by forwarding the read pointer of the client. No events are really deleted, they are still visible to other clients like the logger.</p>
<p>Note that the front-end also contains write buffers which can delay the delivery of events. The standard front-end framework <a class="el" href="mfe_8c.html">mfe.c</a> reduces this effect by flushing all buffers once every second. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l07987">7987</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="mevb_8c_source.html#l00799">handFlush()</a>, <a class="el" href="mevb_8c_source.html#l00833">source_booking()</a>, and <a class="el" href="mevb_8c_source.html#l00914">source_unbooking()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9b74b8aa633c942682e642acba93c51d"></a><!-- doxytag: member="midas.c::bm_flush_cache" ref="ga9b74b8aa633c942682e642acba93c51d" args="(INT buffer_handle, INT async_flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_flush_cache </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>async_flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Empty write cache. This function should be used if events in the write cache should be visible to the consumers immediately. It should be called at the end of each run, otherwise events could be kept in the write buffer and will flow to the data of the next run. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>Buffer handle obtained via <a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer()</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>async_flag</em>&nbsp;</td><td>Synchronous/asynchronous flag. If FALSE, the function blocks if the buffer has not enough free space to receive the full cache. If TRUE, the function returns immediately with a value of BM_ASYNC_RETURN without writing the cache. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE<br/>
 BM_ASYNC_RETURN Routine called with async_flag == TRUE and buffer has not enough space to receive cache<br/>
 BM_NO_MEMORY Event is too large for network buffer or event buffer. One has to increase MAX_EVENT_SIZE in <a class="el" href="midas_8h.html">midas.h</a> and recompile. </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l06897">6897</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06707">bm_send_event()</a>, <a class="el" href="mevb_8c_source.html#l00948">close_buffers()</a>, <a class="el" href="mevb_8c_source.html#l00325">scan_fragment()</a>, <a class="el" href="mfe_8c_source.html#l01853">scheduler()</a>, <a class="el" href="mfe_8c_source.html#l01097">send_event()</a>, and <a class="el" href="mfe_8c_source.html#l00187">tr_stop()</a>.</p>

</div>
</div>
<a class="anchor" id="ga181dcf462745127aa3d011a2e3fee805"></a><!-- doxytag: member="midas.c::bm_match_event" ref="ga181dcf462745127aa3d011a2e3fee805" args="(short int event_id, short int trigger_mask, EVENT_HEADER *pevent)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_match_event </td>
          <td>(</td>
          <td class="paramtype">short int&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int&nbsp;</td>
          <td class="paramname"> <em>trigger_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pevent</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check if an event matches a given event request by the event id and trigger mask </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>event_id</em>&nbsp;</td><td>Event ID of request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>trigger_mask</em>&nbsp;</td><td>Trigger mask of request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pevent</em>&nbsp;</td><td>Pointer to event to check </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if event matches request </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04396">4396</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06380">bm_dispatch_event()</a>, <a class="el" href="midas_8c_source.html#l07426">bm_push_event()</a>, <a class="el" href="midas_8c_source.html#l07094">bm_receive_event()</a>, <a class="el" href="midas_8c_source.html#l06707">bm_send_event()</a>, and <a class="el" href="midas_8c_source.html#l06473">bm_wait_for_free_space()</a>.</p>

</div>
</div>
<a class="anchor" id="gae9636ff3e34ee94e31cb292bd07a679d"></a><!-- doxytag: member="midas.c::bm_open_buffer" ref="gae9636ff3e34ee94e31cb292bd07a679d" args="(char *buffer_name, INT buffer_size, INT *buffer_handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_open_buffer </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Open an event buffer. Two default buffers are created by the system. The "SYSTEM" buffer is used to exchange events and the "SYSMSG" buffer is used to exchange system messages. The name and size of the event buffers is defined in <a class="el" href="midas_8h.html">midas.h</a> as EVENT_BUFFER_NAME and 2*MAX_EVENT_SIZE. Following example opens the "SYSTEM" buffer, requests events with ID 1 and enters a main loop. Events are then received in process_event() </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<span class="keywordtype">void</span> process_event(HNDLE hbuf, HNDLE request_id,
           <a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *pheader, <span class="keywordtype">void</span> *pevent)
{
  printf(<span class="stringliteral">&quot;Received event #%d\r&quot;</span>,
  pheader-&gt;<a class="code" href="structEVENT__HEADER.html#a5ed07c075ebce619a8fa47e96f188440">serial_number</a>);
}
<a class="code" href="mfe_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()
{
  <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> status, request_id;
  HNDLE hbuf;
  status = <a class="code" href="group__cmfunctionc.html#ga1e96495bb5b89e4ea770a1ea7bc7787b">cm_connect_experiment</a>(<span class="stringliteral">&quot;pc810&quot;</span>, <span class="stringliteral">&quot;Sample&quot;</span>, <span class="stringliteral">&quot;Simple Analyzer&quot;</span>, NULL);
  <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
  <span class="keywordflow">return</span> 1;
  <a class="code" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer</a>(<a class="code" href="group__midasincludecode.html#gab520c690db83550e545ce6afbb12de3f">EVENT_BUFFER_NAME</a>, 2*<a class="code" href="group__midasincludecode.html#ga05d5acc365e3342523d84bc4540adc09">MAX_EVENT_SIZE</a>, &amp;hbuf);
  <a class="code" href="group__bmfunctionc.html#gabf663d96482aeede1846487a7ada8184">bm_request_event</a>(hbuf, 1, <a class="code" href="group__mdefineh.html#ga26aa4bcea89857cb7ca669339695ceac">TRIGGER_ALL</a>, <a class="code" href="group__mdefineh.html#ga16218704fdf35f7624064c9d1d4bc78f">GET_ALL</a>, request_id, process_event);

  <span class="keywordflow">do</span>
  {
   status = <a class="code" href="group__cmfunctionc.html#ga115565c5a1d9591fcabf844c1dd624f8">cm_yield</a>(1000);
  } <span class="keywordflow">while</span> (status != <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a> &amp;&amp; status != <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>);
  <a class="code" href="group__cmfunctionc.html#ga7d5a287821786e8dde3d2340826215b2">cm_disconnect_experiment</a>();
  <span class="keywordflow">return</span> 0;
}
</pre></div> <dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_name</em>&nbsp;</td><td>Name of buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer_size</em>&nbsp;</td><td>Default size of buffer in bytes. Can by overwritten with ODB value </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>Buffer handle returned by function </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_CREATED <br/>
 BM_NO_SHM Shared memory cannot be created <br/>
 BM_NO_SEMAPHORE Semaphore cannot be created <br/>
 BM_NO_MEMORY Not enough memory to create buffer descriptor <br/>
 BM_MEMSIZE_MISMATCH Buffer size conflicts with an existing buffer of different size <br/>
 BM_INVALID_PARAM Invalid parameter </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04595">4595</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l00904">cm_msg1()</a>, <a class="el" href="midas_8c_source.html#l01035">cm_msg_register()</a>, <a class="el" href="midas_8c_source.html#l00662">cm_msg_send_event()</a>, <a class="el" href="mevb_8c_source.html#l00114">register_equipment()</a>, and <a class="el" href="mevb_8c_source.html#l00833">source_booking()</a>.</p>

</div>
</div>
<a class="anchor" id="gabcc6bb732b720fcc3ffe859f732a07e0"></a><!-- doxytag: member="midas.c::bm_push_event" ref="gabcc6bb732b720fcc3ffe859f732a07e0" args="(char *buffer_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_push_event </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check a buffer if an event is available and call the dispatch function if found. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_name</em>&nbsp;</td><td>Name of buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE, BM_TRUNCATED, BM_ASYNC_RETURN, RPC_NET_ERROR </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l07426">7426</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07660">bm_check_buffers()</a>.</p>

</div>
</div>
<a class="anchor" id="gae01d28bceec73613c01f4fad2b461c83"></a><!-- doxytag: member="midas.c::bm_read_cache_has_events" ref="gae01d28bceec73613c01f4fad2b461c83" args="(const BUFFER *pbuf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bm_read_cache_has_events </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structBUFFER.html">BUFFER</a> *&nbsp;</td>
          <td class="paramname"> <em>pbuf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06462">6462</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07426">bm_push_event()</a>, and <a class="el" href="midas_8c_source.html#l07094">bm_receive_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga2fd8bb52ad5282be3ce076e84bc007fa"></a><!-- doxytag: member="midas.c::bm_receive_event" ref="ga2fd8bb52ad5282be3ce076e84bc007fa" args="(INT buffer_handle, void *destination, INT *buf_size, INT async_flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_receive_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>destination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> *&nbsp;</td>
          <td class="paramname"> <em>buf_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>async_flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Receives events directly. This function is an alternative way to receive events without a main loop.</p>
<p>It can be used in analysis systems which actively receive events, rather than using callbacks. A analysis package could for example contain its own command line interface. A command like "receive 1000 events" could make it necessary to call <a class="el" href="group__bmfunctionc.html#ga2fd8bb52ad5282be3ce076e84bc007fa">bm_receive_event()</a> 1000 times in a row to receive these events and then return back to the command line prompt. The according <a class="el" href="group__bmfunctionc.html#gabf663d96482aeede1846487a7ada8184">bm_request_event()</a> call contains NULL as the callback routine to indicate that <a class="el" href="group__bmfunctionc.html#ga2fd8bb52ad5282be3ce076e84bc007fa">bm_receive_event()</a> is called to receive events. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<span class="keywordtype">void</span> process_event(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *pheader)
{
 printf(<span class="stringliteral">&quot;Received event #%d\r&quot;</span>,
 pheader-&gt;<a class="code" href="structEVENT__HEADER.html#a5ed07c075ebce619a8fa47e96f188440">serial_number</a>);
}
<a class="code" href="mfe_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()
{
  <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> status, request_id;
  HNDLE hbuf;
  <span class="keywordtype">char</span> <a class="code" href="mfe_8c.html#ac755035b7fe3f9e7e9c0b9ba691fdf7e">event_buffer</a>[1000];
  status = <a class="code" href="group__cmfunctionc.html#ga1e96495bb5b89e4ea770a1ea7bc7787b">cm_connect_experiment</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Sample&quot;</span>,
  <span class="stringliteral">&quot;Simple Analyzer&quot;</span>, NULL);
  <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
   <span class="keywordflow">return</span> 1;
  <a class="code" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer</a>(<a class="code" href="group__midasincludecode.html#gab520c690db83550e545ce6afbb12de3f">EVENT_BUFFER_NAME</a>, 2*<a class="code" href="group__midasincludecode.html#ga05d5acc365e3342523d84bc4540adc09">MAX_EVENT_SIZE</a>, &amp;hbuf);
  <a class="code" href="group__bmfunctionc.html#gabf663d96482aeede1846487a7ada8184">bm_request_event</a>(hbuf, 1, <a class="code" href="group__mdefineh.html#ga26aa4bcea89857cb7ca669339695ceac">TRIGGER_ALL</a>, <a class="code" href="group__mdefineh.html#ga16218704fdf35f7624064c9d1d4bc78f">GET_ALL</a>, request_id, NULL);

  <span class="keywordflow">do</span>
  {
   size = <span class="keyword">sizeof</span>(event_buffer);
   status = <a class="code" href="group__bmfunctionc.html#ga2fd8bb52ad5282be3ce076e84bc007fa">bm_receive_event</a>(hbuf, event_buffer, &amp;size, <a class="code" href="group__mdefineh.html#gad28b60868b6548c43e7a18f30c9b2022">ASYNC</a>);
  <span class="keywordflow">if</span> (status == <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
   process_event((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) event_buffer);
   &lt;...do something <span class="keywordflow">else</span>...&gt;
   status = <a class="code" href="group__cmfunctionc.html#ga115565c5a1d9591fcabf844c1dd624f8">cm_yield</a>(0);
  } <span class="keywordflow">while</span> (status != <a class="code" href="group__err25.html#ga0406ee07e8c5afbf8e46cb0eed698bcd">RPC_SHUTDOWN</a> &amp;&amp;
  status != <a class="code" href="group__err24.html#ga136923b4499af07f13a3cd631b88ec0e">SS_ABORT</a>);
  <a class="code" href="group__cmfunctionc.html#ga7d5a287821786e8dde3d2340826215b2">cm_disconnect_experiment</a>();
  <span class="keywordflow">return</span> 0;
}
</pre></div> <dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>buffer handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>destination</em>&nbsp;</td><td>destination address where event is written to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf_size</em>&nbsp;</td><td>size of destination buffer on input, size of event plus header on return. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>async_flag</em>&nbsp;</td><td>Synchronous/asynchronous flag. If FALSE, the function blocks if no event is available. If TRUE, the function returns immediately with a value of BM_ASYNC_RETURN without receiving any event. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE <br/>
 BM_TRUNCATED The event is larger than the destination buffer and was therefore truncated <br/>
 BM_ASYNC_RETURN No event available </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l07094">7094</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="mevb_8c_source.html#l00799">handFlush()</a>, and <a class="el" href="mevb_8c_source.html#l00997">source_scan()</a>.</p>

</div>
</div>
<a class="anchor" id="gaf13b277e24b666918ee8aec0160f5288"></a><!-- doxytag: member="midas.c::bm_remove_client_locked" ref="gaf13b277e24b666918ee8aec0160f5288" args="(BUFFER_HEADER *pheader, int j)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bm_remove_client_locked </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBUFFER__HEADER.html">BUFFER_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pheader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>j</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Called to forcibly disconnect given client from a data buffer </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04413">4413</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l04445">bm_cleanup_buffer_locked()</a>, and <a class="el" href="midas_8c_source.html#l05381">cm_cleanup()</a>.</p>

</div>
</div>
<a class="anchor" id="ga7810d29ac3894a4e299737bc7c7a2cf1"></a><!-- doxytag: member="midas.c::bm_remove_event_request" ref="ga7810d29ac3894a4e299737bc7c7a2cf1" args="(INT buffer_handle, INT request_id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_remove_event_request </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>request_id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Delete a previously placed request for a specific event type in the client structure of the buffer refereced by buffer_handle. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>Handle to the buffer where the re- quest should be placed in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>request_id</em>&nbsp;</td><td>Request id returned by bm_request_event </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE, BM_NOT_FOUND, RPC_NET_ERROR </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l06131">6131</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06200">bm_delete_request()</a>.</p>

</div>
</div>
<a class="anchor" id="gabf663d96482aeede1846487a7ada8184"></a><!-- doxytag: member="midas.c::bm_request_event" ref="gabf663d96482aeede1846487a7ada8184" args="(HNDLE buffer_handle, short int event_id, short int trigger_mask, INT sampling_type, HNDLE *request_id, void(*func)(HNDLE, HNDLE, EVENT_HEADER *, void *))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_request_event </td>
          <td>(</td>
          <td class="paramtype">HNDLE&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int&nbsp;</td>
          <td class="paramname"> <em>event_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short int&nbsp;</td>
          <td class="paramname"> <em>trigger_mask</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>sampling_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HNDLE *&nbsp;</td>
          <td class="paramname"> <em>request_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(HNDLE, HNDLE, <a class="el" href="structEVENT__HEADER.html">EVENT_HEADER</a> *, void *)&nbsp;</td>
          <td class="paramname"> <em>func</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>dox Place an event request based on certain characteristics. Multiple event requests can be placed for each buffer, which are later identified by their request ID. They can contain different callback routines. Example see <a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer()</a> and <a class="el" href="group__bmfunctionc.html#ga2fd8bb52ad5282be3ce076e84bc007fa">bm_receive_event()</a> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>buffer handle obtained via <a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer()</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>event_id</em>&nbsp;</td><td>event ID for requested events. Use EVENTID_ALL to receive events with any ID. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>trigger_mask</em>&nbsp;</td><td>trigger mask for requested events. The requested events must have at least one bit in its trigger mask common with the requested trigger mask. Use TRIGGER_ALL to receive events with any trigger mask. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sampling_type</em>&nbsp;</td><td>specifies how many events to receive. A value of GET_ALL receives all events which match the specified event ID and trigger mask. If the events are consumed slower than produced, the producer is automatically slowed down. A value of GET_NONBLOCKING receives as much events as possible without slowing down the producer. GET_ALL is typically used by the logger, while GET_NONBLOCKING is typically used by analyzers. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>request_id</em>&nbsp;</td><td>request ID returned by the function. This ID is passed to the callback routine and must be used in the <a class="el" href="group__bmfunctionc.html#ga33221a55f8c90e411dea5eb34a2ee773">bm_delete_request()</a> routine. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>func</em>&nbsp;</td><td>allback routine which gets called when an event of the specified type is received. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE <br/>
 BM_NO_MEMORY too many requests. The value MAX_EVENT_REQUESTS in <a class="el" href="midas_8h.html">midas.h</a> should be increased. </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l06067">6067</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l01035">cm_msg_register()</a>, and <a class="el" href="mevb_8c_source.html#l00833">source_booking()</a>.</p>

</div>
</div>
<a class="anchor" id="ga499b14a246f8ab8d5a3b6ec77bfa9407"></a><!-- doxytag: member="midas.c::bm_send_event" ref="ga499b14a246f8ab8d5a3b6ec77bfa9407" args="(INT buffer_handle, void *source, INT buf_size, INT async_flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_send_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buf_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>async_flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sends an event to a buffer. This function check if the buffer has enough space for the event, then copies the event to the buffer in shared memory. If clients have requests for the event, they are notified via an UDP packet. </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">char</span> <span class="keyword">event</span>[1000];
<span class="comment">// create event with ID 1, trigger mask 0, size 100 bytes and serial number 1</span>
<a class="code" href="group__bmfunctionc.html#gac5e3e469fb6721a502ebd80a35a328f5">bm_compose_event</a>((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) event, 1, 0, 100, 1);

<span class="comment">// set first byte of event</span>
*(<span class="keyword">event</span>+<span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>)) = &lt;...&gt;
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<a class="code" href="mfe_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>()
{
 <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> status, i;
 HNDLE hbuf;
 <span class="keywordtype">char</span> <span class="keyword">event</span>[1000];
 status = <a class="code" href="group__cmfunctionc.html#ga1e96495bb5b89e4ea770a1ea7bc7787b">cm_connect_experiment</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Sample&quot;</span>, <span class="stringliteral">&quot;Producer&quot;</span>, NULL);
 <span class="keywordflow">if</span> (status != <a class="code" href="group__err21.html#ga0180947941230d805f5dbb6f1801c17c">CM_SUCCESS</a>)
 <span class="keywordflow">return</span> 1;
 <a class="code" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer</a>(<a class="code" href="group__midasincludecode.html#gab520c690db83550e545ce6afbb12de3f">EVENT_BUFFER_NAME</a>, 2*<a class="code" href="group__midasincludecode.html#ga05d5acc365e3342523d84bc4540adc09">MAX_EVENT_SIZE</a>, &amp;hbuf);

 <span class="comment">// create event with ID 1, trigger mask 0, size 100 bytes and serial number 1</span>
 <a class="code" href="group__bmfunctionc.html#gac5e3e469fb6721a502ebd80a35a328f5">bm_compose_event</a>((<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a> *) event, 1, 0, 100, 1);

 <span class="comment">// set event data</span>
 <span class="keywordflow">for</span> (i=0 ; i&lt;100 ; i++)
 *(event+<span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>)+i) = i;
 <span class="comment">// send event</span>
 <a class="code" href="group__bmfunctionc.html#ga499b14a246f8ab8d5a3b6ec77bfa9407">bm_send_event</a>(hbuf, event, 100+<span class="keyword">sizeof</span>(<a class="code" href="structEVENT__HEADER.html">EVENT_HEADER</a>), <a class="code" href="group__mdefineh.html#ga9ac82e856c7683e23553431e5224d5f4">SYNC</a>);
 <a class="code" href="group__cmfunctionc.html#ga7d5a287821786e8dde3d2340826215b2">cm_disconnect_experiment</a>();
 <span class="keywordflow">return</span> 0;
}
</pre></div> <dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>Buffer handle obtained via <a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer()</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Address of event buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf_size</em>&nbsp;</td><td>Size of event including event header in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>async_flag</em>&nbsp;</td><td>Synchronous/asynchronous flag. If FALSE, the function blocks if the buffer has not enough free space to receive the event. If TRUE, the function returns immediately with a value of BM_ASYNC_RETURN without writing the event to the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE, BM_INVALID_PARAM<br/>
 BM_ASYNC_RETURN Routine called with async_flag == TRUE and buffer has not enough space to receive event<br/>
 BM_NO_MEMORY Event is too large for network buffer or event buffer. One has to increase MAX_EVENT_SIZE in <a class="el" href="midas_8h.html">midas.h</a> and recompile. </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l06707">6707</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l00904">cm_msg1()</a>, <a class="el" href="midas_8c_source.html#l00662">cm_msg_send_event()</a>, and <a class="el" href="midas_8c_source.html#l10419">rpc_send_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga2689ca85c6d0023f1a02e6827a5eff6e"></a><!-- doxytag: member="midas.c::bm_set_cache_size" ref="ga2689ca85c6d0023f1a02e6827a5eff6e" args="(INT buffer_handle, INT read_size, INT write_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_set_cache_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>read_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>write_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Modifies buffer cache size. Without a buffer cache, events are copied to/from the shared memory event by event.</p>
<p>To protect processed from accessing the shared memory simultaneously, semaphores are used. Since semaphore operations are CPU consuming (typically 50-100us) this can slow down the data transfer especially for small events. By using a cache the number of semaphore operations is reduced dramatically. Instead writing directly to the shared memory, the events are copied to a local cache buffer. When this buffer is full, it is copied to the shared memory in one operation. The same technique can be used when receiving events.</p>
<p>The drawback of this method is that the events have to be copied twice, once to the cache and once from the cache to the shared memory. Therefore it can happen that the usage of a cache even slows down data throughput on a given environment (computer type, OS type, event size). The cache size has therefore be optimized manually to maximize data throughput. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>buffer handle obtained via <a class="el" href="group__bmfunctionc.html#gae9636ff3e34ee94e31cb292bd07a679d">bm_open_buffer()</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>read_size</em>&nbsp;</td><td>cache size for reading events in bytes, zero for no cache </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>write_size</em>&nbsp;</td><td>cache size for writing events in bytes, zero for no cache </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE, BM_NO_MEMORY, BM_INVALID_PARAM </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l05806">5806</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="mevb_8c_source.html#l00114">register_equipment()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4a12567d843b2e1d20da58d8abfabb04"></a><!-- doxytag: member="midas.c::bm_skip_event" ref="ga4a12567d843b2e1d20da58d8abfabb04" args="(INT buffer_handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a> bm_skip_event </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vppg_8h.html#a392e62da233ed3e2f7c3fd4f487a3896">INT</a>&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Skip all events in current buffer.</p>
<p>Useful for single event displays to see the newest events </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buffer_handle</em>&nbsp;</td><td>Handle of the buffer. Must be obtained via bm_open_buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>BM_SUCCESS, BM_INVALID_HANDLE, RPC_NET_ERROR </dd></dl>

<p>Definition at line <a class="el" href="midas_8c_source.html#l07378">7378</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga33415128fc3cfa10528fe85badc265ef"></a><!-- doxytag: member="midas.c::bm_update_read_pointer" ref="ga33415128fc3cfa10528fe85badc265ef" args="(const char *caller_name, BUFFER_HEADER *pheader)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a> bm_update_read_pointer </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>caller_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBUFFER__HEADER.html">BUFFER_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pheader</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06296">6296</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06897">bm_flush_cache()</a>, <a class="el" href="midas_8c_source.html#l07426">bm_push_event()</a>, <a class="el" href="midas_8c_source.html#l07094">bm_receive_event()</a>, <a class="el" href="midas_8c_source.html#l06707">bm_send_event()</a>, and <a class="el" href="midas_8c_source.html#l06473">bm_wait_for_free_space()</a>.</p>

</div>
</div>
<a class="anchor" id="ga4cc39a5180ad4e716108d024f225c914"></a><!-- doxytag: member="midas.c::bm_validate_client_pointers" ref="ga4cc39a5180ad4e716108d024f225c914" args="(BUFFER_HEADER *pheader, BUFFER_CLIENT *pclient)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_validate_client_pointers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBUFFER__HEADER.html">BUFFER_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pheader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBUFFER__CLIENT.html">BUFFER_CLIENT</a> *&nbsp;</td>
          <td class="paramname"> <em>pclient</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06232">6232</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06296">bm_update_read_pointer()</a>.</p>

</div>
</div>
<a class="anchor" id="ga8d40df6e065fc5111d5cce71d3d2bf5f"></a><!-- doxytag: member="midas.c::bm_wait_for_free_space" ref="ga8d40df6e065fc5111d5cce71d3d2bf5f" args="(int buffer_handle, BUFFER *pbuf, int async_flag, int requested_space)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bm_wait_for_free_space </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buffer_handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBUFFER.html">BUFFER</a> *&nbsp;</td>
          <td class="paramname"> <em>pbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>async_flag</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>requested_space</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06473">6473</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l06897">bm_flush_cache()</a>, and <a class="el" href="midas_8c_source.html#l06707">bm_send_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga25b52998c14867875432bc2103231c78"></a><!-- doxytag: member="midas.c::bm_wakeup_producers" ref="ga25b52998c14867875432bc2103231c78" args="(const BUFFER_HEADER *pheader, const BUFFER_CLIENT *pc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bm_wakeup_producers </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structBUFFER__HEADER.html">BUFFER_HEADER</a> *&nbsp;</td>
          <td class="paramname"> <em>pheader</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structBUFFER__CLIENT.html">BUFFER_CLIENT</a> *&nbsp;</td>
          <td class="paramname"> <em>pc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="midas_8c_source.html#l06352">6352</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

<p>Referenced by <a class="el" href="midas_8c_source.html#l07426">bm_push_event()</a>, and <a class="el" href="midas_8c_source.html#l07094">bm_receive_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ga2109ffa213706ade60f0b054d6c39164"></a><!-- doxytag: member="midas.c::cm_update_last_activity" ref="ga2109ffa213706ade60f0b054d6c39164" args="(DWORD actual_time)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void cm_update_last_activity </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="vt2_8h.html#a798af1e30bc65f319c1a246cecf59e39">DWORD</a>&nbsp;</td>
          <td class="paramname"> <em>actual_time</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Update last activity time </p>

<p>Definition at line <a class="el" href="midas_8c_source.html#l04497">4497</a> of file <a class="el" href="midas_8c_source.html">midas.c</a>.</p>

</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

