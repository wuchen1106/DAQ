<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Frontend Code Sections</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="FrontendOperation.html">SECTION 6: Frontend Operation</a>&nbsp;&raquo&nbsp;<a class="el" href="Frontend_code.html">Frontend code</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="FE_code_sections">Frontend Code Sections </a></h1><p><br/>
  
 
<script type="text/javascript">
pages( "Frontend_code","FrontendOperation", "FE_sequence", "FE_code_sections","end" ); // back index next {top bottom}
sections("RunControl","FrontendOperation","DataAnalysis"); // last section; top of this section; next section
</script>
 <br/>
</p>
<h2><a class="anchor" id="FE_includes">
Include files</a></h2>
<p>The user may add any other include files needed, but should not remove any of the existing ones in the example. The include file <a class="el" href="RC_Hot_Link.html#RC_experim_dot_h">experim.h</a> is a special include file for ease of communication between the C code and the <a class="el" href="F_MainElements.html#F_Online_Database_overview">odb</a>.</p>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Examples of include files </caption>
<tr>
<td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 153);"><p><span style="font-weight: bold;">VME :</span>  </p>
</td><td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 204);"><p><span style="font-weight: bold;">CAMAC :</span>  </p>
</td></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="experim_8h.html">experim.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="mvmestd_8h.html">mvmestd.h</a>&quot;</span>
<span class="preprocessor">#include &quot;vmicvme.h&quot;</span>
</pre></div>  </td><td><div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="mcstd_8h.html">mcstd.h</a>&quot;</span>
<span class="preprocessor">#include &quot;<a class="code" href="experim_8h.html">experim.h</a>&quot;</span>
</pre></div> </td></tr>
</table>
<p><br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_global">
Global declarations</a></h2>
<p>The declarations are system wide. Some may be changed to suit the user, but none should not be removed.</p>
<ul>
<li>
<a class="el" href="frontend_8c.html#ac1f0c6df66e35778b61c611107501ec4">frontend_name</a>  <div style="margin-left: 10px;"> This value can be modified to reflect the purpose of the code. </div> </li>
<li>
<a class="el" href="frontend_8c.html#a0215c0a842a0e97fe65c7ef5fb7633a5">frontend_call_loop</a>  <div style="margin-left: 10px;"> If set to TRUE, the function <a class="el" href="mfe_8c.html#ad902740ed5577f2f940454359ec1df1c">frontend_loop()</a> runs after every equipment loop. If FALSE, <a class="el" href="mfe_8c.html#ad902740ed5577f2f940454359ec1df1c">frontend_loop()</a> does not run. The user can add suitable code to this routine if desired (e.g. to check for a condition. </div> </li>
<li>
<a class="el" href="frontend_8c.html#ab9cdcefda91459091b0ed33011d0d18c">display_period</a>  <div style="margin-left: 10px;"> The time interval (defined in milliseconds) between the refresh of a frontend status display. The value of zero disables the display. <br/>
 NOTE: If the frontend is started in the background with the display enabled, the stdout should be redirected to the null device to prevent the process from hanging. </div> </li>
<li>
<a class="el" href="frontend_8c.html#a13adb6e6b95ca2a62bbfe2453d71a1cd">max_event_size</a>  <div style="margin-left: 10px;"> specifies the maximum size (in bytes) of the expected event. </div> </li>
<li>
<a class="el" href="frontend_8c.html#a4411d7db6f901c968b946ed659d202f6">event_buffer_size</a>  <div style="margin-left: 10px;"> specifies the maximum size (in bytes) of the buffer to be allocated by the system. </div> </li>
</ul>
<div class="fragment"><pre class="fragment">    <span class="comment">// The frontend name (client name) as seen by other MIDAS clients</span>
    <span class="keywordtype">char</span> *frontend_name = <span class="stringliteral">&quot;Sample Frontend&quot;</span>;

    <span class="comment">// The frontend file name, don&apos;t change it</span>
    <span class="keywordtype">char</span> *frontend_file_name = __FILE__;

    <span class="comment">// frontend_loop is called periodically if this variable is TRUE</span>
    <a class="code" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a> frontend_call_loop = FALSE;

    <span class="comment">//a frontend status page is displayed with this frequency in ms</span>
    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> display_period = 3000;

    <span class="comment">//maximum event size produced by this frontend</span>
    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> max_event_size = 200000;

    <span class="comment">// maximum event size for fragmented events (EQ_FRAGMENTED) </span>
    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> max_event_size_frag = 5 * 1024 * 1024;

    <span class="comment">//buffer size to hold events</span>
    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> event_buffer_size = 10*10000;
</pre></div><p> <br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_global_user">
Global User declarations</a></h2>
<p>After the global declarations, the user may add his or her own declarations. The example defines various hardware <a class="el" href="structparameters.html">parameters</a>. </p>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Examples of global declarations </caption>
<tr>
<td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 153);"><p><span style="font-weight: bold;">VME :</span>  </p>
</td><td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 204);"><p><span style="font-weight: bold;">CAMAC :</span>  </p>
</td></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><span class="comment">/* Hardware */</span>
<span class="comment">/* Interrupt vector */</span>
<span class="keywordtype">int</span> trig_level =  0;
<span class="preprocessor">#define TRIG_LEVEL  (int) 1</span>
<span class="preprocessor"></span><span class="preprocessor">#define INT_LEVEL   (int) 3</span>
<span class="preprocessor"></span><span class="preprocessor">#define INT_VECTOR  (int) 0x16</span>
<span class="preprocessor"></span><span class="keyword">extern</span> INT_INFO int_info;
<span class="keywordtype">int</span> myinfo = VME_INTERRUPT_SIGEVENT;

<a class="code" href="structMVME__INTERFACE.html">MVME_INTERFACE</a> *myvme;
<span class="keywordtype">int</span>  inRun = 0;
<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> VADC0_BASE = 0x100000; <span class="comment">// VME base address</span>
<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> VLAM_BASE  = 0x800000; <span class="comment">// VME base address</span>
</pre></div>  </td><td><div class="fragment"><pre class="fragment">    <span class="comment">// Global user section</span>
    <span class="comment">// number of channels</span>
<span class="preprocessor">    #define N_ADC  8  </span>
<span class="preprocessor"></span><span class="preprocessor">    #define N_TDC  8 </span>
<span class="preprocessor"></span><span class="preprocessor">    #define N_SCLR 8</span>
<span class="preprocessor"></span>
    CAMAC crate and slots
<span class="preprocessor">    #define CRATE      0</span>
<span class="preprocessor"></span><span class="preprocessor">    #define SLOT_C212 23</span>
<span class="preprocessor"></span><span class="preprocessor">    #define SLOT_ADC   1</span>
<span class="preprocessor"></span><span class="preprocessor">    #define SLOT_TDC   2</span>
<span class="preprocessor">    #define SLOT_SCLR  3</span>
</pre></div> </td></tr>
</table>
<p><br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_system_prototypes">
System prototype functions</a></h2>
<p>These prototypes declare the pre-defined system functions which should be present. </p>
<div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a802849119d469feb2d1deee1be9593ac">frontend_init</a>();
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a3b682405038cc4f6af505d7ca6367a4f">frontend_exit</a>();
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ad8bfe703c49342b9f0275aba77dc7758">begin_of_run</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> *error);
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ae6d798649008b7523c77222bae2d4187">end_of_run</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> *error);
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a164db20cf6c8c81e8c8ca50a590de436">pause_run</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> *error);
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a6cada7e3f07b9fc2b9886263223661d4">resume_run</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> *error);
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ad902740ed5577f2f940454359ec1df1c">frontend_loop</a>();
</pre></div><p> <br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_user_prototypes">
User prototype functions</a></h2>
<p>Following this group is a second group of prototypes, which define the <a class="el" href="FrontendOperation.html#FE_equipment_readout_function">user functions</a> that run when the defined equipments are triggered. In this example, two equipments will be defined, so there are two prototypes. The user functions will be described in detail in the following sections. </p>
<div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="fevmemodules_8c.html#a9c54bafa1af403e5e4737f9d8d5aba07">read_trigger_event</a>(<span class="keywordtype">char</span> *pevent, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> off);
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="fevmemodules_8c.html#af3ad062393c1437922bae26841d8927c">read_scaler_event</a>(<span class="keywordtype">char</span> *pevent, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> off);
</pre></div><p>And following this is the prototype </p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> <a class="code" href="fevmemodules_8c.html#a4c2c646c3b139346601893d06cf6df9d">register_cnaf_callback</a>(<span class="keywordtype">int</span> <a class="code" href="mfe_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>);
</pre></div><p> which is a routine provided in <a class="el" href="cnaf__callback_8c.html">cnaf_callback.c</a></p>
<p><br/>
  
<script type="text/javascript">
pages( "Frontend_code","FrontendOperation", "FE_sequence", "FE_code_sections","" ); // back index next {top bottom}
// section parameters: last section; top of this section; next section
sections("RunControl","FrontendOperation","DataAnalysis");
</script>
 <br/>
</p>
<p><a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

