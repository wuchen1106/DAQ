<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Messaging</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="Features.html">SECTION 4: Features</a>&nbsp;&raquo&nbsp;<a class="el" href="F_Logging.html">Logging in MIDAS</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="F_Messaging">Messaging </a></h1><p><a class="anchor" id="idx_Messaging"></a> <a class="anchor" id="idx_Logging_Messaging"></a></p>
 
<script type="text/javascript">
pages( "F_Logging_Data",  "Features","F_mySQL","F_Messaging","end"); // back index next {top bottom}
// sections params:   last section; top of this section; next section
sections("Quickstart", "Features", "RunControl");
</script>
<p><br/>
</p>
<p>Any client can produce status or error messages with a single call to <a class="el" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg()</a> using the MIDAS library, e.g. </p>
<div class="fragment"><pre class="fragment"> status = <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, 0, <span class="stringliteral">&quot;/Equipment/Cycle_scalers/Settings/&quot;</span>,&amp;hKey);
  <span class="keywordflow">if</span>(status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a> &amp;&amp; status != <a class="code" href="group__err23.html#ga8c6c8ed2099cf2468f0c7c6cd475fe7e">DB_NO_KEY</a>)
    {
      <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;begin_of_run&quot;</span>, <span class="stringliteral">&quot;error accessing \&quot;/Equipment/Cycle_scalers/Settings/\&quot;  (%d)&quot;</span>,status);
      <span class="keywordflow">return</span> status;
    }
</pre></div><p>Depending on the <a class="el" href="F_Messaging.html#F_message_types">message type</a>, these messages are forwarded to any other clients who may be available to receive these messages, as well as to a central <a class="el" href="F_Messaging.html#F_Log_File">MIDAS Log file</a>. The message system is based on the buffer manager scheme, but with a dedicated header to identify the type of message. A dedicated buffer (i.e. shared memory) <a class="el" href="RC_odbedit_examples.html#RC_odbedit_create_ODB">.SYSMSG.SHM</a> is used to receive and distribute messages.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>what is .MSG.SHM used for?</dd></dl>
<p><br/>
 <a class="anchor" id="idx_message_types"></a> <a class="anchor" id="F_message_types"></a> Predefined Message Macros contained in the MIDAS library cover most of the message requirements. These Macros compact the 3 first arguments of the <a class="el" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg()</a> call. The Macro replaces the type of message, the routine name and the line number in the C-code. See example in <a class="el" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg()</a>.</p>
<p>The available message types ( defined in <a class="el" href="midas_8h.html">midas.h</a> ) for use with <a class="el" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg()</a> are:</p>
<ul>
<li><a class="el" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a> : For error (MT_ERROR, __FILE__, __LINE__)</li>
<li><a class="el" href="group__mdefineh.html#ga6e27d8876a43afce3ee4dd16527cbb9e">MINFO</a> : For info (MT_INFO, __FILE__, __LINE__)</li>
<li><a class="el" href="group__mdefineh.html#gad769dc7be0dc5189e019d56664a18655">MDEBUG</a> : For debug (MT_DEBUG, __FILE__, __LINE__)</li>
<li><a class="el" href="group__mdefineh.html#ga34e08186e736dbd7f0b61a23a8ad8d0f">MUSER</a> : Produced by interactive user (MT_USER, __FILE__, __LINE__)</li>
<li><a class="el" href="group__mdefineh.html#ga953a810cf5034c603bdcad8840223ddc">MLOG</a> : Info message which is only logged (MT_LOG, __FILE__, __LINE__)</li>
<li><a class="el" href="group__mdefineh.html#gad6a8d32f94873258d0eebcbe5b24a78e">MTALK</a> : Info message for speech system (MT_TALK, __FILE__, __LINE__)</li>
<li><a class="el" href="group__mdefineh.html#ga9f2fa3417c41f059c815b9c0eba73db2">MCALL</a> : Info message for telephone call (MT_CALL, __FILE__, __LINE__)</li>
</ul>
<p><br/>
 <a class="anchor" id="idx_message_log-file"></a> <hr/>
 <h2><a class="anchor" id="F_Log_File">
MIDAS Log file</a></h2>
<p>MIDAS provides a general log file for recording system and user messages across the different components of the data acquisition clients. The default name of this file is <b>"midas.log"</b>, It is not necessary for <a class="el" href="F_Logging.html#F_mlogger_utility">mlogger</a> to be running for the MIDAS message logging system to work. As soon as any MIDAS application is started, the log file is produced. <br/>
 <a class="anchor" id="idx_message_log-file_location"></a> The location of this file is dependent on the setup of the experiment.</p>
<ul>
<li><b>with</b> the <span class="odb">/Logger tree</span> :<ul>
<li>If the <a class="el" href="F_Logging_Data.html#F_Logger_tree">/Logger ODB tree</a> exists (i.e. has been created by <a class="el" href="F_Logging.html#F_mlogger_utility">mlogger</a>) the message file will be located in the defined directory specified by the key <a class="el" href="F_Logging_Data.html#F_Logger_Data_Dir">/Logger/Data dir</a> .</li>
<li>The <b>name</b> of the message file may be changed using the ODB key <a class="el" href="F_Logging_Data.html#F_Logger_Message_File">/Logger/Message File</a>.</li>
</ul>
</li>
</ul>
<ul>
<li><b>without</b> the <span class="odb">/Logger tree</span> :<ul>
<li>If the ODB <span class="odb">/Logger</span> tree does NOT exist , i.e. the MIDAS standard logger <a class="el" href="F_Logging.html#F_mlogger_utility">mlogger</a> is not being used, then the location of the log file will be in the <b> experiment-specific </b> directory defined by either<ul>
<li>the <a class="el" href="BuildingOptions.html#BO_Environment_variables">Environment Variable</a> named <a class="el" href="BuildingOptions.html#BO_MIDAS_DIR">MIDAS_DIR</a> , or if this not defined,</li>
<li>the <a class="el" href="Q_Linux.html#Q_Linux_Exptab">exptab file</a> .</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><br/>
</p>
<p>The MIDAS log file contains system and user messages generated by any application connected to the given experiment.</p>
<p>The predefined <a class="el" href="F_Messaging.html#F_message_types">MIDAS Message macros</a> provide a list of defined messages types.</p>
<div class="fragment"><pre class="fragment">Fri Mar 24 10:48:40 2000 [CHAOS] Run 8362 started
Fri Mar 24 10:48:40 2000 [Logger] Run #8362 started
Fri Mar 24 10:55:04 2000 [Lazy_Tape] cni-043[10] (cp:383.6s) /dev/nst0/run08360.ybs 849.896MB file NEW
Fri Mar 24 11:24:03 2000 [MStatus] Program MStatus on host umelba started
Fri Mar 24 11:24:03 2000 [MStatus] Program MStatus on host umelba stopped
Fri Mar 24 11:27:02 2000 [Logger] stopping run after having received 1200000 events
Fri Mar 24 11:27:03 2000 [CHAOS] Run 8362 stopped
Fri Mar 24 11:27:03 2000 [SUSI] saving info in run log
Fri Mar 24 11:27:03 2000 [Logger] Run #8362 stopped
Fri Mar 24 11:27:13 2000 [Logger] starting <span class="keyword">new</span> run
Fri Mar 24 11:27:14 2000 [CHAOS] Run 8363 started
Fri Mar 24 11:27:14 2000 [CHAOS] odb_access_file -I- /Equipment/kos_trigger/Dump not found
Fri Mar 24 11:27:14 2000 [Logger] Run #8363 started
Fri Mar 24 11:33:47 2000 [Lazy_Tape] cni-043[11] (cp:391.8s) /dev/nst0/run08361.ybs 850.209MB file NEW
Fri Mar 24 11:42:35 2000 [CHAOS] Run 8363 stopped
Fri Mar 24 11:42:40 2000 [SUSI] saving info in run log
Fri Mar 24 11:42:41 2000 [ODBEdit] Run #8363 stopped
Fri Mar 24 12:19:57 2000 [MChart] client [umelba.Triumf.CA]MChart failed watchdog <a class="code" href="sis3803_8c.html#a8fa8e4c8bef10b038f6a033f736d5bce">test</a> after 10 sec
Fri Mar 24 12:19:57 2000 [MChart] Program MChart on host koslx0 stopped
</pre></div><p> <br/>
 <br/>
 <hr/>
 <h2><a class="anchor" id="F_mspeaker_utility">
m[lx]speaker - audible messaging</a></h2>
<p><b>mspeaker</b>, mlxspeaker are utilities which listen to the MIDAS messages system and pipe these messages to a speech synthesizer application. <b>mspeaker</b> is for the Windows based system and interface to the <a href="http://www.fbyte.com">FirstByte/ProVoice package</a>. The <b>mlxspeaker</b> is for the Linux based system and interface to the <a href="http://www.cstr.ed.ac.uk/projects/festival">Festival</a> speech synthesis package.</p>
<p>If either package is used, the speech synthesis system has to be installed prior to the activation of the <b>mspeaker</b>, or <b>mlxspeaker</b> utilities.</p>
<ul>
<li><b> Arguments </b><ul>
<li>[-h ] : help</li>
<li>[-h hostname ] : host name</li>
<li>[-e exptname ] : experiment name</li>
<li>[-t mt_talk_cmd] : Specify the talk alert command (ux only).</li>
<li>[-u mt_user_cmd] : Specify the user alert command (ux only).</li>
<li>[-s shut up time]: Specify the min time interval between alert [s] The -t &amp; -u switch require a command equivalent to: '-t play --volume=0.3 file.wav'</li>
<li>[-D ] : start program as a daemon</li>
</ul>
</li>
</ul>
<ul>
<li><b> Usage </b> <div class="fragment"><pre class="fragment">&gt; mlxspeaker -D
</pre></div></li>
</ul>
 
<script type="text/javascript">
pages( "F_Logging_Data",  "Features","F_mySQL","F_Messaging",""); // back index next {top bottom}
// sections params:   last section; top of this section; next section
sections("Quickstart", "Features", "RunControl");
</script>
<p><a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

