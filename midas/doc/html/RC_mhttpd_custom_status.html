<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Custom Status page</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="RunControl.html">SECTION 5: Run Control</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_run_control.html">Run Control Programs</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd.html">mhttpd: the MIDAS Web-based Run Control utility</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_Custom_page.html">Custom pages</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_custom_features.html">Features available on custom pages</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="RC_mhttpd_custom_status">Custom Status page </a></h1><p><br/>
  
<script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "RC_mhttpd_Internal", "RunControl", "RC_Monitor", "RC_mhttpd_custom_status",  "end" );
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script>
<p><b>A Custom Status page</b> is a custom page that <b>replaces the default MIDAS status page.</b> <br/>
<br/>
 A custom Status page is activated as described <a class="el" href="RC_mhttpd_Activate.html#RC_odb_custom_status">previously</a>. Features such as the standard <a class="el" href="RC_mhttpd_custom_features.html#RC_mhttpd_custom_midas_buttons">Menu buttons</a>, <a class="el" href="RC_mhttpd_custom_features.html#RC_mhttpd_custom_alias">Alias Buttons and Hyperlinks</a> etc. can be provided in the same way as for any other custom page. When replacing the default Status page by a Custom Status page, any <a class="el" href="RC_mhttpd_status_page_features.html#RC_mhttpd_status_script_buttons">script-buttons</a> defined on the original MIDAS Status page can be easily turned into <a class="el" href="RC_mhttpd_custom_features.html#RC_mhttpd_custom_script_buttons">CustomScript Buttons</a> on the Custom Status page by placing links in the <span class="odb"> /customscript </span> tree to any existing script-buttons under the <span class="odb"> /Script </span> tree.</p>
<div class="fragment"><pre class="fragment">[local:bnmr:S]/&gt;ls /customscript
Hold      -&gt; /Script/BNMR Hold/
Continue  -&gt; /script/Continue 
Scalers   -&gt; /script/Scalers
</pre></div><p> See <a class="el" href="RC_mhttpd_custom_status.html#RC_mhttpd_status_toggle">example</a> of the above defined buttons.</p>
<h2><a class="anchor" id="RC_mhttpd_status_toggle">
Toggle between Default and Custom Status pages</a></h2>
<p>In the following example, the main Status page can be toggled between the Custom version and the default MIDAS status page.</p>
<p>The Custom status page contains a button <b>ToggleStatusPage</b> that will toggle between the two cases. A custom-link has been provided on the Default status page in order to access the custom status page when using the Default status page.</p>
<p>The following shows the /Custom directory when the Custom status page is running. The /Custom directory contains the key <b>CustomStatus&amp;</b>, a link to the custom Status page. The key <b>Status</b> is set as a link to <b>CustomStatus&amp;</b>. </p>
<div class="fragment"><pre class="fragment">[local:bnmr:S]/&gt;ls /custom
CustomStatus&amp;                   /home/bnmr/online/custom/Custom_Status.html
Status                          /custom/CustomStatus&amp; -&gt; /home/bnmr/online/custom/Custom_Status.html
</pre></div><p>A script-button is set up in the custom status page (see <a class="el" href="RC_mhttpd_custom_features.html#RC_mhttpd_custom_script_buttons">CustomScript Buttons</a>) as follows</p>
<div class="fragment"><pre class="fragment">[local:bnmr:S]/&gt;ls /customscript/ToggleStatusPage
cmd                             /home/bnmr/online/perl/set_status.pl
include path                    /home/bnmr/online/perl
experiment name                 bnmr
beamline                        bnmr
</pre></div><p>The script /home/bnmr/online/perl/set_status.pl will toggle between the status page being set to the default or to the custom, by removing or creating the key "Status" in the /Custom subdirectory.</p>
<p>The following shows the /custom directory when the default Status page is selected: </p>
<div class="fragment"><pre class="fragment">[local:bnmr:S]/&gt;ls /custom
CustomStatus&amp;                   /home/bnmr/online/custom/Custom_Status.html
Status                          /custom/CustomStatus&amp; -&gt; /home/bnmr/online/custom/Custom_Status.html
</pre></div><center> Custom and default status pages for the BNMR experiment at TRIUMF </p>
<div align="center">
<img src="bnmr_both_status_pages.gif" alt="bnmr_both_status_pages.gif"/>
</div>
 </center><p>The script file <em> set_status.pl </em> is as follows:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#!/usr/bin/perl </span>
<span class="preprocessor"></span><span class="preprocessor"># above is magic first line to invoke perl</span>
<span class="preprocessor"></span><span class="preprocessor"># or for debug</span>
<span class="preprocessor"></span><span class="preprocessor">###  !/usr/bin/perl -d</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#   Normally invoked from set_status button on custom Web page Custom_Status.html</span>
<span class="preprocessor"></span><span class="preprocessor"># </span>
<span class="preprocessor"></span><span class="preprocessor"># invoke this script with cmd  e.g.</span>
<span class="preprocessor"></span><span class="preprocessor">#              include                    experiment        beamline</span>
<span class="preprocessor"></span><span class="preprocessor">#                path                                     </span>
<span class="preprocessor"></span><span class="preprocessor"># set_status.pl /home/bnmr/online/perl       bnmr             bnmr</span>
<span class="preprocessor"></span><span class="preprocessor"># set_status.pl /home/bnqr/online/perl       bnqr             bnqr</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># toggles Status page between std MIDAS page and Custom Status page</span>
<span class="preprocessor"></span><span class="preprocessor"># by either deleting odb key /Custom/Status</span>
<span class="preprocessor"></span><span class="preprocessor"># or creating odb key /Custom/Status by loading a file /home/bn&lt;mq&gt;r/online/custom/status.odb</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span>use strict;
<span class="preprocessor">##################### G L O B A L S ####################################</span>
<span class="preprocessor"></span>our  @ARRAY;
our $FALSE=0;
our $FAILURE=0;
our $TRUE=1;
our $SUCCESS=1;
our $ODB_SUCCESS=0;   # status = 0 is success <span class="keywordflow">for</span> odb
our $DEBUG=$FALSE;    # <span class="keyword">set</span> to 1 <span class="keywordflow">for</span> <a class="code" href="mfe_8c.html#a81f0a890e023743f1b88d0cb7d4f74db">debug</a>, 0 <span class="keywordflow">for</span> no debug
our $EXPERIMENT=<span class="stringliteral">&quot; &quot;</span>;
our $ANSWER=<span class="stringliteral">&quot; &quot;</span>;      # reply from odb_cmd
our $COMMAND=<span class="stringliteral">&quot; &quot;</span>;     # copy of command sent be odb_cmd (<span class="keywordflow">for</span> error handling)
our $STATE_STOPPED=1; # Run state is stopped
our $STATE_RUNNING=3; # Run state is running
<span class="preprocessor"># for odb  msg cmd:</span>
<span class="preprocessor"></span>our $MERROR=1; # error
our $MINFO=2;  # info
our $MTALK=32; # talk
<span class="preprocessor"># constants for print_3</span>
<span class="preprocessor"></span>our $DIE = $TRUE;  # die after print_3
our $CONT = $FALSE; # <span class="keywordflow">do</span> not die after print_3 (set_status)
<span class="preprocessor">#e.g.    print_3($name,  &quot;ERROR: no path supplied&quot;,$MERROR,$DIE);</span>
<span class="preprocessor"></span><span class="preprocessor">#    or   print_3($name,  &quot;INFO: run number has not changed&quot;,$MINFO,$CONT);</span>
<span class="preprocessor"></span><span class="preprocessor"># print_3 is a subroutine that prints the message to three places:</span>
<span class="preprocessor"></span><span class="preprocessor">#     the output file, standard output, MIDAS message log</span>
<span class="preprocessor"></span><span class="preprocessor"># print_2 is a subroutine that prints the message to two places:</span>
<span class="preprocessor"></span><span class="preprocessor">#     the output file and standard output</span>
<span class="preprocessor"></span>
<span class="preprocessor">#######################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#  parameters needed by init_check.pl (required code common to perlscripts) :</span>
<span class="preprocessor"></span><span class="preprocessor"># init_check uses $inc_dir, $expt, $beamline from the input parameters</span>
<span class="preprocessor"></span>our ($inc_dir,$expt, $beamline ) = @ARGV;
our $len =  $#ARGV; # array length
our $name = <span class="stringliteral">&quot;set_status&quot;</span>; # same as filename
our $nparam=3;
our $outfile = <span class="stringliteral">&quot;set_status.txt&quot;</span>; #path supplied by file open
our $parameter_msg = <span class="stringliteral">&quot;include_path, experiment;  beamline\n&quot;</span>;
<span class="preprocessor">#######################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># local variables</span>
<span class="preprocessor"></span>my ($path, $key, $status);
my $debug=$FALSE;
my $filename;
<span class="preprocessor">#######################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span>$|=1; # flush output buffers


<span class="preprocessor"># Inc_dir needed because when script is invoked by browser it can&apos;t find the</span>
<span class="preprocessor"></span><span class="preprocessor"># code for require</span>
<span class="preprocessor"></span>unless ($inc_dir) { die <span class="stringliteral">&quot;$name: No include directory path has been supplied\n&quot;</span>;}
$inc_dir =~ s/\/$<span class="comment">//;  # remove any trailing slash</span>
require <span class="stringliteral">&quot;$inc_dir/odb_access.pl&quot;</span>; 

<span class="preprocessor"># Init_check.pl checks:</span>
<span class="preprocessor"></span><span class="preprocessor">#   one copy of script running</span>
<span class="preprocessor"></span><span class="preprocessor">#   no. of input parameters</span>
<span class="preprocessor"></span><span class="preprocessor">#   opens output file $outfile on file handle FOUT</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span>require <span class="stringliteral">&quot;$inc_dir/init_check.pl&quot;</span>;

<span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor"># Output will be sent to file $outfile </span>
<span class="preprocessor"></span><span class="preprocessor"># because this is for use with the browser and STDOUT and STDERR get set to null</span>
<span class="preprocessor"></span>
print FOUT  <span class="stringliteral">&quot;$name starting with parameters:  \n&quot;</span>;
print FOUT  <span class="stringliteral">&quot;Experiment = $expt; \n&quot;</span>;
<span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span>
<span class="keywordflow">if</span>( $beamline =~ /bn[qm]r/i )
{
<span class="preprocessor"># BNM/QR experiments use custom page</span>
<span class="preprocessor"></span>}
<span class="keywordflow">else</span>
{ # no action
exit;
}

<span class="preprocessor"># Status is now a link; supply the expected name of the link or odb_cmd will flag and error </span>
<span class="preprocessor"></span>($status) = odb_cmd ( <span class="stringliteral">&quot;ls&quot;</span>,<span class="stringliteral">&quot;/Custom&quot;</span>,<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;CustomStatus&amp;&quot;</span>);

<span class="keywordflow">if</span>  ($status)
{
    ($status)=odb_cmd ( <span class="stringliteral">&quot;rm&quot;</span>,<span class="stringliteral">&quot;/Custom&quot;</span>,<span class="stringliteral">&quot;Status&quot;</span>,<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span> ) ;  
}
<span class="keywordflow">else</span>
{
<span class="preprocessor"># load required link from a saved file</span>
<span class="preprocessor"></span>    $filename = <span class="stringliteral">&quot;/home/$beamline/online/custom/status.odb&quot;</span>; 
    unless (-e $filename)
    {
        print_3 ($name,<span class="stringliteral">&quot;No such file as $filename&quot;</span>,$DIE);
    }

    ($status)=odb_cmd ( <span class="stringliteral">&quot;load&quot;</span>,<span class="stringliteral">&quot;$filename&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span> ) ;
    <span class="keywordflow">if</span>  ($status)
    {
        
        print_2($name, <span class="stringliteral">&quot;loaded file to create /Custom/Status&quot;</span>,$CONT);
    }
    <span class="keywordflow">else</span> {
        print_2 ($name,<span class="stringliteral">&quot;$name: after odb_cmd, ANSWER=$ANSWER &quot;</span>,$CONT);}

}    
exit;
</pre></div><p> <br/>
</p>
<p><br/>
  
<script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "RC_mhttpd_Internal", "RunControl", "RC_Monitor", "RC_mhttpd_custom_status",  "end" );
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script>
 <a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

