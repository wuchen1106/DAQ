<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Inserting an Image into a Custom page</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="RunControl.html">SECTION 5: Run Control</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_run_control.html">Run Control Programs</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd.html">mhttpd: the MIDAS Web-based Run Control utility</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_Custom_page.html">Custom pages</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_custom_features.html">Features available on custom pages</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="RC_mhttpd_Image_access">Inserting an Image into a Custom page </a></h1><p><br/>
</p>
 <script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "RC_mhttpd_custom_RPC_access", "RunControl", "RC_mhttpd_custom_demo","RC_mhttpd_Image_access",  "end" );
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script>
<h2><a class="anchor" id="RC_mhttpd_custom_history">
Inserting a history image in a custom page</a></h2>
<p>In the special case where the image to be inserted is a <b>History</b> image, it can be inserted into a custom page using an HTML <span class="htmltag">&lt;&lt;img...&gt;</span> tag of the following form: </p>
<div class="fragment"><pre class="fragment">&lt;img src=<span class="stringliteral">&quot;http://hostname.domain:port/HS/Meterdis.gif&amp;scale=12h&amp;width=300&quot;</span>&gt;
</pre></div><p><b>Examples</b> See <a class="el" href="RC_mhttpd_custom_demo.html">Demo of custom image page</a> and <a class="el" href="RC_mhttpd_custom_demo.html#example_image_all">image</a> created by the demo.</p>
<p><br/>
<hr/>
<br/>
 <a class="anchor" id="idx_mhttpd_page_custom_image_insert-image"></a> </p>
<h2><a class="anchor" id="RC_mhttpd_custom_image">
Image insertion into a Custom page</a></h2>
<p><a class="anchor" id="idx_mhttpd_page_custom_image_history-image"></a></p>
<ul>
<li>An image may be inserted into a custom webpage by using an HTML <span class="htmltag">&lt;img...&gt;</span> tag. The image file can be in any format supported by the browser (e.g. &nbsp; <b>gif</b>,&nbsp; <b>png</b>,&nbsp; <b>jpg</b> etc.).</li>
</ul>
<ul>
<li>Alternatively, by defining the image in the subdirectory "images" in the <span class="odb">/Custom ODB tree </span> features such as labels, bars and fills can be superimposed on the image. <br/>
 To make an image <em>"myexpt.gif"</em> available in a Custom Page, follow these steps:</li>
</ul>
<ol>
<li>
<p class="startli">the subdirectory <span class="odb">Images</span> must be created in the ODB <span class="odb">/Custom</span> directory, e.g. using <a class="el" href="RC_odbedit_utility.html">odbedit</a> :</p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]/&gt;cd Custom
[local:Default:Stopped]/Custom&gt;mkdir Images  &lt;-- <span class="keywordflow">if</span> Images does not exist
[local:Default:Stopped]/Custom&gt;cd Images/
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Under the subdirectory <span class="odb">Images</span>, create another subdirectory with the name of the image you are going to use (in this example, <b>myexpt.gif</b>), i.e.</p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]Images&gt;mkdir myexpt.gif &lt;-- make a subdirectory with the image name
[local:Default:Stopped]Images&gt;cd myexpt.gif/
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Under the subdirectory <span class="odb"> myexpt.gif</span> , create the STRING key <span class="odb"> Background</span> : </p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]myexpt.gif&gt;create <span class="keywordtype">string</span> Background  &lt;-- create key <span class="stringliteral">&quot;Background&quot;</span> 
String length [32]: 256
</pre></div><p class="endli"></p>
</li>
<li>
Set the key <span class="odb"> Background</span> to contain the name of the image-file. <div class="fragment"><pre class="fragment">[local:Default:Stopped]myexpt.gif&gt;<span class="keyword">set</span> Background \midas\examples\custom\myexpt.gif
</pre></div> </li>
</ol>
<p>This image must be referenced in a custom HTML file, such as <a class="el" href="myexpt_8html.html">myexpt.html</a> . This file also includes other features such as <b>active clickable areas, labels, bars and fills</b> superimposed on the image. These are explained in the sections <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_Labels_Bars_Fills">below</a>.</p>
<p>Before it can be accessed from mhttpd, this file (<a class="el" href="myexpt_8html.html">myexpt.html</a>) must be <a class="el" href="RC_mhttpd_Activate.html">activated</a> by being defined in the ODB under <span class="odb">/Custom</span>. This is demonstrated in the custom demo <a class="el" href="RC_mhttpd_custom_demo.html">example</a> and the <a class="el" href="RC_mhttpd_custom_demo.html#example_image_all">image</a> created by the demo.</p>
<p><a class="anchor" id="idx_ODB_tree_custom_images"></a> </p>
<h3><a class="anchor" id="RC_mhttpd_custom_images_tree_keys">
Explanation of the keys in the ODB /Custom/images  subtree</a></h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="0">
<caption align="bottom">Above: Meaning of keys in the ODB /Custom tree. </caption>
<tr>
<td colspan="5" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>ODB Key  </p>
</td><td style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Explanation  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Custom/  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>User-created directory to contain custom page information </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>&lt;custom_page_link&gt;  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>User-defined custom page link(s) contains path(s) of custom page HTML code. Each custom page must be defined with a separate custom page link. Each link created here will appear as a button on the Status page (except where noted - see <a class="el" href="RC_mhttpd_Activate.html">How to activate custom page(s) in the ODB</a> for details). The user chooses suitable names for the link(s).  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Images/  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>User-created subdirectory to contain the name(s) of the defined image(s).  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>&lt;Image_name&gt;/  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>User-created subdirectory named for the corresponding image, e.g. Gas.gif, switches.gif etc. For multiple custom pages, multiple subdirectories may be defined.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>background  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Path of image file to be displayed on the custom page, e.g. <b>/home/t2ktpc/online/t2kgas/all_images/Gas.gif</b> (local file)  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>labels/  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Optional subdirectory to be used for superimposing labels on top of the image. (See <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_labels_tree">labels subtree</a>)  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>bars/  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Optional subdirectory to be used for superimposing bars on top of the image. (See <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_bars_tree">bars subtree</a>)  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>fills/  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Optional subdirectory to be used for superimposing fills on top of the image. (See <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_fills_tree">fills subtree</a>)  </p>
<p></p>
</td></tr>
</table>
<p><a class="anchor" id="idx_mhttpd_page_custom_image_mapping"></a> <a class="anchor" id="idx_mhttpd_page_custom_image_clickable-area"></a> </p>
<h2><a class="anchor" id="RC_mhttpd_custom_imagemap">
Mapping active areas onto the image</a></h2>
<p>HTML mapping can be activated on an image to provide "clickable" areas, using the <b>map</b> attribute of the HTML <span class="htmltag">&lt;img&gt;</span> tag.</p>
<p>This can be done now with a new function like this: </p>
<div class="fragment"><pre class="fragment">&lt;map name=<span class="stringliteral">&quot;Custom1&quot;</span>&gt;
&lt;area shape=<span class="stringliteral">&quot;rect&quot;</span> coords=<span class="stringliteral">&quot;40,200,100,300&quot;</span> alt=<span class="stringliteral">&quot;Main Valve&quot;</span>
  href=<span class="stringliteral">&quot;Custom1?cmd=Toggle&amp;odb=/Equipment/Environment/Variables/Output[2]&quot;</span>&gt;
&lt;/map&gt;
&lt;img src=<span class="stringliteral">&quot;custom.gif&quot;</span> usemap=<span class="stringliteral">&quot;#Custom1&quot;</span>&gt;
</pre></div><p>This defines a clickable map on top of the custom image. The area(s) should match with some area(s) on the image, e.g. the box of a valve. Determining the co-ordinates of this area is simplified by using the <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_getmouse">Display mouse position</a> feature.</p>
<p>By clicking on this area, the supplied path to the ODB is used (in this case <span class="odb"> /Equipment/Environment/Variables/Output[2]</span>) and its value is toggled (set to 0 if it is 1, set to 0 if it is 1). If the valve value is then used in the image via a "fill" statement to change the color of the valve, it can turn green or red depending on its state. This is illustrated in the <a class="el" href="RC_MEG_Gas_Page.html">Custom Page for MEG gas system</a> .</p>
<p><b>Examples</b> See also <a class="el" href="RC_mhttpd_custom_demo.html">Demo of custom image page</a> and <a class="el" href="RC_mhttpd_custom_demo.html#example_image_all">image</a> created by the demo.</p>
<h3><a class="anchor" id="RC_mhttpd_custom_imagemap_demo">
Image Map demo</a></h3>
<p>The following code fragment is from the demo file <a class="el" href="myexpt_8html.html">myexpt.html</a> (see <a class="el" href="RC_mhttpd_custom_demo.html">below</a>). </p>
<div class="fragment"><pre class="fragment"> &lt;map name=<span class="stringliteral">&quot;myexpt.map&quot;</span>&gt;
     &lt;area shape=rect coords=<span class="stringliteral">&quot;140,70, 420,170&quot;</span> 
     href=<span class="stringliteral">&quot;http://midas.triumf.ca/doc/html/index.html&quot;</span> title=<span class="stringliteral">&quot;Midas Doc&quot;</span>&gt;
     &lt;area shape=rect coords=<span class="stringliteral">&quot;200,200,400,400&quot;</span>
     href=<span class="stringliteral">&quot;http://localhost:8080&quot;</span> title=<span class="stringliteral">&quot;Switch pump&quot;</span>&gt;
     &lt;area shape=rect coords=<span class="stringliteral">&quot;230,515,325,600&quot;</span>
     href=<span class="stringliteral">&quot;http://localhost:8080&quot;</span> title=<span class="stringliteral">&quot;Logger in color level (using Fill)&quot;</span>&gt;
  &lt;img src=<span class="stringliteral">&quot;myexpt.gif&quot;</span> border=1 usemap=<span class="stringliteral">&quot;#myexpt.map&quot;</span>&gt;
  &lt;/map&gt;
</pre></div><p>Three rectangular clickable areas are defined.</p>
<p>See the <a class="el" href="RC_mhttpd_custom_demo.html#mapping_demo">demo</a>.</p>
<p><br/>
<hr/>
<br/>
</p>
<h3><a class="anchor" id="RC_mhttpd_custom_imagemap_pw">
Area map with password check</a></h3>
<p>For safety from accidental changes, the above area map can be combined with a <a class="el" href="RC_mhttpd_custom_ODB_access_features.html#RC_mhttpd_custom_pw_protection">password check</a>. <a class="anchor" id="promptpwd"></a> This is done by adding a small JavaScript function <b>promptpwd</b> into the custom page: </p>
<div class="fragment"><pre class="fragment">&lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;
&lt;!--
function promptpwd(path)
{
    pwd = prompt(<span class="stringliteral">&apos;Please enter password&apos;</span>, <span class="stringliteral">&apos;&apos;</span>);
    document.cookie = <span class="stringliteral">&quot;cpwd=&quot;</span> + pwd;
    location.href = path;
}
<span class="comment">//--&gt;</span>
&lt;/script&gt;
</pre></div><p>and using it like this: </p>
<div class="fragment"><pre class="fragment">&lt;area shape=<span class="stringliteral">&quot;rect&quot;</span> coords=<span class="stringliteral">&quot;40,200,100,300&quot;</span> alt=<span class="stringliteral">&quot;Main Valve&quot;</span>
  href=<span class="stringliteral">&quot;#&quot;</span>
onClick=<span class="stringliteral">&quot;promptpwd(&apos;Custom1?cmd=toggle&amp;pnam=CustomPwd?odb=/Equipment/Environment/Variables/Output[2]</span>
<span class="stringliteral">&apos;)&quot;</span>&gt;
</pre></div><p>If the <b>pwd</b> option is present in the <span class="odbtag"> &lt;odb&gt; </span> tag, <span class="utility">mhttpd</span> establishes a call to the <b>promptpwd()</b> function if one clicks on the value. The password is then requested from the user and is submitted as a cookie. <span class="utility">mhttpd</span> then checks this password against the ODB entry <br/>
 <span class="odb">/Custom/Pwd/CustomPwd</span> <br/>
 See <a class="el" href="RC_mhttpd_custom_ODB_access_features.html#RC_mhttpd_custom_pw_protection">Password protection of ODB variables accessed from a custom page</a> for further details.</p>
<p><a class="el" href="RC_MEG_Gas_Page.html">This page</a> from the MEG experiment at PSI shows a complex gas system. It demonstrates the use of the area map features. The valves are represented as green circles. If they are clicked, they close and become red (after the user successfully supplies the correct password).</p>
<p><br/>
<hr/>
<br/>
</p>
<p><a class="anchor" id="idx_getMouseXY-JavaScript-function"></a> </p>
<h2><a class="anchor" id="RC_mhttpd_custom_getmouse">
Display mouse position</a></h2>
<p>When writing custom pages with large background images and labels and fills placed on that image, it is hard to figure out X and Y coordinates of the labels. This can now be simplified by setting the label ("id") of the background HTML <span class="htmltag">&lt;img...&gt;</span> tag to <b>"refimg"</b>, e.g.</p>
<div class="fragment"><pre class="fragment">&lt;img <span class="keywordtype">id</span>=<span class="stringliteral">&quot;refimg&quot;</span> src=<span class="stringliteral">&quot;...&quot;</span>&gt;
</pre></div><p>The function <b>getMouseXY</b> in the <a class="el" href="RC_mhttpd_custom_js_lib.html">JavaScript built-in library mhttpd.js</a> supplies the X,Y position if an element of ID <b>refimg</b> is present. Therefore, the JS library must be <a class="el" href="RC_mhttpd_custom_js_lib.html#RC_mhttpd_include_js_library">included</a>.</p>
<p><b>Usage:</b> </p>
<div class="fragment"><pre class="fragment">&lt;img  <span class="keywordtype">id</span>=<span class="stringliteral">&quot;refimg&quot;</span> src=<span class="stringliteral">&quot;ebit_pc.gif&quot;</span> usemap=<span class="stringliteral">&quot;#Custom1&quot;</span>&gt;   &lt;!-- name=<span class="stringliteral">&quot;refimg&quot;</span> makes crosshairs appear --&gt;
&lt;map name=<span class="stringliteral">&quot;Custom1&quot;</span>&gt;
.....
&lt;/map&gt;
</pre></div><p>If the "refimg" tag is present, the cursor changes into a crosshair, and its absolute and relative locations in respect to the reference image are shown in the status bar (Figure 1):</p>
<p><br/>
<br/>
<br/>
 </p>
<center> <span class="image"> Figure 1 : Cursor position on custom page <br/>
<br/>
<br/>
 </p>
<div align="center">
<img src="cursor.png" alt="cursor.png"/>
</div>
<p> </span></center><p> <br/>
<br/>
<br/>
</p>
<dl class="note"><dt><b>Note:</b></dt><dd>To make this work under Firefox, the user has to explicitly allow for status bar changes. To do so, enter about:config in the address bar. In the filter bar, enter status. Then locate dom.disable_window_status_change and set it to false.</dd></dl>
<h2><a class="anchor" id="RC_mhttpd_custom_Labels_Bars_Fills">
Superimposing Labels, Bars and Fills onto an image</a></h2>
<p>You can enhance your custom page by superimposing multiple features based on ODB variables onto your image, such as</p>
<ul>
<li><a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_labels">labels</a>: "live" ODB values positioned in a particular location of the page</li>
<li><a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_bars">bars</a> : "bar level" showing graphically levels or rate etc.</li>
<li><a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_fills">fills</a> : "color level" where colour is used as the level indicator.</li>
<li><a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_edit_boxes">edit boxes</a> : editable ODB values superimposed on the image</li>
</ul>
<p>Each entry will have an ODB tree associated to it defining the ODB variable path, X/Y position, colour, etc. Each time the page is updated, the latest ODB value/level/rate will be shown based on the ODB parameter to which the label, bar or fill is linked - hence the term "live". The overlay of the requested features is done onto the selected <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_image">image file</a>.</p>
<p>This powerful new extension brings the <span class="utility">mhttpd</span> capability closer to other experimental web controllers similar to EPICS.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>Be sure to enable the feature to <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_getmouse">Display mouse position</a> in order to facilitate finding the X,Y positions of the various features.</dd></dl>
<p><b>Examples</b> See <a class="el" href="RC_mhttpd_custom_demo.html">Demo of custom image page</a> and <a class="el" href="RC_mhttpd_custom_demo.html#example_image_all">image</a> created by the demo.</p>
<p><a class="anchor" id="idx_mhttpd_page_custom_image_labels"></a> <a class="anchor" id="idx_labels"></a> </p>
<h3><a class="anchor" id="RC_mhttpd_custom_labels">
Labels superimposed on an Image</a></h3>
<p>In order to include a readout of ODB values (i.e. labels), on the image a further ODB subdirectory <span class="odb">labels</span> must be created. Creating <span class="odb"> Labels/&lt;label name&gt;</span> sub-directory under the <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_image">image filename</a>, will, automatically at the <b>next</b> web page refresh, complete the structure for that label, and fill it with default values:</p>
<div class="fragment"><pre class="fragment">odbedit
[local:Default:Stopped]/Custom&gt;cd Images/myexpt.gif
[local:Default:Stopped]/myexpt.gif&gt;mkdir Labels
[local:Default:Stopped]/myexpt.gif&gt;cd labels
[local:Default:Stopped]Labels&gt;mkdir Rate
[local:Default:Stopped]Rate&gt;
</pre></div><p>The above example assumes that the image-filename is <b>myexpt.gif</b> . After the next refresh, the structure will have been created for the <span class="odb">Rate</span> label: </p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]Rate&gt;ls -l
Key name                        Type    #Val  Size  Last Opn Mode Value
---------------------------------------------------------------------------
Src                             STRING  1     256   2m   0   RWD
Format                          STRING  1     32    2m   0   RWD  %1.1f
Font                            STRING  1     32    2m   0   RWD  Medium
X                               <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>     1     4     2m   0   RWD  0
Y                               <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>     1     4     2m   0   RWD  0
Align                           <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>     1     4     2m   0   RWD  0
FGColor                         STRING  1     8     2m   0   RWD  000000
BGColor                         STRING  1     8     2m   0   RWD  FFFFFF
</pre></div><p>This procedure is repeated for all the labels required, using a unique <span class="odb">&lt;label_name&gt;</span> subdirectory for each label.</p>
<h3><a class="anchor" id="RC_mhttpd_labels_tree">
Explanation of the keys in the /Custom/images/Labels ODB subtree</a></h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="0">
<caption align="bottom">Above: Meaning of keys in the ODB /Custom/images/Labels/&lt;label_name&gt; subtree. </caption>
<tr>
<td colspan="4" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Keys in the ODB subtree ../Labels/&lt;label_name&gt;  </p>
<p></p>
</td></tr>
<tr>
<td colspan="3" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>ODB Key  </p>
</td><td style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Explanation  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>.../Labels/&lt;label_name&gt;  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Src  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Path of a valid ODB Key variable. This is the value to be used for this label  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Format  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Format string for this value e.g. "%5.2f%% iBu" (-&gt; percentage of iBu) or "Rate:%1.1f kB/s"  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Font  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Font size for this label. Set to one of "small",&nbsp; "medium" or "giant".  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>X position of this label in pixels  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>X position for this label in pixels  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Y  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Y position for this label.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Align  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Integer representing Horizontal Alignment for this label. Set to one of 0 (left), 1 (center) or 2 (right).  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>FGColor  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Foreground colour RRGGBB (hex) for this label. See <a class="el" href="RC_mhttpd_Image_access.html#RC_html_colours">colour table</a>.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>BGColor  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Background colour RRGGBB (hex) for this label, See <a class="el" href="RC_mhttpd_Image_access.html#RC_html_colours">colour table</a>.   </p>
</td></tr>
</table>
<p><br/>
<hr/>
<br/>
</p>
<center> <a class="anchor" id="RC_html_colours"></a> </p>
<table style="text-align: center; width: 25%;" border="1" cellpadding="2" cellspacing="0">
<caption align="bottom">Above: RGB values defined in HTML standards for some common colours </caption>
<tr>
<td style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Colour </p>
</td><td style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>RGB Value </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>black </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>000000  </p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>white </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>FFFFFF  </p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>red </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>FF0000  </p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>blue </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>0000FF  </p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>lime green </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>00FF00  </p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>yellow </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>FFFF00  </p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p>gray </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>808080  </p>
</td></tr>
</table>
</center><p><br/>
<hr/>
<br/>
</p>
<p><a class="anchor" id="idx_mhttpd_page_custom_image_bars"></a> <a class="anchor" id="idx_bars"></a> </p>
<h3><a class="anchor" id="RC_mhttpd_custom_bars">
Bars superimposed on an Image</a></h3>
<p>To include bars on the image, a further subdirectory <span class="odb">Bars</span> must be created. Following the same principle as for the <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_bars">labels</a>, by creating <span class="odb">Bars/&lt;bar_name&gt;</span>, the structure for the bar will be filled with a default setting after refreshing the custom MIDAS page.</p>
<p>This procedure is repeated for all the bars required, using a unique <span class="odb">&lt;bar_name&gt;</span> subdirectory for each bar. <br/>
</p>
<h3><a class="anchor" id="RC_mhttpd_bars_tree">
Explanation of the keys in the /Custom/Images/Bars ODB subtree</a></h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="0">
<caption align="bottom">Above: Meaning of keys in the ODB /Custom/Images/Bars/&lt;bar_name&gt; subtree. </caption>
<tr>
<td colspan="4" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Keys in the ODB subtree ../Bars/&lt;bar_name&gt;   </p>
</td></tr>
<tr>
<td colspan="3" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>ODB Key  </p>
</td><td style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Explanation  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>.../Bars/&lt;bar_name&gt;  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Src  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Path of a valid ODB Key variable. This is the value to be used for this bar  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>X position of this bar in pixels  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>X position for this label in pixels  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Y  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Y position for this bar in pixels.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Width  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Width of this bar in pixels.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Height  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Height of this bar in pixels.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Direction  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Direction of this bar. Either 0 (vertical) or 1 (horizontal).  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Axis  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Draw axis. One of 0 (none) or 1 (left) or 2 (right).  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Logscale  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>BOOL </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Draw logarithmic axis. Either "y" or "n".  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Min  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DOUBLE </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Minimum value for axis  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Max  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DOUBLE </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Maximum value for axis  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>FGColor  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Foreground colour RRGGBB (hex) for this bar. See <a class="el" href="RC_mhttpd_Image_access.html#RC_html_colours">colour table</a>.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>BGColor  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Background colour RRGGBB (hex) for this bar. See <a class="el" href="RC_mhttpd_Image_access.html#RC_html_colours">colour table</a>.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>BDColor  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Border colour RRGGBB (hex) for this bar. See <a class="el" href="RC_mhttpd_Image_access.html#RC_html_colours">colour table</a>.   </p>
</td></tr>
</table>
<p><br/>
<hr/>
<br/>
</p>
<p><a class="anchor" id="idx_mhttpd_page_custom_image_fills"></a> <a class="anchor" id="idx_fills"></a> </p>
<h2><a class="anchor" id="RC_mhttpd_custom_fills">
Fills superimposed on an Image</a></h2>
<p>The last option available is the <b>Fills</b> where an area can be filled with different colours depending on the given ODB value (src parameter). In order to include filled areas on the image, a further ODB subdirectory <span class="odb">Fills</span> must be created. The colour selection is mapped by correspondence of the index of the <span class="odb"> Limits</span> array to the <span class="odb">Fillcolors</span> array, both of which must be created in the ODB <span class="odb">Fills</span> subdirectory.</p>
<h3><a class="anchor" id="RC_mhttpd_custom_fills_create">
Create the custom  Fills keys</a></h3>
<p>Presently the <span class="odb">fills</span> structure is not pre-defined and needs to be entered by hand, e.g.</p>
<div class="fragment"><pre class="fragment">Tue&gt; odbedit
[local:midas:Stopped]/&gt;cd Custom/Images/myexpt.gif
[local:midas:myexpt.gif]/&gt;mkdir Fills/Level
[local:midas:myexpt.gif]/&gt;cd Fills/Level
[local:midas:Level]/&gt;create <span class="keywordtype">string</span> Src
String length [32]: 256
[local:midas:S]Level&gt;create <span class="keywordtype">int</span> X
[local:midas:S]Level&gt;create <span class="keywordtype">int</span> Y
[local:midas:S]Level&gt;create <span class="keywordtype">double</span> Limits[4]
[local:midas:S]Level&gt;create <span class="keywordtype">string</span> Fillcolors[4]
String length [32]: 4

[local:midas:S]Level&gt;ls
Src
X                               0
Y                               0
Limits
                                0
                                0
                                0
                                0
Fillcolors

                                
                                
                                
[local:midas:S]Level&gt;                                
</pre></div> <dl class="note"><dt><b>Note:</b></dt><dd>The array lengths, of course, depend on the user's requirements, but the length of the two arrays must be the same.</dd></dl>
<p>One could <a class="el" href="RC_odbedit_examples.html#RC_odbedit_set">set</a> the values (which is rather tedious) or</p>
<ol type="1">
<li><a class="el" href="RC_odbedit_examples.html#RC_odbedit_set">save</a> the structure into a file</li>
<li><b>edit</b> the file to fill the values,</li>
<li>then <a class="el" href="RC_odbedit_examples.html#RC_odbedit_set">reload</a>,</li>
</ol>
<p>i.e. </p>
<div class="fragment"><pre class="fragment">[local:midas:S]Level&gt;save level.odb
[local:midas:S]Level&gt;quit
&gt;edit level.odb
... fill in the values &amp; save the file ...

&gt;odbedit
[local:midas:S]/&gt;load level.odb
</pre></div><p>Once filled with values, the saved odb file might look like this:</p>
<div class="fragment"><pre class="fragment">[/Custom/Images/myexpt.gif/Fills/Level]
Src = STRING : [256] /equipment/Trigger/statistics/events sent
X = <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> : 250
Y = <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> : 550
Limits = DOUBLE[4] :
[0] 0
[1] 10
[2] 10000
[3] 100000
Fillcolors = STRING[4] :
[8] 00FF00
[8] AAFF00
[8] AA0000
[8] FF0000
</pre></div><p>This subtree ( <span class="odb">Level</span> in the example) can be duplicated for as many Fills as required, using a unique <span class="odb">&lt;fill_name&gt;</span> for each subdirectory.</p>
<p><br/>
<br/>
</p>
<h3><a class="anchor" id="RC_mhttpd_fills_tree">
Explanation of the keys in the /Custom/images/fills ODB subtree</a></h3>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="0">
<caption align="bottom">Above: Meaning of keys in the ODB /Custom/Images/Fills/&lt;fill_name&gt; subtree. </caption>
<tr>
<td colspan="4" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Keys in the ODB subtree ../Fills/&lt;fill_name&gt;   </p>
</td></tr>
<tr>
<td colspan="3" style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>ODB Key  </p>
</td><td style="vertical-align: top; background-color: rgb(204, 204, 255); font-weight: bold; text-align: center;"><p>Explanation  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>.../Fills/&lt;fill_name&gt;  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>DIR </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Src  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>STRING </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Path of a valid ODB Key variable. May also include a <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_fills_src_logical">logic calculation</a>. This is the value to be used for this fill.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>X  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>X position for this fill in pixels  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Y  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Y position for this label in pixels  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Limits[array]  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Variable length array containing the values of the limits that when reached cause a colour change. Array length must match length of array <b>Fillcolors</b>.  </p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; font-weight: normal; text-align: left;"><p><br/>
 </p>
</td><td style="vertical-align: top; background-color: lightyellow; font-weight: bold; text-align: left;"><p>Fillcolors[array]  </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>INT </p>
</td><td style="vertical-align: top; font-weight: normal; text-align: left;"><p>Variable length array containing the colours corresponding to the <b>Limits</b> array. Array size must match <b>Limits</b> array size.   </p>
</td></tr>
</table>
<h4><a class="anchor" id="RC_mhttpd_fills_src_logical">
fills/SRC: Logical  calculation</a></h4>
<p><span class="new">An extra feature has been added (<a class="el" href="NDF.html#ndf_may_2010">May 2010</a>) to the SRC key to allow a logical calculation to determine the value used for the fill.</span> <br/>
 Up to two operators are permitted and they must be either </p>
<ul>
<li>
"&gt;&gt;" (shift to the right) or </li>
<li>
"&amp;" (bitwise AND). </li>
</ul>
<p>A hexadecimal number preceded by "0x" is also supported. <br/>
 This feature enables a SRC key that is actually a bit pattern to be used for a fill. <br/>
 In the following example, a gas valve is open if bit 14 of PLCR[136] is TRUE and closed if bit 15 is TRUE (bits are from 0-15). The contents of PLCR[136] are shifted to the right by 14 and then a logical AND is performed to clear all but the lowest 2 bits. The result is used to colour the valve body lime green is the valve is open and black if it is closed. If neither bit is set (i.e. the valve is neither open nor closed) the valve body is coloured red to indicate an error. Anything else (i.e. both bits TRUE) will give a gray colour.</p>
<div class="fragment"><pre class="fragment">[local:t2kgas:S]/&gt;ls /custom/images/Pump_20.gif/fills/d2vb3
Src                             /Equipment/TpcGasPlc/Variables/PLCR[136] &gt;&gt; 14 &amp; 0x3
X                               905
Y                               536
limits
                                0
                                1
                                2
                                3
Fillcolors
                                808080
                                00FF00
                                000000
                                808080
[local:t2kgas:S]/&gt;                    
</pre></div><p>Any fill that requires a more complicated calculation than this, will have to be done using Javascript.</p>
<p><br/>
<hr/>
<br/>
 <a class="anchor" id="edit-boxes-see-mhttpd-custom-image"></a> <a class="anchor" id="idx_mhttpd_page_custom_image_edit-boxes"></a> </p>
<h2><a class="anchor" id="RC_mhttpd_custom_edit_boxes">
Edit boxes floating on top of a graphic</a></h2>
<p>An edit box can be placed on top of a graphic by means of an HTML style tag. The custom page code would look like this:</p>
<div class="fragment"><pre class="fragment">&lt;div style=<span class="stringliteral">&quot;position:absolute; top:100px; left:50px;&quot;</span>&gt;
&lt;odb src=<span class="stringliteral">&quot;/Runinfo/run number&quot;</span> edit=1&gt;
&lt;/div&gt;
&lt;img src=<span class="stringliteral">&quot;custom.gif&quot;</span>&gt;
</pre></div><p>The <b>&lt;div</b> ...&gt; tag surrounding the <span class="odbtag">&lt;odb ...&gt; tag</span> places this directly on top of the "custom.gif" image, where it can be clicked to be edited.</p>
<p>The same thing could be done in JavaScript using the <span class="js">ODBEdit</span> function from the <a class="el" href="RC_mhttpd_custom_js_lib.html">JavaScript built-in library mhttpd.js</a> :</p>
<div class="fragment"><pre class="fragment">&lt;div style=<span class="stringliteral">&quot;position:absolute; top:100px; left:50px;&quot;</span>&gt;
&lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;
document.write(<span class="stringliteral">&apos;Using Javascript and ODBEdit:&apos;</span>)
path=<span class="stringliteral">&apos;/runinfo/run number&apos;</span>
rn = ODBGet(path)
document.write(&apos;&lt;a href=&quot;<span class="preprocessor">#&quot; onclick=&quot;ODBEdit(path)&quot; &gt;&apos;)</span>
<span class="preprocessor"></span>document.write(rn)
document.write(<span class="stringliteral">&apos;&lt;/a&gt;&apos;</span>);
document.write(<span class="stringliteral">&apos;&apos;</span>) ;
&lt;/script&gt;
&lt;/div&gt;
&lt;img src=<span class="stringliteral">&quot;custom.gif&quot;</span>&gt;
</pre></div><p>The JavaScript version can be much more flexible than the HTML version. For example, for the EBIT experiment at TRIUMF, different images are shown depending on the experimental mode. This means that the edit boxes have to be placed at different positions according to the image used. The following JavaScript code fragment illustrates this:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// pulse1 width (TITAN beam gate 1 TIBG1 ) </span>
<span class="keywordflow">if</span>(ppg_mode == <span class="stringliteral">&apos;1d&apos;</span>)
   document.write(<span class="stringliteral">&apos;&lt;div style=&quot;position:absolute;  left:364px; top:225px;&quot;&gt;&apos;</span>) <span class="comment">// mode 1d</span>
<span class="keywordflow">else</span> <span class="keywordflow">if</span>(ppg_mode == <span class="stringliteral">&apos;1c&apos;</span>)
   document.write(<span class="stringliteral">&apos;&lt;div style=&quot;position:absolute;  left:248px; top:207px;&quot;&gt;&apos;</span>) <span class="comment">// mode 1c</span>
<span class="keywordflow">else</span>
   document.write(<span class="stringliteral">&apos;&lt;div style=&quot;position:absolute;  left:248px; top:220px;&quot;&gt;&apos;</span>) <span class="comment">// modes 1a 1b</span>

var jpath_p1w =block_path + <span class="stringliteral">&apos;/pulse1/pulse width (ms)&apos;</span>
jvar = ODBGet(jpath_p1w);
document.write(<span class="stringliteral">&apos;&lt;a href=&quot;#&quot; onclick=&quot;ODBEdit(jpath_p1w)&quot; &gt;&apos;</span>)
document.write(jvar + <span class="stringliteral">&apos;ms&apos;</span>);
document.write(<span class="stringliteral">&apos;&lt;/a&gt;&apos;</span>);
document.write(<span class="stringliteral">&apos;&apos;</span>) ;
document.write(<span class="stringliteral">&apos;&lt;/div&gt;&apos;</span>)
</pre></div><p>The EBIT custom page is shown <a class="el" href="RC_Ebit_custom_page.html">here</a>.</p>
<p><br/>
<hr/>
<br/>
</p>
<h3><a class="anchor" id="RC_mhttpd_custom_pw">
Password protection of Edit Boxes</a></h3>
<p>It is a good idea to protect the Edit Box from <a class="el" href="RC_mhttpd_custom_ODB_access_features.html#RC_mhttpd_custom_pw_protection">accidental access</a>. This is done by a using the <a class="el" href="RC_mhttpd_custom_ODB_access.html#RC_mhttpd_custom_odb_html">pwd option</a> in the <span class="odbtag">&lt;odb ...&gt; tag</span>, and adding the same Javascript function <b>promptpwd()</b> as was <a class="el" href="RC_mhttpd_Image_access.html#promptpwd">used above</a> for password protection of an area map. </p>
<div class="fragment"><pre class="fragment">&lt;!--
function promptpwd(path)
{
    pwd = prompt(<span class="stringliteral">&apos;Please enter password&apos;</span>, <span class="stringliteral">&apos;&apos;</span>);
    document.cookie = <span class="stringliteral">&quot;cpwd=&quot;</span> + pwd;
    location.href = path;
}
<span class="comment">//--&gt;</span>
&lt;/script&gt;
...
...

&lt;odb src=<span class="stringliteral">&quot;/...&quot;</span> edit=1 pwd=<span class="stringliteral">&quot;CustomPwd&quot;</span>&gt;

...
</pre></div><p><br/>
<hr/>
<br/>
</p>
<ul>
<li><a class="el" href="RC_mhttpd_custom_demo.html">Demo of custom image page</a></li>
<li><a class="el" href="RC_mhttpd_Internal.html">Internal custom page</a></li>
</ul>
<p><br/>
</p>
 <script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "RC_mhttpd_custom_RPC_access", "RunControl", "RC_mhttpd_custom_demo","RC_mhttpd_Image_access",  "" );
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script> <p><a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

