<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Demo of custom image page</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="RunControl.html">SECTION 5: Run Control</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_run_control.html">Run Control Programs</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd.html">mhttpd: the MIDAS Web-based Run Control utility</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_Custom_page.html">Custom pages</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_custom_features.html">Features available on custom pages</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_Image_access.html">Inserting an Image into a Custom page</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="RC_mhttpd_custom_demo">Demo of custom image page </a></h1><p><br/>
</p>
 <script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "RC_mhttpd_Image_access", "RunControl", "RC_mhttpd_Internal","RC_mhttpd_custom_demo",  "end" );
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script> <p><br/>
</p>
<p>This demo will show you how to make a custom page containing an image, and superimpose edit boxes, clickable areas, labels, fills etc.</p>
<p>The HTML document <a class="el" href="myexpt_8html.html">myexpt.html</a> can be found in the examples/custom directory. This code forms part of a custom demo. For the full operation of this demo, you'll need to have the frontend <b>"sample frontend"</b> (midas/example/experiment/frontend.c), mlogger, <span class="utility">mhttpd</span> running.</p>
<p>The code <a class="el" href="myexpt_8html.html">myexpt.html</a> is shown below for convenience: </p>
<div class="fragment"><pre class="fragment">&lt;html&gt;
  &lt;head&gt;
   &lt;title&gt;MyExperiment Demo Status&lt;/title&gt;
   &lt;meta http-equiv=<span class="stringliteral">&quot;Refresh&quot;</span> content=<span class="stringliteral">&quot;30&quot;</span>&gt;
  &lt;/head&gt;
 &lt;body&gt;
  &lt;form name=<span class="stringliteral">&quot;form1&quot;</span> method=<span class="stringliteral">&quot;Get&quot;</span> action=<span class="stringliteral">&quot;/CS/MyExpt&amp;&quot;</span>&gt;
     &lt;table border=3 cellpadding=2&gt;
          &lt;tr&gt;&lt;th bgcolor=<span class="stringliteral">&quot;#A0A0FF&quot;</span>&gt;Demo Experiment&lt;th bgcolor=<span class="stringliteral">&quot;#A0A0FF&quot;</span>&gt;Custom Monitor/Control&lt;/tr&gt; 
          &lt;tr&gt;&lt;td&gt; &lt;b&gt;&lt;font color=<span class="stringliteral">&quot;#ff 0&quot;</span>&gt;<a class="code" href="myexpt_8html.html#ac26fc1b25ec1347d95b62621aa890be9">Actions</a>: &lt;/font&gt;&lt;/b&gt;&lt;input
                      value=<span class="stringliteral">&quot;Status&quot;</span> name=<span class="stringliteral">&quot;cmd&quot;</span> type=<span class="stringliteral">&quot;submit&quot;</span>&gt; &lt;input type=<span class="stringliteral">&quot;submit&quot;</span>
                      name=<span class="stringliteral">&quot;cmd&quot;</span> value=<span class="stringliteral">&quot;Start&quot;</span>&gt;&lt;input type=<span class="stringliteral">&quot;submit&quot;</span> name=<span class="stringliteral">&quot;cmd&quot;</span> value=<span class="stringliteral">&quot;Stop&quot;</span>&gt;
           &lt;/td&gt;&lt;td&gt;
           &lt;center&gt; &lt;a href=<span class="stringliteral">&quot;http://midas.triumf.ca/doc/html/index.html&quot;</span>&gt; Help &lt;/a&gt;&lt;/center&gt;
           &lt;/td&gt;&lt;/tr&gt;
           &lt;td&gt;Current run #: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Runinfo/run number&quot;</span>&gt;&lt;/b&gt;&lt;/td&gt;
           &lt;td&gt;#events: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/Trigger/Statistics/Events sent&quot;</span>&gt;&lt;/b&gt;&lt;/td&gt;
           &lt;/tr&gt;&lt;tr&gt;
           &lt;td&gt;Event Rate [/sec]: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/Trigger/Statistics/Events per sec.&quot;</span>&gt;&lt;/b&gt;&lt;/td&gt;
           &lt;td&gt;Data Rate [kB/s]: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/Trigger/Statistics/kBytes per sec.&quot;</span>&gt;&lt;/b&gt;&lt;/td&gt;
            &lt;/tr&gt;&lt;tr&gt;
            &lt;td&gt;Cell Pressure: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/NewEpics/Variables/CellPressure&quot;</span>&gt;&lt;/b&gt;&lt;/td&gt;
           &lt;td&gt;FaradayCup   : &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/NewEpics/Variables/ChargeFaradayCup&quot;</span>&gt;&lt;/b&gt;&lt;/td&gt;
           &lt;/tr&gt;&lt;tr&gt;
           &lt;td&gt;Q1 Setpoint: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/NewEpics/Variables/EpicsVars[17]&quot;</span> edit=1&gt;&lt;/b&gt;&lt;/td&gt;
          &lt;td&gt;Q2 Setpoint: &lt;b&gt;&lt;odb src=<span class="stringliteral">&quot;/Equipment/NewEpics/Variables/EpicsVars[19]&quot;</span> edit=1&gt;&lt;/b&gt;&lt;/td&gt;
          &lt;/tr&gt;&lt;tr&gt;
          &lt;th&gt; &lt;img src=<span class="stringliteral">&quot;http://localhost:8080/HS/Default/Trigger%20rate.gif?</span>
<span class="stringliteral">                          exp=default&amp;amp;scale=12h&amp;amp;width=250&quot;</span>&gt;
          &lt;/th&gt;
          &lt;th&gt; &lt;img src=<span class="stringliteral">&quot;http://localhost:8080/HS/Default/Scaler%20rate.gif?</span>
<span class="stringliteral">                          exp=default&amp;amp;scale=10m&amp;amp;width=250&quot;</span>&gt;&lt;/th&gt;
          &lt;/tr&gt;
          &lt;tr&gt;&lt;td colspan=2&gt;
          &lt;map name=<span class="stringliteral">&quot;myexpt.map&quot;</span>&gt;
          &lt;area shape=rect coords=<span class="stringliteral">&quot;140,70, 420,170&quot;</span> 
                  href=<span class="stringliteral">&quot;http://midas.triumf.ca/doc/html/index.html&quot;</span> title=<span class="stringliteral">&quot;Midas Doc&quot;</span>&gt;
          &lt;area shape=rect coords=<span class="stringliteral">&quot;200,200,400,400&quot;</span>
                  href=<span class="stringliteral">&quot;http://localhost:8080&quot;</span> title=<span class="stringliteral">&quot;Switch pump&quot;</span>&gt;
       &lt;area shape=rect coords=<span class="stringliteral">&quot;230,515,325,600&quot;</span>
              href=<span class="stringliteral">&quot;http://localhost:8080&quot;</span> title=<span class="stringliteral">&quot;Logger in color level (using Fill)&quot;</span>&gt;
        &lt;img src=<span class="stringliteral">&quot;myexpt.gif&quot;</span> border=1 usemap=<span class="stringliteral">&quot;#myexpt.map&quot;</span>&gt;
          &lt;/map&gt;
          &lt;/td&gt;&lt;/tr&gt;
     &lt;/table&gt;&lt;/form&gt;
   &lt;/body&gt;
  &lt;/html&gt;  
</pre></div><p>To <a class="el" href="RC_mhttpd_Activate.html">activate</a> this HTML document, it has to be defined in the ODB as follow: </p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]/&gt;cd /Custom
[local:Default:Stopped]/Custom&gt;create <span class="keywordtype">string</span> Myexpt&amp;
String length [32]: 256
[local:Default:Stopped]/Custom&gt;<span class="keyword">set</span> Myexpt&amp; /midas/examples/custom/myexpt.html
</pre></div><p> After refresh, the alias-link <b>Myexpt</b> should be visible on the Main Status Page. If you have not already inserted the image file name <b>myexpt.gif</b> into the Custom page, do so now by following the instructions to <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_image">insert the image</a>.</p>
<p>Once the image is inserted, after refresh the image should be visible by clicking on the alias-link <b>Myexpt</b>, and the mapping active.</p>
<p><a class="anchor" id="mapping_demo"></a> The mapping based on myexpt.map is active, hovering the mouse over the boxes will display the associated titles (Midas Doc, Switch pump, etc), By clicking on either box the browser will go to the defined html page specified by the map.</p>
<p><br/>
<br/>
<br/>
 </p>
<center> <span class="image"> Figure 1 : Demo Custom web page with external reference to html document. <br/>
<br/>
<br/>
 </p>
<div align="center">
<img src="mhxcustom01.jpg" alt="mhxcustom01.jpg"/>
</div>
<p> </span></center><p> <br/>
<br/>
<br/>
</p>
<p>In addition to these initial features, multiple ODB values can be superimposed at define location on the image. Each entry will have a ODB tree associated to it defining the ODB variable, X/Y position, color, etc...</p>
<p>Make the <b>Rate</b> label as explained <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_labels">above</a>. After refreshing the web page, you will see the error message below:</p>
<div class="fragment"><pre class="fragment">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Refresh web page &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;

12:32:38 [mhttpd] [mhttpd.c:5508:show_custom_gif] Empty Src key <span class="keywordflow">for</span> label <span class="stringliteral">&quot;Rate&quot;</span>
</pre></div><p>The keys created in the <span class="odbpath">Labels/Rate</span> subtree are explained <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_labels_tree">here</a>. Customize this label by assigning the <b>Src</b> key to a valid ODB Key variable, and the X,Y fields to position top-left corner of the label, e.g. </p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> src <span class="stringliteral">&quot;/Equipment/Trigger/statistics/kbytes per sec.&quot;</span>
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> x 330
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> y 250 
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> format <span class="stringliteral">&quot;Rate:%1.1f kB/s&quot;</span>
</pre></div><p>Once the initial label is created, the simplest way to extent to multiple labels is to copy the existing label sub-tree and modify the label <a class="el" href="structparameters.html">parameters</a>. </p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]Labels&gt;cd .. 
[local:Default:Stopped]Labels&gt;copy Rate Event
[local:Default:Stopped]Labels&gt;cd Events/
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> src <span class="stringliteral">&quot;/Equipment/Trigger/statistics/events per sec.&quot;</span>
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> Format <span class="stringliteral">&quot;Rate:%1.1f evt/s&quot;</span>
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> y 170
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> x 250
</pre></div><p> You will now have two <b>Labels</b>, named "Rate" and "Event", both subtrees under <span class="odb">../Labels</span>.</p>
<p>In the same manner, you can create <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_bars">bars</a> used for level representation. The keys in the Bars subdirectory are explained <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_bars_tree">above</a>.</p>
<p>This code will setup two ODB values defined by the fields src. </p>
<div class="fragment"><pre class="fragment">[local:Default:Stopped]myexpt.gif&gt;pwd
/Custom/Images/myexpt.gif
[local:Default:Stopped]myexpt.gif&gt;mkdir Bars
[local:Default:Stopped]myexpt.gif&gt;cd <a class="code" href="mevb_8c.html#a3e94d2c0bc333fdca8dd2a5fae330940">bars</a>/
[local:Default:Stopped]Labels&gt;mkdir Rate

&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Refresh web page &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;

14:05:58 [mhttpd] [mhttpd.c:5508:show_custom_gif] Empty Src key <span class="keywordflow">for</span> <a class="code" href="mevb_8c.html#a3e94d2c0bc333fdca8dd2a5fae330940">bars</a> <span class="stringliteral">&quot;Rate&quot;</span>
[local:Default:Stopped]Labels&gt;cd Rate/
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> src <span class="stringliteral">&quot;/Equipment/Trigger/statistics/kbytes per sec.&quot;</span>
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> x 4640
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> y 210 
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> max 1e6 
[local:Default:Stopped]Labels&gt;cd .. 
[local:Default:Stopped]Labels&gt;copy Rate Events
[local:Default:Stopped]Labels&gt;cd Events/
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> src <span class="stringliteral">&quot;/logger/channles/0/statistics/events written&quot;</span>
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> direction 1
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> y 240
[local:Default:Stopped]Event&gt;<span class="keyword">set</span> x 450
[local:Default:Stopped]Rate&gt;<span class="keyword">set</span> max 1e6 
</pre></div><p>You will now have two <b>Bars</b>, also named "Rate" and "Event", both subtrees under <span class="odb">../Bars</span>.</p>
<p>The last feature to be added is a <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_fills">Fill</a> (where an area can be filled with different colors depending on the given ODB value). These have to be entered by hand. See instructions in <a class="el" href="RC_mhttpd_Image_access.html#RC_mhttpd_custom_fills">fills</a>, which shows you how to create a <b>Filled</b> area named "Level" (a subtree under <span class="odb">../Fills</span>).</p>
<p>Once all these features have been added, the custom page will look as Figure 2: <a class="anchor" id="example_image_all"></a></p>
<p><br/>
<br/>
<br/>
 </p>
<center> <span class="image"> Figure 2 : Demo Custom web page with labels,bars,fills and history plots <br/>
<br/>
<br/>
 </p>
<div align="center">
<img src="mhxcustom02.jpg" alt="mhxcustom02.jpg"/>
</div>
<p> </span></center><p> <br/>
<br/>
<br/>
</p>
 <script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "RC_mhttpd_Image_access", "RunControl",  "RC_mhttpd_Internal","RC_mhttpd_custom_demo",  "" );
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script> <p><a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

