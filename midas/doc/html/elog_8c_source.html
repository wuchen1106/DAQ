<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: elog.c Source File</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_967645259cf3504d40df5943f0783e6b.html">src</a>
  </div>
</div>
<div class="contents">
<h1>elog.c</h1><a href="elog_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/********************************************************************\</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  Name:         ELOG.C</span>
<a name="l00004"></a>00004 <span class="comment">  Created by:   Stefan Ritt</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">  Contents:     MIDAS elog functions</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  $Id: elog.c 4637 2009-12-01 16:24:10Z ritt $</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">\********************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;<a class="code" href="msystem_8h.html">msystem.h</a>&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;strlcpy.h&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">/** @defgroup elfunctioncode Midas Elog Functions (el_xxx)</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">/**dox***************************************************************/</span><span class="comment"></span>
<a name="l00021"></a>00021 <span class="comment">/** @addtogroup elfunctioncode</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> *  @{  */</span>
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">/**dox***************************************************************/</span>
<a name="l00026"></a>00026 <span class="preprocessor">#ifndef DOXYGEN_SHOULD_SKIP_THIS</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span>
<a name="l00028"></a>00028 <span class="comment">/********************************************************************\</span>
<a name="l00029"></a>00029 <span class="comment">*                                                                    *</span>
<a name="l00030"></a>00030 <span class="comment">*               Electronic logbook functions                         *</span>
<a name="l00031"></a>00031 <span class="comment">*                                                                    *</span>
<a name="l00032"></a>00032 <span class="comment">\********************************************************************/</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="comment">/********************************************************************/</span>
<a name="l00035"></a>00035 <span class="keywordtype">void</span> el_decode(<span class="keywordtype">char</span> *message, <span class="keywordtype">char</span> *key, <span class="keywordtype">char</span> *result, <span class="keywordtype">int</span> size)
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037    <span class="keywordtype">char</span> *rstart = result;
<a name="l00038"></a>00038    <span class="keywordtype">char</span> *pc;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040    <span class="keywordflow">if</span> (result == NULL)
<a name="l00041"></a>00041       <span class="keywordflow">return</span>;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043    *result = 0;
<a name="l00044"></a>00044 
<a name="l00045"></a>00045    <span class="keywordflow">if</span> (strstr(message, key)) {
<a name="l00046"></a>00046       <span class="keywordflow">for</span> (pc = strstr(message, key) + strlen(key); *pc != <span class="charliteral">&apos;\n&apos;</span>;)
<a name="l00047"></a>00047          *result++ = *pc++;
<a name="l00048"></a>00048       *result = 0;
<a name="l00049"></a>00049    }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051    assert((<span class="keywordtype">int</span>) strlen(rstart) &lt; size);
<a name="l00052"></a>00052 }
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">/**dox***************************************************************/</span>
<a name="l00055"></a>00055 <span class="preprocessor">#endif                          </span><span class="comment">/* DOXYGEN_SHOULD_SKIP_THIS */</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/********************************************************************/</span><span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">/**</span>
<a name="l00059"></a>00059 <span class="comment">Submit an ELog entry.</span>
<a name="l00060"></a>00060 <span class="comment">@param run  Run Number.</span>
<a name="l00061"></a>00061 <span class="comment">@param author Message author.</span>
<a name="l00062"></a>00062 <span class="comment">@param type Message type.</span>
<a name="l00063"></a>00063 <span class="comment">@param syst Message system.</span>
<a name="l00064"></a>00064 <span class="comment">@param subject Subject.</span>
<a name="l00065"></a>00065 <span class="comment">@param text Message text.</span>
<a name="l00066"></a>00066 <span class="comment">@param reply_to In reply to this message.</span>
<a name="l00067"></a>00067 <span class="comment">@param encoding Text encoding, either HTML or plain.</span>
<a name="l00068"></a>00068 <span class="comment">@param afilename1   File name of attachment.</span>
<a name="l00069"></a>00069 <span class="comment">@param buffer1      File contents.</span>
<a name="l00070"></a>00070 <span class="comment">@param buffer_size1 Size of buffer in bytes.</span>
<a name="l00071"></a>00071 <span class="comment">@param afilename2   File name of attachment.</span>
<a name="l00072"></a>00072 <span class="comment">@param buffer2      File contents.</span>
<a name="l00073"></a>00073 <span class="comment">@param buffer_size2 Size of buffer in bytes.</span>
<a name="l00074"></a>00074 <span class="comment">@param afilename3   File name of attachment.</span>
<a name="l00075"></a>00075 <span class="comment">@param buffer3      File contents.</span>
<a name="l00076"></a>00076 <span class="comment">@param buffer_size3 Size of buffer in bytes.</span>
<a name="l00077"></a>00077 <span class="comment">@param tag          If given, edit existing message.</span>
<a name="l00078"></a>00078 <span class="comment">@param tag_size     Maximum size of tag.</span>
<a name="l00079"></a>00079 <span class="comment">@return EL_SUCCESS</span>
<a name="l00080"></a>00080 <span class="comment">*/</span>
<a name="l00081"></a><a class="code" href="group__elfunctioncode.html#gae698a2d388573565a5673afbd3b40f9b">00081</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="group__elfunctioncode.html#gae698a2d388573565a5673afbd3b40f9b">el_submit</a>(<span class="keywordtype">int</span> run, <span class="keyword">const</span> <span class="keywordtype">char</span> *author, <span class="keyword">const</span> <span class="keywordtype">char</span> *type, <span class="keyword">const</span> <span class="keywordtype">char</span> *syst, <span class="keyword">const</span> <span class="keywordtype">char</span> *subject,
<a name="l00082"></a>00082               <span class="keyword">const</span> <span class="keywordtype">char</span> *text, <span class="keyword">const</span> <span class="keywordtype">char</span> *reply_to, <span class="keyword">const</span> <span class="keywordtype">char</span> *encoding,
<a name="l00083"></a>00083               <span class="keyword">const</span> <span class="keywordtype">char</span> *afilename1, <span class="keywordtype">char</span> *buffer1, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> buffer_size1,
<a name="l00084"></a>00084               <span class="keyword">const</span> <span class="keywordtype">char</span> *afilename2, <span class="keywordtype">char</span> *buffer2, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> buffer_size2,
<a name="l00085"></a>00085               <span class="keyword">const</span> <span class="keywordtype">char</span> *afilename3, <span class="keywordtype">char</span> *buffer3, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> buffer_size3, <span class="keywordtype">char</span> *tag, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> tag_size)
<a name="l00086"></a>00086 {
<a name="l00087"></a>00087    <span class="keywordflow">if</span> (rpc_is_remote())
<a name="l00088"></a>00088       <span class="keywordflow">return</span> rpc_call(<a class="code" href="group__mrpcdefineh.html#ga01e8cb480d2e147d0df7075f7c16fd43">RPC_EL_SUBMIT</a>, run, author, type, syst, subject,
<a name="l00089"></a>00089                       text, reply_to, encoding,
<a name="l00090"></a>00090                       afilename1, buffer1, buffer_size1,
<a name="l00091"></a>00091                       afilename2, buffer2, buffer_size2, afilename3, buffer3, buffer_size3, tag, tag_size);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="preprocessor">#ifdef LOCAL_ROUTINES</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>   {
<a name="l00095"></a>00095       <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> n, size, fh, status, <a class="code" href="mfe_8c.html#a16695ea2bfd19f294afe066d6007ab36">run_number</a>, semaphore, buffer_size = 0, idx, offset = 0, tail_size = 0;
<a name="l00096"></a>00096       <span class="keyword">struct </span>tm *tms = NULL;
<a name="l00097"></a>00097       <span class="keywordtype">char</span> afilename[256], file_name[256], afile_name[3][256], dir[256], str[256],
<a name="l00098"></a>00098           start_str[80], end_str[80], last[80], date[80], thread[80], attachment[256];
<a name="l00099"></a>00099       HNDLE <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l00100"></a>00100       time_t now;
<a name="l00101"></a>00101       <span class="keywordtype">char</span> message[10000], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l00102"></a>00102       <span class="keywordtype">char</span> *buffer = NULL;
<a name="l00103"></a>00103       <a class="code" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a> bedit;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105       <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107       bedit = (tag[0] != 0);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109       <span class="comment">/* request semaphore */</span>
<a name="l00110"></a>00110       cm_get_experiment_semaphore(NULL, &amp;semaphore, NULL, NULL);
<a name="l00111"></a>00111       status = ss_semaphore_wait_for(semaphore, 5 * 60 * 1000);
<a name="l00112"></a>00112       <span class="keywordflow">if</span> (status != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>) {
<a name="l00113"></a>00113          <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;el_submit&quot;</span>, <span class="stringliteral">&quot;Cannot lock experiment semaphore, ss_semaphore_wait_for() status %d&quot;</span>, status);
<a name="l00114"></a>00114          abort();
<a name="l00115"></a>00115       }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117       <span class="comment">/* get run number from ODB if not given */</span>
<a name="l00118"></a>00118       <span class="keywordflow">if</span> (run &gt; 0)
<a name="l00119"></a>00119          run_number = run;
<a name="l00120"></a>00120       <span class="keywordflow">else</span> {
<a name="l00121"></a>00121          <span class="comment">/* get run number */</span>
<a name="l00122"></a>00122          size = <span class="keyword">sizeof</span>(run_number);
<a name="l00123"></a>00123          status = <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Runinfo/Run number&quot;</span>, &amp;run_number, &amp;size, <a class="code" href="group__mdefineh.html#gad950d5fde6dd3ea7eba59fb6760a38cb">TID_INT</a>, TRUE);
<a name="l00124"></a>00124          assert(status == <a class="code" href="group__err21.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>);
<a name="l00125"></a>00125       }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127       <span class="keywordflow">if</span> (run_number &lt; 0) {
<a name="l00128"></a>00128          <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;el_submit&quot;</span>, <span class="stringliteral">&quot;aborting on attempt to use invalid run number %d&quot;</span>, run_number);
<a name="l00129"></a>00129          abort();
<a name="l00130"></a>00130       }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132       <span class="keywordflow">for</span> (idx = 0; idx &lt; 3; idx++) {
<a name="l00133"></a>00133          <span class="comment">/* generate filename for attachment */</span>
<a name="l00134"></a>00134          afile_name[idx][0] = file_name[0] = 0;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136          <span class="keywordflow">if</span> (idx == 0) {
<a name="l00137"></a>00137             strcpy(afilename, afilename1);
<a name="l00138"></a>00138             buffer = buffer1;
<a name="l00139"></a>00139             buffer_size = buffer_size1;
<a name="l00140"></a>00140          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == 1) {
<a name="l00141"></a>00141             strcpy(afilename, afilename2);
<a name="l00142"></a>00142             buffer = buffer2;
<a name="l00143"></a>00143             buffer_size = buffer_size2;
<a name="l00144"></a>00144          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == 2) {
<a name="l00145"></a>00145             strcpy(afilename, afilename3);
<a name="l00146"></a>00146             buffer = buffer3;
<a name="l00147"></a>00147             buffer_size = buffer_size3;
<a name="l00148"></a>00148          }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150          <span class="keywordflow">if</span> (afilename[0]) {
<a name="l00151"></a>00151             strcpy(file_name, afilename);
<a name="l00152"></a>00152             p = file_name;
<a name="l00153"></a>00153             <span class="keywordflow">while</span> (strchr(p, <span class="charliteral">&apos;:&apos;</span>))
<a name="l00154"></a>00154                p = strchr(p, <span class="charliteral">&apos;:&apos;</span>) + 1;
<a name="l00155"></a>00155             <span class="keywordflow">while</span> (strchr(p, <span class="charliteral">&apos;\\&apos;</span>))
<a name="l00156"></a>00156                p = strchr(p, <span class="charliteral">&apos;\\&apos;</span>) + 1; <span class="comment">/* NT */</span>
<a name="l00157"></a>00157             <span class="keywordflow">while</span> (strchr(p, <span class="charliteral">&apos;/&apos;</span>))
<a name="l00158"></a>00158                p = strchr(p, <span class="charliteral">&apos;/&apos;</span>) + 1;  <span class="comment">/* Unix */</span>
<a name="l00159"></a>00159             <span class="keywordflow">while</span> (strchr(p, <span class="charliteral">&apos;]&apos;</span>))
<a name="l00160"></a>00160                p = strchr(p, <span class="charliteral">&apos;]&apos;</span>) + 1;  <span class="comment">/* VMS */</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162             <span class="comment">/* assemble ELog filename */</span>
<a name="l00163"></a>00163             <span class="keywordflow">if</span> (p[0]) {
<a name="l00164"></a>00164                dir[0] = 0;
<a name="l00165"></a>00165                <span class="keywordflow">if</span> (hDB &gt; 0) {
<a name="l00166"></a>00166                   size = <span class="keyword">sizeof</span>(dir);
<a name="l00167"></a>00167                   memset(dir, 0, size);
<a name="l00168"></a>00168                   status = <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Elog dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, FALSE);
<a name="l00169"></a>00169                   <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l00170"></a>00170                      <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, TRUE);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172                   <span class="keywordflow">if</span> (dir[0] != 0 &amp;&amp; dir[strlen(dir) - 1] != DIR_SEPARATOR)
<a name="l00173"></a>00173                      strcat(dir, DIR_SEPARATOR_STR);
<a name="l00174"></a>00174                }
<a name="l00175"></a>00175 <span class="preprocessor">#if !defined(OS_VXWORKS)</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span><span class="preprocessor">#if !defined(OS_VMS)</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>               tzset();
<a name="l00178"></a>00178 <span class="preprocessor">#endif</span>
<a name="l00179"></a>00179 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>
<a name="l00181"></a>00181                time(&amp;now);
<a name="l00182"></a>00182                tms = localtime(&amp;now);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184                strcpy(str, p);
<a name="l00185"></a>00185                sprintf(afile_name[idx], <span class="stringliteral">&quot;%02d%02d%02d_%02d%02d%02d_%s&quot;</span>,
<a name="l00186"></a>00186                        tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday,
<a name="l00187"></a>00187                        tms-&gt;tm_hour, tms-&gt;tm_min, tms-&gt;tm_sec, str);
<a name="l00188"></a>00188                sprintf(file_name, <span class="stringliteral">&quot;%s%02d%02d%02d_%02d%02d%02d_%s&quot;</span>, dir,
<a name="l00189"></a>00189                        tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday,
<a name="l00190"></a>00190                        tms-&gt;tm_hour, tms-&gt;tm_min, tms-&gt;tm_sec, str);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192                <span class="comment">/* save attachment */</span>
<a name="l00193"></a>00193                fh = open(file_name, O_CREAT | O_RDWR | O_BINARY, 0644);
<a name="l00194"></a>00194                <span class="keywordflow">if</span> (fh &lt; 0) {
<a name="l00195"></a>00195                   <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;el_submit&quot;</span>, <span class="stringliteral">&quot;Cannot write attachment file \&quot;%s\&quot;&quot;</span>, file_name);
<a name="l00196"></a>00196                } <span class="keywordflow">else</span> {
<a name="l00197"></a>00197                   write(fh, buffer, buffer_size);
<a name="l00198"></a>00198                   close(fh);
<a name="l00199"></a>00199                }
<a name="l00200"></a>00200             }
<a name="l00201"></a>00201          }
<a name="l00202"></a>00202       }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204       <span class="comment">/* generate new file name YYMMDD.log in data directory */</span>
<a name="l00205"></a>00205       <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00206"></a>00206 
<a name="l00207"></a>00207       size = <span class="keyword">sizeof</span>(dir);
<a name="l00208"></a>00208       memset(dir, 0, size);
<a name="l00209"></a>00209       status = <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Elog dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, FALSE);
<a name="l00210"></a>00210       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l00211"></a>00211          <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, TRUE);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213       <span class="keywordflow">if</span> (dir[0] != 0 &amp;&amp; dir[strlen(dir) - 1] != DIR_SEPARATOR)
<a name="l00214"></a>00214          strcat(dir, DIR_SEPARATOR_STR);
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 <span class="preprocessor">#if !defined(OS_VXWORKS)</span>
<a name="l00217"></a>00217 <span class="preprocessor"></span><span class="preprocessor">#if !defined(OS_VMS)</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>      tzset();
<a name="l00219"></a>00219 <span class="preprocessor">#endif</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (bedit) {
<a name="l00223"></a>00223          <span class="comment">/* edit existing message */</span>
<a name="l00224"></a>00224          strcpy(str, tag);
<a name="l00225"></a>00225          <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>)) {
<a name="l00226"></a>00226             offset = atoi(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1);
<a name="l00227"></a>00227             *strchr(str, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l00228"></a>00228          }
<a name="l00229"></a>00229          sprintf(file_name, <span class="stringliteral">&quot;%s%s.log&quot;</span>, dir, str);
<a name="l00230"></a>00230          fh = open(file_name, O_CREAT | O_RDWR | O_BINARY, 0644);
<a name="l00231"></a>00231          <span class="keywordflow">if</span> (fh &lt; 0) {
<a name="l00232"></a>00232             ss_semaphore_release(semaphore);
<a name="l00233"></a>00233             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00234"></a>00234          }
<a name="l00235"></a>00235          lseek(fh, offset, SEEK_SET);
<a name="l00236"></a>00236          read(fh, str, 16);
<a name="l00237"></a>00237          assert(strncmp(str, <span class="stringliteral">&quot;$Start$&quot;</span>, 7) == 0);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239          size = atoi(str + 9);
<a name="l00240"></a>00240          read(fh, message, size);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242          el_decode(message, <span class="stringliteral">&quot;Date: &quot;</span>, date, <span class="keyword">sizeof</span>(date));
<a name="l00243"></a>00243          el_decode(message, <span class="stringliteral">&quot;Thread: &quot;</span>, thread, <span class="keyword">sizeof</span>(thread));
<a name="l00244"></a>00244          el_decode(message, <span class="stringliteral">&quot;Attachment: &quot;</span>, attachment, <span class="keyword">sizeof</span>(attachment));
<a name="l00245"></a>00245 
<a name="l00246"></a>00246          <span class="comment">/* buffer tail of logfile */</span>
<a name="l00247"></a>00247          lseek(fh, 0, SEEK_END);
<a name="l00248"></a>00248          tail_size = TELL(fh) - (offset + size);
<a name="l00249"></a>00249 
<a name="l00250"></a>00250          <span class="keywordflow">if</span> (tail_size &gt; 0) {
<a name="l00251"></a>00251             buffer = (<span class="keywordtype">char</span> *) M_MALLOC(tail_size);
<a name="l00252"></a>00252             <span class="keywordflow">if</span> (buffer == NULL) {
<a name="l00253"></a>00253                close(fh);
<a name="l00254"></a>00254                ss_semaphore_release(semaphore);
<a name="l00255"></a>00255                <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258             lseek(fh, offset + size, SEEK_SET);
<a name="l00259"></a>00259             n = read(fh, buffer, tail_size);
<a name="l00260"></a>00260             assert(n == tail_size);
<a name="l00261"></a>00261          }
<a name="l00262"></a>00262          lseek(fh, offset, SEEK_SET);
<a name="l00263"></a>00263       } <span class="keywordflow">else</span> {
<a name="l00264"></a>00264          <span class="comment">/* create new message */</span>
<a name="l00265"></a>00265          time(&amp;now);
<a name="l00266"></a>00266          tms = localtime(&amp;now);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268          sprintf(file_name, <span class="stringliteral">&quot;%s%02d%02d%02d.log&quot;</span>, dir, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00269"></a>00269 
<a name="l00270"></a>00270          fh = open(file_name, O_CREAT | O_RDWR | O_BINARY, 0644);
<a name="l00271"></a>00271          <span class="keywordflow">if</span> (fh &lt; 0) {
<a name="l00272"></a>00272             ss_semaphore_release(semaphore);
<a name="l00273"></a>00273             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00274"></a>00274          }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276          strcpy(date, ctime(&amp;now));
<a name="l00277"></a>00277          date[24] = 0;
<a name="l00278"></a>00278 
<a name="l00279"></a>00279          <span class="keywordflow">if</span> (reply_to[0])
<a name="l00280"></a>00280             sprintf(thread, <span class="stringliteral">&quot;%16s %16s&quot;</span>, reply_to, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00281"></a>00281          <span class="keywordflow">else</span>
<a name="l00282"></a>00282             sprintf(thread, <span class="stringliteral">&quot;%16s %16s&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284          lseek(fh, 0, SEEK_END);
<a name="l00285"></a>00285       }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287       <span class="comment">/* compose message */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289       sprintf(message, <span class="stringliteral">&quot;Date: %s\n&quot;</span>, date);
<a name="l00290"></a>00290       sprintf(message + strlen(message), <span class="stringliteral">&quot;Thread: %s\n&quot;</span>, thread);
<a name="l00291"></a>00291       sprintf(message + strlen(message), <span class="stringliteral">&quot;Run: %d\n&quot;</span>, run_number);
<a name="l00292"></a>00292       sprintf(message + strlen(message), <span class="stringliteral">&quot;Author: %s\n&quot;</span>, author);
<a name="l00293"></a>00293       sprintf(message + strlen(message), <span class="stringliteral">&quot;Type: %s\n&quot;</span>, type);
<a name="l00294"></a>00294       sprintf(message + strlen(message), <span class="stringliteral">&quot;System: %s\n&quot;</span>, syst);
<a name="l00295"></a>00295       sprintf(message + strlen(message), <span class="stringliteral">&quot;Subject: %s\n&quot;</span>, subject);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297       <span class="comment">/* keep original attachment if edit and no new attachment */</span>
<a name="l00298"></a>00298       <span class="keywordflow">if</span> (bedit &amp;&amp; afile_name[0][0] == 0 &amp;&amp; afile_name[1][0] == 0 &amp;&amp; afile_name[2][0] == 0)
<a name="l00299"></a>00299          sprintf(message + strlen(message), <span class="stringliteral">&quot;Attachment: %s&quot;</span>, attachment);
<a name="l00300"></a>00300       <span class="keywordflow">else</span> {
<a name="l00301"></a>00301          sprintf(message + strlen(message), <span class="stringliteral">&quot;Attachment: %s&quot;</span>, afile_name[0]);
<a name="l00302"></a>00302          <span class="keywordflow">if</span> (afile_name[1][0])
<a name="l00303"></a>00303             sprintf(message + strlen(message), <span class="stringliteral">&quot;,%s&quot;</span>, afile_name[1]);
<a name="l00304"></a>00304          <span class="keywordflow">if</span> (afile_name[2][0])
<a name="l00305"></a>00305             sprintf(message + strlen(message), <span class="stringliteral">&quot;,%s&quot;</span>, afile_name[2]);
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307       sprintf(message + strlen(message), <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00308"></a>00308 
<a name="l00309"></a>00309       sprintf(message + strlen(message), <span class="stringliteral">&quot;Encoding: %s\n&quot;</span>, encoding);
<a name="l00310"></a>00310       sprintf(message + strlen(message), <span class="stringliteral">&quot;========================================\n&quot;</span>);
<a name="l00311"></a>00311       strcat(message, text);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313       assert(strlen(message) &lt; <span class="keyword">sizeof</span>(message));        <span class="comment">/* bomb out on array overrun. */</span>
<a name="l00314"></a>00314 
<a name="l00315"></a>00315       size = 0;
<a name="l00316"></a>00316       sprintf(start_str, <span class="stringliteral">&quot;$Start$: %6d\n&quot;</span>, size);
<a name="l00317"></a>00317       sprintf(end_str, <span class="stringliteral">&quot;$End$:   %6d\n\f&quot;</span>, size);
<a name="l00318"></a>00318 
<a name="l00319"></a>00319       size = strlen(message) + strlen(start_str) + strlen(end_str);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321       <span class="keywordflow">if</span> (tag != NULL &amp;&amp; !bedit)
<a name="l00322"></a>00322          sprintf(tag, <span class="stringliteral">&quot;%02d%02d%02d.%d&quot;</span>, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday, (<span class="keywordtype">int</span>) TELL(fh));
<a name="l00323"></a>00323 
<a name="l00324"></a>00324       <span class="comment">/* size has to fit in 6 digits */</span>
<a name="l00325"></a>00325       assert(size &lt; 999999);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327       sprintf(start_str, <span class="stringliteral">&quot;$Start$: %6d\n&quot;</span>, size);
<a name="l00328"></a>00328       sprintf(end_str, <span class="stringliteral">&quot;$End$:   %6d\n\f&quot;</span>, size);
<a name="l00329"></a>00329 
<a name="l00330"></a>00330       write(fh, start_str, strlen(start_str));
<a name="l00331"></a>00331       write(fh, message, strlen(message));
<a name="l00332"></a>00332       write(fh, end_str, strlen(end_str));
<a name="l00333"></a>00333 
<a name="l00334"></a>00334       <span class="keywordflow">if</span> (bedit) {
<a name="l00335"></a>00335          <span class="keywordflow">if</span> (tail_size &gt; 0) {
<a name="l00336"></a>00336             n = write(fh, buffer, tail_size);
<a name="l00337"></a>00337             M_FREE(buffer);
<a name="l00338"></a>00338          }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340          <span class="comment">/* truncate file here */</span>
<a name="l00341"></a>00341 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l00342"></a>00342 <span class="preprocessor"></span>         chsize(fh, TELL(fh));
<a name="l00343"></a>00343 <span class="preprocessor">#else</span>
<a name="l00344"></a>00344 <span class="preprocessor"></span>         ftruncate(fh, TELL(fh));
<a name="l00345"></a>00345 <span class="preprocessor">#endif</span>
<a name="l00346"></a>00346 <span class="preprocessor"></span>      }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348       close(fh);
<a name="l00349"></a>00349 
<a name="l00350"></a>00350       <span class="comment">/* if reply, mark original message */</span>
<a name="l00351"></a>00351       <span class="keywordflow">if</span> (reply_to[0] &amp;&amp; !bedit) {
<a name="l00352"></a>00352          strcpy(last, reply_to);
<a name="l00353"></a>00353          <span class="keywordflow">do</span> {
<a name="l00354"></a>00354             status = el_search_message(last, &amp;fh, FALSE);
<a name="l00355"></a>00355             <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>) {
<a name="l00356"></a>00356                <span class="comment">/* position to next thread location */</span>
<a name="l00357"></a>00357                lseek(fh, 72, SEEK_CUR);
<a name="l00358"></a>00358                memset(str, 0, <span class="keyword">sizeof</span>(str));
<a name="l00359"></a>00359                read(fh, str, 16);
<a name="l00360"></a>00360                lseek(fh, -16, SEEK_CUR);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362                <span class="comment">/* if no reply yet, set it */</span>
<a name="l00363"></a>00363                <span class="keywordflow">if</span> (atoi(str) == 0) {
<a name="l00364"></a>00364                   sprintf(str, <span class="stringliteral">&quot;%16s&quot;</span>, tag);
<a name="l00365"></a>00365                   write(fh, str, 16);
<a name="l00366"></a>00366                   close(fh);
<a name="l00367"></a>00367                   <span class="keywordflow">break</span>;
<a name="l00368"></a>00368                } <span class="keywordflow">else</span> {
<a name="l00369"></a>00369                   <span class="comment">/* if reply set, find last one in chain */</span>
<a name="l00370"></a>00370                   strcpy(last, strtok(str, <span class="stringliteral">&quot; &quot;</span>));
<a name="l00371"></a>00371                   close(fh);
<a name="l00372"></a>00372                }
<a name="l00373"></a>00373             } <span class="keywordflow">else</span>
<a name="l00374"></a>00374                <span class="comment">/* stop on error */</span>
<a name="l00375"></a>00375                <span class="keywordflow">break</span>;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377          } <span class="keywordflow">while</span> (TRUE);
<a name="l00378"></a>00378       }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380       <span class="comment">/* release elog semaphore */</span>
<a name="l00381"></a>00381       ss_semaphore_release(semaphore);
<a name="l00382"></a>00382    }
<a name="l00383"></a>00383 <span class="preprocessor">#endif                          </span><span class="comment">/* LOCAL_ROUTINES */</span>
<a name="l00384"></a>00384 
<a name="l00385"></a>00385    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>;
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 <span class="comment"></span>
<a name="l00388"></a>00388 <span class="comment">/**dox***************************************************************/</span>
<a name="l00389"></a>00389 <span class="preprocessor">#ifndef DOXYGEN_SHOULD_SKIP_THIS</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span>
<a name="l00391"></a>00391 <span class="comment">/********************************************************************/</span>
<a name="l00392"></a>00392 <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> el_search_message(<span class="keywordtype">char</span> *tag, <span class="keywordtype">int</span> *fh, <a class="code" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a> walk)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394    <span class="keywordtype">int</span> i, size, offset, direction, last, status;
<a name="l00395"></a>00395    <span class="keyword">struct </span>tm *tms, ltms;
<a name="l00396"></a>00396    time_t lt, ltime, lact;
<a name="l00397"></a>00397    <span class="keywordtype">char</span> str[256], file_name[256], dir[256];
<a name="l00398"></a>00398    HNDLE <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="preprocessor">#if !defined(OS_VXWORKS)</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span><span class="preprocessor">#if !defined(OS_VMS)</span>
<a name="l00402"></a>00402 <span class="preprocessor"></span>   tzset();
<a name="l00403"></a>00403 <span class="preprocessor">#endif</span>
<a name="l00404"></a>00404 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>
<a name="l00406"></a>00406    <span class="comment">/* open file */</span>
<a name="l00407"></a>00407    <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00408"></a>00408 
<a name="l00409"></a>00409    size = <span class="keyword">sizeof</span>(dir);
<a name="l00410"></a>00410    memset(dir, 0, size);
<a name="l00411"></a>00411    status = <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Elog dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, FALSE);
<a name="l00412"></a>00412    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l00413"></a>00413       <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, TRUE);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    <span class="keywordflow">if</span> (dir[0] != 0 &amp;&amp; dir[strlen(dir) - 1] != DIR_SEPARATOR)
<a name="l00416"></a>00416       strcat(dir, DIR_SEPARATOR_STR);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418    <span class="comment">/* check tag for direction */</span>
<a name="l00419"></a>00419    direction = 0;
<a name="l00420"></a>00420    <span class="keywordflow">if</span> (strpbrk(tag, <span class="stringliteral">&quot;+-&quot;</span>)) {
<a name="l00421"></a>00421       direction = atoi(strpbrk(tag, <span class="stringliteral">&quot;+-&quot;</span>));
<a name="l00422"></a>00422       *strpbrk(tag, <span class="stringliteral">&quot;+-&quot;</span>) = 0;
<a name="l00423"></a>00423    }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425    <span class="comment">/* if tag is given, open file directly */</span>
<a name="l00426"></a>00426    <span class="keywordflow">if</span> (tag[0]) {
<a name="l00427"></a>00427       <span class="comment">/* extract time structure from tag */</span>
<a name="l00428"></a>00428       tms = &amp;ltms;
<a name="l00429"></a>00429       memset(tms, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> tm));
<a name="l00430"></a>00430       tms-&gt;tm_year = (tag[0] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (tag[1] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l00431"></a>00431       tms-&gt;tm_mon = (tag[2] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (tag[3] - <span class="charliteral">&apos;0&apos;</span>) - 1;
<a name="l00432"></a>00432       tms-&gt;tm_mday = (tag[4] - <span class="charliteral">&apos;0&apos;</span>) * 10 + (tag[5] - <span class="charliteral">&apos;0&apos;</span>);
<a name="l00433"></a>00433       tms-&gt;tm_hour = 12;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435       <span class="keywordflow">if</span> (tms-&gt;tm_year &lt; 90)
<a name="l00436"></a>00436          tms-&gt;tm_year += 100;
<a name="l00437"></a>00437       ltime = lt = mktime(tms);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439       strcpy(str, tag);
<a name="l00440"></a>00440       <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>)) {
<a name="l00441"></a>00441          offset = atoi(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1);
<a name="l00442"></a>00442          *strchr(str, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l00443"></a>00443       } <span class="keywordflow">else</span>
<a name="l00444"></a>00444          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446       <span class="keywordflow">do</span> {
<a name="l00447"></a>00447          tms = localtime(&amp;ltime);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449          sprintf(file_name, <span class="stringliteral">&quot;%s%02d%02d%02d.log&quot;</span>, dir, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00450"></a>00450          *fh = open(file_name, O_RDWR | O_BINARY, 0644);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452          <span class="keywordflow">if</span> (*fh &lt; 0) {
<a name="l00453"></a>00453             <span class="keywordflow">if</span> (!walk)
<a name="l00454"></a>00454                <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456             <span class="keywordflow">if</span> (direction == -1)
<a name="l00457"></a>00457                ltime -= 3600 * 24;      <span class="comment">/* one day back */</span>
<a name="l00458"></a>00458             <span class="keywordflow">else</span>
<a name="l00459"></a>00459                ltime += 3600 * 24;      <span class="comment">/* go forward one day */</span>
<a name="l00460"></a>00460 
<a name="l00461"></a>00461             <span class="comment">/* set new tag */</span>
<a name="l00462"></a>00462             tms = localtime(&amp;ltime);
<a name="l00463"></a>00463             sprintf(tag, <span class="stringliteral">&quot;%02d%02d%02d.0&quot;</span>, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00464"></a>00464          }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466          <span class="comment">/* in forward direction, stop today */</span>
<a name="l00467"></a>00467          <span class="keywordflow">if</span> (direction != -1 &amp;&amp; ltime &gt; time(NULL) + 3600 * 24)
<a name="l00468"></a>00468             <span class="keywordflow">break</span>;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470          <span class="comment">/* in backward direction, go back 10 years */</span>
<a name="l00471"></a>00471          <span class="keywordflow">if</span> (direction == -1 &amp;&amp; <a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) lt - (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) ltime) &gt; 3600 * 24 * 365 * 10)
<a name="l00472"></a>00472             <span class="keywordflow">break</span>;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       } <span class="keywordflow">while</span> (*fh &lt; 0);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476       <span class="keywordflow">if</span> (*fh &lt; 0)
<a name="l00477"></a>00477          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       lseek(*fh, offset, SEEK_SET);
<a name="l00480"></a>00480 
<a name="l00481"></a>00481       <span class="comment">/* check if start of message */</span>
<a name="l00482"></a>00482       i = read(*fh, str, 15);
<a name="l00483"></a>00483       <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l00484"></a>00484          close(*fh);
<a name="l00485"></a>00485          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488       <span class="keywordflow">if</span> (strncmp(str, <span class="stringliteral">&quot;$Start$: &quot;</span>, 9) != 0) {
<a name="l00489"></a>00489          close(*fh);
<a name="l00490"></a>00490          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00491"></a>00491       }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493       lseek(*fh, offset, SEEK_SET);
<a name="l00494"></a>00494    }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496    <span class="comment">/* open most recent file if no tag given */</span>
<a name="l00497"></a>00497    <span class="keywordflow">if</span> (tag[0] == 0) {
<a name="l00498"></a>00498       time((time_t *) &amp;lt);
<a name="l00499"></a>00499       ltime = lt;
<a name="l00500"></a>00500       <span class="keywordflow">do</span> {
<a name="l00501"></a>00501          tms = localtime(&amp;ltime);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503          sprintf(file_name, <span class="stringliteral">&quot;%s%02d%02d%02d.log&quot;</span>, dir, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00504"></a>00504          *fh = open(file_name, O_RDWR | O_BINARY, 0644);
<a name="l00505"></a>00505 
<a name="l00506"></a>00506          <span class="keywordflow">if</span> (*fh &lt; 0)
<a name="l00507"></a>00507             ltime -= 3600 * 24; <span class="comment">/* one day back */</span>
<a name="l00508"></a>00508 
<a name="l00509"></a>00509       } <span class="keywordflow">while</span> (*fh &lt; 0 &amp;&amp; (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) lt - (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) ltime &lt; 3600 * 24 * 365);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511       <span class="keywordflow">if</span> (*fh &lt; 0)
<a name="l00512"></a>00512          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514       <span class="comment">/* remember tag */</span>
<a name="l00515"></a>00515       sprintf(tag, <span class="stringliteral">&quot;%02d%02d%02d&quot;</span>, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517       lseek(*fh, 0, SEEK_END);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519       sprintf(tag + strlen(tag), <span class="stringliteral">&quot;.%d&quot;</span>, (<span class="keywordtype">int</span>) TELL(*fh));
<a name="l00520"></a>00520    }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 
<a name="l00523"></a>00523    <span class="keywordflow">if</span> (direction == -1) {
<a name="l00524"></a>00524       <span class="comment">/* seek previous message */</span>
<a name="l00525"></a>00525 
<a name="l00526"></a>00526       <span class="keywordflow">if</span> (TELL(*fh) == 0) {
<a name="l00527"></a>00527          <span class="comment">/* go back one day */</span>
<a name="l00528"></a>00528          close(*fh);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530          lt = ltime;
<a name="l00531"></a>00531          <span class="keywordflow">do</span> {
<a name="l00532"></a>00532             lt -= 3600 * 24;
<a name="l00533"></a>00533             tms = localtime(&amp;lt);
<a name="l00534"></a>00534             sprintf(str, <span class="stringliteral">&quot;%02d%02d%02d.0&quot;</span>, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536             status = el_search_message(str, fh, FALSE);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538          } <span class="keywordflow">while</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a> &amp;&amp; (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) ltime - (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) lt &lt; 3600 * 24 * 365);
<a name="l00539"></a>00539 
<a name="l00540"></a>00540          <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l00541"></a>00541             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gaac4d08b2b3c0c6755a104864de2ec8f0">EL_FIRST_MSG</a>;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543          <span class="comment">/* adjust tag */</span>
<a name="l00544"></a>00544          strcpy(tag, str);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546          <span class="comment">/* go to end of current file */</span>
<a name="l00547"></a>00547          lseek(*fh, 0, SEEK_END);
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550       <span class="comment">/* read previous message size */</span>
<a name="l00551"></a>00551       lseek(*fh, -17, SEEK_CUR);
<a name="l00552"></a>00552       i = read(*fh, str, 17);
<a name="l00553"></a>00553       <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l00554"></a>00554          close(*fh);
<a name="l00555"></a>00555          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558       <span class="keywordflow">if</span> (strncmp(str, <span class="stringliteral">&quot;$End$: &quot;</span>, 7) != 0) {
<a name="l00559"></a>00559          close(*fh);
<a name="l00560"></a>00560          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00561"></a>00561       }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       <span class="comment">/* make sure the input string to atoi() is zero-terminated:</span>
<a name="l00564"></a>00564 <span class="comment">       * $End$:      355garbage</span>
<a name="l00565"></a>00565 <span class="comment">       * 01234567890123456789 */</span>
<a name="l00566"></a>00566       str[15] = 0;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       size = atoi(str + 7);
<a name="l00569"></a>00569       assert(size &gt; 15);
<a name="l00570"></a>00570 
<a name="l00571"></a>00571       lseek(*fh, -size, SEEK_CUR);
<a name="l00572"></a>00572 
<a name="l00573"></a>00573       <span class="comment">/* adjust tag */</span>
<a name="l00574"></a>00574       sprintf(strchr(tag, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>) TELL(*fh));
<a name="l00575"></a>00575    }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (direction == 1) {
<a name="l00578"></a>00578       <span class="comment">/* seek next message */</span>
<a name="l00579"></a>00579 
<a name="l00580"></a>00580       <span class="comment">/* read current message size */</span>
<a name="l00581"></a>00581       last = TELL(*fh);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583       i = read(*fh, str, 15);
<a name="l00584"></a>00584       <span class="keywordflow">if</span> (i &lt;= 0) {
<a name="l00585"></a>00585          close(*fh);
<a name="l00586"></a>00586          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00587"></a>00587       }
<a name="l00588"></a>00588       lseek(*fh, -15, SEEK_CUR);
<a name="l00589"></a>00589 
<a name="l00590"></a>00590       <span class="keywordflow">if</span> (strncmp(str, <span class="stringliteral">&quot;$Start$: &quot;</span>, 9) != 0) {
<a name="l00591"></a>00591          close(*fh);
<a name="l00592"></a>00592          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00593"></a>00593       }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595       <span class="comment">/* make sure the input string to atoi() is zero-terminated</span>
<a name="l00596"></a>00596 <span class="comment">       * $Start$:    606garbage</span>
<a name="l00597"></a>00597 <span class="comment">       * 01234567890123456789 */</span>
<a name="l00598"></a>00598       str[15] = 0;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600       size = atoi(str + 9);
<a name="l00601"></a>00601       assert(size &gt; 15);
<a name="l00602"></a>00602 
<a name="l00603"></a>00603       lseek(*fh, size, SEEK_CUR);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605       <span class="comment">/* if EOF, goto next day */</span>
<a name="l00606"></a>00606       i = read(*fh, str, 15);
<a name="l00607"></a>00607       <span class="keywordflow">if</span> (i &lt; 15) {
<a name="l00608"></a>00608          close(*fh);
<a name="l00609"></a>00609          time((time_t *) &amp;lact);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611          lt = ltime;
<a name="l00612"></a>00612          <span class="keywordflow">do</span> {
<a name="l00613"></a>00613             lt += 3600 * 24;
<a name="l00614"></a>00614             tms = localtime(&amp;lt);
<a name="l00615"></a>00615             sprintf(str, <span class="stringliteral">&quot;%02d%02d%02d.0&quot;</span>, tms-&gt;tm_year % 100, tms-&gt;tm_mon + 1, tms-&gt;tm_mday);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617             status = el_search_message(str, fh, FALSE);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619          } <span class="keywordflow">while</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a> &amp;&amp; (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) lt - (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>) lact &lt; 3600 * 24);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621          <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l00622"></a>00622             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5f11d9b4e829e2486252fef634b6a382">EL_LAST_MSG</a>;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624          <span class="comment">/* adjust tag */</span>
<a name="l00625"></a>00625          strcpy(tag, str);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627          <span class="comment">/* go to beginning of current file */</span>
<a name="l00628"></a>00628          lseek(*fh, 0, SEEK_SET);
<a name="l00629"></a>00629       } <span class="keywordflow">else</span>
<a name="l00630"></a>00630          lseek(*fh, -15, SEEK_CUR);
<a name="l00631"></a>00631 
<a name="l00632"></a>00632       <span class="comment">/* adjust tag */</span>
<a name="l00633"></a>00633       sprintf(strchr(tag, <span class="charliteral">&apos;.&apos;</span>) + 1, <span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>) TELL(*fh));
<a name="l00634"></a>00634    }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>;
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 
<a name="l00640"></a>00640 <span class="comment">/********************************************************************/</span>
<a name="l00641"></a>00641 <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> el_retrieve(<span class="keywordtype">char</span> *tag, <span class="keywordtype">char</span> *date, <span class="keywordtype">int</span> *run, <span class="keywordtype">char</span> *author, <span class="keywordtype">char</span> *type,
<a name="l00642"></a>00642                 <span class="keywordtype">char</span> *syst, <span class="keywordtype">char</span> *subject, <span class="keywordtype">char</span> *text, <span class="keywordtype">int</span> *textsize,
<a name="l00643"></a>00643                 <span class="keywordtype">char</span> *orig_tag, <span class="keywordtype">char</span> *reply_tag,
<a name="l00644"></a>00644                 <span class="keywordtype">char</span> *attachment1, <span class="keywordtype">char</span> *attachment2, <span class="keywordtype">char</span> *attachment3, <span class="keywordtype">char</span> *encoding)
<a name="l00645"></a>00645 <span class="comment">/********************************************************************\</span>
<a name="l00646"></a>00646 <span class="comment"></span>
<a name="l00647"></a>00647 <span class="comment">  Routine: el_retrieve</span>
<a name="l00648"></a>00648 <span class="comment"></span>
<a name="l00649"></a>00649 <span class="comment">  Purpose: Retrieve an ELog entry by its message tab</span>
<a name="l00650"></a>00650 <span class="comment"></span>
<a name="l00651"></a>00651 <span class="comment">  Input:</span>
<a name="l00652"></a>00652 <span class="comment">    char   *tag             tag in the form YYMMDD.offset</span>
<a name="l00653"></a>00653 <span class="comment">    int    *size            Size of text buffer</span>
<a name="l00654"></a>00654 <span class="comment"></span>
<a name="l00655"></a>00655 <span class="comment">  Output:</span>
<a name="l00656"></a>00656 <span class="comment">    char   *tag             tag of retrieved message</span>
<a name="l00657"></a>00657 <span class="comment">    char   *date            Date/time of message recording</span>
<a name="l00658"></a>00658 <span class="comment">    int    *run             Run number</span>
<a name="l00659"></a>00659 <span class="comment">    char   *author          Message author</span>
<a name="l00660"></a>00660 <span class="comment">    char   *type            Message type</span>
<a name="l00661"></a>00661 <span class="comment">    char   *syst            Message system</span>
<a name="l00662"></a>00662 <span class="comment">    char   *subject         Subject</span>
<a name="l00663"></a>00663 <span class="comment">    char   *text            Message text</span>
<a name="l00664"></a>00664 <span class="comment">    char   *orig_tag        Original message if this one is a reply</span>
<a name="l00665"></a>00665 <span class="comment">    char   *reply_tag       Reply for current message</span>
<a name="l00666"></a>00666 <span class="comment">    char   *attachment1/2/3 File attachment</span>
<a name="l00667"></a>00667 <span class="comment">    char   *encoding        Encoding of message</span>
<a name="l00668"></a>00668 <span class="comment">    int    *size            Actual message text size</span>
<a name="l00669"></a>00669 <span class="comment"></span>
<a name="l00670"></a>00670 <span class="comment">  Function value:</span>
<a name="l00671"></a>00671 <span class="comment">    EL_SUCCESS              Successful completion</span>
<a name="l00672"></a>00672 <span class="comment">    EL_LAST_MSG             Last message in log</span>
<a name="l00673"></a>00673 <span class="comment"></span>
<a name="l00674"></a>00674 <span class="comment">\********************************************************************/</span>
<a name="l00675"></a>00675 {
<a name="l00676"></a>00676    <span class="keywordtype">int</span> size, fh = 0, offset, search_status, rd;
<a name="l00677"></a>00677    <span class="keywordtype">char</span> str[256], *<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a>;
<a name="l00678"></a>00678    <span class="keywordtype">char</span> message[10000], thread[256], attachment_all[256];
<a name="l00679"></a>00679 
<a name="l00680"></a>00680    <span class="keywordflow">if</span> (tag[0]) {
<a name="l00681"></a>00681       search_status = el_search_message(tag, &amp;fh, TRUE);
<a name="l00682"></a>00682       <span class="keywordflow">if</span> (search_status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l00683"></a>00683          <span class="keywordflow">return</span> search_status;
<a name="l00684"></a>00684    } <span class="keywordflow">else</span> {
<a name="l00685"></a>00685       <span class="comment">/* open most recent message */</span>
<a name="l00686"></a>00686       strcpy(tag, <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00687"></a>00687       search_status = el_search_message(tag, &amp;fh, TRUE);
<a name="l00688"></a>00688       <span class="keywordflow">if</span> (search_status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l00689"></a>00689          <span class="keywordflow">return</span> search_status;
<a name="l00690"></a>00690    }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692    <span class="comment">/* extract message size */</span>
<a name="l00693"></a>00693    offset = TELL(fh);
<a name="l00694"></a>00694    rd = read(fh, str, 15);
<a name="l00695"></a>00695    assert(rd == 15);
<a name="l00696"></a>00696 
<a name="l00697"></a>00697    <span class="comment">/* make sure the input string is zero-terminated before we call atoi() */</span>
<a name="l00698"></a>00698    str[15] = 0;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <span class="comment">/* get size */</span>
<a name="l00701"></a>00701    size = atoi(str + 9);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    assert(strncmp(str, <span class="stringliteral">&quot;$Start$:&quot;</span>, 8) == 0);
<a name="l00704"></a>00704    assert(size &gt; 15);
<a name="l00705"></a>00705    assert(size &lt; (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(message));
<a name="l00706"></a>00706 
<a name="l00707"></a>00707    memset(message, 0, <span class="keyword">sizeof</span>(message));
<a name="l00708"></a>00708 
<a name="l00709"></a>00709    rd = read(fh, message, size);
<a name="l00710"></a>00710    assert(rd &gt; 0);
<a name="l00711"></a>00711    assert((rd + 15 == size) || (rd == size));
<a name="l00712"></a>00712 
<a name="l00713"></a>00713    close(fh);
<a name="l00714"></a>00714 
<a name="l00715"></a>00715    <span class="comment">/* decode message */</span>
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (strstr(message, <span class="stringliteral">&quot;Run: &quot;</span>) &amp;&amp; run)
<a name="l00717"></a>00717       *run = atoi(strstr(message, <span class="stringliteral">&quot;Run: &quot;</span>) + 5);
<a name="l00718"></a>00718 
<a name="l00719"></a>00719    el_decode(message, <span class="stringliteral">&quot;Date: &quot;</span>, date, 80);      <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00720"></a>00720    el_decode(message, <span class="stringliteral">&quot;Thread: &quot;</span>, thread, <span class="keyword">sizeof</span>(thread));
<a name="l00721"></a>00721    el_decode(message, <span class="stringliteral">&quot;Author: &quot;</span>, author, 80);  <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00722"></a>00722    el_decode(message, <span class="stringliteral">&quot;Type: &quot;</span>, type, 80);      <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00723"></a>00723    el_decode(message, <span class="stringliteral">&quot;System: &quot;</span>, syst, 80);  <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00724"></a>00724    el_decode(message, <span class="stringliteral">&quot;Subject: &quot;</span>, subject, 256);       <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00725"></a>00725    el_decode(message, <span class="stringliteral">&quot;Attachment: &quot;</span>, attachment_all, <span class="keyword">sizeof</span>(attachment_all));
<a name="l00726"></a>00726    el_decode(message, <span class="stringliteral">&quot;Encoding: &quot;</span>, encoding, 80);      <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <span class="comment">/* break apart attachements */</span>
<a name="l00729"></a>00729    <span class="keywordflow">if</span> (attachment1 &amp;&amp; attachment2 &amp;&amp; attachment3) {
<a name="l00730"></a>00730       attachment1[0] = attachment2[0] = attachment3[0] = 0;
<a name="l00731"></a>00731       p = strtok(attachment_all, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l00732"></a>00732       <span class="keywordflow">if</span> (p != NULL) {
<a name="l00733"></a>00733          strcpy(attachment1, p);
<a name="l00734"></a>00734          p = strtok(NULL, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l00735"></a>00735          <span class="keywordflow">if</span> (p != NULL) {
<a name="l00736"></a>00736             strcpy(attachment2, p);
<a name="l00737"></a>00737             p = strtok(NULL, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l00738"></a>00738             <span class="keywordflow">if</span> (p != NULL)
<a name="l00739"></a>00739                strcpy(attachment3, p);
<a name="l00740"></a>00740          }
<a name="l00741"></a>00741       }
<a name="l00742"></a>00742 
<a name="l00743"></a>00743       assert(strlen(attachment1) &lt; 256);        <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00744"></a>00744       assert(strlen(attachment2) &lt; 256);        <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00745"></a>00745       assert(strlen(attachment3) &lt; 256);        <span class="comment">/* size from show_elog_submit_query() */</span>
<a name="l00746"></a>00746    }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748    <span class="comment">/* conver thread in reply-to and reply-from */</span>
<a name="l00749"></a>00749    <span class="keywordflow">if</span> (orig_tag != NULL &amp;&amp; reply_tag != NULL) {
<a name="l00750"></a>00750       p = strtok(thread, <span class="stringliteral">&quot; \r&quot;</span>);
<a name="l00751"></a>00751       <span class="keywordflow">if</span> (p != NULL)
<a name="l00752"></a>00752          strcpy(orig_tag, p);
<a name="l00753"></a>00753       <span class="keywordflow">else</span>
<a name="l00754"></a>00754          strcpy(orig_tag, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00755"></a>00755       p = strtok(NULL, <span class="stringliteral">&quot; \r&quot;</span>);
<a name="l00756"></a>00756       <span class="keywordflow">if</span> (p != NULL)
<a name="l00757"></a>00757          strcpy(reply_tag, p);
<a name="l00758"></a>00758       <span class="keywordflow">else</span>
<a name="l00759"></a>00759          strcpy(reply_tag, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00760"></a>00760       <span class="keywordflow">if</span> (atoi(orig_tag) == 0)
<a name="l00761"></a>00761          orig_tag[0] = 0;
<a name="l00762"></a>00762       <span class="keywordflow">if</span> (atoi(reply_tag) == 0)
<a name="l00763"></a>00763          reply_tag[0] = 0;
<a name="l00764"></a>00764    }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766    p = strstr(message, <span class="stringliteral">&quot;========================================\n&quot;</span>);
<a name="l00767"></a>00767 
<a name="l00768"></a>00768    <span class="keywordflow">if</span> (text != NULL) {
<a name="l00769"></a>00769       <span class="keywordflow">if</span> (p != NULL) {
<a name="l00770"></a>00770          p += 41;
<a name="l00771"></a>00771          <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>) strlen(p) &gt;= *textsize) {
<a name="l00772"></a>00772             strncpy(text, p, *textsize - 1);
<a name="l00773"></a>00773             text[*textsize - 1] = 0;
<a name="l00774"></a>00774             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga3e20cada0b5022911f56eb7c8b29b20b">EL_TRUNCATED</a>;
<a name="l00775"></a>00775          } <span class="keywordflow">else</span> {
<a name="l00776"></a>00776             strcpy(text, p);
<a name="l00777"></a>00777 
<a name="l00778"></a>00778             <span class="comment">/* strip end tag */</span>
<a name="l00779"></a>00779             <span class="keywordflow">if</span> (strstr(text, <span class="stringliteral">&quot;$End$&quot;</span>))
<a name="l00780"></a>00780                *strstr(text, <span class="stringliteral">&quot;$End$&quot;</span>) = 0;
<a name="l00781"></a>00781 
<a name="l00782"></a>00782             *textsize = strlen(text);
<a name="l00783"></a>00783          }
<a name="l00784"></a>00784       } <span class="keywordflow">else</span> {
<a name="l00785"></a>00785          text[0] = 0;
<a name="l00786"></a>00786          *textsize = 0;
<a name="l00787"></a>00787       }
<a name="l00788"></a>00788    }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790    <span class="keywordflow">if</span> (search_status == <a class="code" href="group__err26.html#ga5f11d9b4e829e2486252fef634b6a382">EL_LAST_MSG</a>)
<a name="l00791"></a>00791       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga5f11d9b4e829e2486252fef634b6a382">EL_LAST_MSG</a>;
<a name="l00792"></a>00792 
<a name="l00793"></a>00793    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>;
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="comment">/********************************************************************/</span>
<a name="l00798"></a>00798 <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> el_search_run(<span class="keywordtype">int</span> run, <span class="keywordtype">char</span> *return_tag)
<a name="l00799"></a>00799 <span class="comment">/********************************************************************\</span>
<a name="l00800"></a>00800 <span class="comment"></span>
<a name="l00801"></a>00801 <span class="comment">  Routine: el_search_run</span>
<a name="l00802"></a>00802 <span class="comment"></span>
<a name="l00803"></a>00803 <span class="comment">  Purpose: Find first message belonging to a specific run</span>
<a name="l00804"></a>00804 <span class="comment"></span>
<a name="l00805"></a>00805 <span class="comment">  Input:</span>
<a name="l00806"></a>00806 <span class="comment">    int    run              Run number</span>
<a name="l00807"></a>00807 <span class="comment"></span>
<a name="l00808"></a>00808 <span class="comment">  Output:</span>
<a name="l00809"></a>00809 <span class="comment">    char   *tag             tag of retrieved message</span>
<a name="l00810"></a>00810 <span class="comment"></span>
<a name="l00811"></a>00811 <span class="comment">  Function value:</span>
<a name="l00812"></a>00812 <span class="comment">    EL_SUCCESS              Successful completion</span>
<a name="l00813"></a>00813 <span class="comment">    EL_LAST_MSG             Last message in log</span>
<a name="l00814"></a>00814 <span class="comment"></span>
<a name="l00815"></a>00815 <span class="comment">\********************************************************************/</span>
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817    <span class="keywordtype">int</span> actual_run, fh, status;
<a name="l00818"></a>00818    <span class="keywordtype">char</span> tag[256];
<a name="l00819"></a>00819 
<a name="l00820"></a>00820    tag[0] = return_tag[0] = 0;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822    <span class="keywordflow">do</span> {
<a name="l00823"></a>00823       <span class="comment">/* open first message in file */</span>
<a name="l00824"></a>00824       strcat(tag, <span class="stringliteral">&quot;-1&quot;</span>);
<a name="l00825"></a>00825       status = el_search_message(tag, &amp;fh, TRUE);
<a name="l00826"></a>00826       <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#gaac4d08b2b3c0c6755a104864de2ec8f0">EL_FIRST_MSG</a>)
<a name="l00827"></a>00827          <span class="keywordflow">break</span>;
<a name="l00828"></a>00828       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l00829"></a>00829          <span class="keywordflow">return</span> status;
<a name="l00830"></a>00830       close(fh);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832       <span class="keywordflow">if</span> (strchr(tag, <span class="charliteral">&apos;.&apos;</span>) != NULL)
<a name="l00833"></a>00833          strcpy(strchr(tag, <span class="charliteral">&apos;.&apos;</span>), <span class="stringliteral">&quot;.0&quot;</span>);
<a name="l00834"></a>00834 
<a name="l00835"></a>00835       el_retrieve(tag, NULL, &amp;actual_run, NULL, NULL,
<a name="l00836"></a>00836                   NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
<a name="l00837"></a>00837    } <span class="keywordflow">while</span> (actual_run &gt;= run);
<a name="l00838"></a>00838 
<a name="l00839"></a>00839    <span class="keywordflow">while</span> (actual_run &lt; run) {
<a name="l00840"></a>00840       strcat(tag, <span class="stringliteral">&quot;+1&quot;</span>);
<a name="l00841"></a>00841       status = el_search_message(tag, &amp;fh, TRUE);
<a name="l00842"></a>00842       <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga5f11d9b4e829e2486252fef634b6a382">EL_LAST_MSG</a>)
<a name="l00843"></a>00843          <span class="keywordflow">break</span>;
<a name="l00844"></a>00844       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>)
<a name="l00845"></a>00845          <span class="keywordflow">return</span> status;
<a name="l00846"></a>00846       close(fh);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       el_retrieve(tag, NULL, &amp;actual_run, NULL, NULL,
<a name="l00849"></a>00849                   NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL);
<a name="l00850"></a>00850    }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852    strcpy(return_tag, tag);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854    <span class="keywordflow">if</span> (status == <a class="code" href="group__err26.html#ga5f11d9b4e829e2486252fef634b6a382">EL_LAST_MSG</a> || status == <a class="code" href="group__err26.html#gaac4d08b2b3c0c6755a104864de2ec8f0">EL_FIRST_MSG</a>)
<a name="l00855"></a>00855       <span class="keywordflow">return</span> status;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>;
<a name="l00858"></a>00858 }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="comment">/********************************************************************/</span>
<a name="l00862"></a>00862 <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> el_delete_message(<span class="keywordtype">char</span> *tag)
<a name="l00863"></a>00863 <span class="comment">/********************************************************************\</span>
<a name="l00864"></a>00864 <span class="comment"></span>
<a name="l00865"></a>00865 <span class="comment">  Routine: el_submit</span>
<a name="l00866"></a>00866 <span class="comment"></span>
<a name="l00867"></a>00867 <span class="comment">  Purpose: Submit an ELog entry</span>
<a name="l00868"></a>00868 <span class="comment"></span>
<a name="l00869"></a>00869 <span class="comment">  Input:</span>
<a name="l00870"></a>00870 <span class="comment">    char   *tag             Message tage</span>
<a name="l00871"></a>00871 <span class="comment"></span>
<a name="l00872"></a>00872 <span class="comment">  Output:</span>
<a name="l00873"></a>00873 <span class="comment">    &lt;none&gt;</span>
<a name="l00874"></a>00874 <span class="comment"></span>
<a name="l00875"></a>00875 <span class="comment">  Function value:</span>
<a name="l00876"></a>00876 <span class="comment">    EL_SUCCESS              Successful completion</span>
<a name="l00877"></a>00877 <span class="comment"></span>
<a name="l00878"></a>00878 <span class="comment">\********************************************************************/</span>
<a name="l00879"></a>00879 {
<a name="l00880"></a>00880 <span class="preprocessor">#ifdef LOCAL_ROUTINES</span>
<a name="l00881"></a>00881 <span class="preprocessor"></span>   <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> n, size, fh, semaphore, offset = 0, tail_size, status;
<a name="l00882"></a>00882    <span class="keywordtype">char</span> dir[256], str[256], file_name[256];
<a name="l00883"></a>00883    HNDLE hDB;
<a name="l00884"></a>00884    <span class="keywordtype">char</span> *buffer = NULL;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886    <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888    <span class="comment">/* request semaphore */</span>
<a name="l00889"></a>00889    cm_get_experiment_semaphore(NULL, &amp;semaphore, NULL, NULL);
<a name="l00890"></a>00890    status = ss_semaphore_wait_for(semaphore, 5 * 60 * 1000);
<a name="l00891"></a>00891    <span class="keywordflow">if</span> (status != <a class="code" href="group__err24.html#ga0abac6c68d7a79ce83d1a25b2c800321">SS_SUCCESS</a>) {
<a name="l00892"></a>00892       <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;el_delete_message&quot;</span>,
<a name="l00893"></a>00893              <span class="stringliteral">&quot;Cannot lock experiment semaphore, ss_semaphore_wait_for() status %d&quot;</span>, status);
<a name="l00894"></a>00894       abort();
<a name="l00895"></a>00895    }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897    <span class="comment">/* generate file name YYMMDD.log in data directory */</span>
<a name="l00898"></a>00898    <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900    size = <span class="keyword">sizeof</span>(dir);
<a name="l00901"></a>00901    memset(dir, 0, size);
<a name="l00902"></a>00902    status = <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Elog dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, FALSE);
<a name="l00903"></a>00903    <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l00904"></a>00904       <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, 0, <span class="stringliteral">&quot;/Logger/Data dir&quot;</span>, dir, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, TRUE);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906    <span class="keywordflow">if</span> (dir[0] != 0 &amp;&amp; dir[strlen(dir) - 1] != DIR_SEPARATOR)
<a name="l00907"></a>00907       strcat(dir, DIR_SEPARATOR_STR);
<a name="l00908"></a>00908 
<a name="l00909"></a>00909    strcpy(str, tag);
<a name="l00910"></a>00910    <span class="keywordflow">if</span> (strchr(str, <span class="charliteral">&apos;.&apos;</span>)) {
<a name="l00911"></a>00911       offset = atoi(strchr(str, <span class="charliteral">&apos;.&apos;</span>) + 1);
<a name="l00912"></a>00912       *strchr(str, <span class="charliteral">&apos;.&apos;</span>) = 0;
<a name="l00913"></a>00913    }
<a name="l00914"></a>00914    sprintf(file_name, <span class="stringliteral">&quot;%s%s.log&quot;</span>, dir, str);
<a name="l00915"></a>00915    fh = open(file_name, O_CREAT | O_RDWR | O_BINARY, 0644);
<a name="l00916"></a>00916    <span class="keywordflow">if</span> (fh &lt; 0) {
<a name="l00917"></a>00917       ss_semaphore_release(semaphore);
<a name="l00918"></a>00918       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00919"></a>00919    }
<a name="l00920"></a>00920    lseek(fh, offset, SEEK_SET);
<a name="l00921"></a>00921    read(fh, str, 16);
<a name="l00922"></a>00922    size = atoi(str + 9);
<a name="l00923"></a>00923 
<a name="l00924"></a>00924    <span class="comment">/* buffer tail of logfile */</span>
<a name="l00925"></a>00925    lseek(fh, 0, SEEK_END);
<a name="l00926"></a>00926    tail_size = TELL(fh) - (offset + size);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928    <span class="keywordflow">if</span> (tail_size &gt; 0) {
<a name="l00929"></a>00929       buffer = (<span class="keywordtype">char</span> *) M_MALLOC(tail_size);
<a name="l00930"></a>00930       <span class="keywordflow">if</span> (buffer == NULL) {
<a name="l00931"></a>00931          close(fh);
<a name="l00932"></a>00932          ss_semaphore_release(semaphore);
<a name="l00933"></a>00933          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#gae97067062620fe28d93670c390f23533">EL_FILE_ERROR</a>;
<a name="l00934"></a>00934       }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936       lseek(fh, offset + size, SEEK_SET);
<a name="l00937"></a>00937       n = read(fh, buffer, tail_size);
<a name="l00938"></a>00938    }
<a name="l00939"></a>00939    lseek(fh, offset, SEEK_SET);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941    <span class="keywordflow">if</span> (tail_size &gt; 0) {
<a name="l00942"></a>00942       n = write(fh, buffer, tail_size);
<a name="l00943"></a>00943       M_FREE(buffer);
<a name="l00944"></a>00944    }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946    <span class="comment">/* truncate file here */</span>
<a name="l00947"></a>00947 <span class="preprocessor">#ifdef OS_WINNT</span>
<a name="l00948"></a>00948 <span class="preprocessor"></span>   chsize(fh, TELL(fh));
<a name="l00949"></a>00949 <span class="preprocessor">#else</span>
<a name="l00950"></a>00950 <span class="preprocessor"></span>   ftruncate(fh, TELL(fh));
<a name="l00951"></a>00951 <span class="preprocessor">#endif</span>
<a name="l00952"></a>00952 <span class="preprocessor"></span>
<a name="l00953"></a>00953    <span class="comment">/* if file length gets zero, delete file */</span>
<a name="l00954"></a>00954    tail_size = lseek(fh, 0, SEEK_END);
<a name="l00955"></a>00955    close(fh);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957    <span class="keywordflow">if</span> (tail_size == 0)
<a name="l00958"></a>00958       <span class="keyword">remove</span>(file_name);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960    <span class="comment">/* release elog semaphore */</span>
<a name="l00961"></a>00961    ss_semaphore_release(semaphore);
<a name="l00962"></a>00962 <span class="preprocessor">#endif                          </span><span class="comment">/* LOCAL_ROUTINES */</span>
<a name="l00963"></a>00963 
<a name="l00964"></a>00964    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga6d87830641fea1e7e72242c32acde1df">EL_SUCCESS</a>;
<a name="l00965"></a>00965 }
<a name="l00966"></a>00966 <span class="comment"></span>
<a name="l00967"></a>00967 <span class="comment">/**dox***************************************************************/</span>
<a name="l00968"></a>00968 <span class="preprocessor">#endif                          </span><span class="comment">/* DOXYGEN_SHOULD_SKIP_THIS */</span>
<a name="l00969"></a>00969 <span class="comment"></span>
<a name="l00970"></a>00970 <span class="comment">/**dox***************************************************************/</span><span class="comment"></span>
<a name="l00971"></a>00971 <span class="comment">/** @} */</span><span class="comment">/* end of elfunctioncode */</span>
<a name="l00972"></a>00972 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

