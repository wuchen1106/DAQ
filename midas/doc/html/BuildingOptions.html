<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: SECTION 10: Build Options</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="BuildingOptions">SECTION 10: Build Options </a></h1><p><a class="anchor" id="AppendixD"></a> <br/>
  
<script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "SpecialConfig", "BuildingOptions","NDF", "BuildingOptions", "end" );
sections("SpecialConfig", "BuildingOptions","NDF"); // last section; top of this section; next section
</script>
<h2><a class="anchor" id="BO_Intro">
Introduction</a></h2>
<p>This section covers the various options available for customization of the MIDAS data acquisition system. The options fall into the following categories:</p>
<ul>
<li><a class="el" href="BuildingOptions.html#BO_makefile_option">Makefile Options</a></li>
<li><a class="el" href="BuildingOptions.html#BO_building_option">Building Options</a></li>
<li><a class="el" href="BuildingOptions.html#BO_Environment_variables">Environment variables</a></li>
</ul>
<hr/>
 <h2><a class="anchor" id="BO_makefile_option">
Makefile Options</a></h2>
<ul>
<li>"make", "make all" : compile the default midas system</li>
<li>"make clean" : remove all compiled object files and executables</li>
<li>"make dox" : make this documentation (in directory .../doxfiles/html)</li>
<li>"make linux32", "make clean32" : compile subset of midas with gcc "-m32" switch, useful for cross-compiling 32-bit midas on a 64-bit machine</li>
<li>"make linux64", "make clean64" : compile subset of midas with gcc "-m64" switch, useful for compiling 64-bit midas when default ROOTSYS points to a 32-bit ROOT version</li>
<li>"make crosscompile" : compile midas using a cross-compiler, for example, to produce midas libraries and executables that will run on a PPC Linux distribution, see Makefile for details.</li>
<li>"make examples" : compile example code in .../examples</li>
</ul>
<hr/>
 <h2><a class="anchor" id="BO_building_option">
Building Options</a></h2>
<p>By default, MIDAS is built with a minimum of pre-compiler flags. The <a class="el" href="Makefile.html">Makefile</a> contains options for the user to apply customization by enabling internal options already available in the package. Generally the options are named "NEED_OPTION" where "OPTION" is replaced by the desired option (ZLIB,LIBROOTA etc.). This will set a compiler flag called "HAVE_OPTION" . To link MIDAS with the required option(s), say </p>
<div class="fragment"><pre class="fragment">make ... NEED_OPTION=1
</pre></div><ul>
<li>Other options are included automatically by the Makefile depending on whether certain software is present (e.g. <a class="el" href="BuildingOptions.html#BO_HAVE_ODBC">HAVE_ODBC</a>).<ul>
<li><a class="el" href="BuildingOptions.html#BO_NEED_ZLIB">NEED_ZLIB</a> <a class="el" href="BuildingOptions.html#BO_NEED_RPATH">NEED_RPATH</a> <a class="el" href="BuildingOptions.html#BO_NEED_LIBROOTA">NEED_LIBROOTA</a> <a class="el" href="BuildingOptions.html#BO_NEED_MYSQL">NEED_MYSQL</a> <a class="el" href="BuildingOptions.html#BO_NEED_STRLCPY">NEED_STRLCPY</a> <a class="el" href="BuildingOptions.html#BO_SPECIFIC_OS_PRG">SPECIFIC_OS_PRG</a></li>
</ul>
</li>
</ul>
<ul>
<li>Other flags are available at the application level:<ul>
<li><a class="el" href="BuildingOptions.html#BO_HAVE_ROOT">HAVE_ROOT</a> , <a class="el" href="BuildingOptions.html#BO_HAVE_HBOOK">HAVE_HBOOK</a> , <a class="el" href="BuildingOptions.html#BO_HAVE_CAMAC">HAVE_CAMAC</a> <a class="el" href="BuildingOptions.html#BO_MIDAS_MAX_EVENT_SIZE">MIDAS_MAX_EVENT_SIZE</a> , <a class="el" href="BuildingOptions.html#BO_HAVE_ODBC">HAVE_ODBC</a></li>
</ul>
</li>
</ul>
<ul>
<li>By default the MIDAS applications are built for use with dynamic library <b>libmidas.so</b>. If static build is required the whole package can be built using the option <b>static</b>. <div class="fragment"><pre class="fragment">&gt; make <span class="keyword">static</span>
</pre></div></li>
</ul>
<ul>
<li>The basic MIDAS package builds without external package library reference. But it does try to build an extra core analyzer application to be used in conjunction with ROOT if the environment variable <a class="el" href="BuildingOptions.html#BO_ROOTSYS">ROOTSYS</a> is found. This is required ONLY if the examples/experiment makefile is used for generating a complete Midas/ROOT analyzer application.</li>
</ul>
<ul>
<li>In case of HBOOK/PAW analyzer application, the build should be done from examples/hbookexpt directory and the environment variable <a class="el" href="BuildingOptions.html#BO_CERNLIB_PACK">CERNLIB_PACK</a> should be pointing to a valid cernpacklib.a library.</li>
</ul>
<ul>
<li>For development it could be useful to built individual application in static. This can be done using the <a class="el" href="BuildingOptions.html#BO_USERFLAGS">USERFLAGS</a> option such as: <div class="fragment"><pre class="fragment">&gt; rm linux/bin/mstat; make USERFLAGS=-<span class="keyword">static</span> linux/bin/mstat
</pre></div></li>
</ul>
<ul>
<li>The current OS support is done through a fixed flag established in the general <a class="el" href="Makefile.html">Makefile</a> . Currently the OS supported are:<ul>
<li><b>OS_OSF1</b> , <b>OS_ULTRIX</b> , <b>OS_FREEBSD</b> , <b>OS_LINUX</b> , <b>OS_SOLARIS</b>.</li>
</ul>
</li>
</ul>
<ul>
<li>For <b>OS_IRIX</b> please contact Pierre. <div class="fragment"><pre class="fragment">OSFLAGS = -DOS_LINUX ...
</pre></div></li>
<li>For 32 bit built, the OSFLAGS should contains the -m32 flag. By default this flag is not enabled. It has to be applied to the Makefile for the frontend examples too. <div class="fragment"><pre class="fragment"><span class="preprocessor"># add to compile MIDAS in 32-bit mode</span>
<span class="preprocessor"># OSFLAGS += -m32</span>
</pre></div></li>
<li>Other OS supported are:<ul>
<li>OS_WINNT : See file makefile.nt.</li>
<li>OS_VXWORKS : See file makefile.ppc_tri.</li>
</ul>
</li>
</ul>
<hr/>
 <h3><a class="anchor" id="BO_USERFLAGS">
USERFLAGS</a></h3>
<p>This flag can be used at the command prompt for individual application built. </p>
<div class="fragment"><pre class="fragment">make USERFLAGS=-<span class="keyword">static</span> linux/bin/mstat
</pre></div><p><a class="anchor" id="idx_ROOT_build-flag"></a> <hr/>
 <h3><a class="anchor" id="BO_HAVE_ROOT">
HAVE_ROOT</a></h3>
<p>This flag is used for the <a class="el" href="DataAnalysis.html#DA_analyzer_utility">MIDAS analyzer</a> in the case <b>ROOT</b> environment is required. An example of the makefile resides in <b>examples/experiment/Makefile</b>. This flag is enabled by the presence of a valid <a class="el" href="BuildingOptions.html#BO_ROOTSYS">ROOTSYS</a> environment variable. In the case that <a class="el" href="BuildingOptions.html#BO_ROOTSYS">ROOTSYS</a> is not found, the analyzer is build without <b>ROOT</b> support. In this latter case, the application <a class="el" href="RC_Monitor.html#RC_rmidas_utility">rmidas</a> will be missing. refer to the <a class="el" href="DataAnalysis.html#DA_Midas_Analyzer">analyzer structure</a> for further details.</p>
<p><a class="anchor" id="idx_HBOOK_build-flag"></a> <hr/>
 <h3><a class="anchor" id="BO_HAVE_HBOOK">
HAVE_HBOOK</a></h3>
<p>This flag is used for <b>examples/hbookexpt/Makefile</b> for building the MIDAS <a class="el" href="DataAnalysis.html#DA_analyzer_utility">analyzer - event analysis</a> against <b>HBOOK</b> and <b>PAW</b>. The path to the cernlib is requested and expected to be found under /cern/pro/lib (see makefile). This can always be overwritten during the make using the following command: </p>
<div class="fragment"><pre class="fragment">make CERNLIB_PACK=&lt;your path&gt;/libpacklib.a
</pre></div><p><a class="anchor" id="idx_mySQL_build-flag"></a> <hr/>
<h3><a class="anchor" id="BO_NEED_MYSQL">
NEED_MYSQL</a></h3>
<p>This flag is used in <a class="el" href="F_Logging.html#F_mlogger_utility">mlogger</a> to build the application with <em>mySQL</em> support. The build requires access to the mysql include files as well as the mysql library. The Makefile tries to figure out automatically if the mySQL library is installed in order to set the default value of NEED_MYSQL.</p>
<p><a class="anchor" id="idx_ODBC"></a> <hr/>
<h3><a class="anchor" id="BO_HAVE_ODBC">
HAVE_ODBC</a></h3>
<p>ODBC (Open DataBase Connectivity) is a standard database access method. In MIDAS, it may be used in the History system (see <a class="el" href="F_History_logging.html#F_History_sql_internal">MIDAS SQL History system</a> ). The Makefile will automatically include ODBC (HAVE_ODBC = 1) if the file <em> /usr/include/sql.h </em> is found. Otherwise ODBC will not be included.</p>
<hr/>
 <h3><a class="anchor" id="BO_HAVE_CAMAC">
HAVE_CAMAC</a></h3>
<p>This flag enable the CAMAC RPC service within the frontend code.</p>
<ul>
<li>The application <span class="utility">mcnaf</span> utility and</li>
<li>the <a class="el" href="RC_mhttpd_CNAF_page.html">web CNAF page</a> (in versions prior to <a class="el" href="NDF.html#ndf_dec_2009">Dec 2009</a> )</li>
</ul>
<p>are by default <b>not</b> CAMAC enabled (i.e. <b>HAVE_CAMAC</b> is undefined).</p>
<p><a class="anchor" id="idx_event_size_build-flag"></a> <hr/>
 <h3><a class="anchor" id="BO_MIDAS_MAX_EVENT_SIZE">
MIDAS_MAX_EVENT_SIZE</a></h3>
<p>By default the MIDAS package is build with the maximum event size set to 4MB (MAX_EVENT_SIZE/midas.h). This parameter is used for event transfer across network as well, therefore it has to be applied to all the MIDAS client involved in the experiment when different value is required and a complete MIDAS rebuid needs to be done. </p>
<div class="fragment"><pre class="fragment">&gt; setenv MIDAS_MAX_EVENT_SIZE 8000000
&gt; make
cc -c -g -O3 -Wall -Wuninitialized -Iinclude -Idrivers -I../mxml -Llinux/lib -DINCLUDE_FTPLIB  \
 -DMAX_EVENT_SIZE=800000 -D_LARGEFILE64_SOURCE -DHAVE_MYSQL -I/usr/include/mysql -DHAVE_ROOT -pthread \
-m64 -I/triumfcs/trshare/olchansk/root/root_v5.12.00_SL42_amd64/include -DHAVE_ZLIB -DOS_LINUX -fPIC \
-Wno-unused-function -o linux/lib/midas.o src/midas.c
...
</pre></div><p> But at the frontend level, the user can define his/her own local maximum event size through the <b>max_event_size</b> (see frontend examples).</p>
<hr/>
 <h3><a class="anchor" id="BO_SPECIFIC_OS_PRG">
SPECIFIC_OS_PRG</a></h3>
<p>This flag is for internal Makefile preference. Used in particular for additional applications build based on the OS selection. In the example below <a class="el" href="F_Messaging.html#F_mspeaker_utility">mspeaker</a> and <a class="el" href="FE_utils.html#FE_dio_utility">dio</a> utilities are built only under OS_LINUX. </p>
<div class="fragment"><pre class="fragment">SPECIFIC_OS_PRG = $(BIN_DIR)/mlxspeaker $(BIN_DIR)/dio
</pre></div><p><a class="anchor" id="idx_LIBROOTA"></a> <a class="anchor" id="idx_ROOT_static-library"></a> <hr/>
<h3><a class="anchor" id="BO_NEED_LIBROOTA">
NEED_LIBROOTA</a></h3>
<p>This option if set links MIDAS with the static ROOT library. By default this option is disabled. To link with the static ROOT library, <br/>
make ... NEED_LIBROOTA=1</p>
<p><a class="anchor" id="idx_ZLIB_build-flag"></a> <hr/>
 <h3><a class="anchor" id="BO_NEED_ZLIB">
NEED_ZLIB</a></h3>
<p>If <a class="el" href="F_Logging_Data.html#F_Logger_CS_Compression">data compression</a> is required by the data logger, the MIDAS package must be compiled with ZLIB support. The applications <a class="el" href="F_LogUtil.html#F_lazylogger_utility">lazylogger</a>, <a class="el" href="RC_Monitor.html#RC_mdump_utility">mdump</a> can be built with <b>zlib.a</b> in order to gain direct access to the data within a file with extension <b>mid.gz</b>. By default this option is disabled except for the system analyzer core code <b>mana.c</b>. However, if NEED_MYSQL is set, NEED_ZLIB will also be set.</p>
<hr/>
 <h3><a class="anchor" id="BO_NEED_RPATH">
NEED_RPATH</a></h3>
<p>Option to set the shared library path on MIDAS executables. By default this option is enabled for Linux, disabled for MacOSX/Darwin.</p>
<hr/>
 <h3><a class="anchor" id="BO_NEED_STRLCPY">
NEED_STRLCPY</a></h3>
<p>Option to use our own implementation of strlcat and strlcpy. By default this option is enabled.</p>
<hr/>
<p><a class="anchor" id="idx_Environment_Variables"></a> <a class="anchor" id="Environment_variables"></a> <br/>
<br/>
 </p>
<h2><a class="anchor" id="BO_Environment_variables">
Environment variables</a></h2>
<p>MIDAS uses a several environment variables to facilitate the startup of the different applications. These are also discussed in the <a class="el" href="Quickstart.html">QuickStart</a> section.</p>
<p><a class="anchor" id="idx_MIDASSYS"></a> <hr/>
<h3><a class="anchor" id="BO_MIDASSYS">
MIDASSYS</a></h3>
<p>This environmental variable is <b>required</b>. It should point to the main path of the installed MIDAS package. The application <a class="el" href="RC_odbedit_utility.html">odbedit</a> will generate a warning message in the case this variable is not defined. <br/>
For example </p>
<div class="fragment"><pre class="fragment">  setenv MIDASSYS $HOME/packages/midas  
</pre></div><p><a class="anchor" id="idx_MIDAS_EXPTAB"></a> <hr/>
<h3><a class="anchor" id="BO_MIDAS_EXPTAB">
MIDAS_EXPTAB</a></h3>
<p>This variable specifies the location of the <b>exptab</b> file containing the predefined MIDAS experiment. If MIDAS_EXPTAB is <b>not</b> defined, the <b>default</b> location will be used (i.e. for OS_UNIX: /etc, / and for OS_WINNT: \system32, \system ). <br/>
For example </p>
<div class="fragment"><pre class="fragment">  setenv MIDAS_EXPTAB $HOME/online/exptab
</pre></div><p><a class="anchor" id="idx_MIDAS_SERVER_HOST"></a> <hr/>
<h3><a class="anchor" id="BO_MIDAS_SERVER_HOST">
MIDAS_SERVER_HOST</a></h3>
<p>This variable predefines the name of the host on which the MIDAS experiment shared memories are residing. It is needed when a connection to a remote experiment is requested. It obviates the need to add the "-h &lt;hostname&gt;" argument to the application command (see <a class="el" href="F_Utilities_List.html#F_utilities_params">Common Parameters to MIDAS Utilities</a>). Superceded by <a class="el" href="BuildingOptions.html#BO_MIDAS_DIR">MIDAS_DIR</a> if defined. This variable is valid for Unix as well as Windows OS.</p>
<p><a class="anchor" id="idx_MIDAS_EXPT_NAME"></a> <hr/>
<h3><a class="anchor" id="BO_MIDAS_EXPT_NAME">
MIDAS_EXPT_NAME</a></h3>
<p>This variable predefines the default name of the experiment to connect to. It prevents the requested application from asking for the experiment name when multiple experiments are available on the host. Defining MIDAS_EXPT_NAME makes adding the "-e &lt;exptname&gt;" argument to the application command unnecessary (see <a class="el" href="F_Utilities_List.html#F_utilities_params">Common Parameters to MIDAS Utilities</a>). Superceded by <a class="el" href="BuildingOptions.html#BO_MIDAS_DIR">MIDAS_DIR</a> if defined. This variable is valid for Unix as well as Windows OS.</p>
<p><a class="anchor" id="idx_MIDAS_DIR"></a> <hr/>
<h3><a class="anchor" id="BO_MIDAS_DIR">
MIDAS_DIR</a></h3>
<p>This variable predefines the LOCAL directory path where the shared memories for the experiment are located. <b>Defining this variable results in a single experiment called "Default".</b> Since a given directory path can only refer to a single experiment, <a class="el" href="BuildingOptions.html#BO_MIDAS_DIR">MIDAS_DIR</a> supersedes the <a class="el" href="F_Utilities_List.html#F_utilities_params">hostname and exptname parameters</a> as well as the <a class="el" href="BuildingOptions.html#BO_MIDAS_SERVER_HOST">MIDAS_SERVER_HOST</a> and <a class="el" href="BuildingOptions.html#BO_MIDAS_EXPT_NAME">MIDAS_EXPT_NAME</a> environment variables.  If you wish to use the "exptab" file to define <b>multiple experiments</b> on a single host, <b>do not define MIDAS_DIR. </b></p>
<p><a class="anchor" id="idx_ROOTSYS"></a> <hr/>
<h3><a class="anchor" id="BO_ROOTSYS">
ROOTSYS</a></h3>
<p>This variable must point to the ROOT package if generating a complete MIDAS/ROOT analyzer application (see <a class="el" href="Q_Linux.html#Q_Linux_Environment_Variables">Environment Variables</a> ). If not using ROOT, ROOTSYS should be undefined.</p>
<p><a class="anchor" id="idx_CERNLIB_PACK"></a> <hr/>
<h3><a class="anchor" id="BO_CERNLIB_PACK">
CERNLIB_PACK</a></h3>
<p>In case of HBOOK/PAW analyzer application, this variable should be pointing to a valid cernpacklib.a library. See <a class="el" href="BuildingOptions.html#BO_HAVE_HBOOK">HAVE_HBOOK</a> .</p>
<p><a class="anchor" id="idx_MIDAS_FRONTEND_INDEX"></a> <hr/>
<h3><a class="anchor" id="BO_MIDAS_FRONTEND_INDEX">
MIDAS_FRONTEND_INDEX</a></h3>
<p>This variable predefines the index assigned to the equipment using the event builder option. Useful if the frontend applications are started from different hosts. Refer to <a class="el" href="FE_Event_Builder.html#FE_principle_eb">Principle of the Event Builder and related frontend fragment</a> for more information.</p>
<hr/>
<h3><a class="anchor" id="BO_MCHART_DIR">
MCHART_DIR</a></h3>
<p>This variable is used for the old <a class="el" href="F_LogUtil.html#F_mchart_utility">mchart</a> utility.</p>
<p><a class="anchor" id="end"></a> <br/>
  
<script type="text/javascript">
// pages parameters: back index next {top bottom}
pages( "SpecialConfig", "BuildingOptions","NDF", "BuildingOptions", "" );
sections("SpecialConfig", "BuildingOptions","NDF"); // last section; top of this section; next section
</script>
 </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

