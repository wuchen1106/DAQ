<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Quickstart Linux</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="Quickstart.html">SECTION 3: Quick Start</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="Q_Linux">Quickstart Linux </a></h1><p><br/>
  
<script type="text/javascript">
pages("Quickstart","Quickstart","Q_Windows","Q_Linux" ,"end" ); // back index next {top bottom}
sections("Intro","Quickstart","Features"); // last section; top of this section; next section
</script>
<p><br/>
</p>
<h2><a class="anchor" id="Q_Linux_system_requirements">
System Requirements</a></h2>
<p>not yet specified</p>
<h2><a class="anchor" id="Q_Linux_installation">
Installation</a></h2>
<p>Throughout the following description the MIDAS package is assumed to be installed under the directory <b>$HOME/packages/midas</b> <br/>
 while the experiment specific directory is <b>$HOME/online</b> . The user name is <em>johnfoo</em>. <br/>
</p>
<h3><a class="anchor" id="Q_Linux_Environment_Variables">
Environment Variables</a></h3>
<p>The following <a class="el" href="BuildingOptions.html#BO_Environment_variables">Environment variables</a> needs to be setup, e.g.: csh: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #!/bin/echo You must source</span>
<span class="preprocessor"></span>  setenv CVS_RSH ssh
  setenv MIDASSYS $HOME/packages/midas  
  setenv ROOTSYS  $HOME/packages/root   ** <span class="keywordflow">do</span> not setup ROOTSYS <span class="keywordflow">if</span> NOT <span class="keyword">using</span> ROOT
  setenv MIDAS_EXPTAB $HOME/online/exptab ** <span class="keywordflow">if</span> not setup,  defaults to  /etc/exptab
  setenv PATH .:$MIDASSYS/linux/bin:$HOME/packages/roody/bin:$ROOTSYS/bin:$PATH
<span class="preprocessor">  #end</span>
</pre></div><p> <br/>
 bash: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #!/bin/echo You must source</span>
<span class="preprocessor"></span>  export CVS_RSH=ssh
  export MIDASSYS=$HOME/packages/midas  
  export ROOTSYS=$HOME/packages/root   ** <span class="keywordflow">do</span> not setup ROOTSYS <span class="keywordflow">if</span> NOT <span class="keyword">using</span> ROOT
  export MIDAS_EXPTAB=$HOME/online/exptab ** <span class="keywordflow">if</span> not setup,  defaults to  /etc/exptab
  export PATH=.:$MIDASSYS/linux/bin:$HOME/packages/roody/bin:$ROOTSYS/bin:$PATH
<span class="preprocessor">  #end</span>
</pre></div><ul>
<li>mkdir $HOME/packages</li>
<li>Logout and login again, or source .cshrc (source .bashrc) for the change to take effect. <br/>
</li>
</ul>
<p><a class="anchor" id="idx_ROOT_installation"></a> </p>
<h3><a class="anchor" id="Q_Linux_Root_Installation">
ROOT Package Installation</a></h3>
<p>For full MIDAS operation <b>ROOT</b> is needed for the data logging and analysis packages.</p>
<ul>
<li>Identify the Linux version: RH9 (Red Hat Linux 9), FC3 (Fedora Core 3), RHEL4/SL4 (Red Hat Enterprise LInux 4/Scientific Linux 4): more /etc/redhat-release</li>
<li>cd $HOME/packages</li>
<li>ln -s /triumfcs/trshare/olchansk/root/root_vNNN_VVV root, where NNN is the latest available version of ROOT ("ls -l /triumfcs/trshare/olchansk/root") and VVV is the Linux version code (RH9, FC3, SL4, etc). For example: /triumfcs/trshare/olchansk/root/root_v5.10.00_SL40</li>
<li>Check that ROOT works: "echo $ROOTSYS", "$ROOTSYS/bin/root" <br/>
 <br/>
 <b>Note:</b> ROOT is not essential to run MIDAS. Some experiments use a custom logger or analyser. If ROOT is NOT installed, the environment variable ROOTSYS must be removed: <div class="fragment"><pre class="fragment">      unsetenv ROOTSYS
</pre></div></li>
</ul>
<p><br/>
</p>
<h3><a class="anchor" id="Q_Linux_Midas_Installation">
MIDAS Package Installation</a></h3>
<p>The source code can be extracted from the <a href="http://savannah.psi.ch/viewcvs/trunk/?root=midas">SVN repository</a>. Anonymous access is available under the username <b>svn</b> and password <b>svn</b> which may be required several time. The SVN web interface provides a quick <b>tarball</b>. This suggested extraction method is shown below. <br/>
 The MIDAS package requires the <b>mxml</b> auxiliary package which can be found at the same SVN site as MIDAS. mxml and MIDAS are extracted at the same directory level as follows: </p>
<div class="fragment"><pre class="fragment">  cd $HOME/packages
  svn co svn+ssh:<span class="comment">//svn@savannah.psi.ch/afs/psi.ch/project/meg/svn/midas/trunk midas</span>
  svn co svn+ssh:<span class="comment">//svn@savannah.psi.ch/afs/psi.ch/project/meg/svn/mxml/trunk mxml</span>
  cd midas
  make
  ls $MIDASSYS/linux/bin   ... should contains odbedit and all the MIDAS applications.
</pre></div><p> <br/>
</p>
<p><a class="anchor" id="idx_ROME_installation"></a> </p>
<h3><a class="anchor" id="Q_Linux_Rome_Installation">
ROME Package Installation</a></h3>
<p>The PSI ROME analysis package can be found at <a href="http://midas.psi.ch/rome/index.html">ROME analyzer</a> The same extraction procedure as for the MIDAS package can be followed. For its operation please refer to the <a href="http://midas.psi.ch/rome/index.html">ROME web site</a>. </p>
<div class="fragment"><pre class="fragment">  cd $HOME/packages
  svn co svn+ssh:<span class="comment">//svn@savannah.psi.ch/afs/psi.ch/project/meg/svn/rome/trunk rome</span>
  cd rome
  make
</pre></div><p><a class="anchor" id="idx_ROODY_installation"></a> </p>
<h3><a class="anchor" id="Q_Linux_Roody_Installation">
ROODY Package Installation</a></h3>
<p><a href="http://ladd00.triumf.ca/~daqweb/doc/roody/html">ROODY</a> is a Histogram display tool. This package is supported by the Triumf DAQ group. Its installation is similar to the MIDAS package. </p>
<div class="fragment"><pre class="fragment">  cd $HOME/packages
  svn checkout svn:<span class="comment">//ladd00.triumf.ca/roody/trunk roody</span>
  cd roody
  make
  $HOME/packages/roody/bin/roody   ... to run the program
</pre></div><hr/>
 <h2><a class="anchor" id="Q_Linux_Basic_Test">
Basic test</a></h2>
<h3><a class="anchor" id="Q_Linux_Hardware_Requirements">
Hardware Requirements</a></h3>
<p>These instructions assume that accessibility to hardware such as VME or CAMAC is available. An ADC is also required, with signals sent to its gate.</p>
<h3><a class="anchor" id="Q_Linux_Software_Requirements">
Software Requirements</a></h3>
<p>Packages ROOT, MIDAS and ROODY have been installed.</p>
<h3><a class="anchor" id="Q_Linux_Expt_Setup">
How to Setup the MIDAS Experiment</a></h3>
<p>NOTE: these instructions provide <b>local</b> access to the experiment. For <b>remote</b> access, refer to <a class="el" href="Q_Linux.html#Q_Linux_Installation_Considerations">Installation Considerations</a> .</p>
<ul>
<li>Create a new user for this daq system (johnfoo)</li>
<li>login as the new user</li>
<li>mkdir online</li>
<li>cd online</li>
<li>mkdir elog history data</li>
<li>create the <a class="el" href="Q_Linux.html#Q_Linux_Exptab">exptab</a> file "$HOME/online/exptab" following the example below<ul>
<li>The first parameter is the MIDAS experiment name e.g. "simptest1"</li>
<li>The second parameter is the location of MIDAS shared memory buffers e.g."/home/johnfoo/online" (by convention, $HOME/online),</li>
<li>the third parameter is the username e.g. "johnfoo" <div class="fragment"><pre class="fragment">  simptest1 /home/johnfoo/online johnfoo
</pre></div> <a class="anchor" id="start-all"></a></li>
</ul>
</li>
<li>copy $MIDASSYS/examples/experiment/* to the online directory.</li>
<li>make (creates frontend executable frontend.exe) <div class="fragment"><pre class="fragment">  cd online
  cp $MIDASSYS/examples/experiment<span class="comment">/* .</span>
<span class="comment">  make</span>
</pre></div></li>
<li>The analyzer will build properly if ROOT has been previously installed.</li>
<li>At this point the frontend and the analyzer should be ready if no error where generated during the build. By running the script <b> start_daq.sh </b> several midas applications will be started in sequence.<ol type="a">
<li>Cleanup previous midas application (if any).</li>
<li>Start the midas web server [mhttpd]</li>
<li>Start the frontend application in its own xterm (for debugging purpose).</li>
<li>Start the analyzer application in its own xterm (for debugging purpose).</li>
<li>Start the Midas Data logger [mlogger]</li>
</ol>
</li>
</ul>
<div class="fragment"><pre class="fragment">   $ sh ./start_daq
</pre></div><ul>
<li>Once all these applications are running, you can invoke the Midas web page by using your browser to <a href="http://localhost:8081">http://localhost:8081</a> . A Midas run status page should be appearing with multiple buttons for run control as well as equipment listing and application listing. Please refers to <a class="el" href="RC_mhttpd.html">mhttpd: the MIDAS Web-based Run Control utility</a> for further information.</li>
<li>You can also run the MIDAS Online Editor [odbedit] in a new terminal to provide you command line access to the database.<ul>
<li>The content of the database is accessible with Unix-like commands. There are directories related to specifics of the Midas environment. One in particular is the "Logger". Please refer to <a class="el" href="F_Logging_Data.html">Customizing the MIDAS data logging</a> for discussion on the different logger configuration options.</li>
</ul>
</li>
<li>Run can be started and stopped under odbedit or through the web page.</li>
<li>While a run is in progress, the midas application <b>mdump</b> will provide you an event dump of the collected data from the running frontend.</li>
<li>For further data processing/analysis, either the <b> midas analyzer </b> or the <a href="http://daq-plone.triumf.ca/SR/rootana">rootana </a> can used for data display as well. <div class="fragment"><pre class="fragment">    $odbedit
        [local:exp:S]&gt; ls
        ...
        [local:exp:S]&gt; help
        ...
        [local:exp:S]&gt; start
        [local:exp:S]&gt; exit
        ...
        $ mdump
</pre></div> <br/>
</li>
</ul>
<hr/>
 <h2><a class="anchor" id="Q_Linux_Installation_Considerations">
Installation Considerations</a></h2>
<h3><a class="anchor" id="Q_Linux_Remote_Access">
Remote Access to the experiment</a></h3>
<p>While the above description in <a class="el" href="Q_Linux.html#Q_Linux_Expt_Setup">How to Setup the MIDAS Experiment</a> installs MIDAS under user privilege for standard operation, MIDAS can also be installed in a more general way under root privilege. This method allows remote access to the package through the xinetd daemon mechanism. In order to implement this, some extra steps are necessary as described here.</p>
<ul>
<li><b> It is to be noted that remote access can be also obtained under user privilege by starting the Midas server [mserver] by hand.</b> <div class="fragment"><pre class="fragment">  $ mserver -D
</pre></div></li>
</ul>
<p>Several system files needs to be modified (as root) for the full MIDAS implementation.</p>
<ul>
<li><b>/etc/services :</b> For remote access, inclusion of the "midas" service is needed. Add following line: <div class="fragment"><pre class="fragment"><span class="preprocessor">  # midas service</span>
<span class="preprocessor">  midas           1175/tcp                        # Midas server</span>
</pre></div></li>
<li><b>/etc/xinetd.d/midas :</b> Daemon definition. Create new file named <b>midas</b> <div class="fragment"><pre class="fragment">  service midas
  {
           flags                   = REUSE NOLIBWRAP
           socket_type             = stream
           wait                    = no
           user                    = root
           server                  = /usr/local/bin/mserver
           log_on_success          += USERID HOST PID
           log_on_failure          += USERID HOST
           disable                 = no
  }
</pre></div></li>
<li><b>/etc/ld.so.conf :</b> Dynamic Linked library list. Add directory pointing to location of the midas.so file (add /usr/local/lib). <div class="fragment"><pre class="fragment">  /usr/local/lib
</pre></div> The system is now build by default in static, which makes it unecessary to setup the .so path through either the environment <b>LD_LIBRARY_PATH</b> or the ld.so.conf.</li>
<li><b>/etc/exptab :</b> MIDAS Experiment definition file (see below). <br/>
<br/>
</li>
</ul>
<p><a class="anchor" id="idx_experiment_multiple"></a> <a class="anchor" id="idx_exptab"></a> </p>
<h3><a class="anchor" id="Q_Linux_Exptab">
Definition of Experiments (exptab)</a></h3>
<p>The MIDAS system supports <b> multiple experiments running at the same time on a single computer</b>. Even though it may not be efficient, this capability makes sense when the experiments are simple detector lab setups which share hardware resources for data collection. In order to support this feature, MIDAS requires a uniquely identified set of <a class="el" href="structparameters.html">parameters</a> for each experiment that is used to define the location of the Online Database. <br/>
<br/>
 Every experiment under MIDAS has its own ODB. In order to differentiate them, an experiment <b> name and directory </b> are assigned to each experiment. This allows several experiments to run concurrently on the same host using a common MIDAS installation. <br/>
<br/>
 Whenever a application specific to a particular experiment is started, the experiment name can be specified as a command line argument, or as an environment variable. <br/>
<br/>
 A list of all possible running experiments on a given machine is kept in the file <b>exptab</b>. This file <b>exptab</b> is expected by default to be located under <b>/etc/exptab</b>. This default location can be overwritten by the <a class="el" href="BuildingOptions.html#BO_Environment_variables">Environment Variable</a> <a class="el" href="BuildingOptions.html#BO_MIDAS_EXPTAB">MIDAS_EXPTAB</a>. <br/>
<br/>
 <b>The</b> exptab file defines each experiment on the machine, with one line per experiment. Each line contains three <a class="el" href="structparameters.html">parameters</a>, i.e: <b>experiment name</b>, <b>experiment directory name</b> and <b>user name</b>. For example: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #</span>
<span class="preprocessor"></span><span class="preprocessor">  # Midas experiment list</span>
<span class="preprocessor"></span>  test   /home/johnfoo/online     johnfoo
  decay  /home/jackfoo/decay_daq  jackfoo
</pre></div><p> <br/>
 Experiments not defined in <b>exptab</b> are not accessible remotely, but can still be accessed locally using the <a class="el" href="BuildingOptions.html#BO_Environment_variables">environment variable</a> <a class="el" href="BuildingOptions.html#BO_MIDAS_DIR">MIDAS_DIR</a> if defined. This environment variable superceeds the <b>exptab</b> definition. <br/>
  Where more than one experiment is defined, the default name of the experiment to connect to can be provided using the <a class="el" href="BuildingOptions.html#BO_MIDAS_EXPT_NAME">MIDAS_EXPT_NAME</a> environment variable.</p>
<hr/>
 <h2><a class="anchor" id="Q_Linux_Demo_Examples">
Demo examples</a></h2>
<p>The midas file structure contains examples of code which should be used as a template. In the <b> midas/examples/experiment</b> directory you will find a full set for frontend and analysis code. The building of this example is performed with the <b>Makefile</b> of this directory. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">  #-------------------------------------------------------------------</span>
<span class="preprocessor"></span><span class="preprocessor">  # The following lines define directories. Adjust if necessary</span>
<span class="preprocessor"></span><span class="preprocessor">  #                 </span>
<span class="preprocessor"></span>  DRV_DIR   = $(MIDASSYS)/drivers/bus
  INC_DIR   = $(MIDASSYS)/include
  LIB_DIR   = $(MIDASSYS)/linux/lib
</pre></div><p>For testing the system, you can start the frontend as follow: </p>
<div class="fragment"><pre class="fragment">  &gt; frontend
  Event buffer size      :     100000
  Buffer allocation      : 2 x 100000
  System max <span class="keyword">event</span> size  :     524288
  User max <span class="keyword">event</span> size    :     10000
  User max frag. size    :     5242880
<span class="preprocessor">  # of events per buffer :     10</span>
<span class="preprocessor"></span>  
  Connect to experiment ...Available experiments on local computer:
  0 : test         
  1 : decay
  Select number:0                    &lt;---- predefined experiment from exptab file

  Sample Frontend connected to &lt;local&gt;. Press <span class="stringliteral">&quot;!&quot;</span> to exit                 17:27:47
  ================================================================================
  Run status:   Stopped    Run number 0
  ================================================================================
  Equipment     Status     Events     Events/sec Rate[kB/s] ODB-&gt;FE    FE-&gt;ODB
  --------------------------------------------------------------------------------
  Trigger       OK         0          0.0        0.0        0          0
  Scaler        OK         0          0.0        0.0        0          0
</pre></div><p> In a different terminal window </p>
<div class="fragment"><pre class="fragment">  &gt;odbedit
  Available experiments on local computer:
  0 : test
  1 : decay
  Select number: 0
  [local:test:S]/&gt;start now
  Starting run #1
  17:28:58 [ODBEdit] Run #1 started
  [local:test:R]/&gt;
</pre></div><p> The run has been started as seen in the frontend terminal window. See the <a class="el" href="frontend_8c.html">frontend.c</a> for data generation code. </p>
<div class="fragment"><pre class="fragment">  Sample Frontend connected to &lt;local&gt;. Press <span class="stringliteral">&quot;!&quot;</span> to exit                 17:29:07
  ================================================================================
  Run status:   Running    Run number 1
  ================================================================================
  Equipment     Status     Events     Events/sec Rate[kB/s] ODB-&gt;FE    FE-&gt;ODB
  --------------------------------------------------------------------------------
  Trigger       OK         865        99.3       5.4        0          9
  Scaler        OK         1          0.0        0.0        0          1
</pre></div><p><br/>
</p>
<p><br/>
  
<script type="text/javascript">
pages("Quickstart","Quickstart","Q_Windows","Q_Linux" ,"" ); // back index next {top bottom}
sections("Intro","Quickstart","Features"); // last section; top of this section; next section
</script>
<p><br/>
</p>
<p><a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

