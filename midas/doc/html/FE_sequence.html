<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Sequence of operations</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="FrontendOperation.html">SECTION 6: Frontend Operation</a>&nbsp;&raquo&nbsp;<a class="el" href="Frontend_code.html">Frontend code</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="FE_sequence">Sequence of operations </a></h1><p><br/>
  
 
<script type="text/javascript">
pages( "FE_code_sections", "FrontendOperation", "FE_eq_event_routines", "FE_sequence","end" ); // back index next {top bottom}
sections("RunControl","FrontendOperation","DataAnalysis"); // last section; top of this section; next section
</script>
 <br/>
</p>
<p><a class="anchor" id="idx_Frontend_sequence-of-operations"></a> The following table shows the sequence of operations of the frontend. These system routines are located in the <a class="el" href="frontend_8c.html">frontend.c</a> code but are called by <a class="el" href="mfe_8c.html">mfe.c</a> at the appropriate time. These routines must be present in the <a class="el" href="frontend_8c.html">frontend.c</a> code, but the contents are coded by the user.</p>
<table style="text-align: left; width: 75%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Table showing sequence of operations </caption>
<tr>
<td style="vertical-align: top; background-color: rgb(51, 204, 255);"><p><span style="font-weight: bold;">Associated Transition</span><br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(102, 255, 153);"><p><span style="font-weight: bold;">System function</span> <br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 51);"><p><span style="font-weight: bold;">Action</span><br/>
  </p>
</td><td style="vertical-align: top;"><p><br/>
   </p>
</td></tr>
<tr>
<td style="vertical-align: top;"><p><br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(153, 255, 153);"><p><a class="el" href="mfe_8c.html#a802849119d469feb2d1deee1be9593ac">frontend_init()</a><br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 204);"><p>Runs once after system initialization, before equipment registration. </p>
</td><td style="vertical-align: top;"><p><a class="el" href="FE_sequence.html#FE_frontend_init">Details</a><br/>
   </p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: rgb(102, 255, 255);"><p>TR_START<br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(153, 255, 153);"><p><a class="el" href="mfe_8c.html#ad8bfe703c49342b9f0275aba77dc7758">begin_of_run()</a><br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 204);"><p>Runs after systerm statistics reset, before any other Equipments at each Beginning of Run request. </p>
</td><td style="vertical-align: top;"><p><a class="el" href="FE_sequence.html#FE_begin_of_run">Details</a><br/>
   </p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: rgb(102, 255, 255);"><p>TR_PAUSE </p>
</td><td style="vertical-align: top; background-color: rgb(153, 255, 153);"><p><a class="el" href="mfe_8c.html#a164db20cf6c8c81e8c8ca50a590de436">pause_run()</a> </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 204);"><p>Runs before any other Equipments at each Run Pause request. </p>
</td><td colspan="1" rowspan="2" style="vertical-align: top;"><p><a class="el" href="FE_sequence.html#FE_pause_resume_run">Details</a> <br/>
   </p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: rgb(102, 255, 255);"><p>TR_RESUME </p>
</td><td style="vertical-align: top; background-color: rgb(153, 255, 153);"><p><a class="el" href="mfe_8c.html#a6cada7e3f07b9fc2b9886263223661d4">resume_run()</a> </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 204);"><p>Runs before any other Equipments at each Run Resume request.</p>
<p></p>
</td></tr>
<tr>
<td style="vertical-align: top; background-color: rgb(102, 255, 255);"><p>TR_STOP </p>
</td><td style="vertical-align: top; background-color: rgb(153, 255, 153);"><p><a class="el" href="mfe_8c.html#ae6d798649008b7523c77222bae2d4187">end_of_run()</a> </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 204);"><p>Runs before any other Equipments at each End of Run request. </p>
</td><td style="vertical-align: top;"><p><a class="el" href="FE_sequence.html#FE_end_of_run">Details</a><br/>
   </p>
</td></tr>
<tr>
<td style="vertical-align: top;"><p><br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(153, 255, 153);"><p><a class="el" href="mfe_8c.html#a3b682405038cc4f6af505d7ca6367a4f">frontend_exit()</a><br/>
  </p>
</td><td style="vertical-align: top; background-color: rgb(255, 255, 204);"><p>Runs once before Slow Control Equipment exit. </p>
</td><td style="vertical-align: top;"><p><br/>
   </p>
</td></tr>
</table>
<p>Each equipment has the option to force itself to run at individual transition times (see <a class="el" href="FrontendOperation.html#FE_event_trigger">Frontend event triggers</a>), so that its equipment function will be called on a certain <a class="el" href="RC_Run_States_and_Transitions.html">transition</a> (or combination of transitions).</p>
<p>However, the <b>system transition functions</b></p>
<ul>
<li><a class="el" href="mfe_8c.html#ad8bfe703c49342b9f0275aba77dc7758">begin_of_run()</a>,</li>
<li><a class="el" href="mfe_8c.html#ae6d798649008b7523c77222bae2d4187">end_of_run()</a>,</li>
<li><a class="el" href="mfe_8c.html#a164db20cf6c8c81e8c8ca50a590de436">pause_run()</a> and</li>
<li><a class="el" href="mfe_8c.html#a6cada7e3f07b9fc2b9886263223661d4">resume_run()</a> <br/>
all run <b>prior</b> to the equipment functions. This gives the system the chance to take basic action on the transition request (e.g. enable/disable interrupt) before the equipment runs.</li>
</ul>
<h2><a class="anchor" id="FE_frontend_status">
Reporting Equipment status</a></h2>
<p>If running with run control utility <a class="el" href="RC_mhttpd_utility.html">mhttpd</a>, a frontend can send an update to the main status page, to report on its progress, using the function set_equipment_status. This is very useful when hardware can take a long time to respond. For example, a frontend might add calls in the <a class="el" href="FE_sequence.html#FE_frontend_init">frontend_init()</a> routine e.g. </p>
<div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a802849119d469feb2d1deee1be9593ac">frontend_init</a>()
{
   <a class="code" href="mfe_8c.html#a3ab359e237ee86bc2f53285b7bf2f673">set_equipment_status</a>(equipment[idx].name, <span class="stringliteral">&quot;Initializing...&quot;</span>, <span class="stringliteral">&quot;yellow&quot;</span>);
   ......  <span class="comment">// Initialize hardware </span>
   ......
   <a class="code" href="mfe_8c.html#a3ab359e237ee86bc2f53285b7bf2f673">set_equipment_status</a>(equipment[idx].name, <span class="stringliteral">&quot;OK&quot;</span>, <span class="stringliteral">&quot;green&quot;</span>);
}
</pre></div><p>The status messages appear next to the equipment name on the <a class="el" href="RC_mhttpd_status_page_features.html#idx_mhttpd_page_status_equipment">main status page</a>.</p>
<p><br/>
 <br/>
 </p>
<h2><a class="anchor" id="FE_frontend_init">
frontend_init()</a></h2>
<p>This function runs once only at the application startup. Allows hardware checking, loading/setting of global variables, hot-link settings to the ODB etc...</p>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Examples of frontend_init routines </caption>
<tr>
<td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 153);"><p><span style="font-weight: bold;">VME :</span>  </p>
</td><td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 204);"><p><span style="font-weight: bold;">CAMAC :</span>  </p>
</td></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a802849119d469feb2d1deee1be9593ac">frontend_init</a>()
{
 ....
 <span class="comment">// Open VME interface</span>
  status = <a class="code" href="group__mvmestdfunctionh.html#ga13db7fc7c7c022e46fadd8fc4dc40047">mvme_open</a>(&amp;myvme, 0);

  <span class="comment">// Set am to A24 non-privileged Data</span>
  <a class="code" href="group__mvmestdfunctionh.html#gaf1529ef7e75316beebc1672840217bd0">mvme_set_am</a>(myvme, <a class="code" href="group__mvmestdinclude.html#ga803ae58eabffb7258a6b07843c6c2523">MVME_AM_A24_ND</a>);

  <span class="comment">// Set dmode to D32</span>
  <a class="code" href="group__mvmestdfunctionh.html#gaaed1e33d2affe73c5afea1ce30b6c25b">mvme_set_dmode</a>(myvme, <a class="code" href="group__mvmestdinclude.html#ga1106eeff8cdbd2cfb5516f7feea8c1ff">MVME_DMODE_D32</a>)
  return SUCCESS;
}
</pre></div>  </td><td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a802849119d469feb2d1deee1be9593ac">frontend_init</a>()
{
   <a class="code" href="group__mcstdfunctionh.html#ga6c97ce64e84d233efe4de457ec495d2f">cam_init</a>();              <span class="comment">// Init CAMAC access</span>
   <a class="code" href="group__mcstdfunctionh.html#ga9fb70c7c5fb16d3807373902b137fe3e">cam_crate_clear</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>);  <span class="comment">// Clear Crate</span>
   <a class="code" href="group__mcstdfunctionh.html#ga476ffc902c4674e17aa3b544781023e4">cam_crate_zinit</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>);  <span class="comment">// Z crate</span>
   <a class="code" href="group__mcstdfunctionh.html#gaa171934ed8e8ce2af3ec97f4192aa27b">cam_inhibit_set</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>);  <span class="comment">// Set I crate </span>
   <span class="keywordflow">return</span> SUCCESS;
}
</pre></div> </td></tr>
</table>
<p><br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_begin_of_run">
begin_of_run</a></h2>
<p>This function is called for every run start transition. Allows the updating of user <a class="el" href="structparameters.html">parameters</a>, and the loading/setup/clearing of hardware. At the exit of this function the acquisition should be armed and ready to test the interrupt (if used).</p>
<p>In case of a CAMAC frontend, the LAM has to be declared to the Crate Controller. The function <b>cam_lam_enable(CRATE, SLOT_IO)</b> is then necessary in order to enable the proper LAM source station. The LAM source station has to also be enabled (F26). <br/>
<br/>
 The arguments</p>
<ul>
<li><b>run_number</b> provides the current run number being started.</li>
<li><b>error</b> can be used for returning a message to the system. This message string will be logged into the <b>midas.log</b> file. <br/>
</li>
</ul>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Examples of begin_of_run routines </caption>
<tr>
<td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 153);"><p><span style="font-weight: bold;">VME :</span>  </p>
</td><td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 204);"><p><span style="font-weight: bold;">CAMAC :</span>  </p>
</td></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ad8bfe703c49342b9f0275aba77dc7758">begin_of_run</a> (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> runnumber, <span class="keywordtype">char</span> * error)
{
  ......

  <span class="comment">// Set am to A24 non-privileged Data</span>
  <a class="code" href="group__mvmestdfunctionh.html#gaf1529ef7e75316beebc1672840217bd0">mvme_set_am</a>(myvme, <a class="code" href="group__mvmestdinclude.html#ga803ae58eabffb7258a6b07843c6c2523">MVME_AM_A24_ND</a>);
  <span class="comment">// Set dmode to D32</span>
  <a class="code" href="group__mvmestdfunctionh.html#gaaed1e33d2affe73c5afea1ce30b6c25b">mvme_set_dmode</a>(myvme, <a class="code" href="group__mvmestdinclude.html#ga1106eeff8cdbd2cfb5516f7feea8c1ff">MVME_DMODE_D32</a>);

 <span class="comment">//-------- ADCs -------------------</span>
  <a class="code" href="v792_8c.html#ab1fa02b31b58838414803d8d750dbaa3">v792_Setup</a>(myvme, VADC0_BASE, 2);
  <a class="code" href="v792_8c.html#a3eec625d3dca654c6f99f82d964d4287">v792_ThresholdWrite</a>(myvme, VADC0_BASE,
       (<a class="code" href="sis3803_8h.html#a2b0e863dadf920709ec53d9088ee7c91">WORD</a> *)&amp;(<a class="code" href="fevmemodules_8c.html#a8d1988d3d35f995fe7cb2e1095e59136">ts</a>.v792.threshold1));
  <a class="code" href="v792_8c.html#a526dbfe955e68a6e982bb5a3345b74e3">v792_DataClear</a>(myvme, VADC0_BASE);
  csr = <a class="code" href="v792_8c.html#a01124a009c024fb70d7243658facd6b9">v792_CSR1Read</a>(myvme, VADC0_BASE);
  printf(<span class="stringliteral">&quot;Data Ready ADC0: 0x%x\n&quot;</span>, csr);
  ........
  <span class="comment">// Disable interrupt</span>
  <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE+4, 0x0);
  <span class="comment">// Reset Latch</span>
  <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE, 0x1);
  <span class="comment">// Clear pending interrupts</span>
  <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE+8, 0x0);
  <span class="comment">// Enable interrupt</span>
  inRun = 1;
  <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE+4, inRun);
  <span class="keywordflow">return</span> SUCCESS;
}
</pre></div>  </td><td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ad8bfe703c49342b9f0275aba77dc7758">begin_of_run</a> (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> runnumber, <span class="keywordtype">char</span> * error)
{
  ......
  <span class="comment">// clear units</span>
  <a class="code" href="group__mcstdfunctionh.html#ga3840e8a0619db3b383cc2829b83b8e6a">camc</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_C212, 0, 9);
  <a class="code" href="group__mcstdfunctionh.html#ga3840e8a0619db3b383cc2829b83b8e6a">camc</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_2249A, 0, 9);
  <a class="code" href="group__mcstdfunctionh.html#ga3840e8a0619db3b383cc2829b83b8e6a">camc</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_SC2, 0, 9);
  <a class="code" href="group__mcstdfunctionh.html#ga3840e8a0619db3b383cc2829b83b8e6a">camc</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_SC3, 0, 9);

  <span class="comment">// Enable LAM generation</span>
  <a class="code" href="group__mcstdfunctionh.html#ga3840e8a0619db3b383cc2829b83b8e6a">camc</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_C212, 0, 26);  

  <a class="code" href="group__mcstdfunctionh.html#gaaf50e8892fd5226754befa7185c9dc3a">cam_inhibit_clear</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>); <span class="comment">// Remove I</span>
  <span class="comment">// Declare Station to  CC as LAM source</span>
  <a class="code" href="group__mcstdfunctionh.html#ga3b676540b901e12fc4fd6a8495d612eb">cam_lam_enable</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_C212);


  <span class="comment">// set and clear OR1320 pattern bits</span>
  <a class="code" href="group__mcstdfunctionh.html#ga0c0e5e0a19205781825e673e694db77f">camo</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_OR1320, 0, 18, 0x0330);
  <span class="comment">// Open run gate, reset latch</span>
  <a class="code" href="group__mcstdfunctionh.html#ga0c0e5e0a19205781825e673e694db77f">camo</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_OR1320, 0, 21, 0x0663);
  <span class="keywordflow">return</span> SUCCESS;
}
</pre></div><p></p>
</td></tr>
</table>
<p><br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_pause_resume_run">
pause_run() or resume_run()</a></h2>
<p>These two functions are called respectively upon "Pause" and "Resume" command. Any code relevant to the upcoming run state can be included.</p>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Examples of pause_run and resume_run routines </caption>
<tr>
<td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 153);"><p><span style="font-weight: bold;">VME :</span>  </p>
</td><td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 204);"><p><span style="font-weight: bold;">CAMAC :</span>  </p>
</td></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a164db20cf6c8c81e8c8ca50a590de436">pause_run</a> (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> * error)
{
 <span class="comment">// Disable interrupt</span>
  inRun = 0;
  <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE+4, inRun);
   <span class="keywordflow">return</span> SUCCESS;
}

<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a6cada7e3f07b9fc2b9886263223661d4">resume_run</a> (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> * error)
{
 inRun = 1;
 <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE+4, inRun);
   <span class="keywordflow">return</span> SUCCESS;
}
</pre></div>  </td><td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a164db20cf6c8c81e8c8ca50a590de436">pause_run</a> (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> * error)
{
   <a class="code" href="group__mcstdfunctionh.html#gaa171934ed8e8ce2af3ec97f4192aa27b">cam_inhibit_set</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>)
   return SUCCESS;
}
<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#a6cada7e3f07b9fc2b9886263223661d4">resume_run</a> (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> * error)
{
   <a class="code" href="group__mcstdfunctionh.html#gaaf50e8892fd5226754befa7185c9dc3a">cam_inhibit_clear</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>)
   return SUCCESS;
}  
</pre></div><p></p>
</td></tr>
</table>
<p>The arguments</p>
<ul>
<li><b>run_number</b> provides the current run number being paused/resumed.</li>
<li><b>error</b> can be used for returning a message to the system. This message string will be logged into the midas.log file.</li>
</ul>
<p><br/>
</p>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_end_of_run">
end_of_run()</a></h2>
<p>For every "stop run" transition this function is called and provides the opportunity to disable the hardware. </p>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<caption align="bottom">Examples of end_of_run routines </caption>
<tr>
<td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 153);"><p><span style="font-weight: bold;">VME :</span>  </p>
</td><td style="vertical-align: top; text-align: center; background-color: rgb(255, 255, 204);"><p><span style="font-weight: bold;">CAMAC :</span>  </p>
</td></tr>
<tr>
<td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ae6d798649008b7523c77222bae2d4187">end_of_run</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span> *error)
{
  <span class="comment">// Stop DAQ for seting up the parameters</span>
  vf48_AcqStop(myvme, <a class="code" href="fevmemodules_8c.html#a7675505ab96ded09e577ea510c2900e0">VF48_BASE</a>);

  <a class="code" href="fevmemodules_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a> = 0;
  <a class="code" href="fevmemodules_8c.html#a25a07c1f75f0b67144cbdc264ffdb09c">stop_req</a> = 0;
  inRun = 0;
  <span class="comment">// Disable interrupt</span>
  <a class="code" href="group__mvmestdfunctionh.html#ga901e510ac4c207e424e944ee92c5ea65">mvme_write_value</a>(myvme, VLAM_BASE+4, inRun);
  trig_level = 0;
  <span class="comment">// Close run gate</span>
  <a class="code" href="vmeio_8c.html#a55bfbc8acc81f96641ce87521deb9f53">vmeio_AsyncWrite</a>(myvme, <a class="code" href="fevmemodules_8c.html#aa914897ada170e3d2b39940ef62467cf">VMEIO_BASE</a>, 0x0);
  <span class="keywordflow">return</span> SUCCESS;
}
</pre></div> </td><td><div class="fragment"><pre class="fragment"><a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ae6d798649008b7523c77222bae2d4187">end_of_run</a>( <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> run_number, <span class="keywordtype">char</span>* error)
{
   <span class="comment">// set and clear OR1320 pattern bits or close run gate.</span>
   <a class="code" href="group__mcstdfunctionh.html#ga0c0e5e0a19205781825e673e694db77f">camo</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_OR1320, 0, 18, 0x0CC3);
   <a class="code" href="group__mcstdfunctionh.html#ga0c0e5e0a19205781825e673e694db77f">camo</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_OR1320, 0, 21, 0x0990);
   <span class="comment">// Enable LAM generation</span>
   <a class="code" href="group__mcstdfunctionh.html#ga3840e8a0619db3b383cc2829b83b8e6a">camc</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_C212, 0, 26);  
   <span class="comment">// disable LAM in crate controller</span>
   <a class="code" href="group__mcstdfunctionh.html#gac24088d63d7b5b460a93eba5fbd32518">cam_lam_disable</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>, SLOT_C212);
   <span class="comment">// set crate inhibit </span>
   <a class="code" href="group__mcstdfunctionh.html#gaa171934ed8e8ce2af3ec97f4192aa27b">cam_inhibit_set</a>(<a class="code" href="frontend_8c.html#ad927298c4aa5421ba6e9c19a15535a16">CRATE</a>);          
   <span class="keywordflow">return</span> SUCCESS;
}
</pre></div> </td></tr>
</table>
<p>The arguments</p>
<ul>
<li><b>run_number</b> provides the current run number being ended.</li>
<li><b>error</b> can be used for returning a message to the system. This message string will be logged into the midas.log file. <br/>
</li>
</ul>
<p><br/>
 </p>
<h2><a class="anchor" id="FE_frontend_exit">
frontend_exit()</a></h2>
<p>This function runs when the frontend is requested to terminate. Can be used for local statistic collection etc.</p>
<p><br/>
  
<script type="text/javascript">
pages( "FE_code_sections", "FrontendOperation", "FE_eq_event_routines", "FE_sequence","" ); // back index next {top bottom}
// section parameters: last section; top of this section; next section
sections("RunControl","FrontendOperation","DataAnalysis");
</script>
 <br/>
</p>
<p><a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

