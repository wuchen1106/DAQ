<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: hv.c Source File</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_3a31cb640e3adcf1204f611a3086db97.html">drivers</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_ac683fcc8bf5e14e49bc95edd965e9e1.html">class</a>
  </div>
</div>
<div class="contents">
<h1>hv.c</h1><a href="hv_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/********************************************************************\</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">  Name:         hv.c</span>
<a name="l00004"></a>00004 <span class="comment">  Created by:   Stefan Ritt</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">  Contents:     High Voltage Class Driver</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">  $Id: hv.c 5126 2011-07-07 12:32:53Z ritt $</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">\********************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;<a class="code" href="midas_8h.html">midas.h</a>&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;ybos.h&quot;</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="structHV__INFO.html">00018</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00019"></a>00019 
<a name="l00020"></a>00020    <span class="comment">/* ODB keys */</span>
<a name="l00021"></a><a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">00021</a>    HNDLE hKeyRoot, hKeyDemand, hKeyMeasured, hKeyCurrent;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023    <span class="comment">/* globals */</span>
<a name="l00024"></a><a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">00024</a>    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> num_channels;
<a name="l00025"></a><a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">00025</a>    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> format;
<a name="l00026"></a><a class="code" href="structHV__INFO.html#a2668b8cf12fab6db3723bd974f420168">00026</a>    <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> last_update;
<a name="l00027"></a><a class="code" href="structHV__INFO.html#a2c2b5ebfbef1fd3741bbbbc204682a17">00027</a>    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> last_channel;
<a name="l00028"></a><a class="code" href="structHV__INFO.html#a4e75f06fff4493c516a8376bdbb18465">00028</a>    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> last_channel_updated;
<a name="l00029"></a>00029 
<a name="l00030"></a>00030    <span class="comment">/* items in /Variables record */</span>
<a name="l00031"></a><a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">00031</a>    <span class="keywordtype">char</span> *names;
<a name="l00032"></a><a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">00032</a>    <span class="keywordtype">float</span> *demand;
<a name="l00033"></a><a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">00033</a>    <span class="keywordtype">float</span> *measured;
<a name="l00034"></a><a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">00034</a>    <span class="keywordtype">float</span> *current;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036    <span class="comment">/* items in /Settings */</span>
<a name="l00037"></a><a class="code" href="structHV__INFO.html#a95fca973c2f8312e960cd4bb52963058">00037</a>    <span class="keywordtype">float</span> *update_threshold;
<a name="l00038"></a><a class="code" href="structHV__INFO.html#a3cec5d42540d9e8264b083e85c4a3bf2">00038</a>    <span class="keywordtype">float</span> *update_threshold_current;
<a name="l00039"></a><a class="code" href="structHV__INFO.html#a4696558233da1263e01e8971a01923e0">00039</a>    <span class="keywordtype">float</span> *zero_threshold;
<a name="l00040"></a><a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">00040</a>    <span class="keywordtype">float</span> *voltage_limit;
<a name="l00041"></a><a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">00041</a>    <span class="keywordtype">float</span> *current_limit;
<a name="l00042"></a><a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">00042</a>    <span class="keywordtype">float</span> *rampup_speed;
<a name="l00043"></a><a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">00043</a>    <span class="keywordtype">float</span> *rampdown_speed;
<a name="l00044"></a><a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">00044</a>    <span class="keywordtype">float</span> *trip_time;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046    <span class="comment">/* mirror arrays */</span>
<a name="l00047"></a><a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">00047</a>    <span class="keywordtype">float</span> *demand_mirror;
<a name="l00048"></a><a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">00048</a>    <span class="keywordtype">float</span> *measured_mirror;
<a name="l00049"></a><a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">00049</a>    <span class="keywordtype">float</span> *current_mirror;
<a name="l00050"></a><a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">00050</a>    <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *last_change;
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">00052</a>    <a class="code" href="structDEVICE__DRIVER.html">DEVICE_DRIVER</a> **driver;
<a name="l00053"></a><a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">00053</a>    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> *channel_offset;
<a name="l00054"></a><a class="code" href="structHV__INFO.html#a493551928e54f1d2389d3623e7f1eb13">00054</a>    <span class="keywordtype">void</span> **dd_info;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 } <a class="code" href="structHV__INFO.html">HV_INFO</a>;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="preprocessor">#ifndef abs</span>
<a name="l00059"></a><a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define abs(a) (((a) &lt; 0)   ? -(a) : (a))</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00062"></a>00062 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="hv_8c.html#a85cbcc39927a7a621dfe3b417ac6c0cb">00064</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#a85cbcc39927a7a621dfe3b417ac6c0cb">free_mem</a>(<a class="code" href="structHV__INFO.html">HV_INFO</a> * hv_info)
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a>);
<a name="l00067"></a>00067    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>);
<a name="l00068"></a>00068    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>);
<a name="l00069"></a>00069    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a95fca973c2f8312e960cd4bb52963058">update_threshold</a>);
<a name="l00072"></a>00072    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a3cec5d42540d9e8264b083e85c4a3bf2">update_threshold_current</a>);
<a name="l00073"></a>00073    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a4696558233da1263e01e8971a01923e0">zero_threshold</a>);
<a name="l00074"></a>00074    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>);
<a name="l00075"></a>00075    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a>);
<a name="l00076"></a>00076    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>);
<a name="l00077"></a>00077    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>);
<a name="l00078"></a>00078    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a>);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>);
<a name="l00081"></a>00081    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>);
<a name="l00082"></a>00082    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>);
<a name="l00083"></a>00083    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a493551928e54f1d2389d3623e7f1eb13">dd_info</a>);
<a name="l00086"></a>00086    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>);
<a name="l00087"></a>00087    free(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089    free(hv_info);
<a name="l00090"></a>00090 }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="hv_8c.html#aa65c35bd0a67b97f157e6cf96f8da0c2">00094</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#aa65c35bd0a67b97f157e6cf96f8da0c2">hv_start</a>(<a class="code" href="structeqpmnt.html">EQUIPMENT</a> * pequipment)
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098    <span class="comment">/* call start method of device drivers */</span>
<a name="l00099"></a>00099    <span class="keywordflow">for</span> (i = 0; pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#adfdb7ee99dd506e35f65d3f8d4b41a4b">dd</a> != NULL ; i++)
<a name="l00100"></a>00100       <span class="keywordflow">if</span> (pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga2499f0abd1f0577de72d1d5645fc7713">DF_MULTITHREAD</a>) {
<a name="l00101"></a>00101          pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#a0c44eefaa711ea871881308c507c8b00">pequipment</a> = &amp;pequipment-&gt;<a class="code" href="structeqpmnt.html#a51afc5b1fc5a6a107cffb9542444b188">info</a>;
<a name="l00102"></a>00102          <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(&amp;pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i], <a class="code" href="group__err26.html#gab905e6aff2332984df0552c6b50203f2">CMD_START</a>);
<a name="l00103"></a>00103       }
<a name="l00104"></a>00104 
<a name="l00105"></a>00105    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 <span class="comment">/*----------------------------------------------------------------------------*/</span>
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="hv_8c.html#a436026ab3058e095a1c65188b29106a4">00110</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#a436026ab3058e095a1c65188b29106a4">hv_stop</a>(<a class="code" href="structeqpmnt.html">EQUIPMENT</a> * pequipment)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114    <span class="comment">/* call close method of device drivers */</span>
<a name="l00115"></a>00115    <span class="keywordflow">for</span> (i = 0; pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#adfdb7ee99dd506e35f65d3f8d4b41a4b">dd</a> != NULL ; i++)
<a name="l00116"></a>00116       <span class="keywordflow">if</span> (pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga2499f0abd1f0577de72d1d5645fc7713">DF_MULTITHREAD</a>)
<a name="l00117"></a>00117          <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(&amp;pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i], <a class="code" href="group__err26.html#ga46dc7ae84992bfe62cc00731959a67f4">CMD_STOP</a>);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00120"></a>00120 }
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="hv_8c.html#adf53cc684488e64813243dafb3649712">00124</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#adf53cc684488e64813243dafb3649712">hv_read</a>(<a class="code" href="structeqpmnt.html">EQUIPMENT</a> * pequipment, <span class="keywordtype">int</span> channel)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126    <span class="keywordtype">int</span> i, status;
<a name="l00127"></a>00127    <span class="keywordtype">float</span> max_diff;
<a name="l00128"></a>00128    <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> act_time, min_time;
<a name="l00129"></a>00129    <a class="code" href="vt2_8h.html#a239c7f0d40651c3e419c5b9651507d14">BOOL</a> changed;
<a name="l00130"></a>00130    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00131"></a>00131    HNDLE <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>;
<a name="l00132"></a>00132 
<a name="l00133"></a>00133    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00134"></a>00134    <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00135"></a>00135 
<a name="l00136"></a>00136    <span class="comment">/* if driver is multi-threaded, read all channels at once */</span>
<a name="l00137"></a>00137    <span class="keywordflow">for</span> (i=0 ; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> ; i++) {
<a name="l00138"></a>00138       <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga2499f0abd1f0577de72d1d5645fc7713">DF_MULTITHREAD</a>) {
<a name="l00139"></a>00139          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga39f82f93564bba7925fd849ce7967a2b">CMD_GET</a>,
<a name="l00140"></a>00140                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i],
<a name="l00141"></a>00141                                 &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i]);
<a name="l00142"></a>00142          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga3578ee798d04c6279a03f61fe70079e0">CMD_GET_CURRENT</a>,
<a name="l00143"></a>00143                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i],
<a name="l00144"></a>00144                                 &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i]);
<a name="l00145"></a>00145       }
<a name="l00146"></a>00146    }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148    <span class="comment">/* else read only single channel */</span>
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (!(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[channel]-&gt;<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga2499f0abd1f0577de72d1d5645fc7713">DF_MULTITHREAD</a>)) {
<a name="l00150"></a>00150       status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[channel], <a class="code" href="group__err26.html#ga39f82f93564bba7925fd849ce7967a2b">CMD_GET</a>,
<a name="l00151"></a>00151                                  channel - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[channel],
<a name="l00152"></a>00152                                  &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[channel]);
<a name="l00153"></a>00153       status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[channel], <a class="code" href="group__err26.html#ga3578ee798d04c6279a03f61fe70079e0">CMD_GET_CURRENT</a>,
<a name="l00154"></a>00154                                  channel - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[channel],
<a name="l00155"></a>00155                                  &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[channel]);
<a name="l00156"></a>00156    }
<a name="l00157"></a>00157 
<a name="l00158"></a>00158    <span class="comment">/* check how much channels have changed since last ODB update */</span>
<a name="l00159"></a>00159    act_time = <a class="code" href="group__msfunctionc.html#ga999b383482224a5a6c4f5974d2625717">ss_millitime</a>();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161    <span class="comment">/* check for update measured */</span>
<a name="l00162"></a>00162    max_diff = 0.f;
<a name="l00163"></a>00163    min_time = 60000;
<a name="l00164"></a>00164    changed = FALSE;
<a name="l00165"></a>00165    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++) {
<a name="l00166"></a>00166       <span class="keywordflow">if</span> (<a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i] - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>[i]) &gt; max_diff)
<a name="l00167"></a>00167          max_diff = <a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i] - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>[i]);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169       <span class="comment">/* indicate change if variation more than the threshold */</span>
<a name="l00170"></a>00170       <span class="keywordflow">if</span> (<a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i] - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>[i]) &gt;
<a name="l00171"></a>00171           hv_info-&gt;<a class="code" href="structHV__INFO.html#a95fca973c2f8312e960cd4bb52963058">update_threshold</a>[i] &amp;&amp; hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i] &gt; hv_info-&gt;<a class="code" href="structHV__INFO.html#a4696558233da1263e01e8971a01923e0">zero_threshold</a>[i])
<a name="l00172"></a>00172          changed = TRUE;
<a name="l00173"></a>00173 
<a name="l00174"></a>00174       <span class="keywordflow">if</span> (act_time - hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i] &lt; min_time)
<a name="l00175"></a>00175          min_time = act_time - hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i];
<a name="l00176"></a>00176    }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178    <span class="comment">/* update if change is more than update_sensitivity or less than 20 seconds ago </span>
<a name="l00179"></a>00179 <span class="comment">      or last update is older than a minute */</span>
<a name="l00180"></a>00180    <span class="keywordflow">if</span> (changed || (min_time &lt; 20000 &amp;&amp; max_diff &gt; 0) ||
<a name="l00181"></a>00181        act_time - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2668b8cf12fab6db3723bd974f420168">last_update</a> &gt; 60000) {
<a name="l00182"></a>00182       hv_info-&gt;<a class="code" href="structHV__INFO.html#a2668b8cf12fab6db3723bd974f420168">last_update</a> = act_time;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184       <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00185"></a>00185          hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i];
<a name="l00186"></a>00186 
<a name="l00187"></a>00187       <a class="code" href="group__odbfunctionc.html#gaa3f93c5321c56ad5a5200d17958e9bb3">db_set_data</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#af2b905a3cef2dab26cd394b462c88707">hKeyMeasured</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>,
<a name="l00188"></a>00188                   <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00189"></a>00189                   <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191       pequipment-&gt;<a class="code" href="structeqpmnt.html#a2ba622da82fc7a02605e5f630464b13f">odb_out</a>++;
<a name="l00192"></a>00192    }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="comment">/* check for update current */</span>
<a name="l00195"></a>00195    max_diff = 0.f;
<a name="l00196"></a>00196    min_time = 10000;
<a name="l00197"></a>00197    changed = FALSE;
<a name="l00198"></a>00198    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++) {
<a name="l00199"></a>00199       <span class="keywordflow">if</span> (<a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i] - hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>[i]) &gt; max_diff)
<a name="l00200"></a>00200          max_diff = <a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i] - hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>[i]);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202       <span class="keywordflow">if</span> (<a class="code" href="hv_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i] - hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>[i]) &gt;
<a name="l00203"></a>00203           hv_info-&gt;<a class="code" href="structHV__INFO.html#a3cec5d42540d9e8264b083e85c4a3bf2">update_threshold_current</a>[i])
<a name="l00204"></a>00204          changed = TRUE;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (act_time - hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i] &lt; min_time)
<a name="l00207"></a>00207          min_time = act_time - hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i];
<a name="l00208"></a>00208    }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210    <span class="comment">/* update if change is more than update_sensitivity or less than 5sec ago */</span>
<a name="l00211"></a>00211    <span class="keywordflow">if</span> (changed || (min_time &lt; 5000 &amp;&amp; max_diff &gt; 0)) {
<a name="l00212"></a>00212       <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00213"></a>00213          hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i];
<a name="l00214"></a>00214 
<a name="l00215"></a>00215       <a class="code" href="group__odbfunctionc.html#gaa3f93c5321c56ad5a5200d17958e9bb3">db_set_data</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a46e402f65ea500e884faa91002204bf1">hKeyCurrent</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>,
<a name="l00216"></a>00216                   <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00217"></a>00217                   <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219       pequipment-&gt;<a class="code" href="structeqpmnt.html#a2ba622da82fc7a02605e5f630464b13f">odb_out</a>++;
<a name="l00220"></a>00220    }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="keywordflow">return</span> status;
<a name="l00223"></a>00223 }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00226"></a>00226 
<a name="l00227"></a><a class="code" href="hv_8c.html#af87c3c364f95d9ef5dd7bf0602c1b7bd">00227</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#af87c3c364f95d9ef5dd7bf0602c1b7bd">hv_ramp</a>(<a class="code" href="structHV__INFO.html">HV_INFO</a> * hv_info)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i, status = 0, switch_tag = FALSE;
<a name="l00230"></a>00230    <span class="keywordtype">float</span> delta, ramp_speed = 0;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++) {
<a name="l00233"></a>00233       <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] != hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i]) {
<a name="l00234"></a>00234          <span class="comment">/* check if to ramp up or down */</span>
<a name="l00235"></a>00235          <span class="keywordflow">if</span> ((hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &gt;= 0.f) &amp;&amp; (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] &gt; 0.f)) {
<a name="l00236"></a>00236             switch_tag = FALSE;
<a name="l00237"></a>00237             <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &gt; hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i])
<a name="l00238"></a>00238                ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>[i];
<a name="l00239"></a>00239             <span class="keywordflow">else</span>
<a name="l00240"></a>00240                ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i];
<a name="l00241"></a>00241          }
<a name="l00242"></a>00242          <span class="keywordflow">if</span> ((hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &gt;= 0.f) &amp;&amp; (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] &lt; 0.f)) {
<a name="l00243"></a>00243             switch_tag = TRUE;
<a name="l00244"></a>00244             ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i];
<a name="l00245"></a>00245          }
<a name="l00246"></a>00246          <span class="keywordflow">if</span> ((hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &lt; 0.f) &amp;&amp; (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] &gt; 0.f)) {
<a name="l00247"></a>00247             switch_tag = TRUE;
<a name="l00248"></a>00248             ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i];
<a name="l00249"></a>00249          }
<a name="l00250"></a>00250          <span class="keywordflow">if</span> ((hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &lt; 0.f) &amp;&amp; (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] &lt; 0.f)) {
<a name="l00251"></a>00251             switch_tag = FALSE;
<a name="l00252"></a>00252             <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &gt; hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i])
<a name="l00253"></a>00253                ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i];
<a name="l00254"></a>00254             <span class="keywordflow">else</span>
<a name="l00255"></a>00255                ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>[i];
<a name="l00256"></a>00256          }
<a name="l00257"></a>00257          <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] == 0.f) {
<a name="l00258"></a>00258             switch_tag = FALSE;
<a name="l00259"></a>00259             ramp_speed = hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>[i];
<a name="l00260"></a>00260          }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262          <span class="keywordflow">if</span> (ramp_speed == 0.f)
<a name="l00263"></a>00263             <span class="keywordflow">if</span> (switch_tag)
<a name="l00264"></a>00264                hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] = 0.f; <span class="comment">/* go to zero */</span>
<a name="l00265"></a>00265             <span class="keywordflow">else</span>
<a name="l00266"></a>00266                hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i];  <span class="comment">/* step directly to the new high voltage */</span>
<a name="l00267"></a>00267          <span class="keywordflow">else</span> {
<a name="l00268"></a>00268             delta = (float) ((<a class="code" href="group__msfunctionc.html#ga999b383482224a5a6c4f5974d2625717">ss_millitime</a>() -
<a name="l00269"></a>00269                               hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i]) / 1000.0 * ramp_speed);
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] &gt; hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i])
<a name="l00271"></a>00271                hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] =
<a name="l00272"></a>00272                    <a class="code" href="group__mmacroh.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] + delta);
<a name="l00273"></a>00273             <span class="keywordflow">else</span>
<a name="l00274"></a>00274                hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] =
<a name="l00275"></a>00275                    <a class="code" href="group__mmacroh.html#gafa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] - delta);
<a name="l00276"></a>00276          }
<a name="l00277"></a>00277          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gabb268d264836b9443ef23350814c0f68">CMD_SET</a>,
<a name="l00278"></a>00278                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i]);
<a name="l00279"></a>00279          hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i] = <a class="code" href="group__msfunctionc.html#ga999b383482224a5a6c4f5974d2625717">ss_millitime</a>();
<a name="l00280"></a>00280       }
<a name="l00281"></a>00281    }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283    <span class="keywordflow">return</span> status;
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="hv_8c.html#a1972c5d2a46d25f2fa81e42d6fcbac1c">00289</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#a1972c5d2a46d25f2fa81e42d6fcbac1c">hv_demand</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00292"></a>00292    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00293"></a>00293    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00296"></a>00296    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298    <span class="comment">/* check for voltage limit */</span>
<a name="l00299"></a>00299    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00300"></a>00300       <span class="keywordflow">if</span> (fabs(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i]) &gt; fabs(hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>[i]))
<a name="l00301"></a>00301          hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>[i];
<a name="l00302"></a>00302 
<a name="l00303"></a>00303    <span class="comment">/* set individual channels only if demand value differs */</span>
<a name="l00304"></a>00304    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00305"></a>00305       <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] != hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i])
<a name="l00306"></a>00306          hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i] = <a class="code" href="group__msfunctionc.html#ga999b383482224a5a6c4f5974d2625717">ss_millitime</a>();
<a name="l00307"></a>00307 
<a name="l00308"></a>00308    pequipment-&gt;<a class="code" href="structeqpmnt.html#ab487ff66b0ceb7677a3e664717158c51">odb_in</a>++;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++) {
<a name="l00311"></a>00311       <span class="comment">/* if device can do hardware ramping, just set value */</span>   
<a name="l00312"></a>00312       <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga2bc66eaec0c3f864e8e3fb89992857d5">DF_HW_RAMP</a>) {
<a name="l00313"></a>00313          <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i] != hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i]) {
<a name="l00314"></a>00314             <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gabb268d264836b9443ef23350814c0f68">CMD_SET</a>,
<a name="l00315"></a>00315                           i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i]);
<a name="l00316"></a>00316             hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[i] = <a class="code" href="group__msfunctionc.html#ga999b383482224a5a6c4f5974d2625717">ss_millitime</a>();
<a name="l00317"></a>00317             hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i];
<a name="l00318"></a>00318          }
<a name="l00319"></a>00319       }
<a name="l00320"></a>00320    }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322    <span class="comment">/* execute one ramping for devices which have not hardware ramping */</span>
<a name="l00323"></a>00323    <a class="code" href="hv_8c.html#af87c3c364f95d9ef5dd7bf0602c1b7bd">hv_ramp</a>(hv_info);
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="hv_8c.html#a3191cdab3dab02398919e46fbc289b82">00328</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#a3191cdab3dab02398919e46fbc289b82">hv_set_trip_time</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00331"></a>00331    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00332"></a>00332    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00335"></a>00335    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <span class="comment">/* check for voltage limit */</span>
<a name="l00338"></a>00338    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00339"></a>00339       <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga777213a0f7da75a6faf4ca53623a80c6">CMD_SET_TRIP_TIME</a>,
<a name="l00340"></a>00340                     i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a>[i]);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342    pequipment-&gt;<a class="code" href="structeqpmnt.html#ab487ff66b0ceb7677a3e664717158c51">odb_in</a>++;
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="hv_8c.html#aad24ee51a854f8e3d655e11f1b87ad1a">00347</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#aad24ee51a854f8e3d655e11f1b87ad1a">hv_set_current_limit</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00350"></a>00350    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00351"></a>00351    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00354"></a>00354    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    <span class="comment">/* check for voltage limit */</span>
<a name="l00357"></a>00357    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00358"></a>00358       <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga3f2bdc89e0bd028b914d2a4caf0c5736">CMD_SET_CURRENT_LIMIT</a>,
<a name="l00359"></a>00359                     i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a>[i]);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361    pequipment-&gt;<a class="code" href="structeqpmnt.html#ab487ff66b0ceb7677a3e664717158c51">odb_in</a>++;
<a name="l00362"></a>00362 }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00365"></a>00365 
<a name="l00366"></a><a class="code" href="hv_8c.html#a6c2c1ccdfbcf710a0a81249710b72cc4">00366</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#a6c2c1ccdfbcf710a0a81249710b72cc4">hv_set_rampup</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00367"></a>00367 {
<a name="l00368"></a>00368    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00369"></a>00369    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00370"></a>00370    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00373"></a>00373    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375    <span class="comment">/* check for voltage limit */</span>
<a name="l00376"></a>00376    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00377"></a>00377       <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gaf8be6c837a47b6de4d00bdd64db319cd">CMD_SET_RAMPUP</a>,
<a name="l00378"></a>00378                     i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>[i]);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    pequipment-&gt;<a class="code" href="structeqpmnt.html#ab487ff66b0ceb7677a3e664717158c51">odb_in</a>++;
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00384"></a>00384 
<a name="l00385"></a><a class="code" href="hv_8c.html#a035e3d5e825a2e7537549cbc9133957c">00385</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#a035e3d5e825a2e7537549cbc9133957c">hv_set_rampdown</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00388"></a>00388    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00389"></a>00389    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00392"></a>00392    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    <span class="comment">/* check for voltage limit */</span>
<a name="l00395"></a>00395    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00396"></a>00396       <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gafbd1844707a6b9a25d40ef1848ce750f">CMD_SET_RAMPDOWN</a>,
<a name="l00397"></a>00397                     i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i]);
<a name="l00398"></a>00398 
<a name="l00399"></a>00399    pequipment-&gt;<a class="code" href="structeqpmnt.html#ab487ff66b0ceb7677a3e664717158c51">odb_in</a>++;
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00403"></a>00403 
<a name="l00404"></a><a class="code" href="hv_8c.html#ae3c91ed41bc6b7f2182adfcd5549f710">00404</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#ae3c91ed41bc6b7f2182adfcd5549f710">hv_set_voltage_limit</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00405"></a>00405 {
<a name="l00406"></a>00406    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00407"></a>00407    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00408"></a>00408    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00411"></a>00411    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413    <span class="comment">/* check for voltage limit */</span>
<a name="l00414"></a>00414    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00415"></a>00415       <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga847a3b931dbb2facfceca2ff1e5be9a5">CMD_SET_VOLTAGE_LIMIT</a>,
<a name="l00416"></a>00416                     i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>[i]);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418    pequipment-&gt;<a class="code" href="structeqpmnt.html#ab487ff66b0ceb7677a3e664717158c51">odb_in</a>++;
<a name="l00419"></a>00419 }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00422"></a>00422 
<a name="l00423"></a><a class="code" href="hv_8c.html#a3d7aa8fc312aea3251456ed55b47ae56">00423</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#a3d7aa8fc312aea3251456ed55b47ae56">hv_update_label</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>, <span class="keywordtype">void</span> *info)
<a name="l00424"></a>00424 {
<a name="l00425"></a>00425    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i, status;
<a name="l00426"></a>00426    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00427"></a>00427    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429    pequipment = (<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *) info;
<a name="l00430"></a>00430    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432    <span class="comment">/* update channel labels based on the midas channel names */</span>
<a name="l00433"></a>00433    for (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00434"></a>00434       status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gaa0706cd66be2ae6e198adc217c2ad9bf">CMD_SET_LABEL</a>,
<a name="l00435"></a>00435                              i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i],
<a name="l00436"></a>00436                              hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a> + <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * i);
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00440"></a>00440 
<a name="l00441"></a><a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">00441</a> <span class="keywordtype">void</span> <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(HNDLE <a class="code" href="mfe_8c.html#ab1f60c53f74e806a3b9f687af38d7421">hDB</a>, <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info, <span class="keywordtype">char</span> *path, <span class="keywordtype">double</span> default_value, <span class="keywordtype">int</span> cmd, 
<a name="l00442"></a>00442                         <span class="keywordtype">float</span> *array, <span class="keywordtype">void</span> (*callback)(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>,<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>,<span class="keywordtype">void</span> *) ,<a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment)
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444    <span class="keywordtype">int</span> i;
<a name="l00445"></a>00445    HNDLE <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>;
<a name="l00446"></a>00446 
<a name="l00447"></a>00447    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00448"></a>00448       array[i] = (<span class="keywordtype">float</span>)default_value;
<a name="l00449"></a>00449    <span class="keywordflow">if</span> (<a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, path, &amp;hKey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l00450"></a>00450       <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00451"></a>00451          <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], cmd,
<a name="l00452"></a>00452                        i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], array + i);
<a name="l00453"></a>00453    db_merge_data(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, path, array, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00454"></a>00454                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00455"></a>00455    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, path, &amp;hKey);
<a name="l00456"></a>00456    assert(hKey);
<a name="l00457"></a>00457    <a class="code" href="group__odbfunctionc.html#ga852bc9fa8ee4d0884b328aeb0b0cfd63">db_open_record</a>(hDB, hKey, array, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__mdefineh.html#gac4d1baf108e9ce6414088db508d7c182">MODE_READ</a>, 
<a name="l00458"></a>00458                   callback, pequipment);
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00462"></a>00462 
<a name="l00463"></a><a class="code" href="hv_8c.html#ad9b5d26722c8f5bd4dd77951bfdb7f36">00463</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#ad9b5d26722c8f5bd4dd77951bfdb7f36">hv_init</a>(<a class="code" href="structeqpmnt.html">EQUIPMENT</a> * pequipment)
<a name="l00464"></a>00464 {
<a name="l00465"></a>00465    <span class="keywordtype">int</span> status, size, i, j, index, offset;
<a name="l00466"></a>00466    <span class="keywordtype">char</span> str[256];
<a name="l00467"></a>00467    HNDLE hDB, <a class="code" href="mevb_8c.html#a8cd567d23219ba7fc83280cf20caf1c2">hKey</a>;
<a name="l00468"></a>00468    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470    <span class="comment">/* allocate private data */</span>
<a name="l00471"></a>00471    pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a> = calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="structHV__INFO.html">HV_INFO</a>));
<a name="l00472"></a>00472    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474    <span class="comment">/* get class driver root key */</span>
<a name="l00475"></a>00475    <a class="code" href="group__cmfunctionc.html#ga16b33b70783a3f5ba98b4094149d12b7">cm_get_experiment_database</a>(&amp;hDB, NULL);
<a name="l00476"></a>00476    sprintf(str, <span class="stringliteral">&quot;/Equipment/%s&quot;</span>, pequipment-&gt;<a class="code" href="structeqpmnt.html#a80db04cadcc657d17e5ba6f742d6fbc6">name</a>);
<a name="l00477"></a>00477    <a class="code" href="group__odbfunctionc.html#ga4dcab15e47980882e35bddf3ceb9aee5">db_create_key</a>(hDB, 0, str, <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>);
<a name="l00478"></a>00478    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, 0, str, &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480    <span class="comment">/* save event format */</span>
<a name="l00481"></a>00481    size = <span class="keyword">sizeof</span>(str);
<a name="l00482"></a>00482    <a class="code" href="group__odbfunctionc.html#gaf3958854e073e1ddbb43324e07a6287f">db_get_value</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Common/Format&quot;</span>, str, &amp;size, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>, TRUE);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484    <span class="keywordflow">if</span> (<a class="code" href="group__odbfunctionc.html#ga060d9c5ccec906f52a34dc39de6e2069">equal_ustring</a>(str, <span class="stringliteral">&quot;Fixed&quot;</span>))
<a name="l00485"></a>00485       hv_info-&gt;<a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">format</a> = <a class="code" href="group__mdefineh.html#ga44835dd4c169e13e0fedf8c01a54dc2b">FORMAT_FIXED</a>;
<a name="l00486"></a>00486    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__odbfunctionc.html#ga060d9c5ccec906f52a34dc39de6e2069">equal_ustring</a>(str, <span class="stringliteral">&quot;MIDAS&quot;</span>))
<a name="l00487"></a>00487       hv_info-&gt;<a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">format</a> = <a class="code" href="group__mdefineh.html#gac7ef5b0cbb1fc1d26c3bfd4cc4a191a9">FORMAT_MIDAS</a>;
<a name="l00488"></a>00488    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="group__odbfunctionc.html#ga060d9c5ccec906f52a34dc39de6e2069">equal_ustring</a>(str, <span class="stringliteral">&quot;YBOS&quot;</span>))
<a name="l00489"></a>00489       hv_info-&gt;<a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">format</a> = <a class="code" href="group__mdefineh.html#gaab9657af955d54be6cd05e0a726ad964">FORMAT_YBOS</a>;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491    <span class="comment">/* count total number of channels */</span>
<a name="l00492"></a>00492    <span class="keywordflow">for</span> (i = 0, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> = 0; pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#a3c47bfe572999fec51df9c6072d6c6d7">name</a>[0]; i++) {
<a name="l00493"></a>00493       <span class="keywordflow">if</span> (pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#a1451258cb714852eef78ec04e7970f65">channels</a> == 0) {
<a name="l00494"></a>00494          <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hv_init&quot;</span>, <span class="stringliteral">&quot;Driver with zero channels not allowed&quot;</span>);
<a name="l00495"></a>00495          <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8a0cc5de6ea758c61231a11b6a076e1f">FE_ERR_ODB</a>;
<a name="l00496"></a>00496       }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498       hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> += pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#a1451258cb714852eef78ec04e7970f65">channels</a>;
<a name="l00499"></a>00499    }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> == 0) {
<a name="l00502"></a>00502       <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hv_init&quot;</span>, <span class="stringliteral">&quot;No channels found in device driver list&quot;</span>);
<a name="l00503"></a>00503       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8a0cc5de6ea758c61231a11b6a076e1f">FE_ERR_ODB</a>;
<a name="l00504"></a>00504    }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506    <span class="comment">/* Allocate memory for buffers */</span>
<a name="l00507"></a>00507    hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a> = (<span class="keywordtype">char</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a>);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00510"></a>00510    hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00511"></a>00511    hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00512"></a>00512 
<a name="l00513"></a>00513    hv_info-&gt;<a class="code" href="structHV__INFO.html#a95fca973c2f8312e960cd4bb52963058">update_threshold</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00514"></a>00514    hv_info-&gt;<a class="code" href="structHV__INFO.html#a3cec5d42540d9e8264b083e85c4a3bf2">update_threshold_current</a> =
<a name="l00515"></a>00515        (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00516"></a>00516    hv_info-&gt;<a class="code" href="structHV__INFO.html#a4696558233da1263e01e8971a01923e0">zero_threshold</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00517"></a>00517    hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00518"></a>00518    hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00519"></a>00519    hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00520"></a>00520    hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00521"></a>00521    hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00522"></a>00522 
<a name="l00523"></a>00523    hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00524"></a>00524    hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00525"></a>00525    hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a> = (<span class="keywordtype">float</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00526"></a>00526    hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a> = (<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a>));
<a name="l00527"></a>00527 
<a name="l00528"></a>00528    hv_info-&gt;<a class="code" href="structHV__INFO.html#a493551928e54f1d2389d3623e7f1eb13">dd_info</a> = (<span class="keywordtype">void</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
<a name="l00529"></a>00529    hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a> = (<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a>));
<a name="l00530"></a>00530    hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a> = (<span class="keywordtype">void</span> *) calloc(hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
<a name="l00531"></a>00531 
<a name="l00532"></a>00532    <span class="keywordflow">if</span> (!hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>) {
<a name="l00533"></a>00533       <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hv_init&quot;</span>, <span class="stringliteral">&quot;Not enough memory&quot;</span>);
<a name="l00534"></a>00534       <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8a0cc5de6ea758c61231a11b6a076e1f">FE_ERR_ODB</a>;
<a name="l00535"></a>00535    }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="comment">/*---- Initialize device drivers ----*/</span>
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <span class="comment">/* call init method */</span>
<a name="l00540"></a>00540    <span class="keywordflow">for</span> (i = 0; pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#a3c47bfe572999fec51df9c6072d6c6d7">name</a>[0]; i++) {
<a name="l00541"></a>00541       sprintf(str, <span class="stringliteral">&quot;Settings/Devices/%s&quot;</span>, pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#a3c47bfe572999fec51df9c6072d6c6d7">name</a>);
<a name="l00542"></a>00542       status = <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, str, &amp;hKey);
<a name="l00543"></a>00543       <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l00544"></a>00544          <a class="code" href="group__odbfunctionc.html#ga4dcab15e47980882e35bddf3ceb9aee5">db_create_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, str, <a class="code" href="group__mdefineh.html#ga15ae151ae0b7588b3327bd8451d9bcb8">TID_KEY</a>);
<a name="l00545"></a>00545          status = <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, str, &amp;hKey);
<a name="l00546"></a>00546          <span class="keywordflow">if</span> (status != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>) {
<a name="l00547"></a>00547             <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;hv_init&quot;</span>, <span class="stringliteral">&quot;Cannot create %s entry in online database&quot;</span>, str);
<a name="l00548"></a>00548             <a class="code" href="hv_8c.html#a85cbcc39927a7a621dfe3b417ac6c0cb">free_mem</a>(hv_info);
<a name="l00549"></a>00549             <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga8a0cc5de6ea758c61231a11b6a076e1f">FE_ERR_ODB</a>;
<a name="l00550"></a>00550          }
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(&amp;pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i], <a class="code" href="group__err26.html#ga2677fc43f8393bcf3bafc8bbface003f">CMD_INIT</a>, hKey);
<a name="l00554"></a>00554       <span class="keywordflow">if</span> (status != <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>) {
<a name="l00555"></a>00555          <a class="code" href="hv_8c.html#a85cbcc39927a7a621dfe3b417ac6c0cb">free_mem</a>(hv_info);
<a name="l00556"></a>00556          <span class="keywordflow">return</span> status;
<a name="l00557"></a>00557       }
<a name="l00558"></a>00558    }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560    <span class="comment">/* compose device driver channel assignment */</span>
<a name="l00561"></a>00561    <span class="keywordflow">for</span> (i = 0, j = 0, index = 0, offset = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++, j++) {
<a name="l00562"></a>00562       <span class="keywordflow">while</span> (j &gt;= pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[index].<a class="code" href="structDEVICE__DRIVER.html#a1451258cb714852eef78ec04e7970f65">channels</a> &amp;&amp; pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[index].<a class="code" href="structDEVICE__DRIVER.html#a3c47bfe572999fec51df9c6072d6c6d7">name</a>[0]) {
<a name="l00563"></a>00563          offset += j;
<a name="l00564"></a>00564          index++;
<a name="l00565"></a>00565          j = 0;
<a name="l00566"></a>00566       }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i] = &amp;pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[index];
<a name="l00569"></a>00569       hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i] = offset;
<a name="l00570"></a>00570    }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572    <span class="comment">/*---- Create/Read settings ----*/</span>
<a name="l00573"></a>00573 
<a name="l00574"></a>00574    <span class="comment">/* Names */</span>
<a name="l00575"></a>00575    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00576"></a>00576       sprintf(hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a> + <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * i, <span class="stringliteral">&quot;Default%%CH %d&quot;</span>, i);
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (<a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Names&quot;</span>, &amp;hKey) != <a class="code" href="group__err23.html#ga4d6ab4d32144d851ddeb7931b81a63e3">DB_SUCCESS</a>)
<a name="l00578"></a>00578       <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++)
<a name="l00579"></a>00579          <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gacd4918f4633cc4bb4bc967382c756b9a">CMD_GET_LABEL</a>,
<a name="l00580"></a>00580                        i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a> + <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * i);
<a name="l00581"></a>00581    db_merge_data(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Names&quot;</span>,
<a name="l00582"></a>00582                  hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00583"></a>00583                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__mdefineh.html#gab81af1d9631a5c29500d506f0c3470cd">TID_STRING</a>);
<a name="l00584"></a>00584    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Names&quot;</span>, &amp;hKey);
<a name="l00585"></a>00585    assert(hKey);
<a name="l00586"></a>00586    <a class="code" href="group__odbfunctionc.html#ga852bc9fa8ee4d0884b328aeb0b0cfd63">db_open_record</a>(hDB, hKey, hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a>, <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00587"></a>00587                   <a class="code" href="group__mdefineh.html#gac4d1baf108e9ce6414088db508d7c182">MODE_READ</a>, <a class="code" href="hv_8c.html#a3d7aa8fc312aea3251456ed55b47ae56">hv_update_label</a>, pequipment);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589    <span class="comment">/* Update threshold */</span>
<a name="l00590"></a>00590    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Update Threshold Measured&quot;</span>, 0.5, <a class="code" href="group__err26.html#gafa1449391aaad6d2e8b58ac5a151ab45">CMD_GET_THRESHOLD</a>, 
<a name="l00591"></a>00591                       hv_info-&gt;<a class="code" href="structHV__INFO.html#a95fca973c2f8312e960cd4bb52963058">update_threshold</a>, NULL, NULL);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593    <span class="comment">/* Update threshold current */</span>
<a name="l00594"></a>00594    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Update Threshold Current&quot;</span>, 1, <a class="code" href="group__err26.html#gaf447cadf8b96a84e466e576c4248588f">CMD_GET_THRESHOLD_CURRENT</a>, 
<a name="l00595"></a>00595                       hv_info-&gt;<a class="code" href="structHV__INFO.html#a3cec5d42540d9e8264b083e85c4a3bf2">update_threshold_current</a>, NULL, NULL);
<a name="l00596"></a>00596 
<a name="l00597"></a>00597    <span class="comment">/* Zero threshold */</span>
<a name="l00598"></a>00598    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Zero Threshold&quot;</span>, 20, <a class="code" href="group__err26.html#gaea8b0116d495be466ccec4983e057c80">CMD_GET_THRESHOLD_ZERO</a>, 
<a name="l00599"></a>00599                       hv_info-&gt;<a class="code" href="structHV__INFO.html#a4696558233da1263e01e8971a01923e0">zero_threshold</a>, NULL, NULL);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601    <span class="comment">/* Voltage limit */</span>
<a name="l00602"></a>00602    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Voltage Limit&quot;</span>, 3000, <a class="code" href="group__err26.html#ga7202bbec592221c9cb28fbf4e7f4a65e">CMD_GET_VOLTAGE_LIMIT</a>, 
<a name="l00603"></a>00603                       hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>, <a class="code" href="hv_8c.html#ae3c91ed41bc6b7f2182adfcd5549f710">hv_set_voltage_limit</a>, pequipment);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605    <span class="comment">/* Current limit */</span>
<a name="l00606"></a>00606    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Current Limit&quot;</span>, 3000, <a class="code" href="group__err26.html#ga3e10107388c1ca0db3c4518f7f671bda">CMD_GET_CURRENT_LIMIT</a>, 
<a name="l00607"></a>00607                       hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a>, <a class="code" href="hv_8c.html#aad24ee51a854f8e3d655e11f1b87ad1a">hv_set_current_limit</a>, pequipment);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609    <span class="comment">/* Trip Time */</span>
<a name="l00610"></a>00610    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Trip Time&quot;</span>, 10, <a class="code" href="group__err26.html#ga6556f17b00a7c75ce492cf0664fcad15">CMD_GET_TRIP_TIME</a>, 
<a name="l00611"></a>00611                       hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a>, <a class="code" href="hv_8c.html#a3191cdab3dab02398919e46fbc289b82">hv_set_trip_time</a>, pequipment);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613    <span class="comment">/* Ramp up */</span>
<a name="l00614"></a>00614    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Ramp Up Speed&quot;</span>, 0, <a class="code" href="group__err26.html#gaf7240072ae61d012e70aca676ab00492">CMD_GET_RAMPUP</a>, 
<a name="l00615"></a>00615                       hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>, <a class="code" href="hv_8c.html#a6c2c1ccdfbcf710a0a81249710b72cc4">hv_set_rampup</a>, pequipment);
<a name="l00616"></a>00616 
<a name="l00617"></a>00617    <span class="comment">/* Ramp down */</span>
<a name="l00618"></a>00618    <a class="code" href="hv_8c.html#ac42d4bdc1a509e87ead709972da88ea9">validate_odb_array</a>(hDB, hv_info, <span class="stringliteral">&quot;Settings/Ramp Down Speed&quot;</span>, 0, <a class="code" href="group__err26.html#ga44aa2c303f8f03a0b6f7ed9adeb6c58f">CMD_GET_RAMPDOWN</a>, 
<a name="l00619"></a>00619                       hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>, <a class="code" href="hv_8c.html#a035e3d5e825a2e7537549cbc9133957c">hv_set_rampdown</a>, pequipment);
<a name="l00620"></a>00620 
<a name="l00621"></a>00621    <span class="comment">/*---- Create/Read variables ----*/</span>
<a name="l00622"></a>00622 
<a name="l00623"></a>00623    <span class="comment">/* Demand */</span>
<a name="l00624"></a>00624    db_merge_data(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Variables/Demand&quot;</span>,
<a name="l00625"></a>00625                  hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00626"></a>00626                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00627"></a>00627    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Variables/Demand&quot;</span>, &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a24238bcc73ad7722de5fc4106312d768">hKeyDemand</a>);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629    <span class="comment">/* Measured */</span>
<a name="l00630"></a>00630    db_merge_data(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Variables/Measured&quot;</span>,
<a name="l00631"></a>00631                  hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00632"></a>00632                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00633"></a>00633    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Variables/Measured&quot;</span>, &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#af2b905a3cef2dab26cd394b462c88707">hKeyMeasured</a>);
<a name="l00634"></a>00634    memcpy(hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>,
<a name="l00635"></a>00635           hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00636"></a>00636 
<a name="l00637"></a>00637    <span class="comment">/* Current */</span>
<a name="l00638"></a>00638    db_merge_data(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Variables/Current&quot;</span>,
<a name="l00639"></a>00639                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00640"></a>00640                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00641"></a>00641    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Variables/Current&quot;</span>, &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a46e402f65ea500e884faa91002204bf1">hKeyCurrent</a>);
<a name="l00642"></a>00642    memcpy(hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>,
<a name="l00643"></a>00643           hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l00644"></a>00644 
<a name="l00645"></a>00645    <span class="comment">/*---- set labels form midas SC names ----*/</span>
<a name="l00646"></a>00646    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++) {
<a name="l00647"></a>00647       status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gaa0706cd66be2ae6e198adc217c2ad9bf">CMD_SET_LABEL</a>, 
<a name="l00648"></a>00648                              i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#abb11a3d3bd69af64d9fef6b3bfa4a89c">names</a> + <a class="code" href="group__midasincludecode.html#gaf71324c57f05ff9e24bd384925dd6b17">NAME_LENGTH</a> * i);
<a name="l00649"></a>00649    }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651    <span class="comment">/*---- set/get values ----*/</span>
<a name="l00652"></a>00652    <span class="keywordflow">for</span> (i = 0; i &lt; hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>; i++) {
<a name="l00653"></a>00653       <span class="keywordflow">if</span> ((hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga14cf699d29a6edd2088b83e17cda6744">DF_PRIO_DEVICE</a>) == 0) {
<a name="l00654"></a>00654          hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] = <a class="code" href="group__mmacroh.html#ga3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>[i]);
<a name="l00655"></a>00655          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gabb268d264836b9443ef23350814c0f68">CMD_SET</a>, 
<a name="l00656"></a>00656                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i]);
<a name="l00657"></a>00657          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga777213a0f7da75a6faf4ca53623a80c6">CMD_SET_TRIP_TIME</a>,
<a name="l00658"></a>00658                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a>[i]);
<a name="l00659"></a>00659          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga3f2bdc89e0bd028b914d2a4caf0c5736">CMD_SET_CURRENT_LIMIT</a>,
<a name="l00660"></a>00660                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a>[i]);
<a name="l00661"></a>00661          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga847a3b931dbb2facfceca2ff1e5be9a5">CMD_SET_VOLTAGE_LIMIT</a>,
<a name="l00662"></a>00662                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>[i]);
<a name="l00663"></a>00663          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gaf8be6c837a47b6de4d00bdd64db319cd">CMD_SET_RAMPUP</a>,
<a name="l00664"></a>00664                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>[i]);
<a name="l00665"></a>00665          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gafbd1844707a6b9a25d40ef1848ce750f">CMD_SET_RAMPDOWN</a>,
<a name="l00666"></a>00666                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i]);
<a name="l00667"></a>00667       } <span class="keywordflow">else</span> {
<a name="l00668"></a>00668          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga24de488cd06cc543d6030027ca206a10">CMD_GET_DEMAND</a>,
<a name="l00669"></a>00669                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a> + i);
<a name="l00670"></a>00670          hv_info-&gt;<a class="code" href="structHV__INFO.html#ac49b673d5b0ad29adeb87f6bd97946c0">demand_mirror</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>[i];
<a name="l00671"></a>00671 
<a name="l00672"></a>00672          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga6556f17b00a7c75ce492cf0664fcad15">CMD_GET_TRIP_TIME</a>,
<a name="l00673"></a>00673                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a>[i]);
<a name="l00674"></a>00674          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga3e10107388c1ca0db3c4518f7f671bda">CMD_GET_CURRENT_LIMIT</a>,
<a name="l00675"></a>00675                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a>[i]);
<a name="l00676"></a>00676          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga7202bbec592221c9cb28fbf4e7f4a65e">CMD_GET_VOLTAGE_LIMIT</a>,
<a name="l00677"></a>00677                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>[i]);
<a name="l00678"></a>00678          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#gaf7240072ae61d012e70aca676ab00492">CMD_GET_RAMPUP</a>,
<a name="l00679"></a>00679                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>[i]);
<a name="l00680"></a>00680          status = <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i], <a class="code" href="group__err26.html#ga44aa2c303f8f03a0b6f7ed9adeb6c58f">CMD_GET_RAMPDOWN</a>,
<a name="l00681"></a>00681                                 i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>[i]);
<a name="l00682"></a>00682       }
<a name="l00683"></a>00683    }
<a name="l00684"></a>00684    <a class="code" href="group__odbfunctionc.html#ga1e4bca66d45d069477c614bc2481d89f">db_set_record</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a24238bcc73ad7722de5fc4106312d768">hKeyDemand</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>,
<a name="l00685"></a>00685                  hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 0);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Trip Time&quot;</span>, &amp;hKey);
<a name="l00688"></a>00688    <a class="code" href="group__odbfunctionc.html#ga1e4bca66d45d069477c614bc2481d89f">db_set_record</a>(hDB, hKey, hv_info-&gt;<a class="code" href="structHV__INFO.html#a399d84bfe53e9ebf05376371258bf076">trip_time</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 0);
<a name="l00689"></a>00689    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Current Limit&quot;</span>, &amp;hKey);
<a name="l00690"></a>00690    <a class="code" href="group__odbfunctionc.html#ga1e4bca66d45d069477c614bc2481d89f">db_set_record</a>(hDB, hKey, hv_info-&gt;<a class="code" href="structHV__INFO.html#ae416bc95f379ab67836cdf923ab5e3b6">current_limit</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 0);
<a name="l00691"></a>00691    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Voltage Limit&quot;</span>, &amp;hKey);
<a name="l00692"></a>00692    <a class="code" href="group__odbfunctionc.html#ga1e4bca66d45d069477c614bc2481d89f">db_set_record</a>(hDB, hKey, hv_info-&gt;<a class="code" href="structHV__INFO.html#a98357ca25873d9cf7f0df5fd94cf4df2">voltage_limit</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 0);
<a name="l00693"></a>00693    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Ramp Up Speed&quot;</span>, &amp;hKey);
<a name="l00694"></a>00694    <a class="code" href="group__odbfunctionc.html#ga1e4bca66d45d069477c614bc2481d89f">db_set_record</a>(hDB, hKey, hv_info-&gt;<a class="code" href="structHV__INFO.html#a582f1fa8277448a56a6bff022655f220">rampup_speed</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 0);
<a name="l00695"></a>00695    <a class="code" href="group__odbfunctionc.html#ga321df44195a9cbc83dbf10e32e32fd5b">db_find_key</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a55accfbc1288db4424698175696d50ac">hKeyRoot</a>, <span class="stringliteral">&quot;Settings/Ramp Down Speed&quot;</span>, &amp;hKey);
<a name="l00696"></a>00696    <a class="code" href="group__odbfunctionc.html#ga1e4bca66d45d069477c614bc2481d89f">db_set_record</a>(hDB, hKey, hv_info-&gt;<a class="code" href="structHV__INFO.html#ac662201b0d4ab12fa2603e8cf9a98d64">rampdown_speed</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), 0);
<a name="l00697"></a>00697 
<a name="l00698"></a>00698    <span class="comment">/*--- open hotlink to HV demand values ----*/</span>
<a name="l00699"></a>00699    <a class="code" href="group__odbfunctionc.html#ga852bc9fa8ee4d0884b328aeb0b0cfd63">db_open_record</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a24238bcc73ad7722de5fc4106312d768">hKeyDemand</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>,
<a name="l00700"></a>00700                   hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>), <a class="code" href="group__mdefineh.html#gac4d1baf108e9ce6414088db508d7c182">MODE_READ</a>, <a class="code" href="hv_8c.html#a1972c5d2a46d25f2fa81e42d6fcbac1c">hv_demand</a>,
<a name="l00701"></a>00701                   pequipment);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    <span class="comment">/* initially read all channels */</span>
<a name="l00704"></a>00704    <span class="keywordflow">for</span> (i=0 ; i&lt;hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a> ; i++) {
<a name="l00705"></a>00705 
<a name="l00706"></a>00706       hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#adfdb7ee99dd506e35f65d3f8d4b41a4b">dd</a>(<a class="code" href="group__err26.html#ga39f82f93564bba7925fd849ce7967a2b">CMD_GET</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#a334e4f80981fd4d70bb6ebea2fe3e911">dd_info</a>, 
<a name="l00707"></a>00707                              i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i]);
<a name="l00708"></a>00708       hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#adfdb7ee99dd506e35f65d3f8d4b41a4b">dd</a>(<a class="code" href="group__err26.html#ga3578ee798d04c6279a03f61fe70079e0">CMD_GET_CURRENT</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[i]-&gt;<a class="code" href="structDEVICE__DRIVER.html#a334e4f80981fd4d70bb6ebea2fe3e911">dd_info</a>, 
<a name="l00709"></a>00709                              i - hv_info-&gt;<a class="code" href="structHV__INFO.html#a2ee4d6a9ac2b672a8f9198abb3233c51">channel_offset</a>[i], &amp;hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i]);
<a name="l00710"></a>00710 
<a name="l00711"></a>00711       hv_info-&gt;<a class="code" href="structHV__INFO.html#a2e8b64d058496b0316464c89f7bacaa4">measured_mirror</a>[i] = hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>[i];
<a name="l00712"></a>00712       hv_info-&gt;<a class="code" href="structHV__INFO.html#a62b97138272e788fa8705300a07b469e">current_mirror</a>[i]  = hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>[i];
<a name="l00713"></a>00713    }
<a name="l00714"></a>00714    <a class="code" href="group__odbfunctionc.html#gaa3f93c5321c56ad5a5200d17958e9bb3">db_set_data</a>(hDB, hv_info-&gt;<a class="code" href="structHV__INFO.html#a46e402f65ea500e884faa91002204bf1">hKeyCurrent</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>,
<a name="l00715"></a>00715                <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>, hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>,
<a name="l00716"></a>00716                <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>);
<a name="l00717"></a>00717    pequipment-&gt;<a class="code" href="structeqpmnt.html#a2ba622da82fc7a02605e5f630464b13f">odb_out</a>++;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00720"></a>00720 }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00723"></a>00723 
<a name="l00724"></a><a class="code" href="hv_8c.html#ac206528c83f8db2bd36c4d8c52ee0596">00724</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#ac206528c83f8db2bd36c4d8c52ee0596">hv_exit</a>(<a class="code" href="structeqpmnt.html">EQUIPMENT</a> * pequipment)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> i;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <a class="code" href="hv_8c.html#a85cbcc39927a7a621dfe3b417ac6c0cb">free_mem</a>((<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730    <span class="comment">/* call exit method of device drivers */</span>
<a name="l00731"></a>00731    <span class="keywordflow">for</span> (i = 0; pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i].<a class="code" href="structDEVICE__DRIVER.html#adfdb7ee99dd506e35f65d3f8d4b41a4b">dd</a> != NULL; i++)
<a name="l00732"></a>00732       <a class="code" href="group__mequipment.html#gab0636870de45a7b8a7bcb625c0ac7582">device_driver</a>(&amp;pequipment-&gt;<a class="code" href="structeqpmnt.html#af19c464fc7092048c9418328ca4e4afc">driver</a>[i], <a class="code" href="group__err26.html#gacfa1d482ab47b3ceebb9717007111649">CMD_EXIT</a>);
<a name="l00733"></a>00733 
<a name="l00734"></a>00734    <span class="keywordflow">return</span> <a class="code" href="group__err26.html#ga23395a243c74edd61ed4ce0df1256419">FE_SUCCESS</a>;
<a name="l00735"></a>00735 }
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00738"></a>00738 
<a name="l00739"></a><a class="code" href="hv_8c.html#aaa369e2228fc887094ab22aa51c1b68f">00739</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#aaa369e2228fc887094ab22aa51c1b68f">hv_idle</a>(<a class="code" href="structeqpmnt.html">EQUIPMENT</a> * pequipment)
<a name="l00740"></a>00740 {
<a name="l00741"></a>00741    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> act, status;
<a name="l00742"></a>00742    <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> act_time;
<a name="l00743"></a>00743    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747    <span class="comment">/* do ramping */</span>
<a name="l00748"></a>00748    <a class="code" href="hv_8c.html#af87c3c364f95d9ef5dd7bf0602c1b7bd">hv_ramp</a>(hv_info);
<a name="l00749"></a>00749 
<a name="l00750"></a>00750    <span class="comment">/* select next measurement channel */</span>
<a name="l00751"></a>00751    hv_info-&gt;<a class="code" href="structHV__INFO.html#a2c2b5ebfbef1fd3741bbbbc204682a17">last_channel</a> = (hv_info-&gt;<a class="code" href="structHV__INFO.html#a2c2b5ebfbef1fd3741bbbbc204682a17">last_channel</a> + 1) % hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753    <span class="comment">/* measure channel */</span>
<a name="l00754"></a>00754    status = <a class="code" href="hv_8c.html#adf53cc684488e64813243dafb3649712">hv_read</a>(pequipment, hv_info-&gt;<a class="code" href="structHV__INFO.html#a2c2b5ebfbef1fd3741bbbbc204682a17">last_channel</a>);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756    <span class="comment">/* additionally read channel recently updated if not multithreaded */</span>
<a name="l00757"></a>00757    <span class="keywordflow">if</span> (!(hv_info-&gt;<a class="code" href="structHV__INFO.html#a06621eb6098d0cceb57de1a61a29e25c">driver</a>[hv_info-&gt;<a class="code" href="structHV__INFO.html#a2c2b5ebfbef1fd3741bbbbc204682a17">last_channel</a>]-&gt;<a class="code" href="structDEVICE__DRIVER.html#ac40f8fcceded9b51b8a772a66f874087">flags</a> &amp; <a class="code" href="group__mequipment.html#ga2499f0abd1f0577de72d1d5645fc7713">DF_MULTITHREAD</a>)) {
<a name="l00758"></a>00758 
<a name="l00759"></a>00759       act_time = <a class="code" href="group__msfunctionc.html#ga999b383482224a5a6c4f5974d2625717">ss_millitime</a>();
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       act = (hv_info-&gt;<a class="code" href="structHV__INFO.html#a4e75f06fff4493c516a8376bdbb18465">last_channel_updated</a> + 1) % hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00762"></a>00762       while (!(act_time - hv_info-&gt;<a class="code" href="structHV__INFO.html#ace1b6ddf8f8c685313bc16796e606f81">last_change</a>[act] &lt; 10000)) {
<a name="l00763"></a>00763          act = (act + 1) % hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00764"></a>00764          if (act == hv_info-&gt;<a class="code" href="structHV__INFO.html#a4e75f06fff4493c516a8376bdbb18465">last_channel_updated</a>) {
<a name="l00765"></a>00765             <span class="comment">/* non found, so return */</span>
<a name="l00766"></a>00766             <span class="keywordflow">return</span> status;
<a name="l00767"></a>00767          }
<a name="l00768"></a>00768       }
<a name="l00769"></a>00769 
<a name="l00770"></a>00770       <span class="comment">/* updated channel found, so read it additionally */</span>
<a name="l00771"></a>00771       status = <a class="code" href="hv_8c.html#adf53cc684488e64813243dafb3649712">hv_read</a>(pequipment, act);
<a name="l00772"></a>00772       hv_info-&gt;<a class="code" href="structHV__INFO.html#a4e75f06fff4493c516a8376bdbb18465">last_channel_updated</a> = act;
<a name="l00773"></a>00773    }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775    <span class="keywordflow">return</span> status;
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00779"></a>00779 
<a name="l00780"></a><a class="code" href="hv_8c.html#aa5383a81945ebd5e43ca55dcd4d6b07b">00780</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#aa5383a81945ebd5e43ca55dcd4d6b07b">cd_hv_read</a>(<span class="keywordtype">char</span> *pevent, <span class="keywordtype">int</span> offset)
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782    <span class="keywordtype">float</span> *pdata;
<a name="l00783"></a>00783    <a class="code" href="structHV__INFO.html">HV_INFO</a> *hv_info;
<a name="l00784"></a>00784    <a class="code" href="structeqpmnt.html">EQUIPMENT</a> *pequipment;
<a name="l00785"></a>00785 <span class="preprocessor">#ifdef HAVE_YBOS</span>
<a name="l00786"></a>00786 <span class="preprocessor"></span>   <a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *pdw;
<a name="l00787"></a>00787 <span class="preprocessor">#endif</span>
<a name="l00788"></a>00788 <span class="preprocessor"></span>
<a name="l00789"></a>00789    pequipment = *((<a class="code" href="structeqpmnt.html">EQUIPMENT</a> **) pevent);
<a name="l00790"></a>00790    hv_info = (<a class="code" href="structHV__INFO.html">HV_INFO</a> *) pequipment-&gt;<a class="code" href="structeqpmnt.html#ac88537c1672f32d13a99ce6822fc4d46">cd_info</a>;
<a name="l00791"></a>00791 
<a name="l00792"></a>00792    if (hv_info-&gt;<a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">format</a> == <a class="code" href="group__mdefineh.html#ga44835dd4c169e13e0fedf8c01a54dc2b">FORMAT_FIXED</a>) {
<a name="l00793"></a>00793       memcpy(pevent, hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00794"></a>00794       pevent += <span class="keyword">sizeof</span>(float) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796       memcpy(pevent, hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00797"></a>00797       pevent += <span class="keyword">sizeof</span>(float) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799       memcpy(pevent, hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00800"></a>00800       pevent += <span class="keyword">sizeof</span>(float) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802       <span class="keywordflow">return</span> 3 * <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00803"></a>00803    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">format</a> == <a class="code" href="group__mdefineh.html#gac7ef5b0cbb1fc1d26c3bfd4cc4a191a9">FORMAT_MIDAS</a>) {
<a name="l00804"></a>00804       <a class="code" href="group__bkfunctionc.html#gac6fadde40824dbf7bd70abedd29be2bd">bk_init</a>(pevent);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806       <span class="comment">/* create DMND bank */</span>
<a name="l00807"></a>00807       <a class="code" href="group__bkfunctionc.html#ga4bb781187e18834136ed8ac368d53413">bk_create</a>(pevent, <span class="stringliteral">&quot;DMND&quot;</span>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, &amp;pdata);
<a name="l00808"></a>00808       memcpy(pdata, hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00809"></a>00809       pdata += hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00810"></a>00810       <a class="code" href="group__bkfunctionc.html#ga132dc71c8f74b478cdcc59bc1d9f6a26">bk_close</a>(pevent, pdata);
<a name="l00811"></a>00811 
<a name="l00812"></a>00812       <span class="comment">/* create MSRD bank */</span>
<a name="l00813"></a>00813       <a class="code" href="group__bkfunctionc.html#ga4bb781187e18834136ed8ac368d53413">bk_create</a>(pevent, <span class="stringliteral">&quot;MSRD&quot;</span>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, &amp;pdata);
<a name="l00814"></a>00814       memcpy(pdata, hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00815"></a>00815       pdata += hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00816"></a>00816       <a class="code" href="group__bkfunctionc.html#ga132dc71c8f74b478cdcc59bc1d9f6a26">bk_close</a>(pevent, pdata);
<a name="l00817"></a>00817 
<a name="l00818"></a>00818       <span class="comment">/* create CRNT bank */</span>
<a name="l00819"></a>00819       <a class="code" href="group__bkfunctionc.html#ga4bb781187e18834136ed8ac368d53413">bk_create</a>(pevent, <span class="stringliteral">&quot;CRNT&quot;</span>, <a class="code" href="group__mdefineh.html#gae932ec1b283f6c4b9c30a6d489beea7f">TID_FLOAT</a>, &amp;pdata);
<a name="l00820"></a>00820       memcpy(pdata, hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00821"></a>00821       pdata += hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00822"></a>00822       <a class="code" href="group__bkfunctionc.html#ga132dc71c8f74b478cdcc59bc1d9f6a26">bk_close</a>(pevent, pdata);
<a name="l00823"></a>00823 
<a name="l00824"></a>00824       <span class="keywordflow">return</span> <a class="code" href="group__bkfunctionc.html#ga8fc93de36e62c4328cb6581be7f42a0f">bk_size</a>(pevent);
<a name="l00825"></a>00825    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hv_info-&gt;<a class="code" href="structHV__INFO.html#a04325175603b708132a47b04d699b1a8">format</a> == <a class="code" href="group__mdefineh.html#gaab9657af955d54be6cd05e0a726ad964">FORMAT_YBOS</a>) {
<a name="l00826"></a>00826 <span class="preprocessor">#ifdef HAVE_YBOS</span>
<a name="l00827"></a>00827 <span class="preprocessor"></span>      ybk_init((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829       <span class="comment">/* create EVID bank */</span>
<a name="l00830"></a>00830       ybk_create((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, <span class="stringliteral">&quot;EVID&quot;</span>, I4_BKTYPE, (<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) (&amp;pdw));
<a name="l00831"></a>00831       *(pdw)++ = <a class="code" href="group__mbufferh.html#gaf42c9a1ac33cf459bfd366673f6a4d70">EVENT_ID</a>(pevent);      <span class="comment">/* Event_ID + Mask */</span>
<a name="l00832"></a>00832       *(pdw)++ = <a class="code" href="group__mbufferh.html#gadbb75a9d81e264e357bc5fc73dd4ebb8">SERIAL_NUMBER</a>(pevent); <span class="comment">/* Serial number */</span>
<a name="l00833"></a>00833       *(pdw)++ = <a class="code" href="group__mbufferh.html#gae8d2f03c283637c81cdcfd3fda065d53">TIME_STAMP</a>(pevent);    <span class="comment">/* Time Stamp */</span>
<a name="l00834"></a>00834       ybk_close((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, pdw);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836       <span class="comment">/* create DMND bank */</span>
<a name="l00837"></a>00837       ybk_create((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, <span class="stringliteral">&quot;DMND&quot;</span>, F4_BKTYPE, (<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) &amp; pdata);
<a name="l00838"></a>00838       memcpy(pdata, hv_info-&gt;<a class="code" href="structHV__INFO.html#ac2f4df0be0ef80b9448fa003cf3c00a5">demand</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00839"></a>00839       pdata += hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00840"></a>00840       ybk_close((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, pdata);
<a name="l00841"></a>00841 
<a name="l00842"></a>00842       <span class="comment">/* create MSRD bank */</span>
<a name="l00843"></a>00843       ybk_create((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, <span class="stringliteral">&quot;MSRD&quot;</span>, F4_BKTYPE, (<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) &amp; pdata);
<a name="l00844"></a>00844       memcpy(pdata, hv_info-&gt;<a class="code" href="structHV__INFO.html#a13349cbb396a9eb7bc736c33f42b2288">measured</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00845"></a>00845       pdata += hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00846"></a>00846       ybk_close((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, pdata);
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       <span class="comment">/* create CRNT bank */</span>
<a name="l00849"></a>00849       ybk_create((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, <span class="stringliteral">&quot;CRNT&quot;</span>, F4_BKTYPE, (<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) &amp; pdata);
<a name="l00850"></a>00850       memcpy(pdata, hv_info-&gt;<a class="code" href="structHV__INFO.html#aed0c3771d4b42de6ab316500e40eb09d">current</a>, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>);
<a name="l00851"></a>00851       pdata += hv_info-&gt;<a class="code" href="structHV__INFO.html#aeb36315d8c77519e4e855a32174fb190">num_channels</a>;
<a name="l00852"></a>00852       ybk_close((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent, pdata);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854       <span class="keywordflow">return</span> ybk_size((<a class="code" href="sis3801_8h.html#a408a2366473807fbe658ba18e75dea66">DWORD</a> *) pevent);
<a name="l00855"></a>00855 <span class="preprocessor">#else</span>
<a name="l00856"></a>00856 <span class="preprocessor"></span>      assert(!<span class="stringliteral">&quot;YBOS support not compiled in&quot;</span>);
<a name="l00857"></a>00857 <span class="preprocessor">#endif</span>
<a name="l00858"></a>00858 <span class="preprocessor"></span>   }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860    <span class="keywordflow">return</span> 0;
<a name="l00861"></a>00861 }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="comment">/*------------------------------------------------------------------*/</span>
<a name="l00864"></a>00864 
<a name="l00865"></a><a class="code" href="hv_8c.html#af6fe77dbe946ebf6e925982d50d0db3c">00865</a> <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> <a class="code" href="hv_8c.html#af6fe77dbe946ebf6e925982d50d0db3c">cd_hv</a>(<a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> cmd, <a class="code" href="structeqpmnt.html">PEQUIPMENT</a> pequipment)
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867    <a class="code" href="sis3803_8h.html#a09fddde158a3a20bd2dcadb609de11dc">INT</a> status;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869    <span class="keywordflow">switch</span> (cmd) {
<a name="l00870"></a>00870    <span class="keywordflow">case</span> <a class="code" href="group__err26.html#ga2677fc43f8393bcf3bafc8bbface003f">CMD_INIT</a>:
<a name="l00871"></a>00871       status = <a class="code" href="hv_8c.html#ad9b5d26722c8f5bd4dd77951bfdb7f36">hv_init</a>(pequipment);
<a name="l00872"></a>00872       <span class="keywordflow">break</span>;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874    <span class="keywordflow">case</span> <a class="code" href="group__err26.html#gacfa1d482ab47b3ceebb9717007111649">CMD_EXIT</a>:
<a name="l00875"></a>00875       status = <a class="code" href="hv_8c.html#ac206528c83f8db2bd36c4d8c52ee0596">hv_exit</a>(pequipment);
<a name="l00876"></a>00876       <span class="keywordflow">break</span>;
<a name="l00877"></a>00877 
<a name="l00878"></a>00878    <span class="keywordflow">case</span> <a class="code" href="group__err26.html#gab905e6aff2332984df0552c6b50203f2">CMD_START</a>:
<a name="l00879"></a>00879       status = <a class="code" href="hv_8c.html#aa65c35bd0a67b97f157e6cf96f8da0c2">hv_start</a>(pequipment);
<a name="l00880"></a>00880       <span class="keywordflow">break</span>;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882    <span class="keywordflow">case</span> <a class="code" href="group__err26.html#ga46dc7ae84992bfe62cc00731959a67f4">CMD_STOP</a>:
<a name="l00883"></a>00883       status = <a class="code" href="hv_8c.html#a436026ab3058e095a1c65188b29106a4">hv_stop</a>(pequipment);
<a name="l00884"></a>00884       <span class="keywordflow">break</span>;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886    <span class="keywordflow">case</span> <a class="code" href="group__err26.html#ga433697a25587c6ffe8a14f02e5be9066">CMD_IDLE</a>:
<a name="l00887"></a>00887       status = <a class="code" href="hv_8c.html#aaa369e2228fc887094ab22aa51c1b68f">hv_idle</a>(pequipment);
<a name="l00888"></a>00888       <span class="keywordflow">break</span>;
<a name="l00889"></a>00889 
<a name="l00890"></a>00890    <span class="keywordflow">default</span>:
<a name="l00891"></a>00891       <a class="code" href="group__msgfunctionc.html#gaac032ca2438c47466bfc9722de6746ea">cm_msg</a>(<a class="code" href="group__mdefineh.html#gac2d967025ca0f84f611d568f4ede934a">MERROR</a>, <span class="stringliteral">&quot;HV class driver&quot;</span>, <span class="stringliteral">&quot;Received unknown command %d&quot;</span>, cmd);
<a name="l00892"></a>00892       status = <a class="code" href="group__err26.html#gac4221d7e494c798f57552f502e2459ef">FE_ERR_DRIVER</a>;
<a name="l00893"></a>00893       <span class="keywordflow">break</span>;
<a name="l00894"></a>00894    }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896    <span class="keywordflow">return</span> status;
<a name="l00897"></a>00897 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

