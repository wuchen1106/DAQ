<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: SECTION 6: Frontend Operation</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="FrontendOperation">SECTION 6: Frontend Operation </a></h1><p><br/>
  
<script type="text/javascript">
pages(  "RC_Hot_Link","FrontendOperation", "FE_ODB_equipment_tree","FrontendOperation","end" ); // back index next {top bottom}
sections("RunControl","FrontendOperation","DataAnalysis"); // last section; top of this section; next section
</script>
<p><br/>
</p>
<h2><a class="anchor" id="FE_Intro">
Introduction</a></h2>
<p>The <b>terms</b> that are needed for a discussion of the frontend will be introduced here. The features of a typical frontend program will then be explained by reference to some of the examples included with the MIDAS package. <br/>
</p>
<h3><a class="anchor" id="FE_program">
Frontend Program</a></h3>
<p>A "frontend program" refers to a <a class="el" href="FrontendOperation.html#FE_frontend_utility">frontend - MIDAS Frontend application</a> running on a particular computer which has access to hardware equipment in use by the experiment. The frontend program (image) consists of</p>
<ul>
<li>a fixed <em>experiment-independent system framework</em> (<a class="el" href="mfe_8c.html">mfe.c</a>)</li>
<li>a <em>user part</em> (<a class="el" href="frontend_8c.html">frontend.c</a>)</li>
</ul>
<p>A set of templates for the user part is provided in the MIDAS package. The hardware access is only apparent in the user part ( referred to here as <a class="el" href="frontend_8c.html">frontend.c</a>, but the user may select any name). The system framework is contained in the file <a class="el" href="mfe_8c.html">mfe.c</a>, which is part of the MIDAS package. The term "frontend code" in this document usually refers to the user part, since the system framework is fixed. <br/>
</p>
<p>The frontend task, once built, is run as described as follows.</p>
<p><a class="anchor" id="idx_frontend_utility"></a> </p>
<h3><a class="anchor" id="FE_frontend_utility">
frontend  - MIDAS Frontend application</a></h3>
<p>The "frontend" task is built by the user and may have any name the user chooses (e.g. fecamac, fegpib). The purpose of a <a class="el" href="FrontendOperation.html#FE_program">Frontend Program</a> is to collect data from hardware and transmit this information to a central place where data logging and analysis can be performed. This task is achieved with</p>
<ol type="1">
<li>a specific <a class="el" href="Frontend_code.html">Frontend code</a> written by the user describing the sequence of action to acquire the hardware data and</li>
<li>a framework code handling the data flow control, data transmission and run control operation.</li>
</ol>
<p>The framework code (<a class="el" href="mfe_8c.html">mfe.c</a>) has the following arguments:</p>
<ul>
<li><b> Arguments </b><ul>
<li>[-h hostname ] : host name (see <a class="el" href="RC_odbedit_utility.html">odbedit - ODB Editor and run control utility</a>)</li>
<li>[-e exptname ] : experiment name (see <a class="el" href="RC_odbedit_utility.html">odbedit - ODB Editor and run control utility</a>)</li>
<li>[-D ] : Become a Daemon.</li>
<li>[-O ] : Become a Daemon but keep stdout</li>
<li>[-d ] : Used for debugging the frontend</li>
<li>[-i index] : Set frontend index (used with <a class="el" href="FE_Event_Builder.html#FE_mevb_utility">mevb - event builder utility</a> . See also <a class="el" href="FE_Event_Builder.html#FE_principle_eb">Principle of the Event Builder and related frontend fragment</a>).</li>
</ul>
</li>
</ul>
<p>Note that the new argument (-i index) has been introduced to facilitate the multiple frontend configuration operation required for the <a class="el" href="FE_Event_Builder.html">Event Builder Functions</a>.</p>
<ul>
<li><b> Usage </b></li>
</ul>
<p>Start the application as a daemon, using the default host, experiment and port : </p>
<div class="fragment"><pre class="fragment">e.g. fecamac -D
</pre></div><p> Start the application superceding the default host, experiment and port: </p>
<div class="fragment"><pre class="fragment">e.g. fegpib -e exp218 -h isdaq10 -<a class="code" href="sis3803_8c.html#afcb0609a0beab248bb3994a3368bd9ff">p</a> 7077 -D
</pre></div><p><a class="anchor" id="idx_hardware"></a> </p>
<h3><a class="anchor" id="FE_hw_equipment">
Hardware Modules</a></h3>
<p>Examples of hardware modules accessed by the frontend are ADC modules, TDC modules, Scaler modules etc.</p>
<p><a class="anchor" id="idx_hardware_drivers"></a> </p>
<h3><a class="anchor" id="FE_drivers">
Hardware Drivers</a></h3>
<p>The frontend is usually linked to a <b>driver</b> for the particular hardware in use. Dedicated header and library files (drivers) for hardware access to CAMAC, VME, Fastbus, GPIB and RS232 are part of the MIDAS distribution set. Several libraries and drivers exist for the various bus systems. See <a class="el" href="FE_Hardware.html">Supported Hardware: MIDAS driver library</a>.</p>
<p>The drivers are located in the drivers directory of the MIDAS distribution. Some libraries consist only of a header file, others of a C file plus a header file. The file names usually refer to the manufacturer abbreviation followed by the model number of the device. The libraries are continuously expanding to widen MIDAS support.</p>
<p>ESONE standard routines for CAMAC are supplied and permit the re-use of the frontend code among different platforms as well as among different CAMAC hardware interfaces, without modification of the code.</p>
<p><a class="anchor" id="idx_Equipment_software"></a> </p>
<h3><a class="anchor" id="FE_sw_equipment">
Software Equipment</a></h3>
<p>Under MIDAS, hardware equipment from the experiment is structured into software entities also called "Equipments". A software "Equipment" refer to a collection of hardware equipment (devices) that are grouped together for convenience, such as</p>
<ul>
<li>a set of high voltage supplies</li>
<li>one or more crates of digitizing electronics e.g. ADCs and TDCs</li>
<li>a set of scalers <a class="anchor" id="idx_Equipment"></a> <a class="anchor" id="Equipment_definition"></a></li>
</ul>
<p>From a software point of view, we keep this same term, i.e. "Equipment", to refer to the means of collecting the data related to this set of hardware equipment. <br/>
 Thus the term <b>"Equipment"</b> refers to <em> a single or a collection of sub-tasks meant to collect and regroup logical or physical data under a single and uniquely identified event.</em> <br/>
 <a class="anchor" id="Event_definition"></a> An <b>"event"</b> is thus a collection of data sent into the data stream by an "Equipment". <br/>
</p>
<h3><a class="anchor" id="FE_multi">
Multiple Equipments and Frontends</a></h3>
<p>A single frontend may contain several Equipments. For example, an experiment may have a frontend to service crates of ADC, TDC and Scaler modules. The ADC and TDC modules may be grouped together in one Equipment, and the scalers in a second Equipment.</p>
<p>In complex experimental setups, several frontends controlling different sets of hardware equipment may be attached simultaneously to a given experiment, i.e. they share the same Online Database. For example, one frontend might service the VME hardware, while another might service the CAMAC hardware.</p>
<h3><a class="anchor" id="FE_features">
Frontend Features</a></h3>
<p>A typical frontend will:</p>
<ul>
<li>Register the given Equipment list(s) to a specific MIDAS experiment.</li>
<li>Provide the mean of collecting data from the hardware source defined by each Equipment read function.</li>
<li>Gather these data in one of the supported formats (i.e. Fixed format or in MIDAS data bank(s)) for each Equipment.</li>
<li>Send these data banks to the buffer manager either locally or remotely.</li>
<li>Periodically collect statistics of the acquisition task, and send them to the Online Database.</li>
</ul>
<p><a class="anchor" id="idx_data_transfer_optimize"></a> </p>
<h3><a class="anchor" id="FE_data_transfer">
Data transfer from the frontend</a></h3>
<p>The system frontend framework (<a class="el" href="mfe_8c.html">mfe.c</a>) sends events to the buffer manager and optionally a copy to the Online Database (ODB). A "Data cache" in the frontend and on the server side reduces the amount of network operations pushing the transfer speed closer to the physical limit of the network configuration.</p>
<h4><a class="anchor" id="FE_optimize_transfer">
Optimizing data transfer</a></h4>
<p>A frontend's data transfer can be optimized for all kinds of experiments. Those where <b> multiple small events </b> are produced can have the data built into <a class="el" href="FE_Super_Event.html">super-events</a>, by removing the bank headers to reduce the amount of data transferred.</p>
<p>Other frontends that produce <b> very large amounts of data in one bank </b> (too large to be transferred as a single bank), can transmit the data bank as a number of <a class="el" href="FE_eq_event_routines.html#FE_fragmented_event">fragments</a>, which are combined into a single bank by the system code.</p>
<p>An <a class="el" href="FE_Event_Builder.html">event builder</a> mechanism is also available, that can combine events from different into a composite event.</p>
<p><a class="anchor" id="idx_frontend_event_triggers"></a> </p>
<h3><a class="anchor" id="FE_event_trigger">
Frontend event triggers</a></h3>
<p>The <b> data collection </b> in the frontend framework can be <b>triggered</b> by several mechanisms. Currently the frontend supports five different kind of event trigger: </p>
<ul>
<li>
<b> Periodic events: </b> <br/>
 Scheduled event based on a fixed time interval. They can be used to read information such as scaler values, temperatures etc. </li>
<li>
<b> Polled events: </b> <br/>
 Hardware signal read continuously for a certain time period. If the signal is TRUE, the Equipment readout will be triggered. </li>
<li>
<b> Interrupt events: </b> <br/>
 Generated by particular hardware device supporting interrupt mode (e.g. LAM if CAMAC). </li>
<li>
<b> Slow Control events: </b> <br/>
 Special class of events that are used in the slow control system. </li>
<li>
<b> Manual events: </b> <br/>
 Triggered by a remote procedure call (RPC). The web interface provides an extra button for manual triggering by the user. </li>
</ul>
<p><span class="note">Each of these types of trigger can be enabled or activated for a particular experiment's <a class="el" href="RC_Run_States_and_Transitions.html">run state, transition state</a> or a combination of any of them </span>.</p>
<p>Examples such as</p>
<ul>
<li><em> read scaler event <b>only when running</b> </em> or</li>
<li><em> read periodic event if the run state is <b> not paused and on all transitions</b> </em></li>
</ul>
<p>are possible (see <a class="el" href="FE_table.html#FE_tbl_ReadOn">RO_Flags</a> ). <br/>
 A frontend can also cause a transition to be <b>delayed</b> until a particular condition is met (see <a class="el" href="FE_event_notification.html#FE_Deferred_Transition">Deferred Transition</a> ).</p>
<p><a class="anchor" id="idx_event_readout"></a> </p>
<h3><a class="anchor" id="FE_equipment_readout_function">
Event Readout Functions</a></h3>
<p><em>Associated with each Equipment </em>is an <a class="el" href="FE_eq_event_routines.html#FE_readout_routine">readout function</a> which <em> runs when the Equipment is triggered</em>. <br/>
This function performs the actions required at the Equipment trigger, for example reading out the Equipment data and packing it into banks.</p>
<p><a class="anchor" id="idx_Equipment_list"></a> </p>
<h2><a class="anchor" id="FE_Equipment_list">
Equipment List</a></h2>
<p><em>The user section (<a class="el" href="frontend_8c.html">frontend.c</a>) must have an <b>Equipment List</b> for each defined Equipment</em>, organized as a structure definition. One such structure is needed for each of the Equipments defined in the frontend. Each defined Equipment is created in the Online Database when the frontend program first runs.</p>
<p>The specifics of the <a class="el" href="FE_eqdec.html">Equipment List structure</a> is described below.</p>
<ul>
<li><a class="el" href="FE_ODB_equipment_tree.html">The ODB /Equipment tree</a></li>
<li><a class="el" href="FE_eqdec.html">Equipment list for a Frontend</a></li>
<li><a class="el" href="FE_table.html">Explanation of Equipment list parameters</a></li>
<li><a class="el" href="Frontend_code.html">Frontend code</a></li>
</ul>
<p><br/>
  
<script type="text/javascript">
pages(  "RC_Hot_Link","FrontendOperation", "FE_ODB_equipment_tree","FrontendOperation","" ); // back index next {top bottom}
sections("RunControl","FrontendOperation","DataAnalysis"); // last section; top of this section; next section
</script>
<p><br/>
 <a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

