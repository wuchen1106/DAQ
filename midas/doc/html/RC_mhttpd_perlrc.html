<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Midas: Examples of MPET Perlscripts for run control</title>
<link href="midox.css" rel="stylesheet" type="text/css">
<!--
<link href="doxygen.css" rel="stylesheet" type="text/css">
-->
<link href="tabs.css" rel="stylesheet" type="text/css">

<script type="text/javascript"  src="navigation.js">
</script>

</head>

<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">Midas Documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="RunControl.html">SECTION 5: Run Control</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_run_control.html">Run Control Programs</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd.html">mhttpd: the MIDAS Web-based Run Control utility</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_Main_Status_page.html">Main Status Page</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_status_page_features.html">Features of the Main Status Page</a>&nbsp;&raquo&nbsp;<a class="el" href="RC_mhttpd_defining_script_buttons.html">Defining Script Buttons on the main Status Page</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="RC_mhttpd_perlrc">Examples of MPET Perlscripts for run control </a></h1><p><br/>
</p>
 
<script type="text/javascript">
pages( "RC_mhttpd_defining_script_buttons",  "RunControl","RC_mhttpd_Main_Status_page#RC_mhttpd_status_script_buttons", "RC_mhttpd_perlrc",  "end" ); // back index next {top bottom}
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script>
 <a class="anchor" id="idx_script_perlmidas"></a></p>
<p>Part of the run control perlscripts for MPET experiment at TRIUMF (written by Vladimir Rykov) are reproduced below. The script <a class="el" href="RC_mhttpd_perlrc.html#RC_mhttpd_perlrc_script">perlrc.pl</a> calls a script called <a class="el" href="RC_mhttpd_perlrc.html#RC_mhttpd_perlmidas_script">perlmidas.pl</a> to access the ODB.</p>
<p><a class="el" href="RC_mhttpd_perlrc.html#RC_mhttpd_perlmidas_script">perlmidas.pl</a> may be of interest to users who wish to interact with the ODB through scripts.</p>
<h2><a class="anchor" id="RC_mhttpd_perlmidas_script">
perlmidas.pl</a></h2>
<div class="fragment"><pre class="fragment"><span class="preprocessor"># common subroutines</span>
<span class="preprocessor"></span>use strict;
use warnings;
<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>sub MIDAS_env
<span class="preprocessor"># set up proper MIDAS environment...</span>
<span class="preprocessor"></span><span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>{
    our ($MIDAS_HOSTNAME,$MIDAS_EXPERIMENT,$ODB_SUCCESS,$DEBUG);
    our ($CMDFLAG_HOST, $CMDFLAG_EXPT);

    $ODB_SUCCESS=0;

    $MIDAS_HOSTNAME = $ENV{<span class="stringliteral">&quot;MIDAS_SERVER_HOST&quot;</span>};
    <span class="keywordflow">if</span> (defined($MIDAS_HOSTNAME) &amp;&amp;   $MIDAS_HOSTNAME ne <span class="stringliteral">&quot;&quot;</span>)
    {
        $CMDFLAG_HOST = <span class="stringliteral">&quot;-h $MIDAS_HOSTNAME&quot;</span>;
    }
    <span class="keywordflow">else</span>
    {
        $MIDAS_HOSTNAME = <span class="stringliteral">&quot;&quot;</span>;
        $CMDFLAG_HOST = <span class="stringliteral">&quot;&quot;</span>;
    }

    $MIDAS_EXPERIMENT = $ENV{<span class="stringliteral">&quot;MIDAS_EXPT_NAME&quot;</span>};
    <span class="keywordflow">if</span> (defined($MIDAS_EXPERIMENT) &amp;&amp;   $MIDAS_EXPERIMENT ne <span class="stringliteral">&quot;&quot;</span>)
    {
        $CMDFLAG_EXPT = <span class="stringliteral">&quot;-e ${MIDAS_EXPERIMENT}&quot;</span>;
    }
    <span class="keywordflow">else</span>
    {
        $MIDAS_EXPERIMENT = <span class="stringliteral">&quot;&quot;</span>;
        $CMDFLAG_EXPT = <span class="stringliteral">&quot;&quot;</span>;
    }

}


<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>sub MIDAS_sendmsg
<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>{
<span class="preprocessor"># send a message to odb message logger</span>
<span class="preprocessor"></span>    my ($name, $message) =  @_;

    our ($MIDAS_HOSTNAME,$MIDAS_EXPERIMENT,$ODB_SUCCESS,$DEBUG);
    our ($CMDFLAG_HOST, $CMDFLAG_EXPT);
    our ($COMMAND, $ANSWER);

    my $status;
    my $host=<span class="stringliteral">&quot;&quot;</span>;
    my $dquote=<span class="charliteral">&apos;&quot;&apos;</span>;
    my $squote=<span class="stringliteral">&quot;&apos;&quot;</span>;
    my $command=<span class="stringliteral">&quot;${dquote}msg ${name} ${squote}${message}${squote}${dquote}&quot;</span>;
    print <span class="stringliteral">&quot;name=$name, message=$message\n&quot;</span>;
    print <span class="stringliteral">&quot;command is: $command \n&quot;</span>;

    $COMMAND =<span class="stringliteral">&quot;`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c ${command}`&quot;</span>;
    $ANSWER=`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c ${command}`;
    $status=$?;
    chomp $ANSWER;  # strip trailing linefeed
    <span class="keywordflow">if</span>($DEBUG)
    {
        print <span class="stringliteral">&quot;command: $COMMAND\n&quot;</span>;
        print <span class="stringliteral">&quot; answer: $ANSWER\n&quot;</span>;
    }

    <span class="keywordflow">if</span>($status != $ODB_SUCCESS) 
    { # <span class="keyword">this</span> status value is NOT the midas status code
        print <span class="stringliteral">&quot;send_message:  Failure status returned from odb msg (status=$status)\n&quot;</span>;
    }
    <span class="keywordflow">return</span>;
}

sub strip
{
<span class="preprocessor"># removes / from end of string, // becomes /</span>
<span class="preprocessor"></span>    my $string=shift;
    $string=~ (s!<span class="comment">//!/!g);</span>
<span class="comment"></span>    $string=~s!/$!!;
    print <span class="stringliteral">&quot;strip: now \&quot;$string\&quot;\n&quot;</span>;
    <span class="keywordflow">return</span> ($string);
}

sub MIDAS_varset
<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>{
<span class="preprocessor"># set a value of an odb key</span>
<span class="preprocessor"></span>    my ($key, $value) =  @_;

    our ($MIDAS_HOSTNAME,$MIDAS_EXPERIMENT,$ODB_SUCCESS,$DEBUG);
    our ($CMDFLAG_HOST, $CMDFLAG_EXPT);
    our ($COMMAND, $ANSWER);

    my $status;
    my $host=<span class="stringliteral">&quot;&quot;</span>;
    my $dquote=<span class="charliteral">&apos;&quot;&apos;</span>;
    my $squote=<span class="stringliteral">&quot;&apos;&quot;</span>;
    my $command=<span class="stringliteral">&quot;${dquote}set ${squote}${key}${squote} ${squote}${value}${squote}${dquote}&quot;</span>;
    print <span class="stringliteral">&quot;key=$key, new value=${value}\n&quot;</span>;
    print <span class="stringliteral">&quot;command is: $command \n&quot;</span>;

    $COMMAND =<span class="stringliteral">&quot;`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c command`&quot;</span>;
    $ANSWER=`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c $command `;
    $status=$?;
    chomp $ANSWER;  # strip trailing linefeed
    <span class="keywordflow">if</span>($DEBUG)
    {
        print <span class="stringliteral">&quot;command: $COMMAND\n&quot;</span>;
        print <span class="stringliteral">&quot; answer: $ANSWER\n&quot;</span>;
    }

    <span class="keywordflow">if</span>($status != $ODB_SUCCESS) 
    { # <span class="keyword">this</span> status value is NOT the midas status code
        print <span class="stringliteral">&quot;send_message:  Failure status returned from odb msg (status=$status)\n&quot;</span>;
    }
    <span class="keywordflow">return</span>;
}

sub MIDAS_varget
<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>{
<span class="preprocessor"># set a value of an odb key</span>
<span class="preprocessor"></span>    my ($key) =  @_;

    our ($MIDAS_HOSTNAME,$MIDAS_EXPERIMENT,$ODB_SUCCESS,$DEBUG);
    our ($CMDFLAG_HOST, $CMDFLAG_EXPT);
    our ($COMMAND, $ANSWER);

    my $status;
    my $host=<span class="stringliteral">&quot;&quot;</span>;
    my $dquote=<span class="charliteral">&apos;&quot;&apos;</span>;
    my $squote=<span class="stringliteral">&quot;&apos;&quot;</span>;
    my $command=<span class="stringliteral">&quot;${dquote}ls -v ${squote}${key}${squote}${dquote}&quot;</span>;
    print <span class="stringliteral">&quot;key=$key\n&quot;</span>;
    print <span class="stringliteral">&quot;command is: $command \n&quot;</span>;
    
    $COMMAND =<span class="stringliteral">&quot;`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c command`&quot;</span>;
    $ANSWER=`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c $command `;  
    $status=$?;
    chomp $ANSWER;  # strip trailing linefeed
    <span class="keywordflow">if</span>($DEBUG)
    {
        print <span class="stringliteral">&quot;command: $COMMAND\n&quot;</span>;
        print <span class="stringliteral">&quot; answer: $ANSWER\n&quot;</span>;
    }

    <span class="keywordflow">if</span>($status != 0) 
    { # <span class="keyword">this</span> status value is NOT the midas status code
        print <span class="stringliteral">&quot;send_varset  Failure status returned from odb msg (status=$status)\n&quot;</span>;
    }
    <span class="keywordflow">return</span> $ANSWER;
}

sub MIDAS_dirlist
<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>{
<span class="preprocessor"># return a directory list of directory given by odb key</span>
<span class="preprocessor"></span>    my ($key) =  @_;

    our ($MIDAS_HOSTNAME,$MIDAS_EXPERIMENT,$ODB_SUCCESS,$DEBUG);
    our ($CMDFLAG_HOST, $CMDFLAG_EXPT);
    our ($COMMAND, $ANSWER);

    my $status;
    my $host=<span class="stringliteral">&quot;&quot;</span>;
    my $dquote=<span class="charliteral">&apos;&quot;&apos;</span>;
    my $squote=<span class="stringliteral">&quot;&apos;&quot;</span>;
    my $command=<span class="stringliteral">&quot;${dquote}ls ${squote}${key}${squote}${dquote}&quot;</span>;
    print <span class="stringliteral">&quot;key=$key\n&quot;</span>;
    print <span class="stringliteral">&quot;command is: $command \n&quot;</span>;
    
    $COMMAND =<span class="stringliteral">&quot;`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c command`&quot;</span>;
    $ANSWER=`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c $command `;  
    $status=$?;
    chomp $ANSWER;  # strip trailing linefeed
    <span class="keywordflow">if</span>($DEBUG)
    {
        print <span class="stringliteral">&quot;command: $COMMAND\n&quot;</span>;
        print <span class="stringliteral">&quot; answer: $ANSWER\n&quot;</span>;
    }

    <span class="keywordflow">if</span>($status != 0) 
    { # <span class="keyword">this</span> status value is NOT the midas status code
        print <span class="stringliteral">&quot;send_varset  Failure status returned from odb msg (status=$status)\n&quot;</span>;
    }
    <span class="keywordflow">return</span> $ANSWER;
}

sub MIDAS_startrun
<span class="preprocessor">##############################################################</span>
<span class="preprocessor"></span>{
<span class="preprocessor"># start MIDAS run</span>
<span class="preprocessor"></span>    my ($key) =  @_;

    our ($MIDAS_HOSTNAME,$MIDAS_EXPERIMENT,$ODB_SUCCESS,$DEBUG);
    our ($CMDFLAG_HOST, $CMDFLAG_EXPT);
    our ($COMMAND, $ANSWER);

    our ($SCANLOG_FH);

    my $status;
    my $host=<span class="stringliteral">&quot;&quot;</span>;
    my $dquote=<span class="charliteral">&apos;&quot;&apos;</span>;
    my $squote=<span class="stringliteral">&quot;&apos;&quot;</span>;
    my $command=<span class="stringliteral">&quot;${dquote}start now${dquote}&quot;</span>;
    print <span class="stringliteral">&quot;command is: $command \n&quot;</span>;

<span class="preprocessor">    #sleep(10);</span>
<span class="preprocessor"></span>
    $COMMAND =<span class="stringliteral">&quot;`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c ${command}`&quot;</span>;
    $ANSWER=`odb ${CMDFLAG_EXPT} ${CMDFLAG_HOST} -c ${command}`;
    $status=$?;
    chomp $ANSWER;  # strip trailing linefeed
    <span class="keywordflow">if</span>($DEBUG)
    {
        print <span class="stringliteral">&quot;command: $COMMAND\n&quot;</span>;
        print <span class="stringliteral">&quot; answer: $ANSWER\n&quot;</span>;

<span class="preprocessor">        #print $SCANLOG_FH &quot;status: $status\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #print $SCANLOG_FH &quot;command: $COMMAND\n&quot;;</span>
<span class="preprocessor"></span><span class="preprocessor">        #print $SCANLOG_FH &quot; answer: $ANSWER\n&quot;;</span>
<span class="preprocessor"></span>
    }

    <span class="keywordflow">if</span>($status != 0)
    { # <span class="keyword">this</span> status value is NOT the midas status code
        print <span class="stringliteral">&quot;startrun:  Failure status returned from odb msg (status=$status)\n&quot;</span>;
        print $SCANLOG_FH <span class="stringliteral">&quot; answer: $ANSWER\n&quot;</span>;

    }
    <span class="keywordflow">return</span> $ANSWER;
}   
1;
</pre></div><p><br/>
<hr/>
<br/>
</p>
<h2><a class="anchor" id="RC_mhttpd_perlrc_script">
perlrc.pl</a></h2>
<div class="fragment"><pre class="fragment"><span class="preprocessor"> #!/usr/bin/perl</span>
<span class="preprocessor"></span>
<span class="preprocessor">################################################################</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  PerlRC</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  MIDAS piggyback perl script that is exectuted upon completion</span>
<span class="preprocessor"></span><span class="preprocessor">#  of a run. It checks its parameters, modifies the MIDAS variables</span>
<span class="preprocessor"></span><span class="preprocessor">#  as required, and starts a new run. This way it can run through</span>
<span class="preprocessor"></span><span class="preprocessor">#  different DAQ settings. Implemented scans:</span>
<span class="preprocessor"></span><span class="preprocessor">#  1) Scan1D - scans a set of variables from beginning values</span>
<span class="preprocessor"></span><span class="preprocessor">#     to ending values. All valiables are changed simultaneously.</span>
<span class="preprocessor"></span><span class="preprocessor">#  2) Scan2D - scans 2 sets of variables.</span>
<span class="preprocessor"></span><span class="preprocessor">#  3) SettingsSwitch - switches between different settings sets</span>
<span class="preprocessor"></span><span class="preprocessor">#     typically to be used to switch between ion species.</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">#  V. Ryjkov</span>
<span class="preprocessor"></span><span class="preprocessor">#  June 2008</span>
<span class="preprocessor"></span><span class="preprocessor">#</span>
<span class="preprocessor"></span><span class="preprocessor">################################################################</span>
<span class="preprocessor"></span>
require <span class="stringliteral">&quot;/home/mpet/vr/perl/PerlRC/perlmidas.pl&quot;</span>;

our $DEBUG = <span class="keyword">true</span>;
our $PERLSCAN_PREF = <span class="stringliteral">&quot;/PerlRC&quot;</span>;
our $PERLSCAN_CONTROLVARS = $PERLSCAN_PREF . <span class="stringliteral">&quot;/ControlVariables&quot;</span>;
our $PERLSCAN_START = $PERLSCAN_PREF . <span class="stringliteral">&quot;/RunControl/RCActive&quot;</span>;
our $PERLSCAN_NRUNS = $PERLSCAN_PREF . <span class="stringliteral">&quot;/RunControl/RCTotalRuns&quot;</span>;
our $PERLSCAN_CURRUN = $PERLSCAN_PREF . <span class="stringliteral">&quot;/RunControl/RCCurrentRun&quot;</span>;
our $SCANLOG_PATH = <span class="stringliteral">&quot;/data/mpet/PerlRC.log&quot;</span>;
our $SCANLOG_FH;
our $MIDAS_RUNNO = <span class="stringliteral">&quot;/Runinfo/Run number&quot;</span>;
my  $PERLSCAN_SCANTYPE = $PERLSCAN_PREF . <span class="stringliteral">&quot;/RunControl/RCType&quot;</span>;

MIDAS_env();
<span class="preprocessor"># MIDAS_sendmsg(&quot;test&quot;,&quot;run stop&quot;);</span>
<span class="preprocessor"></span>my $ScanStart  =MIDAS_varget($PERLSCAN_START);
my $ScanType   =MIDAS_varget($PERLSCAN_SCANTYPE);
my $NRuns      =MIDAS_varget($PERLSCAN_NRUNS);
my $CurrentRun =MIDAS_varget($PERLSCAN_CURRUN);
my $retval;
my $MIDASrunno;

open(SCANLOG,<span class="stringliteral">&quot;&gt;&gt;${SCANLOG_PATH}&quot;</span>);
$SCANLOG_FH=\*SCANLOG;

<span class="keywordflow">if</span>(scalar(@ARGV)==1 &amp;&amp; $ARGV[0] =~ /start/) {
    MIDAS_varset($PERLSCAN_START,<span class="charliteral">&apos;y&apos;</span>);
    $ScanStart = <span class="stringliteral">&quot;y&quot;</span>;
}
<span class="keywordflow">if</span>(scalar(@ARGV)==1 &amp;&amp; $ARGV[0] =~ /stop/) {
    MIDAS_varset($PERLSCAN_START,<span class="charliteral">&apos;n&apos;</span>);
    $ScanStart = <span class="stringliteral">&quot;n&quot;</span>;
}
<span class="keywordflow">if</span>( $ScanStart eq <span class="stringliteral">&quot;y&quot;</span>) {
    <span class="keywordflow">if</span>( $CurrentRun == 0) {
        print $SCANLOG_FH <span class="stringliteral">&quot;=== NEW PerlRC scan. Scan type is \&quot;${ScanType}\&quot; ===\n&quot;</span>;
        print $SCANLOG_FH <span class="stringliteral">&quot;===    Number of runs in this scan is ${NRuns}    ===\n&quot;</span>;
    }
    <span class="keywordflow">if</span>( $CurrentRun == $NRuns) {
        print $SCANLOG_FH <span class="stringliteral">&quot;=== Finished PerlRC scan ===\n&quot;</span>;
        print $SCANLOG_FH <span class="stringliteral">&quot;============================\n&quot;</span>;
    }
    <span class="keywordflow">if</span>( ++$CurrentRun &lt;= $NRuns ) {
        $MIDASrunno=MIDAS_varget($MIDAS_RUNNO);
        $MIDASrunno++;
        print $SCANLOG_FH <span class="stringliteral">&quot;&lt;Run #${MIDASrunno}&gt; &quot;</span>;
        MIDAS_varset($PERLSCAN_CURRUN,$CurrentRun);
        <span class="keywordflow">for</span> ($ScanType) {
            <span class="keywordflow">if</span>    (/Scan1D/)   {$retval=Scan1D(); }     # <span class="keywordflow">do</span> something
            elsif (/Scan2D/)   {$retval=Scan2D(); }     # <span class="keywordflow">do</span> something <span class="keywordflow">else</span>
            elsif (/TuneSwitch/) {$retval=TuneSwitch(); } # <span class="keywordflow">do</span> something <span class="keywordflow">else</span>
        }
        <span class="keywordflow">if</span>($retval != 0) {
            MIDAS_varset($PERLSCAN_CURRUN,0);
            MIDAS_varset($PERLSCAN_START,<span class="stringliteral">&quot;n&quot;</span>);
            print $SCANLOG_FH <span class="stringliteral">&quot;!!!#### Aborting scan! ####!!!\n&quot;</span>;
        }
        <span class="keywordflow">else</span> {
            sleep(1);
<span class="preprocessor">            #print $SCANLOG_FH &quot;pausing 10 sec...\n&quot;;</span>
<span class="preprocessor"></span>            MIDAS_startrun();
<span class="preprocessor">            #print $SCANLOG_FH &quot;start the run\n&quot;;</span>
<span class="preprocessor"></span>        }
    }
    <span class="keywordflow">else</span> {
        MIDAS_varset($PERLSCAN_CURRUN,0);
        MIDAS_varset($PERLSCAN_START,<span class="stringliteral">&quot;n&quot;</span>);
    }
}
<span class="keywordflow">else</span> {
    <span class="keywordflow">if</span>(scalar(@ARGV)==2 &amp;&amp; $ARGV[0] =~ /tune/) {
        SwitchToTune($ARGV[1]);
    }
}
close(SCANLOG);

sub Scan1D
{

    ............


}    


sub SetControlVar
{
    our $SCANLOG_FH;
    our $PERLSCAN_CONTROLVARS;
    my ($varname,$varvalue)=@_;
    my $retval;
    my $varpath;

<span class="preprocessor">    #print $SCANLOG_FH &quot;variablename: $varname \n&quot;;</span>
<span class="preprocessor"></span>
    $varpath=MIDAS_varget($PERLSCAN_CONTROLVARS . <span class="stringliteral">&quot;/&quot;</span> . $varname);
    <span class="keywordflow">if</span>($varpath =~ /^key (.*) not found/) {
        print $SCANLOG_FH <span class="stringliteral">&quot;! Control variable ${varname}(${1}) is not listed in ${PERLSCAN_CONTROLVARS}\n&quot;</span>;
        <span class="keywordflow">return</span> -4;
    }

    .............
    
    
    val=MIDAS_varset($varpath,$varvalue);
        <span class="keywordflow">if</span>($retval =~ /^key not found/) {<span class="keywordflow">return</span> -5;}
    }
    <span class="keywordflow">return</span> 0;
}

sub SwitchToTune
{
    our $SCANLOG_FH;
    our $PERLSCAN_CONTROLVARS;
    our $PERLSCAN_PREF;
    my $PERLSCAN_TUNEDIR = $PERLSCAN_PREF . <span class="stringliteral">&quot;/Tunes&quot;</span>;
    my ($tunename)=@_;
    my $retval;
    my $varpath;
    my $varval;
    my $cvarname;

    $retval = MIDAS_dirlist($PERLSCAN_TUNEDIR . <span class="stringliteral">&quot;/&quot;</span> . $tunename);
    <span class="keywordflow">if</span>($retval =~ /^key not found/){
        print $SCANLOG_FH <span class="stringliteral">&quot;! Could not locate tune ${tunename} in the tune directory ${PERLSCAN_TUNEDIR}\n&quot;</span>;
        <span class="keywordflow">return</span> -7;
    }
    my @TuneVars=split(/\n/,$retval);
    <span class="keywordflow">foreach</span> (@TuneVars) {
        <span class="keywordflow">if</span> (/^(.+\S)\s{2,}.*/) {
            $cvarname = $1;
            $varval = MIDAS_varget($PERLSCAN_TUNEDIR . <span class="stringliteral">&quot;/&quot;</span> . $tunename . <span class="stringliteral">&quot;/&quot;</span> .$cvarname);
            $retval = SetControlVar($cvarname, $varval);
            <span class="keywordflow">if</span>($retval &lt; 0) {<span class="keywordflow">return</span> $retval;}
        }
        <span class="keywordflow">else</span> {
            print $SCANLOG_FH <span class="stringliteral">&quot;! Cannot decipher tune variable list, offending line: $_\n&quot;</span>;
            <span class="keywordflow">return</span> -8;
        }
        sleep(1);
    }
    <span class="keywordflow">return</span> 0;
}

sub Scan2D
{
   .................
}


sub TuneSwitch
{   
    our  ($PERLSCAN_PREF, $PERLSCAN_START);
    our $SCANLOG_FH;
    my $PERLSCAN_TUNESWITCHDIR = <span class="stringliteral">&quot;/RunControl/TuneSwitch&quot;</span>;
    my $PERLSCAN_TUNESLIST = $PERLSCAN_PREF . $PERLSCAN_TUNESWITCHDIR .  <span class="stringliteral">&quot;/TunesList&quot;</span>;
    my $PERLSCAN_TUNEIDX = $PERLSCAN_PREF . $PERLSCAN_TUNESWITCHDIR .  <span class="stringliteral">&quot;/CurrentTuneIndex&quot;</span>;
    my $PERLSCAN_TUNENAME = $PERLSCAN_PREF . $PERLSCAN_TUNESWITCHDIR .  <span class="stringliteral">&quot;/CurrentTuneName&quot;</span>;

    my $TunesList = MIDAS_varget($PERLSCAN_TUNESLIST);
    my $TuneIdx = MIDAS_varget($PERLSCAN_TUNEIDX);
    my $TuneName = MIDAS_varget($PERLSCAN_TUNENAME);
    
    my @tunes = split(/\s*;\s*/,$TunesList);
    print <span class="stringliteral">&quot;tunes length= &quot;</span>,scalar(@tunes),<span class="stringliteral">&quot;\n&quot;</span>;
    <span class="keywordflow">if</span>( ++$TuneIdx &gt; scalar(@tunes) ) {
            $TuneIdx=1;
    }
    MIDAS_varset($PERLSCAN_TUNEIDX,$TuneIdx);

    $retval=SwitchToTune($tunes[$TuneIdx-1]);
    <span class="keywordflow">if</span>($retval &lt; 0) {<span class="keywordflow">return</span> $retval;}
    MIDAS_varset($PERLSCAN_TUNENAME,$tunes[$TuneIdx-1]);
    print $SCANLOG_FH <span class="stringliteral">&quot;Tune is \&quot;&quot;</span>,$tunes[$TuneIdx-1],<span class="stringliteral">&quot;\&quot;\n&quot;</span>;
    <span class="keywordflow">return</span> 0;
}
</pre></div> 
<script type="text/javascript">                            
pages( "RC_mhttpd_defining_script_buttons",  "RunControl","RC_mhttpd_status_page_features#RC_mhttpd_status_script_buttons", "RC_mhttpd_perlrc",  "" ); // back index next {top bottom}
sections("Features", "RunControl","FrontendOperation"); // last section; top of this section; next section
</script>
 <br/>
 <a class="anchor" id="end"></a> </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<br>
<hr WIDTH="100%">
Midas DOC Version 2.3.0&nbsp;----&nbsp;PSI Stefan Ritt&nbsp;----
<br>
Contributions: Pierre-Andre Amaudruz - Sergio Ballestrero - Suzannah Daviel -
<a href=http://www.stack.nl/~dimitri/doxygen/features.html>Doxygen</a> - Peter Green -
Qing Gu - Greg Hackman - Gertjan Hofman - Paul Knowles - Exaos Lee - Rudi Meier - Glenn
Moloney - Dave Morris - John M O'Donnell - Konstantin Olchanski - Chris Pearson - Renee Poutissou
- Tamsen Schurman - Andreas Suter - Jan M.Wouters - Piotr Adam Zolnierczuk
<hr WIDTH="100%">

