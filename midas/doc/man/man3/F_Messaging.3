.TH "F_Messaging" 3 "31 May 2012" "Version 2.3.0-0" "Midas" \" -*- nroff -*-
.ad l
.nh
.SH NAME
F_Messaging \- Messaging 
 
.PP
.PP

.br
.PP
Any client can produce status or error messages with a single call to \fBcm_msg()\fP using the MIDAS library, e.g. 
.PP
.nf
 status = db_find_key(hDB, 0, '/Equipment/Cycle_scalers/Settings/',&hKey);
  if(status != DB_SUCCESS && status != DB_NO_KEY)
    {
      cm_msg(MERROR, 'begin_of_run', 'error accessing \'/Equipment/Cycle_scalers/Settings/\'  (%d)',status);
      return status;
    }

.fi
.PP
.PP
Depending on the \fBmessage type\fP, these messages are forwarded to any other clients who may be available to receive these messages, as well as to a central \fBMIDAS Log file\fP. The message system is based on the buffer manager scheme, but with a dedicated header to identify the type of message. A dedicated buffer (i.e. shared memory) \fB.SYSMSG.SHM\fP is used to receive and distribute messages.
.PP
\fBTodo\fP
.RS 4
what is .MSG.SHM used for?
.RE
.PP

.br
   Predefined Message Macros contained in the MIDAS library cover most of the message requirements. These Macros compact the 3 first arguments of the \fBcm_msg()\fP call. The Macro replaces the type of message, the routine name and the line number in the C-code. See example in \fBcm_msg()\fP.
.PP
The available message types ( defined in \fBmidas.h\fP ) for use with \fBcm_msg()\fP are:
.IP "\(bu" 2
\fBMERROR\fP : For error (MT_ERROR, __FILE__, __LINE__)
.IP "\(bu" 2
\fBMINFO\fP : For info (MT_INFO, __FILE__, __LINE__)
.IP "\(bu" 2
\fBMDEBUG\fP : For debug (MT_DEBUG, __FILE__, __LINE__)
.IP "\(bu" 2
\fBMUSER\fP : Produced by interactive user (MT_USER, __FILE__, __LINE__)
.IP "\(bu" 2
\fBMLOG\fP : Info message which is only logged (MT_LOG, __FILE__, __LINE__)
.IP "\(bu" 2
\fBMTALK\fP : Info message for speech system (MT_TALK, __FILE__, __LINE__)
.IP "\(bu" 2
\fBMCALL\fP : Info message for telephone call (MT_CALL, __FILE__, __LINE__)
.PP
.PP

.br
  
.PP
 
.SH "MIDAS Log file"
.PP
MIDAS provides a general log file for recording system and user messages across the different components of the data acquisition clients. The default name of this file is \fB'midas.log'\fP, It is not necessary for \fBmlogger\fP to be running for the MIDAS message logging system to work. As soon as any MIDAS application is started, the log file is produced. 
.br
  The location of this file is dependent on the setup of the experiment.
.PP
.IP "\(bu" 2
\fBwith\fP the /Logger tree :
.IP "  \(bu" 4
If the \fB/Logger ODB tree\fP exists (i.e. has been created by \fBmlogger\fP) the message file will be located in the defined directory specified by the key \fB/Logger/Data dir\fP .
.IP "  \(bu" 4
The \fBname\fP of the message file may be changed using the ODB key \fB/Logger/Message File\fP.
.PP

.PP
.PP
.IP "\(bu" 2
\fBwithout\fP the /Logger tree :
.IP "  \(bu" 4
If the ODB /Logger tree does NOT exist , i.e. the MIDAS standard logger \fBmlogger\fP is not being used, then the location of the log file will be in the \fB experiment-specific \fP directory defined by either
.IP "    \(bu" 6
the \fBEnvironment Variable\fP named \fBMIDAS_DIR\fP , or if this not defined,
.IP "    \(bu" 6
the \fBexptab file\fP .
.PP

.PP

.PP
.PP

.br
.PP
The MIDAS log file contains system and user messages generated by any application connected to the given experiment.
.PP
The predefined \fBMIDAS Message macros\fP provide a list of defined messages types.
.PP
.PP
.nf
Fri Mar 24 10:48:40 2000 [CHAOS] Run 8362 started
Fri Mar 24 10:48:40 2000 [Logger] Run #8362 started
Fri Mar 24 10:55:04 2000 [Lazy_Tape] cni-043[10] (cp:383.6s) /dev/nst0/run08360.ybs 849.896MB file NEW
Fri Mar 24 11:24:03 2000 [MStatus] Program MStatus on host umelba started
Fri Mar 24 11:24:03 2000 [MStatus] Program MStatus on host umelba stopped
Fri Mar 24 11:27:02 2000 [Logger] stopping run after having received 1200000 events
Fri Mar 24 11:27:03 2000 [CHAOS] Run 8362 stopped
Fri Mar 24 11:27:03 2000 [SUSI] saving info in run log
Fri Mar 24 11:27:03 2000 [Logger] Run #8362 stopped
Fri Mar 24 11:27:13 2000 [Logger] starting new run
Fri Mar 24 11:27:14 2000 [CHAOS] Run 8363 started
Fri Mar 24 11:27:14 2000 [CHAOS] odb_access_file -I- /Equipment/kos_trigger/Dump not found
Fri Mar 24 11:27:14 2000 [Logger] Run #8363 started
Fri Mar 24 11:33:47 2000 [Lazy_Tape] cni-043[11] (cp:391.8s) /dev/nst0/run08361.ybs 850.209MB file NEW
Fri Mar 24 11:42:35 2000 [CHAOS] Run 8363 stopped
Fri Mar 24 11:42:40 2000 [SUSI] saving info in run log
Fri Mar 24 11:42:41 2000 [ODBEdit] Run #8363 stopped
Fri Mar 24 12:19:57 2000 [MChart] client [umelba.Triumf.CA]MChart failed watchdog test after 10 sec
Fri Mar 24 12:19:57 2000 [MChart] Program MChart on host koslx0 stopped
.fi
.PP
 
.br
 
.br
 
.PP
 
.SH "m[lx]speaker - audible messaging"
.PP
\fBmspeaker\fP, mlxspeaker are utilities which listen to the MIDAS messages system and pipe these messages to a speech synthesizer application. \fBmspeaker\fP is for the Windows based system and interface to the \fCFirstByte/ProVoice package\fP. The \fBmlxspeaker\fP is for the Linux based system and interface to the \fCFestival\fP speech synthesis package.
.PP
If either package is used, the speech synthesis system has to be installed prior to the activation of the \fBmspeaker\fP, or \fBmlxspeaker\fP utilities.
.PP
.IP "\(bu" 2
\fB Arguments \fP
.IP "  \(bu" 4
[-h ] : help
.IP "  \(bu" 4
[-h hostname ] : host name
.IP "  \(bu" 4
[-e exptname ] : experiment name
.IP "  \(bu" 4
[-t mt_talk_cmd] : Specify the talk alert command (ux only).
.IP "  \(bu" 4
[-u mt_user_cmd] : Specify the user alert command (ux only).
.IP "  \(bu" 4
[-s shut up time]: Specify the min time interval between alert [s] The -t & -u switch require a command equivalent to: '-t play --volume=0.3 file.wav'
.IP "  \(bu" 4
[-D ] : start program as a daemon
.PP

.PP
.PP
.IP "\(bu" 2
\fB Usage \fP 
.PP
.nf
> mlxspeaker -D

.fi
.PP

.PP
.PP
.PP
 
